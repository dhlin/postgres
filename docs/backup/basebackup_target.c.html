<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>backup/basebackup_target.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>backup/basebackup_target.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L53">BaseBackupTargetTypeList</a></li>
<li><a href="#L40">builtin_backup_targets</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L28">BaseBackupTargetHandle</a></li>
<li><a href="#L21">BaseBackupTargetType</a></li>
<li><a href="#L26">BaseBackupTargetType</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L61">BaseBackupAddTarget</a></li>
<li><a href="#L163">BaseBackupGetSink</a></li>
<li><a href="#L117">BaseBackupGetTargetHandle</a></li>
<li><a href="#L194">blackhole_get_sink</a></li>
<li><a href="#L172">initialize_target_list</a></li>
<li><a href="#L213">reject_target_detail</a></li>
<li><a href="#L232">server_check_detail</a></li>
<li><a href="#L203">server_get_sink</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * basebackup_target.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Base backups can be &quot;targeted&quot;, which means that they can be sent<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; somewhere other than to the client which requested the backup.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Furthermore, new targets can be defined by extensions. This file<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; contains code to support that functionality.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 2010-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/backup/basebackup_target.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;backup/basebackup_target.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/memutils.h&quot;<br/></li>
<li></span><br/></li>
<li><a id="L21">&#x200c;</a><span class="Type">typedef</span> <span class="Type">struct</span> <span class="linkable">BaseBackupTargetType</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *name;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp;&nbsp; *(*check_detail) (<span class="Type">char</span> *, <span class="Type">char</span> *);<br/></li>
<li>&nbsp; &nbsp; bbsink&nbsp; &nbsp; &nbsp;&nbsp; *(*get_sink) (bbsink *, <span class="Type">void</span> *);<br/></li>
<li><a id="L26">&#x200c;</a>} <span class="linkable">BaseBackupTargetType</span>;<br/></li>
<li><br/></li>
<li><a id="L28">&#x200c;</a><span class="Type">struct</span> <span class="linkable">BaseBackupTargetHandle</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L21" title="backup/basebackup_target.c:21">BaseBackupTargetType</a> *type;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp;&nbsp; *detail_arg;<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L172" title="backup/basebackup_target.c:172">initialize_target_list</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">static</span> bbsink *<a href="#L194" title="backup/basebackup_target.c:194">blackhole_get_sink</a>(bbsink *next_sink, <span class="Type">void</span> *detail_arg);<br/></li>
<li><span class="Type">static</span> bbsink *<a href="#L203" title="backup/basebackup_target.c:203">server_get_sink</a>(bbsink *next_sink, <span class="Type">void</span> *detail_arg);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<a href="#L213" title="backup/basebackup_target.c:213">reject_target_detail</a>(<span class="Type">char</span> *target, <span class="Type">char</span> *target_detail);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<a href="#L232" title="backup/basebackup_target.c:232">server_check_detail</a>(<span class="Type">char</span> *target, <span class="Type">char</span> *target_detail);<br/></li>
<li><br/></li>
<li><a id="L40">&#x200c;</a><span class="Type">static</span> <a href="#L21" title="backup/basebackup_target.c:21">BaseBackupTargetType</a> <span class="linkable">builtin_backup_targets</span>[] =<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;blackhole&quot;</span>, <a href="#L213" title="backup/basebackup_target.c:213">reject_target_detail</a>, <a href="#L194" title="backup/basebackup_target.c:194">blackhole_get_sink</a><br/></li>
<li>&nbsp; &nbsp; },<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;server&quot;</span>, <a href="#L232" title="backup/basebackup_target.c:232">server_check_detail</a>, <a href="#L203" title="backup/basebackup_target.c:203">server_get_sink</a><br/></li>
<li>&nbsp; &nbsp; },<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><a id="L53">&#x200c;</a><span class="Type">static</span> List *<span class="linkable">BaseBackupTargetTypeList</span> = NIL;<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Add a new base backup target type.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This is intended for use by server extensions.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L61">&#x200c;</a></span><span class="linkable">BaseBackupAddTarget</span>(<span class="Type">char</span> *name,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">void</span> *(*check_detail) (<span class="Type">char</span> *, <span class="Type">char</span> *),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bbsink *(*get_sink) (bbsink *, <span class="Type">void</span> *))<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L21" title="backup/basebackup_target.c:21">BaseBackupTargetType</a> *newtype;<br/></li>
<li>&nbsp; &nbsp; MemoryContext oldcontext;<br/></li>
<li>&nbsp; &nbsp; ListCell&nbsp;&nbsp; *lc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If the target list is not yet initialized, do that first. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a> == NIL)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L172" title="backup/basebackup_target.c:172">initialize_target_list</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Search the target type list for an existing entry with this name. */<br/></li>
<li></span>&nbsp; &nbsp; foreach(lc, <a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L21" title="backup/basebackup_target.c:21">BaseBackupTargetType</a> *ttype = lfirst(lc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(ttype-&gt;name, name) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We found one, so update it.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * It is probably not a great idea to call <a href="#L61" title="backup/basebackup_target.c:61">BaseBackupAddTarget</a> for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the same name multiple times, but if it happens, this seems<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * like the sanest behavior.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ttype-&gt;check_detail = check_detail;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ttype-&gt;get_sink = get_sink;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We use <a href="../utils/mmgr/mcxt.c.html#L149" title="utils/mmgr/mcxt.c:149">TopMemoryContext</a> for allocations here to make sure that the data<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * we need doesn't vanish under us; that's also why we copy the target<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * name into a newly-allocated chunk of memory.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; oldcontext = MemoryContextSwitchTo(<a href="../utils/mmgr/mcxt.c.html#L149" title="utils/mmgr/mcxt.c:149">TopMemoryContext</a>);<br/></li>
<li>&nbsp; &nbsp; newtype = <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L21" title="backup/basebackup_target.c:21">BaseBackupTargetType</a>));<br/></li>
<li>&nbsp; &nbsp; newtype-&gt;name = <a href="../utils/mmgr/mcxt.c.html#L1695" title="utils/mmgr/mcxt.c:1695">pstrdup</a>(name);<br/></li>
<li>&nbsp; &nbsp; newtype-&gt;check_detail = check_detail;<br/></li>
<li>&nbsp; &nbsp; newtype-&gt;get_sink = get_sink;<br/></li>
<li>&nbsp; &nbsp; <a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a> = <a href="../nodes/list.c.html#L339" title="nodes/list.c:339">lappend</a>(<a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a>, newtype);<br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(oldcontext);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Look up a base backup target and validate the target_detail.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Extensions that define new backup targets will probably define a new<br/></li>
<li></span><span class="Comment"> * type of bbsink to match. Validation of the target_detail can be performed<br/></li>
<li></span><span class="Comment"> * either in the check_detail routine called here, or in the bbsink<br/></li>
<li></span><span class="Comment"> * constructor, which will be called from <a href="#L163" title="backup/basebackup_target.c:163">BaseBackupGetSink</a>. It's mostly<br/></li>
<li></span><span class="Comment"> * a matter of taste, but the check_detail function runs somewhat earlier.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><a href="#L28" title="backup/basebackup_target.c:28">BaseBackupTargetHandle</a> *<br/></li>
<li><a id="L117">&#x200c;</a><span class="linkable">BaseBackupGetTargetHandle</span>(<span class="Type">char</span> *target, <span class="Type">char</span> *target_detail)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; ListCell&nbsp;&nbsp; *lc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If the target list is not yet initialized, do that first. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a> == NIL)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L172" title="backup/basebackup_target.c:172">initialize_target_list</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Search the target type list for a match. */<br/></li>
<li></span>&nbsp; &nbsp; foreach(lc, <a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L21" title="backup/basebackup_target.c:21">BaseBackupTargetType</a> *ttype = lfirst(lc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(ttype-&gt;name, target) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L28" title="backup/basebackup_target.c:28">BaseBackupTargetHandle</a> *handle;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Found the target. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; handle = <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L28" title="backup/basebackup_target.c:28">BaseBackupTargetHandle</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; handle-&gt;type = ttype;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; handle-&gt;detail_arg = ttype-&gt;check_detail(target, target_detail);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> handle;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Did not <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> the target. */<br/></li>
<li></span>&nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;unrecognized target: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, target)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* keep compiler quiet */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Construct a bbsink that will implement the backup target.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The get_sink function does all the real work, so all we have to do here<br/></li>
<li></span><span class="Comment"> * is call it with the correct arguments. Whatever the check_detail function<br/></li>
<li></span><span class="Comment"> * returned is here passed through to the get_sink function. This lets those<br/></li>
<li></span><span class="Comment"> * two <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> communicate with each other, if they wish. If not, the<br/></li>
<li></span><span class="Comment"> * check_detail function can simply return the target_detail and let the<br/></li>
<li></span><span class="Comment"> * get_sink function take it from there.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>bbsink *<br/></li>
<li><a id="L163">&#x200c;</a><span class="linkable">BaseBackupGetSink</span>(<a href="#L28" title="backup/basebackup_target.c:28">BaseBackupTargetHandle</a> *handle, bbsink *next_sink)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> handle-&gt;type-&gt;get_sink(next_sink, handle-&gt;detail_arg);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Load predefined target types into <a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L172">&#x200c;</a></span><span class="linkable">initialize_target_list</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L21" title="backup/basebackup_target.c:21">BaseBackupTargetType</a> *ttype = <a href="#L40" title="backup/basebackup_target.c:40">builtin_backup_targets</a>;<br/></li>
<li>&nbsp; &nbsp; MemoryContext oldcontext;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; oldcontext = MemoryContextSwitchTo(<a href="../utils/mmgr/mcxt.c.html#L149" title="utils/mmgr/mcxt.c:149">TopMemoryContext</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (ttype-&gt;name != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a> = <a href="../nodes/list.c.html#L339" title="nodes/list.c:339">lappend</a>(<a href="#L53" title="backup/basebackup_target.c:53">BaseBackupTargetTypeList</a>, ttype);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ++ttype;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(oldcontext);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Normally, a get_sink function should construct and return a new bbsink that<br/></li>
<li></span><span class="Comment"> * implements the backup target, but the 'blackhole' target just throws the<br/></li>
<li></span><span class="Comment"> * data away. We could implement that by adding a bbsink that does nothing<br/></li>
<li></span><span class="Comment"> * but forward, but it's even cheaper to implement that by not adding a bbsink<br/></li>
<li></span><span class="Comment"> * at all.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> bbsink *<br/></li>
<li><a id="L194">&#x200c;</a><span class="linkable">blackhole_get_sink</span>(bbsink *next_sink, <span class="Type">void</span> *detail_arg)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> next_sink;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Create a bbsink implementing a server-side backup.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> bbsink *<br/></li>
<li><a id="L203">&#x200c;</a><span class="linkable">server_get_sink</span>(bbsink *next_sink, <span class="Type">void</span> *detail_arg)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="basebackup_server.c.html#L60" title="backup/basebackup_server.c:60">bbsink_server_new</a>(next_sink, detail_arg);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Implement target-detail checking for a target that does not <a href="../port/win32/socket.c.html#L34" title="port/win32/socket.c:34">accept</a> a<br/></li>
<li></span><span class="Comment"> * detail.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void</span> *<br/></li>
<li><a id="L213">&#x200c;</a><span class="linkable">reject_target_detail</span>(<span class="Type">char</span> *target, <span class="Type">char</span> *target_detail)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (target_detail != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;target </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> does not <a href="../port/win32/socket.c.html#L34" title="port/win32/socket.c:34">accept</a> a target detail&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; target)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Implement target-detail checking for a server-side backup.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * target_detail should be the name of the directory to which the backup<br/></li>
<li></span><span class="Comment"> * should be written, but we don't check that here. Rather, that check,<br/></li>
<li></span><span class="Comment"> * as well as the necessary permissions checking, happens in <a href="basebackup_server.c.html#L60" title="backup/basebackup_server.c:60">bbsink_server_new</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void</span> *<br/></li>
<li><a id="L232">&#x200c;</a><span class="linkable">server_check_detail</span>(<span class="Type">char</span> *target, <span class="Type">char</span> *target_detail)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (target_detail == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;target </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> requires a target detail&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; target)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> target_detail;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
