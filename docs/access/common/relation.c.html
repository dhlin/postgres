<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>access/common/relation.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>access/common/relation.c - pgsql17devel-backend</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L205">relation_close</a></li>
<li><a href="#L47">relation_open</a></li>
<li><a href="#L137">relation_openrv</a></li>
<li><a href="#L172">relation_openrv_extended</a></li>
<li><a href="#L88">try_relation_open</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * relation.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Generic relation related routines.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/access/common/relation.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * NOTES<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; This file contains relation_ routines that implement access to relations<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; (tables, indexes, etc). Support that's specific to subtypes of relations<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; should go into their respective files, not here.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;access/relation.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/xact.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/namespace.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;pgstat.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/lmgr.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/inval.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/syscache.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L47" title="access/common/relation.c:47">relation_open</a> - open <a href="../../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> relation by relation OID<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; If lockmode is not &quot;NoLock&quot;, the specified kind of lock is<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; obtained on the relation.&nbsp; (Generally, NoLock should only be<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; used if the caller knows it has some appropriate lock on the<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; relation already.)<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; An error is raised if the relation does not exist.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; NB: a &quot;relation&quot; is anything with a pg_class entry.&nbsp; The caller is<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; expected to check whether the relkind is something it can handle.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Relation<br/></li>
<li><a id="L47">&#x200c;</a><span class="linkable">relation_open</span>(Oid relationId, LOCKMODE lockmode)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Relation&nbsp; &nbsp; r;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(lockmode &gt;= NoLock &amp;&amp; lockmode &lt; MAX_LOCKMODES);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Get the lock <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> trying to open the relcache entry */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (lockmode != NoLock)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../storage/lmgr/lmgr.c.html#L108" title="storage/lmgr/lmgr.c:108">LockRelationOid</a>(relationId, lockmode);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* The relcache does all the real work... */<br/></li>
<li></span>&nbsp; &nbsp; r = <a href="../../utils/cache/relcache.c.html#L2062" title="utils/cache/relcache.c:2062">RelationIdGetRelation</a>(relationId);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!RelationIsValid(r))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;could not open relation with OID </span><span class="Special">%u</span><span class="Constant">&quot;</span>, relationId);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If we didn't get the lock ourselves, assert that caller holds one,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * except in bootstrap mode where no locks are used.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; Assert(lockmode != NoLock ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; IsBootstrapProcessingMode() ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../../storage/lmgr/lmgr.c.html#L330" title="storage/lmgr/lmgr.c:330">CheckRelationLockedByMe</a>(r, AccessShareLock, <span class="Constant">true</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Make note that we've accessed a temporary relation */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (RelationUsesLocalBuffers(r))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../transam/xact.c.html#L134" title="access/transam/xact.c:134">MyXactFlags</a> |= XACT_FLAGS_ACCESSEDTEMPNAMESPACE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../utils/activity/pgstat_relation.c.html#L92" title="utils/activity/pgstat_relation.c:92">pgstat_init_relation</a>(r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> r;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="access/common/relation.c:88">try_relation_open</a> - open <a href="../../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> relation by relation OID<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Same as <a href="#L47" title="access/common/relation.c:47">relation_open</a>, except return NULL instead of failing<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; if the relation does not exist.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Relation<br/></li>
<li><a id="L88">&#x200c;</a><span class="linkable">try_relation_open</span>(Oid relationId, LOCKMODE lockmode)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Relation&nbsp; &nbsp; r;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(lockmode &gt;= NoLock &amp;&amp; lockmode &lt; MAX_LOCKMODES);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Get the lock first */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (lockmode != NoLock)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../storage/lmgr/lmgr.c.html#L108" title="storage/lmgr/lmgr.c:108">LockRelationOid</a>(relationId, lockmode);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Now that we have the lock, probe to see if the relation really exists<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * or not.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!SearchSysCacheExists1(RELOID, ObjectIdGetDatum(relationId)))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Release useless lock */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lockmode != NoLock)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../storage/lmgr/lmgr.c.html#L227" title="storage/lmgr/lmgr.c:227">UnlockRelationOid</a>(relationId, lockmode);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Should be safe to do a relcache load */<br/></li>
<li></span>&nbsp; &nbsp; r = <a href="../../utils/cache/relcache.c.html#L2062" title="utils/cache/relcache.c:2062">RelationIdGetRelation</a>(relationId);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!RelationIsValid(r))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;could not open relation with OID </span><span class="Special">%u</span><span class="Constant">&quot;</span>, relationId);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If we didn't get the lock ourselves, assert that caller holds one */<br/></li>
<li></span>&nbsp; &nbsp; Assert(lockmode != NoLock ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../../storage/lmgr/lmgr.c.html#L330" title="storage/lmgr/lmgr.c:330">CheckRelationLockedByMe</a>(r, AccessShareLock, <span class="Constant">true</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Make note that we've accessed a temporary relation */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (RelationUsesLocalBuffers(r))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../transam/xact.c.html#L134" title="access/transam/xact.c:134">MyXactFlags</a> |= XACT_FLAGS_ACCESSEDTEMPNAMESPACE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../utils/activity/pgstat_relation.c.html#L92" title="utils/activity/pgstat_relation.c:92">pgstat_init_relation</a>(r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> r;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L137" title="access/common/relation.c:137">relation_openrv</a> - open <a href="../../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> relation specified by a RangeVar<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Same as <a href="#L47" title="access/common/relation.c:47">relation_open</a>, but the relation is specified by a RangeVar.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Relation<br/></li>
<li><a id="L137">&#x200c;</a><span class="linkable">relation_openrv</span>(<span class="Type">const</span> RangeVar *relation, LOCKMODE lockmode)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; relOid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Check for shared-cache-inval messages <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> trying to open the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * relation.&nbsp; This is needed even if we already hold a lock on the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * relation, because GRANT/REVOKE are executed without taking <a href="../../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> lock on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the target relation, and we want to be sure we see current ACL<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * information.&nbsp; We can <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> this if asked for NoLock, on the assumption<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * that such a call is not the first one in the current command, and so we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * should be reasonably up-to-date already.&nbsp; (</span><span class="Todo">XXX</span><span class="Comment"> this all could stand to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * be redesigned, but for the moment we'll keep doing this like it's been<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * done historically.)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (lockmode != NoLock)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../utils/cache/inval.c.html#L806" title="utils/cache/inval.c:806">AcceptInvalidationMessages</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Look up and lock the appropriate relation using namespace search */<br/></li>
<li></span>&nbsp; &nbsp; relOid = RangeVarGetRelid(relation, lockmode, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Let <a href="#L47" title="access/common/relation.c:47">relation_open</a> do the rest */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L47" title="access/common/relation.c:47">relation_open</a>(relOid, NoLock);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L172" title="access/common/relation.c:172">relation_openrv_extended</a> - open <a href="../../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> relation specified by a RangeVar<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Same as <a href="#L137" title="access/common/relation.c:137">relation_openrv</a>, but with an additional missing_ok argument<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; allowing a NULL return rather than an error if the relation is not<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; found.&nbsp; (Note that some other causes, such as permissions problems,<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; will still result in an ereport.)<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Relation<br/></li>
<li><a id="L172">&#x200c;</a><span class="linkable">relation_openrv_extended</span>(<span class="Type">const</span> RangeVar *relation, LOCKMODE lockmode,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type"><a href="../../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> missing_ok)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; relOid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Check for shared-cache-inval messages <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> trying to open the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * relation.&nbsp; See comments in <a href="#L137" title="access/common/relation.c:137">relation_openrv</a>().<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (lockmode != NoLock)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../utils/cache/inval.c.html#L806" title="utils/cache/inval.c:806">AcceptInvalidationMessages</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Look up and lock the appropriate relation using namespace search */<br/></li>
<li></span>&nbsp; &nbsp; relOid = RangeVarGetRelid(relation, lockmode, missing_ok);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Return NULL on not-found */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(relOid))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Let <a href="#L47" title="access/common/relation.c:47">relation_open</a> do the rest */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L47" title="access/common/relation.c:47">relation_open</a>(relOid, NoLock);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L205" title="access/common/relation.c:205">relation_close</a> - close <a href="../../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> relation<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; If lockmode is not &quot;NoLock&quot;, we then release the specified lock.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Note that it is often sensible to hold a lock beyond <a href="#L205" title="access/common/relation.c:205">relation_close</a>;<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; in that case, the lock is released automatically at xact end.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L205">&#x200c;</a></span><span class="linkable">relation_close</span>(Relation relation, LOCKMODE lockmode)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; LockRelId&nbsp; &nbsp; relid = relation-&gt;rd_lockInfo.lockRelId;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(lockmode &gt;= NoLock &amp;&amp; lockmode &lt; MAX_LOCKMODES);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* The relcache does the real work... */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../utils/cache/relcache.c.html#L2193" title="utils/cache/relcache.c:2193">RelationClose</a>(relation);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (lockmode != NoLock)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../storage/lmgr/lmgr.c.html#L212" title="storage/lmgr/lmgr.c:212">UnlockRelationId</a>(&amp;relid, lockmode);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
