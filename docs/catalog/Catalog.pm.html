<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>catalog/Catalog.pm - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>catalog/Catalog.pm - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L394">AddDefaultValues</a></li>
<li><a href="#L574">FindAllOidsFromHeaders</a></li>
<li><a href="#L531">FindDefinedSymbol</a></li>
<li><a href="#L557">FindDefinedSymbolFromData</a></li>
<li><a href="#L445">GenerateArrayTypes</a></li>
<li><a href="#L308">ParseData</a></li>
<li><a href="#L24">ParseHeader</a></li>
<li><a href="#L511">RenameTempFile</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">#----------------------------------------------------------------------<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Catalog.pm<br/></li>
<li></span><span class="Comment">#&nbsp; &nbsp; Perl module that extracts info from catalog files into Perl<br/></li>
<li></span><span class="Comment">#&nbsp; &nbsp; data structures<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># src/backend/catalog/Catalog.pm<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment">#----------------------------------------------------------------------<br/></li>
<li></span><br/></li>
<li><span class="Statement">package</span><span class="Type"> Catalog</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">use strict</span>;<br/></li>
<li><span class="Statement">use warnings</span> <span class="Constant">FATAL</span> =&gt; <span class="Constant">'all'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">use </span>File::Compare;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># Parses a catalog header file into a data structure describing the schema<br/></li>
<li></span><span class="Comment"># of the catalog.<br/></li>
<li><a id="L24">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">ParseHeader</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$input_file</span> = <span class="Statement">shift</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># There are a few types which are given one name in the C source, but a<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># different name at the SQL level.&nbsp; These are enumerated here.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%RENAME_ATTTYPE</span> = (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'int16'</span> =&gt; <span class="Constant">'int2'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'int32'</span> =&gt; <span class="Constant">'int4'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'int64'</span> =&gt; <span class="Constant">'int8'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'Oid'</span> =&gt; <span class="Constant">'oid'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'NameData'</span> =&gt; <span class="Constant">'name'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'TransactionId'</span> =&gt; <span class="Constant">'xid'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'XLogRecPtr'</span> =&gt; <span class="Constant">'pg_lsn'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%catalog</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$declaring_attributes</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$is_varlen</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$is_client_code</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">columns</span><span class="Identifier">}</span> = [];<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">toasting</span><span class="Identifier">}</span> = [];<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">indexing</span><span class="Identifier">}</span> = [];<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">other_oids</span><span class="Identifier">}</span> = [];<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">foreign_keys</span><span class="Identifier">}</span> = [];<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">client_code</span><span class="Identifier">}</span> = [];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">open</span>(<span class="Statement">my</span> <span class="Identifier">$ifh</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$input_file</span>) || <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$input_file</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Scan the input file.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (&lt;<span class="Identifier">$ifh</span>&gt;)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Set appropriate flag when we're in certain code sections.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^#</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$is_varlen</span> = <span class="Constant">1</span> <span class="Statement">if</span> <span class="Statement">/</span><span class="Constant">^#ifdef</span><span class="Special">\s+</span><span class="Constant">CATALOG_VARLEN</span><span class="Statement">/</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^#ifdef</span><span class="Special">\s+</span><span class="Constant">EXPOSE_TO_CLIENT_CODE</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$is_client_code</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> !<span class="Identifier">$is_client_code</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Identifier">$is_client_code</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Strip C-style comments.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">s;</span><span class="Constant">/</span><span class="Special">\*(.</span><span class="Constant">|</span><span class="Special">\n)*\*</span><span class="Constant">/</span><span class="Statement">;;g</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">m;</span><span class="Constant">/</span><span class="Special">\*</span><span class="Statement">;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># handle multi-line comments properly.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$next_line</span> = &lt;<span class="Identifier">$ifh</span>&gt;;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$input_file</span><span class="Constant">: ends within C-style comment</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> !<span class="Statement">defined</span> <span class="Identifier">$next_line</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$_</span> .= <span class="Identifier">$next_line</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">redo</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Strip useless whitespace and trailing semicolons.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">chomp</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">s/</span><span class="Constant">^</span><span class="Special">\s+</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">s/</span><span class="Constant">;</span><span class="Special">\s*</span><span class="Constant">$</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">s/</span><span class="Special">\s+</span><span class="Statement">/</span><span class="Constant"> </span><span class="Statement">/g</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Push the data into the appropriate data structure.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Caution: when adding new recognized OID-defining macros,<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># also update src/include/catalog/renumber_oids.pl.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^DECLARE_TOAST</span><span class="Special">\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;parent_table&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;toast_oid&gt;</span><span class="Special">\d+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;toast_index_oid&gt;</span><span class="Special">\d+)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">toasting</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, {<span class="Identifier">%+</span>};<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^DECLARE_TOAST_WITH_MACRO</span><span class="Special">\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;parent_table&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;toast_oid&gt;</span><span class="Special">\d+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;toast_index_oid&gt;</span><span class="Special">\d+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;toast_oid_macro&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;toast_index_oid_macro&gt;</span><span class="Special">\w+)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">toasting</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, {<span class="Identifier">%+</span>};<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^DECLARE_</span><span class="Special">(</span><span class="Constant">UNIQUE_</span><span class="Special">)?</span><span class="Constant">INDEX</span><span class="Special">(</span><span class="Constant">_PKEY</span><span class="Special">)?\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;index_name&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;index_oid&gt;</span><span class="Special">\d+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;index_oid_macro&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;table_name&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;index_decl&gt;</span><span class="Special">.+)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">indexing</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">is_unique</span> =&gt; <span class="Identifier">$1</span> ? <span class="Constant">1</span> : <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">is_pkey</span> =&gt; <span class="Identifier">$2</span> ? <span class="Constant">1</span> : <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">%+</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^MAKE_SYSCACHE</span><span class="Special">\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;syscache_name&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;index_name&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;syscache_nbuckets&gt;</span><span class="Special">\w+)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">syscaches</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, {<span class="Identifier">%+</span>};<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^DECLARE_OID_DEFINING_MACRO</span><span class="Special">\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;other_name&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;other_oid&gt;</span><span class="Special">\d+)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">other_oids</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, {<span class="Identifier">%+</span>};<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^DECLARE_</span><span class="Special">(</span><span class="Constant">ARRAY_</span><span class="Special">)?</span><span class="Constant">FOREIGN_KEY</span><span class="Special">(</span><span class="Constant">_OPT</span><span class="Special">)?\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\((?</span><span class="Constant">&lt;fk_cols&gt;</span><span class="Special">[^)]+)\)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;pk_table&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\((?</span><span class="Constant">&lt;pk_cols&gt;</span><span class="Special">[^)]+)\)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">foreign_keys</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">is_array</span> =&gt; <span class="Identifier">$1</span> ? <span class="Constant">1</span> : <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">is_opt</span> =&gt; <span class="Identifier">$2</span> ? <span class="Constant">1</span> : <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">%+</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^CATALOG</span><span class="Special">\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;catname&gt;</span><span class="Special">\w+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;relation_oid&gt;</span><span class="Special">\d+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;relation_oid_macro&gt;</span><span class="Special">\w+)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">@catalog{</span><span class="perlVarMember"> </span><span class="Statement">keys</span><span class="perlVarMember"> </span><span class="Identifier">%+</span><span class="perlVarMember"> </span><span class="Identifier">}</span> = <span class="Statement">values</span> <span class="Identifier">%+</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">bootstrap</span><span class="Identifier">}</span> = <span class="Statement">/</span><span class="Constant">BKI_BOOTSTRAP</span><span class="Statement">/</span> ? <span class="Constant">' bootstrap'</span> : <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">shared_relation</span><span class="Identifier">}</span> =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">BKI_SHARED_RELATION</span><span class="Statement">/</span> ? <span class="Constant">' shared_relation'</span> : <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">BKI_ROWTYPE_OID</span><span class="Special">\(\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;rowtype_oid&gt;</span><span class="Special">\d+)</span><span class="Constant">,</span><span class="Special">\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">(?</span><span class="Constant">&lt;rowtype_oid_macro&gt;</span><span class="Special">\w+)\s*<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Special">\)</span><span class="Statement">/x<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">@catalog{</span><span class="perlVarMember"> </span><span class="Statement">keys</span><span class="perlVarMember"> </span><span class="Identifier">%+</span><span class="perlVarMember"> </span><span class="Identifier">}</span> = <span class="Statement">values</span> <span class="Identifier">%+</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">rowtype_oid_clause</span><span class="Identifier">}</span> = <span class="Constant">&quot; rowtype_oid </span><span class="Identifier">$+</span><span class="Constant">{rowtype_oid}&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">rowtype_oid</span><span class="Identifier">}</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">rowtype_oid_clause</span><span class="Identifier">}</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">rowtype_oid_macro</span><span class="Identifier">}</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$catalog{</span><span class="Constant">schema_macro</span><span class="Identifier">}</span> = <span class="Statement">/</span><span class="Constant">BKI_SCHEMA_MACRO</span><span class="Statement">/</span> ? <span class="Constant">1</span> : <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$declaring_attributes</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$is_client_code</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^#endif</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$is_client_code</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">client_code</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, <span class="Identifier">$_</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$declaring_attributes</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^{|^$</span><span class="Statement">/</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^}</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$declaring_attributes</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%column</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@attopts</span> = <span class="Statement">split</span> <span class="Statement">/</span><span class="Special">\s+</span><span class="Statement">/</span>, <span class="Identifier">$_</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$atttype</span> = <span class="Statement">shift</span> <span class="Identifier">@attopts</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$attname</span> = <span class="Statement">shift</span> <span class="Identifier">@attopts</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;parse <a href="../parser/check_keywords.pl.html#L17" title="parser/check_keywords.pl:17">error</a> (</span><span class="Identifier">$input_file</span><span class="Constant">)&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> (<span class="Identifier">$attname</span> <span class="Statement">and</span> <span class="Identifier">$atttype</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">exists</span> <span class="Identifier">$RENAME_ATTTYPE{$atttype}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$atttype</span> = <span class="Identifier">$RENAME_ATTTYPE{$atttype}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># If the C name ends with '[]' or '[digits]', we have<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># an array type, so we discard that from the name and<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># prepend '_' to the type.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$attname</span> =~ <span class="Statement">/</span><span class="Special">(\w+)\[\d*\]</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$attname</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$atttype</span> = <span class="Constant">'_'</span> . <span class="Identifier">$atttype</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">type</span><span class="Identifier">}</span> = <span class="Identifier">$atttype</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">name</span><span class="Identifier">}</span> = <span class="Identifier">$attname</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">is_varlen</span><span class="Identifier">}</span> = <span class="Constant">1</span> <span class="Statement">if</span> <span class="Identifier">$is_varlen</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$attopt</span> (<span class="Identifier">@attopts</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$attopt</span> <span class="Statement">eq</span> <span class="Constant">'BKI_FORCE_NULL'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">forcenull</span><span class="Identifier">}</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attopt</span> <span class="Statement">eq</span> <span class="Constant">'BKI_FORCE_NOT_NULL'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">forcenotnull</span><span class="Identifier">}</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># We use quotes for values like \0 and \054, to<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># make sure all compilers and syntax highlighters<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># can recognize them properly.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attopt</span> =~ <span class="Statement">/</span><span class="Constant">BKI_DEFAULT</span><span class="Special">\(['&quot;]?([^'&quot;]+)['&quot;]?\)</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">default</span><span class="Identifier">}</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$attopt</span> =~ <span class="Statement">/</span><span class="Constant">BKI_ARRAY_DEFAULT</span><span class="Special">\(['&quot;]?([^'&quot;]+)['&quot;]?\)</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">array_default</span><span class="Identifier">}</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attopt</span> =~ <span class="Statement">/</span><span class="Constant">BKI_LOOKUP</span><span class="Special">(</span><span class="Constant">_OPT</span><span class="Special">)?\((\w+)\)</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">lookup</span><span class="Identifier">}</span> = <span class="Identifier">$2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$column{</span><span class="Constant">lookup_opt</span><span class="Identifier">}</span> = <span class="Identifier">$1</span> ? <span class="Constant">1</span> : <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># BKI_LOOKUP implicitly makes an FK reference<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">foreign_keys</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">is_array</span> =&gt; (<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$atttype</span> <span class="Statement">eq</span> <span class="Constant">'oidvector'</span> || <span class="Identifier">$atttype</span> <span class="Statement">eq</span> <span class="Constant">'_oid'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">is_opt</span> =&gt; <span class="Identifier">$column{</span><span class="Constant">lookup_opt</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">fk_cols</span> =&gt; <span class="Identifier">$attname</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">pk_table</span> =&gt; <span class="Identifier">$column{</span><span class="Constant">lookup</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">pk_cols</span> =&gt; <span class="Constant">'oid'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;unknown or misformatted column option </span><span class="Identifier">$attopt</span><span class="Constant"> on column </span><span class="Identifier">$attname</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$column{</span><span class="Constant">forcenull</span><span class="Identifier">}</span> <span class="Statement">and</span> <span class="Identifier">$column{</span><span class="Constant">forcenotnull</span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$attname</span><span class="Constant"> is forced both null and not null&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog{</span><span class="Constant">columns</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, \<span class="Identifier">%column</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$ifh</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> \<span class="Identifier">%catalog</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Parses a file containing Perl data structure literals, returning live data.<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># The parameter $preserve_comments needs to be set for callers that want<br/></li>
<li></span><span class="Comment"># to work with non-data lines in the data files, such as comments and blank<br/></li>
<li></span><span class="Comment"># lines. If a caller just wants to consume the data, leave it unset.<br/></li>
<li></span><span class="Comment"># (When requested, non-data lines will be returned as array entries that<br/></li>
<li></span><span class="Comment"># are strings not hashes, so extra code is needed to deal with that.)<br/></li>
<li><a id="L308">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">ParseData</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$input_file</span>, <span class="Identifier">$schema</span>, <span class="Identifier">$preserve_comments</span>) = <span class="Identifier">@_</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">open</span>(<span class="Statement">my</span> <span class="Identifier">$ifd</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$input_file</span>) || <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$input_file</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$input_file</span> =~ <span class="Statement">/</span><span class="Special">(\w+)\.</span><span class="Constant">dat$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Input file </span><span class="Identifier">$input_file</span><span class="Constant"> needs to be a .dat file.</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$catname</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$data</span> = [];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Scan the input file.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (&lt;<span class="Identifier">$ifd</span>&gt;)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$hash_ref</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">{</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Capture the hash ref<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># NB: Assumes that the next hash ref can't start on the<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># same line where the present one ended.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Not foolproof, but we shouldn't need a full parser,<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># since we expect relatively well-behaved input.<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Quick hack to detect when we have a full hash ref to<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># parse. We can't just use a regex because of values in<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># pg_aggregate and pg_proc like '{0,0}'.&nbsp; This will need<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># work if we ever need to allow unbalanced braces within<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># a field value.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$lcnt</span> = <span class="Statement">tr/</span><span class="Constant">{</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$rcnt</span> = <span class="Statement">tr/</span><span class="Constant">}</span><span class="Statement">//</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$lcnt</span> == <span class="Identifier">$rcnt</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># We're treating the input line as a piece of Perl, so we<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># need to use string eval here. Tell perlcritic we know what<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># we're doing.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">eval</span> <span class="Constant">&quot;</span><span class="Special">\$</span><span class="Constant">hash_ref = </span><span class="Identifier">$_</span><span class="Constant">&quot;</span>; <span class="Comment">## no critic (ProhibitStringyEval)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Statement">ref</span> <span class="Identifier">$hash_ref</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$input_file</span><span class="Constant">: <a href="../parser/check_keywords.pl.html#L17" title="parser/check_keywords.pl:17">error</a> parsing line </span><span class="Identifier">$.</span><span class="Constant">:</span><span class="Special">\n</span><span class="Identifier">$_</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Annotate each hash with the source line number.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$hash_ref-&gt;{</span><span class="Constant">line_number</span><span class="Identifier">}</span> = <span class="Identifier">$.</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Expand tuples to their full representation.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L394" title="catalog/Catalog.pm:394">AddDefaultValues</a>(<span class="Identifier">$hash_ref</span>, <span class="Identifier">$schema</span>, <span class="Identifier">$catname</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$next_line</span> = &lt;<span class="Identifier">$ifd</span>&gt;;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$input_file</span><span class="Constant">: file ends within Perl hash</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> !<span class="Statement">defined</span> <span class="Identifier">$next_line</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$_</span> .= <span class="Identifier">$next_line</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">redo</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># If we found a hash reference, keep it, unless it is marked as<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># autogenerated; in that case it'd duplicate an entry we'll<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># autogenerate below.&nbsp; (This makes it safe for reformat_dat_file.pl<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># with --full-tuples to print autogenerated entries, which seems like<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># useful behavior for debugging.)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">#<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Otherwise, we have a non-data string, which we keep only if<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># the caller requested it.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$hash_ref</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@$data</span>, <span class="Identifier">$hash_ref</span> <span class="Statement">if</span> !<span class="Identifier">$hash_ref-&gt;{</span><span class="Constant">autogenerated</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@$data</span>, <span class="Identifier">$_</span> <span class="Statement">if</span> <span class="Identifier">$preserve_comments</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$ifd</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># If this is pg_type, auto-generate array types too.<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L445" title="catalog/Catalog.pm:445">GenerateArrayTypes</a>(<span class="Identifier">$schema</span>, <span class="Identifier">$data</span>) <span class="Statement">if</span> <span class="Identifier">$catname</span> <span class="Statement">eq</span> <span class="Constant">'pg_type'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Identifier">$data</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Fill in default values of a record using the given schema.<br/></li>
<li></span><span class="Comment"># It's the caller's responsibility to specify other values beforehand.<br/></li>
<li><a id="L394">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">AddDefaultValues</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$row</span>, <span class="Identifier">$schema</span>, <span class="Identifier">$catname</span>) = <span class="Identifier">@_</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@missing_fields</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Compute special-case column values.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># Note: If you add new cases here, you must also teach<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># strip_default_values() in include/catalog/reformat_dat_file.pl<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># to delete them.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$catname</span> <span class="Statement">eq</span> <span class="Constant">'pg_proc'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># pg_proc.pronargs can be derived from proargtypes.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$row-&gt;{</span><span class="Constant">proargtypes</span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@proargtypes</span> = <span class="Statement">split</span> <span class="Statement">/</span><span class="Special">\s+</span><span class="Statement">/</span>, <span class="Identifier">$row-&gt;{</span><span class="Constant">proargtypes</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$row-&gt;{</span><span class="Constant">pronargs</span><span class="Identifier">}</span> = <span class="Statement">scalar</span>(<span class="Identifier">@proargtypes</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Now fill in defaults, and note any columns that remain undefined.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$column</span> (<span class="Identifier">@$schema</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$attname</span> = <span class="Identifier">$column-&gt;{</span><span class="Constant">name</span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># No work if field already has a value.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Statement">defined</span> <span class="Identifier">$row-&gt;{$attname}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Ignore 'oid' columns, they're handled elsewhere.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$attname</span> <span class="Statement">eq</span> <span class="Constant">'oid'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># If column has a default value, fill that in.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$column-&gt;{</span><span class="Constant">default</span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$row-&gt;{$attname}</span> = <span class="Identifier">$column-&gt;{</span><span class="Constant">default</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Failed to find a value for this field.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@missing_fields</span>, <span class="Identifier">$attname</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Failure to provide all columns is a hard <a href="../parser/check_keywords.pl.html#L17" title="parser/check_keywords.pl:17">error</a>.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">@missing_fields</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Statement">sprintf</span> <span class="Constant">&quot;missing values for field(s) %s in %s.dat line %s</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">join</span>(<span class="Constant">', '</span>, <span class="Identifier">@missing_fields</span>), <span class="Identifier">$catname</span>, <span class="Identifier">$row-&gt;{</span><span class="Constant">line_number</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># If a pg_type entry has an array_type_oid metadata field,<br/></li>
<li></span><span class="Comment"># auto-generate an entry for its array type.<br/></li>
<li><a id="L445">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">GenerateArrayTypes</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$pgtype_schema</span> = <span class="Statement">shift</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$types</span> = <span class="Statement">shift</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@array_types</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$elem_type</span> (<span class="Identifier">@$types</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> !(<span class="Statement">ref</span> <span class="Identifier">$elem_type</span> <span class="Statement">eq</span> <span class="Constant">'HASH'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> !<span class="Statement">defined</span>(<span class="Identifier">$elem_type-&gt;{</span><span class="Constant">array_type_oid</span><span class="Identifier">}</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%array_type</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Set up metadata fields for array type.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{</span><span class="Constant">oid</span><span class="Identifier">}</span> = <span class="Identifier">$elem_type-&gt;{</span><span class="Constant">array_type_oid</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{</span><span class="Constant">autogenerated</span><span class="Identifier">}</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{</span><span class="Constant">line_number</span><span class="Identifier">}</span> = <span class="Identifier">$elem_type-&gt;{</span><span class="Constant">line_number</span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Set up column values derived from the element type.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{</span><span class="Constant">typname</span><span class="Identifier">}</span> = <span class="Constant">'_'</span> . <span class="Identifier">$elem_type-&gt;{</span><span class="Constant">typname</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{</span><span class="Constant">typelem</span><span class="Identifier">}</span> = <span class="Identifier">$elem_type-&gt;{</span><span class="Constant">typname</span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Arrays require INT alignment, unless the element type requires<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># DOUBLE alignment.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{</span><span class="Constant">typalign</span><span class="Identifier">}</span> = <span class="Identifier">$elem_type-&gt;{</span><span class="Constant">typalign</span><span class="Identifier">}</span> <span class="Statement">eq</span> <span class="Constant">'d'</span> ? <span class="Constant">'d'</span> : <span class="Constant">'i'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Fill in the rest of the array entry's fields.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$column</span> (<span class="Identifier">@$pgtype_schema</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$attname</span> = <span class="Identifier">$column-&gt;{</span><span class="Constant">name</span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Skip if we already set it above.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Statement">defined</span> <span class="Identifier">$array_type{$attname}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Apply the BKI_ARRAY_DEFAULT setting if there is one,<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># otherwise copy the field from the element type.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$column-&gt;{</span><span class="Constant">array_default</span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{$attname}</span> = <span class="Identifier">$column-&gt;{</span><span class="Constant">array_default</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_type{$attname}</span> = <span class="Identifier">$elem_type-&gt;{$attname}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Lastly, cross-link the array to the element type.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$elem_type-&gt;{</span><span class="Constant">typarray</span><span class="Identifier">}</span> = <span class="Identifier">$array_type{</span><span class="Constant">typname</span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@array_types</span>, \<span class="Identifier">%array_type</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@$types</span>, <span class="Identifier">@array_types</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Rename temporary files to final names.<br/></li>
<li></span><span class="Comment"># Call this function with the final file name and the .tmp extension.<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># If the final file already exists and has identical contents, don't<br/></li>
<li></span><span class="Comment"># overwrite it; this behavior avoids unnecessary recompiles due to<br/></li>
<li></span><span class="Comment"># updating the mod date on unchanged header files.<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Note: recommended extension is &quot;.tmp$$&quot;, so that parallel make steps<br/></li>
<li></span><span class="Comment"># can't use the same temp files.<br/></li>
<li><a id="L511">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">RenameTempFile</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$final_name</span> = <span class="Statement">shift</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$extension</span> = <span class="Statement">shift</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$temp_name</span> = <span class="Identifier">$final_name</span> . <span class="Identifier">$extension</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">-f</span> <span class="Identifier">$final_name<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; compare(<span class="Identifier">$temp_name</span>, <span class="Identifier">$final_name</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unlink</span>(<span class="Identifier">$temp_name</span>) || <span class="Statement">die</span> <span class="Constant">&quot;unlink: </span><span class="Identifier">$temp_name</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">rename</span>(<span class="Identifier">$temp_name</span>, <span class="Identifier">$final_name</span>) || <span class="Statement">die</span> <span class="Constant">&quot;rename: </span><span class="Identifier">$temp_name</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Find a symbol defined in a particular header file and extract the value.<br/></li>
<li></span><span class="Comment"># include_path should be the path to src/include/.<br/></li>
<li><a id="L531">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">FindDefinedSymbol</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$catalog_header</span>, <span class="Identifier">$include_path</span>, <span class="Identifier">$symbol</span>) = <span class="Identifier">@_</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$value</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Make sure include path ends in a slash.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">substr</span>(<span class="Identifier">$include_path</span>, -<span class="Constant">1</span>) <span class="Statement">ne</span> <span class="Constant">'/'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$include_path</span> .= <span class="Constant">'/'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$file</span> = <span class="Identifier">$include_path</span> . <span class="Identifier">$catalog_header</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">open</span>(<span class="Statement">my</span> <span class="Identifier">$find_defined_symbol</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$file</span>) || <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$file</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (&lt;<span class="Identifier">$find_defined_symbol</span>&gt;)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^#define</span><span class="Special">\s+\Q</span><span class="Identifier">$symbol</span><span class="Special">\E\s+(\S+)</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$value</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">last</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$find_defined_symbol</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Identifier">$value</span> <span class="Statement">if</span> <span class="Statement">defined</span> <span class="Identifier">$value</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$file</span><span class="Constant">: no definition found for </span><span class="Identifier">$symbol</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Similar to <a href="#L531" title="catalog/Catalog.pm:531">FindDefinedSymbol</a>, but looks in the bootstrap metadata.<br/></li>
<li><a id="L557">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">FindDefinedSymbolFromData</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$data</span>, <span class="Identifier">$symbol</span>) = <span class="Identifier">@_</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$row</span> (<span class="Identifier">@{$data}</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$row-&gt;{</span><span class="Constant">oid_symbol</span><span class="Identifier">}</span> <span class="Statement">eq</span> <span class="Identifier">$symbol</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Identifier">$row-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;no definition found for </span><span class="Identifier">$symbol</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Extract an array of all the OIDs assigned in the specified catalog headers<br/></li>
<li></span><span class="Comment"># and their associated data files (if any).<br/></li>
<li></span><span class="Comment"># Caution: genbki.pl contains equivalent logic; change it too if you need to<br/></li>
<li></span><span class="Comment"># touch this.<br/></li>
<li><a id="L574">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">FindAllOidsFromHeaders</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@input_files</span> = <span class="Identifier">@_</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@oids</span> = ();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$header</span> (<span class="Identifier">@input_files</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$header</span> =~ <span class="Statement">/</span><span class="Special">(.+)\.</span><span class="Constant">h$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Input files need to be header files.</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$datfile</span> = <span class="Constant">&quot;</span><span class="Identifier">$1</span><span class="Constant">.dat&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$catalog</span> = Catalog::<a href="#L24" title="catalog/Catalog.pm:24">ParseHeader</a>(<span class="Identifier">$header</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># We ignore the pg_class OID and rowtype OID of bootstrap catalogs,<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># as those are expected to appear in the initial data for pg_class<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># and pg_type.&nbsp; For regular catalogs, include these OIDs.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Identifier">$catalog-&gt;{</span><span class="Constant">bootstrap</span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@oids</span>, <span class="Identifier">$catalog-&gt;{</span><span class="Constant">relation_oid</span><span class="Identifier">}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$catalog-&gt;{</span><span class="Constant">relation_oid</span><span class="Identifier">}</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@oids</span>, <span class="Identifier">$catalog-&gt;{</span><span class="Constant">rowtype_oid</span><span class="Identifier">}</span> <span class="Statement">if</span> (<span class="Identifier">$catalog-&gt;{</span><span class="Constant">rowtype_oid</span><span class="Identifier">}</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Not all catalogs have a data file.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">-e</span> <span class="Identifier">$datfile</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$catdata</span> =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Catalog::<a href="#L308" title="catalog/Catalog.pm:308">ParseData</a>(<span class="Identifier">$datfile</span>, <span class="Identifier">$catalog-&gt;{</span><span class="Constant">columns</span><span class="Identifier">}</span>, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$row</span> (<span class="Identifier">@$catdata</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@oids</span>, <span class="Identifier">$row-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span> <span class="Statement">if</span> <span class="Statement">defined</span> <span class="Identifier">$row-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$toast</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog-&gt;{</span><span class="Constant">toasting</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@oids</span>, <span class="Identifier">$toast-&gt;{</span><span class="Constant">toast_oid</span><span class="Identifier">}</span>, <span class="Identifier">$toast-&gt;{</span><span class="Constant">toast_index_oid</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$index</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog-&gt;{</span><span class="Constant">indexing</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@oids</span>, <span class="Identifier">$index-&gt;{</span><span class="Constant">index_oid</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$other</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog-&gt;{</span><span class="Constant">other_oids</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@oids</span>, <span class="Identifier">$other-&gt;{</span><span class="Constant">other_oid</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> \<span class="Identifier">@oids</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Constant">1</span>;<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
