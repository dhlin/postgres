<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>nodes/gen_node_support.pl - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>nodes/gen_node_support.pl - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L37">elem</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="PreProc">#!/usr/bin/perl<br/></li>
<li></span><span class="Comment">#----------------------------------------------------------------------<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Generate node support files:<br/></li>
<li></span><span class="Comment"># - nodetags.h<br/></li>
<li></span><span class="Comment"># - copyfuncs<br/></li>
<li></span><span class="Comment"># - equalfuncs<br/></li>
<li></span><span class="Comment"># - readfuncs<br/></li>
<li></span><span class="Comment"># - outfuncs<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># src/backend/nodes/gen_node_support.pl<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment">#----------------------------------------------------------------------<br/></li>
<li></span><br/></li>
<li><span class="Statement">use strict</span>;<br/></li>
<li><span class="Statement">use warnings</span> <span class="Constant">FATAL</span> =&gt; <span class="Constant">'all'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">use </span>File::Basename;<br/></li>
<li><span class="Statement">use </span>Getopt::Long;<br/></li>
<li><br/></li>
<li><span class="Statement">use </span>FindBin;<br/></li>
<li><span class="Statement">use lib</span> <span class="Constant">&quot;</span><span class="Identifier">$</span><span class="Type">FindBin::</span><span class="Identifier">RealBin</span><span class="Constant">/../catalog&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">use </span>Catalog;&nbsp; &nbsp; <span class="Comment"># for <a href="../catalog/Catalog.pm.html#L511" title="catalog/Catalog.pm:511">RenameTempFile</a><br/></li>
<li></span><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$output_path</span> = <span class="Constant">'.'</span>;<br/></li>
<li><br/></li>
<li>GetOptions(<span class="Constant">'outdir:s'</span> =&gt; \<span class="Identifier">$output_path</span>)<br/></li>
<li>&nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$0</span><span class="Constant">: wrong arguments&quot;</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># Test whether first argument is element of the list in the second<br/></li>
<li></span><span class="Comment"># argument<br/></li>
<li><a id="L37">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">elem</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$x</span> = <span class="Statement">shift</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Statement">grep</span> <span class="Statement">{</span> <span class="Identifier">$_</span> <span class="Statement">eq</span> <span class="Identifier">$x</span> <span class="Statement">}</span> <span class="Identifier">@_</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># This list defines the canonical set of header files to be read by this<br/></li>
<li></span><span class="Comment"># script, and the order they are to be processed in.&nbsp; We must have a stable<br/></li>
<li></span><span class="Comment"># processing order, else the NodeTag enum's order will vary, with catastrophic<br/></li>
<li></span><span class="Comment"># consequences for ABI stability across different builds.<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Currently, the various build systems also have copies of this list,<br/></li>
<li></span><span class="Comment"># so that they can do dependency checking properly.&nbsp; In future we may be<br/></li>
<li></span><span class="Comment"># able to make this list the only copy.&nbsp; For now, we just check that<br/></li>
<li></span><span class="Comment"># it matches the list of files passed on the command line.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@all_input_files</span> = <span class="Constant">qw(<br/></li>
<li></span><span class="Constant">&nbsp; nodes/nodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/primnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/parsenodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/pathnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/plannodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/execnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; access/amapi.h<br/></li>
<li></span><span class="Constant">&nbsp; access/sdir.h<br/></li>
<li></span><span class="Constant">&nbsp; access/tableam.h<br/></li>
<li></span><span class="Constant">&nbsp; access/tsmapi.h<br/></li>
<li></span><span class="Constant">&nbsp; commands/event_trigger.h<br/></li>
<li></span><span class="Constant">&nbsp; commands/trigger.h<br/></li>
<li></span><span class="Constant">&nbsp; executor/tuptable.h<br/></li>
<li></span><span class="Constant">&nbsp; foreign/fdwapi.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/bitmapset.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/extensible.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/lockoptions.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/miscnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/replnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/supportnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/value.h<br/></li>
<li></span><span class="Constant">&nbsp; utils/rel.h<br/></li>
<li></span><span class="Constant">)</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Nodes from these input files are automatically treated as nodetag_only.<br/></li>
<li></span><span class="Comment"># In the future we might add explicit pg_node_attr labeling to some of these<br/></li>
<li></span><span class="Comment"># files and remove them from this list, but for now this is the path of least<br/></li>
<li></span><span class="Comment"># resistance.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@nodetag_only_files</span> = <span class="Constant">qw(<br/></li>
<li></span><span class="Constant">&nbsp; nodes/execnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; access/amapi.h<br/></li>
<li></span><span class="Constant">&nbsp; access/sdir.h<br/></li>
<li></span><span class="Constant">&nbsp; access/tableam.h<br/></li>
<li></span><span class="Constant">&nbsp; access/tsmapi.h<br/></li>
<li></span><span class="Constant">&nbsp; commands/event_trigger.h<br/></li>
<li></span><span class="Constant">&nbsp; commands/trigger.h<br/></li>
<li></span><span class="Constant">&nbsp; executor/tuptable.h<br/></li>
<li></span><span class="Constant">&nbsp; foreign/fdwapi.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/lockoptions.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/miscnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/replnodes.h<br/></li>
<li></span><span class="Constant">&nbsp; nodes/supportnodes.h<br/></li>
<li></span><span class="Constant">)</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># ARM ABI STABILITY CHECK HERE:<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># In stable branches, set $last_nodetag to the name of the last node type<br/></li>
<li></span><span class="Comment"># that should receive an auto-generated nodetag number, and $last_nodetag_no<br/></li>
<li></span><span class="Comment"># to its number.&nbsp; (Find these values in the last line of the current<br/></li>
<li></span><span class="Comment"># nodetags.h file.)&nbsp; The script will then complain if those values don't<br/></li>
<li></span><span class="Comment"># match reality, providing a cross-check that we haven't broken ABI by<br/></li>
<li></span><span class="Comment"># adding or removing nodetags.<br/></li>
<li></span><span class="Comment"># In HEAD, these variables should be left undef, since we don't promise<br/></li>
<li></span><span class="Comment"># ABI stability during development.<br/></li>
<li></span><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$last_nodetag</span> = <span class="Statement">undef</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$last_nodetag_no</span> = <span class="Statement">undef</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># output file names<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@output_files</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># collect node names<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@node_types</span> = <span class="Constant">qw(Node)</span>;<br/></li>
<li><span class="Comment"># collect info for each node type<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">%node_type_info</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># node types we don't want copy support for<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@no_copy</span>;<br/></li>
<li><span class="Comment"># node types we don't want equal support for<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@no_equal</span>;<br/></li>
<li><span class="Comment"># node types we don't want query jumble support for<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@no_query_jumble</span>;<br/></li>
<li><span class="Comment"># node types we don't want read support for<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@no_read</span>;<br/></li>
<li><span class="Comment"># node types we don't want read/write support for<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@no_read_write</span>;<br/></li>
<li><span class="Comment"># node types that have handmade read/write support<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@special_read_write</span>;<br/></li>
<li><span class="Comment"># node types we don't want any support functions for, just node tags<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@nodetag_only</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># types that are copied by straight assignment<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@scalar_types</span> = <span class="Constant">qw(<br/></li>
<li></span><span class="Constant">&nbsp; bits32 bool char double int int8 int16 int32 int64 long uint8 uint16 uint32 uint64<br/></li>
<li></span><span class="Constant">&nbsp; AclMode AttrNumber Cardinality Cost Index Oid RelFileNumber Selectivity Size StrategyNumber SubTransactionId TimeLineID XLogRecPtr<br/></li>
<li></span><span class="Constant">)</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># collect enum types<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@enum_types</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># collect types that are abstract (hence no node tag, no support functions)<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@abstract_types</span> = <span class="Constant">qw(Node)</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Special cases that either don't have their own struct or the struct<br/></li>
<li></span><span class="Comment"># is not in a header file.&nbsp; We generate node tags for them, but<br/></li>
<li></span><span class="Comment"># they otherwise don't participate in node support.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@extra_tags</span> = <span class="Constant">qw(<br/></li>
<li></span><span class="Constant">&nbsp; IntList OidList XidList<br/></li>
<li></span><span class="Constant">&nbsp; AllocSetContext GenerationContext SlabContext BumpContext<br/></li>
<li></span><span class="Constant">&nbsp; TIDBitmap<br/></li>
<li></span><span class="Constant">&nbsp; WindowObjectData<br/></li>
<li></span><span class="Constant">)</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># This is a regular node, but we skip parsing it from its header file<br/></li>
<li></span><span class="Comment"># since we won't use its internal structure here anyway.<br/></li>
<li></span><span class="Statement">push</span> <span class="Identifier">@node_types</span>, <span class="Constant">qw(List)</span>;<br/></li>
<li><span class="Comment"># Lists are specially treated in all five support files, too.<br/></li>
<li></span><span class="Comment"># (Ideally we'd mark List as &quot;special copy/equal&quot; not &quot;no copy/equal&quot;.<br/></li>
<li></span><span class="Comment"># But until there's other use-cases for that, just hot-wire the tests<br/></li>
<li></span><span class="Comment"># that would need to distinguish.)<br/></li>
<li></span><span class="Statement">push</span> <span class="Identifier">@no_copy</span>, <span class="Constant">qw(List)</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@no_equal</span>, <span class="Constant">qw(List)</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@no_query_jumble</span>, <span class="Constant">qw(List)</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@special_read_write</span>, <span class="Constant">qw(List)</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Nodes with custom copy/equal implementations are skipped from<br/></li>
<li></span><span class="Comment"># .funcs.c but need case statements in .switch.c.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@custom_copy_equal</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Similarly for custom read/write implementations.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@custom_read_write</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Similarly for custom query jumble implementation.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@custom_query_jumble</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Track node types with manually assigned NodeTag numbers.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">%manual_nodetag_number</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># This is a struct, so we can copy it by assignment.&nbsp; Equal support is<br/></li>
<li></span><span class="Comment"># currently not required.<br/></li>
<li></span><span class="Statement">push</span> <span class="Identifier">@scalar_types</span>, <span class="Constant">qw(QualCost)</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">## check that we have the expected number of files on the command line<br/></li>
<li></span><span class="Statement">die</span> <span class="Constant">&quot;wrong number of input files, expected:</span><span class="Special">\n</span><span class="Identifier">@all_input_files</span><span class="Special">\n</span><span class="Constant">got:</span><span class="Special">\n</span><span class="Identifier">@ARGV</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<span class="Identifier">$#ARGV</span> != <span class="Identifier">$#all_input_files</span>);<br/></li>
<li><br/></li>
<li><span class="Comment">## read input<br/></li>
<li></span><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$next_input_file</span> = <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$infile</span> (<span class="Identifier">@ARGV</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$subline</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$is_node_struct</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$supertype</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$supertype_field</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$node_attrs</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$node_attrs_lineno</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@my_fields</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%my_field_types</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%my_field_attrs</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># open file with name from command line, which may have a path prefix<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$ifh</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$infile</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;could not open </span><span class="Special">\&quot;</span><span class="Identifier">$infile</span><span class="Special">\&quot;</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># now shorten filename for use below<br/></li>
<li></span>&nbsp; &nbsp; <span class="Identifier">$infile</span> =~ <span class="Statement">s!</span><span class="Special">.*</span><span class="Constant">src/include/</span><span class="Statement">!!</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># check it against next member of @all_input_files<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;wrong input file ordering, expected </span><span class="Identifier">@all_input_files</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$infile</span> <span class="Statement">ne</span> <span class="Identifier">$all_input_files[$next_input_file]</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$next_input_file</span>++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$raw_file_content</span> = <span class="Statement">do</span> { <span class="Statement">local</span> <span class="Identifier">$/</span>; &lt;<span class="Identifier">$ifh</span>&gt; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># strip C comments, preserving newlines so we can count lines correctly<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$file_content</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (<span class="Identifier">$raw_file_content</span> =~ <span class="Statement">m{</span><span class="Constant">^</span><span class="Special">(.*?)(</span><span class="Constant">/</span><span class="Special">\*.*?\*</span><span class="Constant">/</span><span class="Special">)(.*)</span><span class="Constant">$</span><span class="Statement">}s</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$file_content</span> .= <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$comment</span> = <span class="Identifier">$2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$raw_file_content</span> = <span class="Identifier">$3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$comment</span> =~ <span class="Statement">tr/</span><span class="Constant">\n</span><span class="Statement">//cd</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$file_content</span> .= <span class="Identifier">$comment</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$file_content</span> .= <span class="Identifier">$raw_file_content</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$lineno</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$prevline</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$line</span> (<span class="Statement">split</span> <span class="Statement">/</span><span class="Special">\n</span><span class="Statement">/</span>, <span class="Identifier">$file_content</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># per-physical-line processing<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$lineno</span>++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">chomp</span> <span class="Identifier">$line</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$line</span> =~ <span class="Statement">s/</span><span class="Special">\s*</span><span class="Constant">$</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$line</span> <span class="Statement">eq</span> <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^#</span><span class="Special">(</span><span class="Constant">define|ifdef|endif</span><span class="Special">)</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># within a struct, don't process until we have whole logical line<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$in_struct</span> &amp;&amp; <span class="Identifier">$subline</span> &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">;$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># found the end, re-attach any previous line(s)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$line</span> = <span class="Identifier">$prevline</span> . <span class="Identifier">$line</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$prevline</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$prevline</span> <span class="Statement">eq</span> <span class="Constant">''<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">pg_node_attr</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w()</span><span class="Constant">, ]</span><span class="Special">*)\)</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># special case: node-attributes line doesn't end with semi<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># set it aside for a moment<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$prevline</span> .= <span class="Identifier">$line</span> . <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># we are analyzing a struct definition<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$in_struct</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$subline</span>++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># first line should have opening brace<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$subline</span> == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$is_node_struct</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$supertype</span> = <span class="Statement">undef</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$line</span> <span class="Statement">eq</span> <span class="Constant">'{'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$infile</span><span class="Constant">:</span><span class="Identifier">$lineno</span><span class="Constant">: expected opening brace</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># second line could be node attributes<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$subline</span> == <span class="Constant">2<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">pg_node_attr</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w()</span><span class="Constant">, ]</span><span class="Special">*)\)</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_attrs</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_attrs_lineno</span> = <span class="Identifier">$lineno</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># hack: don't count the line<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$subline</span>--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># next line should have node tag or supertype<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$subline</span> == <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">NodeTag</span><span class="Special">\s+</span><span class="Constant">type;</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$is_node_struct</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Special">\s*(\w+)\s+(\w+)</span><span class="Constant">;</span><span class="Statement">/</span> <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@node_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$is_node_struct</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$supertype</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$supertype_field</span> = <span class="Identifier">$2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># end of struct<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\}\s*(?:\Q</span><span class="Identifier">$in_struct</span><span class="Special">\E\s*)?</span><span class="Constant">;$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$is_node_struct</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># This is the end of a node struct definition.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Save everything we have collected.<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$attr</span> (<span class="Statement">split</span> <span class="Statement">/</span><span class="Constant">,</span><span class="Special">\s*</span><span class="Statement">/</span>, <span class="Identifier">$node_attrs</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'abstract'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@abstract_types</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'custom_copy_equal'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@custom_copy_equal</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'custom_read_write'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@custom_read_write</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'custom_query_jumble'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@custom_query_jumble</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'no_copy'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_copy</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'no_equal'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_equal</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'no_copy_equal'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_copy</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_equal</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'no_query_jumble'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_query_jumble</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'no_read'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_read</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'nodetag_only'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@nodetag_only</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> <span class="Statement">eq</span> <span class="Constant">'special_read_write'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@special_read_write</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$attr</span> =~ <span class="Statement">/</span><span class="Constant">^nodetag_number</span><span class="Special">\((\d+)\)</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$manual_nodetag_number{$in_struct}</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Identifier">$infile</span><span class="Constant">:</span><span class="Identifier">$node_attrs_lineno</span><span class="Constant">: unrecognized attribute </span><span class="Special">\&quot;</span><span class="Identifier">$attr</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># node name<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@node_types</span>, <span class="Identifier">$in_struct</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># field names, types, attributes<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@f</span> = <span class="Identifier">@my_fields</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%ft</span> = <span class="Identifier">%my_field_types</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%fa</span> = <span class="Identifier">%my_field_attrs</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># If there is a supertype, add those fields, too.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$supertype</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@superfields</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$sf</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$supertype}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$fn</span> = <span class="Constant">&quot;</span><span class="Identifier">${supertype_field}</span><span class="Constant">.</span><span class="Identifier">$sf</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@superfields</span>, <span class="Identifier">$fn</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$ft{$fn}</span> =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_type_info{$supertype}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}{$sf}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$node_type_info{$supertype}<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&gt;{field_attrs}{<span class="Identifier">$sf</span>})<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Copy any attributes, adjusting array_size field references<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@newa</span> = <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$supertype}<br/></li>
<li></span><span class="perlVarBlock">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">-&gt;{</span><span class="Constant">field_attrs</span><span class="Identifier">}{$sf}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$a</span> (<span class="Identifier">@newa</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$a</span> =~<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">s/</span><span class="Constant">array_size</span><span class="Special">\((\w+)\)</span><span class="Statement">/</span><span class="Constant">array_size(</span><span class="Identifier">${supertype_field}</span><span class="Constant">.</span><span class="Identifier">$1</span><span class="Constant">)</span><span class="Statement">/</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$fa{$fn}</span> = \<span class="Identifier">@newa</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unshift</span> <span class="Identifier">@f</span>, <span class="Identifier">@superfields</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># save in global info structure<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_type_info{$in_struct}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span> = \<span class="Identifier">@f</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_type_info{$in_struct}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}</span> = \<span class="Identifier">%ft</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_type_info{$in_struct}-&gt;{</span><span class="Constant">field_attrs</span><span class="Identifier">}</span> = \<span class="Identifier">%fa</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Propagate nodetag_only marking from files to nodes<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@nodetag_only</span>, <span class="Identifier">$in_struct<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$infile</span>, <span class="Identifier">@nodetag_only_files</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Propagate some node attributes from supertypes<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$supertype</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_copy</span>, <span class="Identifier">$in_struct<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$supertype</span>, <span class="Identifier">@no_copy</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_equal</span>, <span class="Identifier">$in_struct<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$supertype</span>, <span class="Identifier">@no_equal</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_read</span>, <span class="Identifier">$in_struct<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$supertype</span>, <span class="Identifier">@no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@no_query_jumble</span>, <span class="Identifier">$in_struct<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$supertype</span>, <span class="Identifier">@no_query_jumble</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># start new cycle<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$in_struct</span> = <span class="Statement">undef</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_attrs</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">@my_fields</span> = ();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">%my_field_types</span> = ();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">%my_field_attrs</span> = ();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># normal struct field<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$line</span> =~<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*(.+)\s*\b(\w+)(\[</span><span class="Constant">[</span><span class="Special">\w\s+</span><span class="Constant">]</span><span class="Special">+\])?\s*(?:</span><span class="Constant">pg_node_attr</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w()</span><span class="Constant">, ]</span><span class="Special">*)\))?</span><span class="Constant">;</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$is_node_struct</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$type</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$name</span> = <span class="Identifier">$2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$array_size</span> = <span class="Identifier">$3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$attrs</span> = <span class="Identifier">$4</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># strip &quot;const&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$type</span> =~ <span class="Statement">s/</span><span class="Constant">^const</span><span class="Special">\s*</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># strip trailing space<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$type</span> =~ <span class="Statement">s/</span><span class="Special">\s*</span><span class="Constant">$</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># strip space between type and &quot;*&quot; (pointer) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$type</span> =~ <span class="Statement">s/</span><span class="Special">\s+\*</span><span class="Constant">$</span><span class="Statement">/</span><span class="Constant">*</span><span class="Statement">/</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># strip space between type and &quot;**&quot; (array of pointers) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$type</span> =~ <span class="Statement">s/</span><span class="Special">\s+\*\*</span><span class="Constant">$</span><span class="Statement">/</span><span class="Constant">**</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Identifier">$infile</span><span class="Constant">:</span><span class="Identifier">$lineno</span><span class="Constant">: cannot parse data type in </span><span class="Special">\&quot;</span><span class="Identifier">$line</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> <span class="Identifier">$type</span> <span class="Statement">eq</span> <span class="Constant">''</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@attrs</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$attrs</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">@attrs</span> = <span class="Statement">split</span> <span class="Statement">/</span><span class="Constant">,</span><span class="Special">\s*</span><span class="Statement">/</span>, <span class="Identifier">$attrs</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$attr</span> (<span class="Identifier">@attrs</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (&nbsp;&nbsp; <span class="Identifier">$attr</span> !~ <span class="Statement">/</span><span class="Constant">^array_size</span><span class="Special">\(\w+\)</span><span class="Constant">$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <span class="Identifier">$attr</span> !~ <span class="Statement">/</span><span class="Constant">^copy_as</span><span class="Special">\(\w+\)</span><span class="Constant">$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <span class="Identifier">$attr</span> !~ <span class="Statement">/</span><span class="Constant">^read_as</span><span class="Special">\(\w+\)</span><span class="Constant">$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; !<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$attr</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">qw(copy_as_scalar<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equal_as_scalar<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equal_ignore<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; equal_ignore_if_zero<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query_jumble_ignore<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query_jumble_location<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read_write_ignore<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write_only_relids<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write_only_nondefault_pathtarget<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write_only_req_outer)</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Identifier">$infile</span><span class="Constant">:</span><span class="Identifier">$lineno</span><span class="Constant">: unrecognized attribute </span><span class="Special">\&quot;</span><span class="Identifier">$attr</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$type</span> = <span class="Identifier">$type</span> . <span class="Identifier">$array_size</span> <span class="Statement">if</span> <span class="Identifier">$array_size</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@my_fields</span>, <span class="Identifier">$name</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$my_field_types{$name}</span> = <span class="Identifier">$type</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$my_field_attrs{$name}</span> = \<span class="Identifier">@attrs</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># function pointer field<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$line</span> =~<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*(</span><span class="Constant">[</span><span class="Special">\w\s*</span><span class="Constant">]</span><span class="Special">+)\s*\(\*(\w+)\)\s*\((.*)\)\s*(?:</span><span class="Constant">pg_node_attr</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w()</span><span class="Constant">, ]</span><span class="Special">*)\))?</span><span class="Constant">;</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$is_node_struct</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$type</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$name</span> = <span class="Identifier">$2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$args</span> = <span class="Identifier">$3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$attrs</span> = <span class="Identifier">$4</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@attrs</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$attrs</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">@attrs</span> = <span class="Statement">split</span> <span class="Statement">/</span><span class="Constant">,</span><span class="Special">\s*</span><span class="Statement">/</span>, <span class="Identifier">$attrs</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$attr</span> (<span class="Identifier">@attrs</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (&nbsp;&nbsp; <span class="Identifier">$attr</span> !~ <span class="Statement">/</span><span class="Constant">^copy_as</span><span class="Special">\(\w+\)</span><span class="Constant">$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <span class="Identifier">$attr</span> !~ <span class="Statement">/</span><span class="Constant">^read_as</span><span class="Special">\(\w+\)</span><span class="Constant">$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; !<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$attr</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">qw(equal_ignore read_write_ignore)</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Identifier">$infile</span><span class="Constant">:</span><span class="Identifier">$lineno</span><span class="Constant">: unrecognized attribute </span><span class="Special">\&quot;</span><span class="Identifier">$attr</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@my_fields</span>, <span class="Identifier">$name</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$my_field_types{$name}</span> = <span class="Constant">'function pointer'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$my_field_attrs{$name}</span> = \<span class="Identifier">@attrs</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># We're not too picky about what's outside structs,<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># but we'd better understand everything inside.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$infile</span><span class="Constant">:</span><span class="Identifier">$lineno</span><span class="Constant">: could not parse </span><span class="Special">\&quot;</span><span class="Identifier">$line</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># not in a struct<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># start of a struct?<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(?:</span><span class="Constant">typedef </span><span class="Special">)?</span><span class="Constant">struct </span><span class="Special">(\w+)</span><span class="Constant">$</span><span class="Statement">/</span> &amp;&amp; <span class="Identifier">$1</span> <span class="Statement">ne</span> <span class="Constant">'Node'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$in_struct</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$subline</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># one node type typedef'ed directly from another<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^typedef </span><span class="Special">(\w+)</span><span class="Constant"> </span><span class="Special">(\w+)</span><span class="Constant">;$</span><span class="Statement">/</span> <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@node_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$alias_of</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$n</span> = <span class="Identifier">$2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># copy everything over<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@node_types</span>, <span class="Identifier">$n</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@f</span> = <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$alias_of}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%ft</span> = <span class="Identifier">%{</span><span class="perlVarBlock2"> </span><span class="Identifier">$node_type_info{$alias_of}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}</span><span class="perlVarBlock2"> </span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%fa</span> = <span class="Identifier">%{</span><span class="perlVarBlock2"> </span><span class="Identifier">$node_type_info{$alias_of}-&gt;{</span><span class="Constant">field_attrs</span><span class="Identifier">}</span><span class="perlVarBlock2"> </span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span> = \<span class="Identifier">@f</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}</span> = \<span class="Identifier">%ft</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_attrs</span><span class="Identifier">}</span> = \<span class="Identifier">%fa</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># collect enum names<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^typedef enum </span><span class="Special">(\w+)(\s*\/\*.*)?</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@enum_types</span>, <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$in_struct</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;runaway </span><span class="Special">\&quot;</span><span class="Identifier">$in_struct</span><span class="Special">\&quot;</span><span class="Constant"> in file </span><span class="Special">\&quot;</span><span class="Identifier">$infile</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$ifh</span>;<br/></li>
<li>}&nbsp; &nbsp; <span class="Comment"># for each file<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">## write output<br/></li>
<li></span><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$tmpext</span> = <span class="Constant">&quot;.tmp</span><span class="Identifier">$$</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># opening boilerplate for output files<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">$header_comment</span> =<br/></li>
<li>&nbsp; <span class="Constant">'/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * %s<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; Generated node infrastructure code<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * NOTES<br/></li>
<li></span><span class="Constant"> *&nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *&nbsp; *** DO NOT EDIT THIS FILE! ***<br/></li>
<li></span><span class="Constant"> *&nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *&nbsp; It has been GENERATED by src/backend/nodes/gen_node_support.pl<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> */<br/></li>
<li></span><span class="Constant">'</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># nodetags.h<br/></li>
<li></span><br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'nodetags.h'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$nt</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/nodetags.h</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/nodetags.h</span><span class="Identifier">$tmpext</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$nt</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'nodetags.h'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$tagno</span> = <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$last_tag</span> = <span class="Statement">undef</span>;<br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$n</span> (<span class="Identifier">@node_types</span>, <span class="Identifier">@extra_tags</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@abstract_types</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$manual_nodetag_number{$n}</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># do not change $tagno or $last_tag<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$nt</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">T_</span><span class="Identifier">${n}</span><span class="Constant"> = </span><span class="Identifier">$manual_nodetag_number{$n}</span><span class="Constant">,</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$tagno</span>++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$last_tag</span> = <span class="Identifier">$n</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$nt</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">T_</span><span class="Identifier">${n}</span><span class="Constant"> = </span><span class="Identifier">$tagno</span><span class="Constant">,</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># verify that last auto-assigned nodetag stays stable<br/></li>
<li></span><span class="Statement">die</span> <span class="Constant">&quot;ABI stability break: last nodetag is </span><span class="Identifier">$last_tag</span><span class="Constant"> not </span><span class="Identifier">$last_nodetag</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$last_nodetag</span> &amp;&amp; <span class="Identifier">$last_nodetag</span> <span class="Statement">ne</span> <span class="Identifier">$last_tag</span>);<br/></li>
<li><span class="Statement">die<br/></li>
<li></span>&nbsp; <span class="Constant">&quot;ABI stability break: last nodetag number is </span><span class="Identifier">$tagno</span><span class="Constant"> not </span><span class="Identifier">$last_nodetag_no</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$last_nodetag_no</span> &amp;&amp; <span class="Identifier">$last_nodetag_no</span> != <span class="Identifier">$tagno</span>);<br/></li>
<li><br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$nt</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># make #include lines necessary to pull in all the struct definitions<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">$node_includes</span> = <span class="Constant">''</span>;<br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$infile</span> (<span class="Statement">sort</span> <span class="Identifier">@ARGV</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$infile</span> =~ <span class="Statement">s!</span><span class="Special">.*</span><span class="Constant">src/include/</span><span class="Statement">!!</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$node_includes</span> .= <span class="Constant">qq{#include &quot;</span><span class="Identifier">$infile</span><span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">}</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># copyfuncs.c, equalfuncs.c<br/></li>
<li></span><br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'copyfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$cff</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/copyfuncs.funcs.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'equalfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$eff</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/equalfuncs.funcs.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'copyfuncs.switch.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$cfs</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/copyfuncs.switch.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'equalfuncs.switch.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$efs</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/equalfuncs.switch.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$cff</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'copyfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$eff</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'equalfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$cfs</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'copyfuncs.switch.c'</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$efs</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'equalfuncs.switch.c'</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># add required #include lines to each file set<br/></li>
<li></span><span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Identifier">$node_includes</span>;<br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Identifier">$node_includes</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$n</span> (<span class="Identifier">@node_types</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@abstract_types</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@nodetag_only</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$struct_no_copy</span> = (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@no_copy</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$struct_no_equal</span> = (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@no_equal</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$struct_no_copy</span> &amp;&amp; <span class="Identifier">$struct_no_equal</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cfs</span> <span class="Constant">&quot;</span><span class="Special">\t\t</span><span class="Constant">case T_</span><span class="Identifier">${n}</span><span class="Constant">:</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant">retval = _copy</span><span class="Identifier">${n}</span><span class="Constant">(from);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant">break;</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$struct_no_copy</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$efs</span> <span class="Constant">&quot;</span><span class="Special">\t\t</span><span class="Constant">case T_</span><span class="Identifier">${n}</span><span class="Constant">:</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant">retval = _equal</span><span class="Identifier">${n}</span><span class="Constant">(a, b);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant">break;</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$struct_no_equal</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@custom_copy_equal</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Constant">static </span><span class="Identifier">$n</span><span class="Constant"> *<br/></li>
<li></span><span class="Constant">_copy</span><span class="Identifier">${n}</span><span class="Constant">(const </span><span class="Identifier">$n</span><span class="Constant"> *from)<br/></li>
<li></span><span class="Constant">{<br/></li>
<li></span><span class="Special">\t</span><span class="Identifier">${n}</span><span class="Constant"> *newnode = makeNode(</span><span class="Identifier">$n</span><span class="Constant">);<br/></li>
<li></span><br/></li>
<li><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$struct_no_copy</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Constant">static bool<br/></li>
<li></span><span class="Constant">_equal</span><span class="Identifier">${n}</span><span class="Constant">(const </span><span class="Identifier">$n</span><span class="Constant"> *a, const </span><span class="Identifier">$n</span><span class="Constant"> *b)<br/></li>
<li></span><span class="Constant">{<br/></li>
<li></span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$struct_no_equal</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># track already-processed fields to support field order checks<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%previous_fields</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># print instructions for each field<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$f</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$t</span> = <span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}{$f}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@a</span> = <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_attrs</span><span class="Identifier">}{$f}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$copy_ignore</span> = <span class="Identifier">$struct_no_copy</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$equal_ignore</span> = <span class="Identifier">$struct_no_equal</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># extract per-field attributes<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$array_size_field</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$copy_as_field</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$copy_as_scalar</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$equal_as_scalar</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$a</span> (<span class="Identifier">@a</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$a</span> =~ <span class="Statement">/</span><span class="Constant">^array_size</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w.</span><span class="Constant">]</span><span class="Special">+)\)</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_size_field</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># insist that we copy or compare the array size first!<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;array size field </span><span class="Identifier">$array_size_field</span><span class="Constant"> for field </span><span class="Identifier">$n</span><span class="Constant">.</span><span class="Identifier">$f</span><span class="Constant"> must precede </span><span class="Identifier">$f</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Identifier">$previous_fields{$array_size_field}</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$a</span> =~ <span class="Statement">/</span><span class="Constant">^copy_as</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w.</span><span class="Constant">]</span><span class="Special">+)\)</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$copy_as_field</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$a</span> <span class="Statement">eq</span> <span class="Constant">'copy_as_scalar'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$copy_as_scalar</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$a</span> <span class="Statement">eq</span> <span class="Constant">'equal_as_scalar'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$equal_as_scalar</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$a</span> <span class="Statement">eq</span> <span class="Constant">'equal_ignore'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$equal_ignore</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># override type-specific copy method if requested<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$copy_as_field</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">newnode-&gt;</span><span class="Identifier">$f</span><span class="Constant"> = </span><span class="Identifier">$copy_as_field</span><span class="Constant">;</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$copy_ignore</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$copy_as_scalar</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$copy_ignore</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># override type-specific equal method if requested<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$equal_as_scalar</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$equal_ignore</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># select instructions by field type<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'char*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_STRING_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_STRING_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Bitmapset*'</span> || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Relids'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_BITMAPSET_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_BITMAPSET_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'ParseLoc'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_LOCATION_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_LOCATION_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$t</span>, <span class="Identifier">@scalar_types</span> <span class="Statement">or</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$t</span>, <span class="Identifier">@enum_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Constant">'equal_ignore_if_zero'</span>, <span class="Identifier">@a</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">if (a-&gt;</span><span class="Identifier">$f</span><span class="Constant"> != b-&gt;</span><span class="Identifier">$f</span><span class="Constant"> &amp;&amp; a-&gt;</span><span class="Identifier">$f</span><span class="Constant"> != 0 &amp;&amp; b-&gt;</span><span class="Identifier">$f</span><span class="Constant"> != 0)</span><span class="Special">\n\t\t</span><span class="Constant">return false;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># All CoercionForm fields are treated as equal_ignore<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span> || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'CoercionForm'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># arrays of scalar types<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(\w+)\*</span><span class="Constant">$</span><span class="Statement">/</span> <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@scalar_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$tt</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Statement">defined</span> <span class="Identifier">$array_size_field</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;no array size defined for </span><span class="Identifier">$n</span><span class="Constant">.</span><span class="Identifier">$f</span><span class="Constant"> of type </span><span class="Identifier">$t</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}{$array_size_field}</span> <span class="Statement">eq<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'List*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_POINTER_FIELD(</span><span class="Identifier">$f</span><span class="Constant">, list_length(from-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">) * sizeof(</span><span class="Identifier">$tt</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_POINTER_FIELD(</span><span class="Identifier">$f</span><span class="Constant">, list_length(a-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">) * sizeof(</span><span class="Identifier">$tt</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_POINTER_FIELD(</span><span class="Identifier">$f</span><span class="Constant">, from-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant"> * sizeof(</span><span class="Identifier">$tt</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_POINTER_FIELD(</span><span class="Identifier">$f</span><span class="Constant">, a-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant"> * sizeof(</span><span class="Identifier">$tt</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'function pointer'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># we can copy and compare as a scalar<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># node type<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> ((<span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(\w+)\*</span><span class="Constant">$</span><span class="Statement">/</span> <span class="Statement">or</span> <span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^struct</span><span class="Special">\s+(\w+)\*</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@node_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;node type </span><span class="Special">\&quot;</span><span class="Identifier">$1</span><span class="Special">\&quot;</span><span class="Constant"> lacks copy support, which is required for struct </span><span class="Special">\&quot;</span><span class="Identifier">$n</span><span class="Special">\&quot;</span><span class="Constant"> field </span><span class="Special">\&quot;</span><span class="Identifier">$f</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@no_copy</span> <span class="Statement">or</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@nodetag_only</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="Identifier">$1</span> <span class="Statement">ne</span> <span class="Constant">'List'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> !<span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;node type </span><span class="Special">\&quot;</span><span class="Identifier">$1</span><span class="Special">\&quot;</span><span class="Constant"> lacks equal support, which is required for struct </span><span class="Special">\&quot;</span><span class="Identifier">$n</span><span class="Special">\&quot;</span><span class="Constant"> field </span><span class="Special">\&quot;</span><span class="Identifier">$f</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@no_equal</span> <span class="Statement">or</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@nodetag_only</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <span class="Identifier">$1</span> <span class="Statement">ne</span> <span class="Constant">'List'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> !<span class="Identifier">$equal_ignore</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_NODE_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_NODE_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># array (inline)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\w+\[\w+\]</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_ARRAY_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_ARRAY_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'struct CustomPathMethods*'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'struct CustomScanMethods*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Fields of these types are required to be a pointer to a<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># static table of callback functions.&nbsp; So we don't copy<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># the table itself, just reference the original one.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COPY_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$copy_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">COMPARE_SCALAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$equal_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;could not handle type </span><span class="Special">\&quot;</span><span class="Identifier">$t</span><span class="Special">\&quot;</span><span class="Constant"> in struct </span><span class="Special">\&quot;</span><span class="Identifier">$n</span><span class="Special">\&quot;</span><span class="Constant"> field </span><span class="Special">\&quot;</span><span class="Identifier">$f</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$previous_fields{$f}</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$cff</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Special">\t</span><span class="Constant">return newnode;<br/></li>
<li></span><span class="Constant">}<br/></li>
<li></span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$struct_no_copy</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$eff</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Special">\t</span><span class="Constant">return true;<br/></li>
<li></span><span class="Constant">}<br/></li>
<li></span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$struct_no_equal</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$cff</span>;<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$eff</span>;<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$cfs</span>;<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$efs</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># outfuncs.c, readfuncs.c<br/></li>
<li></span><br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'outfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$off</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/outfuncs.funcs.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'readfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$rff</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/readfuncs.funcs.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'outfuncs.switch.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$ofs</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/outfuncs.switch.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'readfuncs.switch.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$rfs</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/readfuncs.switch.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$off</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'outfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$rff</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'readfuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$ofs</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'outfuncs.switch.c'</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$rfs</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'readfuncs.switch.c'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Identifier">$node_includes</span>;<br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Identifier">$node_includes</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$n</span> (<span class="Identifier">@node_types</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@abstract_types</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@nodetag_only</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@no_read_write</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@special_read_write</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$no_read</span> = (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@no_read</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># output format starts with upper case node type name<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$N</span> = <span class="Statement">uc</span> <span class="Identifier">$n</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$ofs</span> <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant">case T_</span><span class="Identifier">${n}</span><span class="Constant">:</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t\t</span><span class="Constant">_out</span><span class="Identifier">${n}</span><span class="Constant">(str, obj);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t\t</span><span class="Constant">break;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rfs</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">if (MATCH(</span><span class="Special">\&quot;</span><span class="Identifier">$N</span><span class="Special">\&quot;</span><span class="Constant">, &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Statement">length</span>(<span class="Identifier">$N</span>) . <span class="Constant">&quot;))</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t</span><span class="Constant">return (Node *) _read</span><span class="Identifier">${n}</span><span class="Constant">();</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@custom_read_write</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Constant">static void<br/></li>
<li></span><span class="Constant">_out</span><span class="Identifier">${n}</span><span class="Constant">(StringInfo str, const </span><span class="Identifier">$n</span><span class="Constant"> *node)<br/></li>
<li></span><span class="Constant">{<br/></li>
<li></span><span class="Special">\t</span><span class="Constant">WRITE_NODE_TYPE(</span><span class="Special">\&quot;</span><span class="Identifier">$N</span><span class="Special">\&quot;</span><span class="Constant">);<br/></li>
<li></span><br/></li>
<li><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Identifier">$no_read</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$macro</span> =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span> &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? <span class="Constant">'READ_LOCALS'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : <span class="Constant">'READ_LOCALS_NO_FIELDS'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Constant">static </span><span class="Identifier">$n</span><span class="Constant"> *<br/></li>
<li></span><span class="Constant">_read</span><span class="Identifier">${n}</span><span class="Constant">(void)<br/></li>
<li></span><span class="Constant">{<br/></li>
<li></span><span class="Special">\t</span><span class="Identifier">$macro</span><span class="Constant">(</span><span class="Identifier">$n</span><span class="Constant">);<br/></li>
<li></span><br/></li>
<li><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># track already-processed fields to support field order checks<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># (this isn't quite redundant with the previous loop, since<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># we may be considering structs that lack copy/equal support)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%previous_fields</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># print instructions for each field<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$f</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$t</span> = <span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}{$f}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@a</span> = <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_attrs</span><span class="Identifier">}{$f}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># extract per-field attributes<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$array_size_field</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$read_as_field</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$read_write_ignore</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$a</span> (<span class="Identifier">@a</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$a</span> =~ <span class="Statement">/</span><span class="Constant">^array_size</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w.</span><span class="Constant">]</span><span class="Special">+)\)</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$array_size_field</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># insist that we read the array size first!<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;array size field </span><span class="Identifier">$array_size_field</span><span class="Constant"> for field </span><span class="Identifier">$n</span><span class="Constant">.</span><span class="Identifier">$f</span><span class="Constant"> must precede </span><span class="Identifier">$f</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Identifier">$previous_fields{$array_size_field}</span> &amp;&amp; !<span class="Identifier">$no_read</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$a</span> =~ <span class="Statement">/</span><span class="Constant">^read_as</span><span class="Special">\((</span><span class="Constant">[</span><span class="Special">\w.</span><span class="Constant">]</span><span class="Special">+)\)</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$read_as_field</span> = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$a</span> <span class="Statement">eq</span> <span class="Constant">'read_write_ignore'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$read_write_ignore</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$read_write_ignore</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># nothing to do if no_read<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># for read_write_ignore with read_as(), emit the appropriate<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># assignment on the read side and move on.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$read_as_field</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">local_node-&gt;</span><span class="Identifier">$f</span><span class="Constant"> = </span><span class="Identifier">$read_as_field</span><span class="Constant">;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># else, bad specification<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;</span><span class="Identifier">$n</span><span class="Constant">.</span><span class="Identifier">$f</span><span class="Constant"> must not be marked read_write_ignore</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># select instructions by field type<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'bool'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_BOOL_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_BOOL_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'ParseLoc'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_LOCATION_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_LOCATION_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'int'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'int16'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'int32'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'AttrNumber'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'StrategyNumber'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_INT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_INT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'uint32'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'bits32'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'BlockNumber'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Index'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'SubTransactionId'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_UINT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_UINT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'uint64'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'AclMode'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_UINT64_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_UINT64_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Oid'</span> || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'RelFileNumber'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_OID_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_OID_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'long'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_LONG_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_LONG_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'char'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_CHAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_CHAR_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'double'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Cardinality'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Cost'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'QualCost'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">.startup);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">.per_tuple);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">.startup);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">.per_tuple);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Selectivity'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_FLOAT_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'char*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_STRING_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_STRING_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Bitmapset*'</span> || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'Relids'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_BITMAPSET_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_BITMAPSET_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$t</span>, <span class="Identifier">@enum_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_ENUM_FIELD(</span><span class="Identifier">$f</span><span class="Constant">, </span><span class="Identifier">$t</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_ENUM_FIELD(</span><span class="Identifier">$f</span><span class="Constant">, </span><span class="Identifier">$t</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># arrays of scalar types<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(\w+)(\*</span><span class="Constant">|</span><span class="Special">\[\w+\])</span><span class="Constant">$</span><span class="Statement">/</span> <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@scalar_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$tt</span> = <span class="Statement">uc</span> <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Statement">defined</span> <span class="Identifier">$array_size_field</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;no array size defined for </span><span class="Identifier">$n</span><span class="Constant">.</span><span class="Identifier">$f</span><span class="Constant"> of type </span><span class="Identifier">$t</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}{$array_size_field}</span> <span class="Statement">eq<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'List*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_</span><span class="Identifier">${tt}</span><span class="Constant">_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, list_length(node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_</span><span class="Identifier">${tt}</span><span class="Constant">_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, list_length(local_node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_</span><span class="Identifier">${tt}</span><span class="Constant">_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_</span><span class="Identifier">${tt}</span><span class="Constant">_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, local_node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'function pointer'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># We don't print these, and we can't read them either<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;cannot read function pointer in struct </span><span class="Special">\&quot;</span><span class="Identifier">$n</span><span class="Special">\&quot;</span><span class="Constant"> field </span><span class="Special">\&quot;</span><span class="Identifier">$f</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Special treatments of several Path node fields<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'RelOptInfo*'</span> &amp;&amp; <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Constant">'write_only_relids'</span>, <span class="Identifier">@a</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">appendStringInfoString(str, </span><span class="Special">\&quot;</span><span class="Constant"> :parent_relids </span><span class="Special">\&quot;</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">outBitmapset(str, node-&gt;</span><span class="Identifier">$f</span><span class="Constant">-&gt;relids);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'PathTarget*'</span> &amp;&amp; <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Constant">'write_only_nondefault_pathtarget'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">@a</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Statement">my</span> <span class="Identifier">$f2</span> = <span class="Identifier">$f</span>) =~ <span class="Statement">s/</span><span class="Constant">pathtarget</span><span class="Statement">/</span><span class="Constant">parent</span><span class="Statement">/</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">if (node-&gt;</span><span class="Identifier">$f</span><span class="Constant"> != node-&gt;</span><span class="Identifier">$f2</span><span class="Constant">-&gt;reltarget)</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t</span><span class="Constant">WRITE_NODE_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'ParamPathInfo*'</span> &amp;&amp; <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Constant">'write_only_req_outer'</span>, <span class="Identifier">@a</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">appendStringInfoString(str, </span><span class="Special">\&quot;</span><span class="Constant"> :required_outer </span><span class="Special">\&quot;</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">if (node-&gt;</span><span class="Identifier">$f</span><span class="Constant">)</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t</span><span class="Constant">outBitmapset(str, node-&gt;</span><span class="Identifier">$f</span><span class="Constant">-&gt;ppi_req_outer);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">else</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t</span><span class="Constant">outBitmapset(str, NULL);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># node type<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> ((<span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(\w+)\*</span><span class="Constant">$</span><span class="Statement">/</span> <span class="Statement">or</span> <span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^struct</span><span class="Special">\s+(\w+)\*</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@node_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;node type </span><span class="Special">\&quot;</span><span class="Identifier">$1</span><span class="Special">\&quot;</span><span class="Constant"> lacks write support, which is required for struct </span><span class="Special">\&quot;</span><span class="Identifier">$n</span><span class="Special">\&quot;</span><span class="Constant"> field </span><span class="Special">\&quot;</span><span class="Identifier">$f</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@no_read_write</span> <span class="Statement">or</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@nodetag_only</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;node type </span><span class="Special">\&quot;</span><span class="Identifier">$1</span><span class="Special">\&quot;</span><span class="Constant"> lacks read support, which is required for struct </span><span class="Special">\&quot;</span><span class="Identifier">$n</span><span class="Special">\&quot;</span><span class="Constant"> field </span><span class="Special">\&quot;</span><span class="Identifier">$f</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@no_read</span> <span class="Statement">or</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@nodetag_only</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> !<span class="Identifier">$no_read</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_NODE_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_NODE_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># arrays of node pointers (currently supported for write only)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> ((<span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(\w+)\*\*</span><span class="Constant">$</span><span class="Statement">/</span> <span class="Statement">or</span> <span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^struct</span><span class="Special">\s+(\w+)\*\*</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a>(<span class="Identifier">$1</span>, <span class="Identifier">@node_types</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<span class="Statement">defined</span> <span class="Identifier">$array_size_field</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;no array size defined for </span><span class="Identifier">$n</span><span class="Constant">.</span><span class="Identifier">$f</span><span class="Constant"> of type </span><span class="Identifier">$t</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}{$array_size_field}</span> <span class="Statement">eq<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">'List*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_NODE_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, list_length(node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_NODE_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, list_length(local_node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">));</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">WRITE_NODE_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">READ_NODE_ARRAY(</span><span class="Identifier">$f</span><span class="Constant">, local_node-&gt;</span><span class="Identifier">$array_size_field</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'struct CustomPathMethods*'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'struct CustomScanMethods*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">q{<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; /* CustomName is a key to lookup CustomScanMethods */<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; appendStringInfoString(str, &quot; :methods &quot;);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; outToken(str, node-&gt;methods-&gt;CustomName);<br/></li>
<li></span><span class="Constant">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">q!<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; /* Lookup CustomScanMethods by CustomName */<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; char&nbsp; &nbsp; &nbsp;&nbsp; *custom_name;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; const CustomScanMethods *methods;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; token = pg_strtok(&amp;length); /* skip methods: */<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; token = pg_strtok(&amp;length); /* CustomName */<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; custom_name = nullable_string(token, length);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; methods = GetCustomScanMethods(custom_name, false);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; local_node-&gt;methods = methods;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">!</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">die<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;could not handle type </span><span class="Special">\&quot;</span><span class="Identifier">$t</span><span class="Special">\&quot;</span><span class="Constant"> in struct </span><span class="Special">\&quot;</span><span class="Identifier">$n</span><span class="Special">\&quot;</span><span class="Constant"> field </span><span class="Special">\&quot;</span><span class="Identifier">$f</span><span class="Special">\&quot;\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># for read_as() without read_write_ignore, we have to read the value<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># that outfuncs.c wrote and then overwrite it.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">defined</span> <span class="Identifier">$read_as_field</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">local_node-&gt;</span><span class="Identifier">$f</span><span class="Constant"> = </span><span class="Identifier">$read_as_field</span><span class="Constant">;</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$previous_fields{$f}</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$off</span> <span class="Constant">&quot;}<br/></li>
<li></span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$rff</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Special">\t</span><span class="Constant">READ_DONE();<br/></li>
<li></span><span class="Constant">}<br/></li>
<li></span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$no_read</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$off</span>;<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$rff</span>;<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$ofs</span>;<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$rfs</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># queryjumblefuncs.c<br/></li>
<li></span><br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'queryjumblefuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$jff</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/queryjumblefuncs.funcs.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><span class="Statement">push</span> <span class="Identifier">@output_files</span>, <span class="Constant">'queryjumblefuncs.switch.c'</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$jfs</span>, <span class="Constant">'&gt;'</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/queryjumblefuncs.switch.c</span><span class="Identifier">$tmpext</span><span class="Constant">&quot;</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Identifier">$!</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$jff</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'queryjumblefuncs.funcs.c'</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$jfs</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'queryjumblefuncs.switch.c'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Identifier">$node_includes</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$n</span> (<span class="Identifier">@node_types</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@abstract_types</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@nodetag_only</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$struct_no_query_jumble</span> = (<a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@no_query_jumble</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jfs</span> <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant">case T_</span><span class="Identifier">${n}</span><span class="Constant">:</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t\t</span><span class="Constant">_jumble</span><span class="Identifier">${n}</span><span class="Constant">(jstate, expr);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Special">\t\t\t\t</span><span class="Constant">break;</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$struct_no_query_jumble</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$n</span>, <span class="Identifier">@custom_query_jumble</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Constant">&quot;<br/></li>
<li></span><span class="Constant">static void<br/></li>
<li></span><span class="Constant">_jumble</span><span class="Identifier">${n}</span><span class="Constant">(JumbleState *jstate, Node *node)<br/></li>
<li></span><span class="Constant">{<br/></li>
<li></span><span class="Special">\t</span><span class="Identifier">${n}</span><span class="Constant"> *expr = (</span><span class="Identifier">${n}</span><span class="Constant"> *) node;</span><span class="Special">\n<br/></li>
<li></span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$struct_no_query_jumble</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># print instructions for each field<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$f</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$t</span> = <span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_types</span><span class="Identifier">}{$f}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@a</span> = <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">field_attrs</span><span class="Identifier">}{$f}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$query_jumble_ignore</span> = <span class="Identifier">$struct_no_query_jumble</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$query_jumble_location</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># extract per-field attributes<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$a</span> (<span class="Identifier">@a</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$a</span> <span class="Statement">eq</span> <span class="Constant">'query_jumble_ignore'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$query_jumble_ignore</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$a</span> <span class="Statement">eq</span> <span class="Constant">'query_jumble_location'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$query_jumble_location</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># node type<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(\w+)\*</span><span class="Constant">$</span><span class="Statement">/</span> <span class="Statement">or</span> <span class="Identifier">$t</span> =~ <span class="Statement">/</span><span class="Constant">^struct</span><span class="Special">\s+(\w+)\*</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">and</span> <a href="#L37" title="nodes/gen_node_support.pl:37">elem</a> <span class="Identifier">$1</span>, <span class="Identifier">@node_types</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">JUMBLE_NODE(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$query_jumble_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'ParseLoc'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Track the node's location only if directly requested.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$query_jumble_location</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">JUMBLE_LOCATION(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$query_jumble_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$t</span> <span class="Statement">eq</span> <span class="Constant">'char*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">JUMBLE_STRING(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$query_jumble_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">JUMBLE_FIELD(</span><span class="Identifier">$f</span><span class="Constant">);</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$query_jumble_ignore</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Some nodes have no attributes like CheckPointStmt,<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># so tweak things for empty contents.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">scalar</span>(<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$node_type_info{$n}-&gt;{</span><span class="Constant">fields</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">(void) expr;</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$struct_no_query_jumble</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$jff</span> <span class="Constant">&quot;}<br/></li>
<li></span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$struct_no_query_jumble</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$jff</span>;<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$jfs</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># now rename the temporary files to their final names<br/></li>
<li></span><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$file</span> (<span class="Identifier">@output_files</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Catalog::<a href="../catalog/Catalog.pm.html#L511" title="catalog/Catalog.pm:511">RenameTempFile</a>(<span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/</span><span class="Identifier">$file</span><span class="Constant">&quot;</span>, <span class="Identifier">$tmpext</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># Automatically clean up any temp files if the script fails.<br/></li>
<li></span><span class="PreProc">END<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># take care not to change the script's exit value<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$exit_code</span> = <span class="Identifier">$?</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$exit_code</span> != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$file</span> (<span class="Identifier">@output_files</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unlink</span>(<span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/</span><span class="Identifier">$file$tmpext</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$?</span> = <span class="Identifier">$exit_code</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
