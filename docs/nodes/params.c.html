<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>nodes/params.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>nodes/params.c - pgsql17devel-backend</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L335">BuildParamLogString</a></li>
<li><a href="#L167">EstimateParamListSpace</a></li>
<li><a href="#L407">ParamsErrorCallback</a></li>
<li><a href="#L292">RestoreParamList</a></li>
<li><a href="#L229">SerializeParamList</a></li>
<li><a href="#L78">copyParamList</a></li>
<li><a href="#L44">makeParamList</a></li>
<li><a href="#L131">paramlist_param_ref</a></li>
<li><a href="#L120">paramlist_parser_setup</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * params.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Support for finding the <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> associated with Param nodes.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/nodes/params.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;access/xact.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;fmgr.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;mb/stringinfo_mb.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;nodes/params.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;parser/parse_node.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/shmem.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/datum.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/lsyscache.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/memutils.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L120" title="nodes/params.c:120">paramlist_parser_setup</a>(ParseState *pstate, <span class="Type">void</span> *arg);<br/></li>
<li><span class="Type">static</span> Node *<a href="#L131" title="nodes/params.c:131">paramlist_param_ref</a>(ParseState *pstate, ParamRef *pref);<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Allocate and <a href="../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> a new ParamListInfo structure.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * To make a new structure for the &quot;dynamic&quot; way (with hooks), pass 0 for<br/></li>
<li></span><span class="Comment"> * numParams and set numParams manually.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * A default parserSetup function is supplied automatically.&nbsp; Callers may<br/></li>
<li></span><span class="Comment"> * override it if they choose.&nbsp; (Note that most use-cases for ParamListInfos<br/></li>
<li></span><span class="Comment"> * will never use the parserSetup function anyway.)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>ParamListInfo<br/></li>
<li><a id="L44">&#x200c;</a><span class="linkable">makeParamList</span>(<span class="Type">int</span> numParams)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; ParamListInfo retval;<br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = offsetof(ParamListInfoData, params) +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numParams * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(ParamExternData);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; retval = (ParamListInfo) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(size);<br/></li>
<li>&nbsp; &nbsp; retval-&gt;paramFetch = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; retval-&gt;paramFetchArg = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; retval-&gt;paramCompile = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; retval-&gt;paramCompileArg = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; retval-&gt;parserSetup = <a href="#L120" title="nodes/params.c:120">paramlist_parser_setup</a>;<br/></li>
<li>&nbsp; &nbsp; retval-&gt;parserSetupArg = (<span class="Type">void</span> *) retval;<br/></li>
<li>&nbsp; &nbsp; retval-&gt;paramValuesStr = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; retval-&gt;numParams = numParams;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> retval;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copy a ParamListInfo structure.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The result is allocated in <a href="../utils/mmgr/mcxt.c.html#L143" title="utils/mmgr/mcxt.c:143">CurrentMemoryContext</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note: the intent of this function is to make a static, self-contained<br/></li>
<li></span><span class="Comment"> * set of parameter <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.&nbsp; If dynamic parameter hooks are present, we<br/></li>
<li></span><span class="Comment"> * intentionally do not copy them into the result.&nbsp; Rather, we forcibly<br/></li>
<li></span><span class="Comment"> * instantiate all available parameter <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> and copy the datum <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * paramValuesStr is not copied, either.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>ParamListInfo<br/></li>
<li><a id="L78">&#x200c;</a><span class="linkable">copyParamList</span>(ParamListInfo from)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; ParamListInfo retval;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (from == <span class="Constant">NULL</span> || from-&gt;numParams &lt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; retval = <a href="#L44" title="nodes/params.c:44">makeParamList</a>(from-&gt;numParams);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; from-&gt;numParams; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData *oprm;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData *nprm = &amp;retval-&gt;params[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData prmdata;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; typLen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; typByVal;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* give hook a chance in case parameter is dynamic */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from-&gt;paramFetch != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oprm = from-&gt;paramFetch(from, i + <span class="Constant">1</span>, <span class="Constant">false</span>, &amp;prmdata);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oprm = &amp;from-&gt;params[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* flat-copy the parameter info */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *nprm = *oprm;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* need <a href="../utils/adt/datum.c.html#L132" title="utils/adt/datum.c:132">datumCopy</a> in case it's a pass-by-reference datatype */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nprm-&gt;isnull || !OidIsValid(nprm-&gt;ptype))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/cache/lsyscache.c.html#L2251" title="utils/cache/lsyscache.c:2251">get_typlenbyval</a>(nprm-&gt;ptype, &amp;typLen, &amp;typByVal);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; nprm-&gt;value = <a href="../utils/adt/datum.c.html#L132" title="utils/adt/datum.c:132">datumCopy</a>(nprm-&gt;value, typByVal, typLen);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> retval;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Set up to <a href="../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> a query containing references to parameters<br/></li>
<li></span><span class="Comment"> * sourced from a ParamListInfo.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L120">&#x200c;</a></span><span class="linkable">paramlist_parser_setup</span>(ParseState *pstate, <span class="Type">void</span> *arg)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; pstate-&gt;p_paramref_hook = <a href="#L131" title="nodes/params.c:131">paramlist_param_ref</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* no need to use p_coerce_param_hook */<br/></li>
<li></span>&nbsp; &nbsp; pstate-&gt;p_ref_hook_state = arg;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Transform a ParamRef using parameter type data from a ParamListInfo.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> Node *<br/></li>
<li><a id="L131">&#x200c;</a><span class="linkable">paramlist_param_ref</span>(ParseState *pstate, ParamRef *pref)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; ParamListInfo paramLI = (ParamListInfo) pstate-&gt;p_ref_hook_state;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; paramno = pref-&gt;number;<br/></li>
<li>&nbsp; &nbsp; ParamExternData *prm;<br/></li>
<li>&nbsp; &nbsp; ParamExternData prmdata;<br/></li>
<li>&nbsp; &nbsp; Param&nbsp; &nbsp; &nbsp;&nbsp; *param;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* check parameter number is valid */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (paramno &lt;= <span class="Constant">0</span> || paramno &gt; paramLI-&gt;numParams)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* give hook a chance in case parameter is dynamic */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (paramLI-&gt;paramFetch != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; prm = paramLI-&gt;paramFetch(paramLI, paramno, <span class="Constant">false</span>, &amp;prmdata);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; prm = &amp;paramLI-&gt;params[paramno - <span class="Constant">1</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(prm-&gt;ptype))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; param = makeNode(Param);<br/></li>
<li>&nbsp; &nbsp; param-&gt;paramkind = PARAM_EXTERN;<br/></li>
<li>&nbsp; &nbsp; param-&gt;paramid = paramno;<br/></li>
<li>&nbsp; &nbsp; param-&gt;paramtype = prm-&gt;ptype;<br/></li>
<li>&nbsp; &nbsp; param-&gt;paramtypmod = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; param-&gt;paramcollid = <a href="../utils/cache/lsyscache.c.html#L3056" title="utils/cache/lsyscache.c:3056">get_typcollation</a>(param-&gt;paramtype);<br/></li>
<li>&nbsp; &nbsp; param-&gt;location = pref-&gt;location;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (Node *) param;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Estimate the amount of space required to serialize a ParamListInfo.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Size<br/></li>
<li><a id="L167">&#x200c;</a><span class="linkable">EstimateParamListSpace</span>(ParamListInfo paramLI)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; sz = <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (paramLI == <span class="Constant">NULL</span> || paramLI-&gt;numParams &lt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> sz;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; paramLI-&gt;numParams; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData *prm;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData prmdata;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typeOid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; typLen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; typByVal;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* give hook a chance in case parameter is dynamic */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (paramLI-&gt;paramFetch != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prm = paramLI-&gt;paramFetch(paramLI, i + <span class="Constant">1</span>, <span class="Constant">false</span>, &amp;prmdata);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prm = &amp;paramLI-&gt;params[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; typeOid = prm-&gt;ptype;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sz = <a href="../storage/ipc/shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(sz, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Oid)); <span class="Comment">/* space for type OID */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; sz = <a href="../storage/ipc/shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(sz, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(uint16));&nbsp; &nbsp; <span class="Comment">/* space for pflags */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* space for datum/isnull */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (OidIsValid(typeOid))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/cache/lsyscache.c.html#L2251" title="utils/cache/lsyscache.c:2251">get_typlenbyval</a>(typeOid, &amp;typLen, &amp;typByVal);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If no type OID, assume by-value, like <a href="#L78" title="nodes/params.c:78">copyParamList</a> does. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typLen = <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Datum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typByVal = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sz = <a href="../storage/ipc/shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(sz,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/datum.c.html#L412" title="utils/adt/datum.c:412">datumEstimateSpace</a>(prm-&gt;value, prm-&gt;isnull, typByVal, typLen));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> sz;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Serialize a ParamListInfo structure into caller-provided storage.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We write the number of parameters first, as a 4-byte integer, and then<br/></li>
<li></span><span class="Comment"> * write details for each parameter in turn.&nbsp; The details for each parameter<br/></li>
<li></span><span class="Comment"> * consist of a 4-byte type OID, 2 bytes of flags, and then the datum as<br/></li>
<li></span><span class="Comment"> * serialized by <a href="../utils/adt/datum.c.html#L459" title="utils/adt/datum.c:459">datumSerialize</a>().&nbsp; The caller is responsible for ensuring<br/></li>
<li></span><span class="Comment"> * that there is enough storage to store the number of bytes that will be<br/></li>
<li></span><span class="Comment"> * written; use <a href="#L167" title="nodes/params.c:167">EstimateParamListSpace</a> to <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> out how many will be needed.<br/></li>
<li></span><span class="Comment"> * *start_address is updated to point to the byte immediately following those<br/></li>
<li></span><span class="Comment"> * written.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * <a href="#L292" title="nodes/params.c:292">RestoreParamList</a> can be used to recreate a ParamListInfo based on the<br/></li>
<li></span><span class="Comment"> * serialized representation; this will be a static, self-contained copy<br/></li>
<li></span><span class="Comment"> * just as <a href="#L78" title="nodes/params.c:78">copyParamList</a> would create.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * paramValuesStr is not included.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L229">&#x200c;</a></span><span class="linkable">SerializeParamList</span>(ParamListInfo paramLI, <span class="Type">char</span> **start_address)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nparams;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Write number of parameters. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (paramLI == <span class="Constant">NULL</span> || paramLI-&gt;numParams &lt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; nparams = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; nparams = paramLI-&gt;numParams;<br/></li>
<li>&nbsp; &nbsp; memcpy(*start_address, &amp;nparams, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>));<br/></li>
<li>&nbsp; &nbsp; *start_address += <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Write each parameter in turn. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; nparams; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData *prm;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData prmdata;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typeOid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; typLen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; typByVal;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* give hook a chance in case parameter is dynamic */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (paramLI-&gt;paramFetch != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prm = paramLI-&gt;paramFetch(paramLI, i + <span class="Constant">1</span>, <span class="Constant">false</span>, &amp;prmdata);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prm = &amp;paramLI-&gt;params[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; typeOid = prm-&gt;ptype;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Write type OID. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(*start_address, &amp;typeOid, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Oid));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *start_address += <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Oid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Write flags. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(*start_address, &amp;prm-&gt;pflags, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(uint16));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *start_address += <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(uint16);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Write datum/isnull. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (OidIsValid(typeOid))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/cache/lsyscache.c.html#L2251" title="utils/cache/lsyscache.c:2251">get_typlenbyval</a>(typeOid, &amp;typLen, &amp;typByVal);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If no type OID, assume by-value, like <a href="#L78" title="nodes/params.c:78">copyParamList</a> does. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typLen = <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Datum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typByVal = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/datum.c.html#L459" title="utils/adt/datum.c:459">datumSerialize</a>(prm-&gt;value, prm-&gt;isnull, typByVal, typLen,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; start_address);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copy a ParamListInfo structure.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The result is allocated in <a href="../utils/mmgr/mcxt.c.html#L143" title="utils/mmgr/mcxt.c:143">CurrentMemoryContext</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note: the intent of this function is to make a static, self-contained<br/></li>
<li></span><span class="Comment"> * set of parameter <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.&nbsp; If dynamic parameter hooks are present, we<br/></li>
<li></span><span class="Comment"> * intentionally do not copy them into the result.&nbsp; Rather, we forcibly<br/></li>
<li></span><span class="Comment"> * instantiate all available parameter <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> and copy the datum <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>ParamListInfo<br/></li>
<li><a id="L292">&#x200c;</a><span class="linkable">RestoreParamList</span>(<span class="Type">char</span> **start_address)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; ParamListInfo paramLI;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nparams;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memcpy(&amp;nparams, *start_address, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>));<br/></li>
<li>&nbsp; &nbsp; *start_address += <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; paramLI = <a href="#L44" title="nodes/params.c:44">makeParamList</a>(nparams);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; nparams; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData *prm = &amp;paramLI-&gt;params[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Read type OID. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(&amp;prm-&gt;ptype, *start_address, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Oid));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *start_address += <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Oid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Read flags. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(&amp;prm-&gt;pflags, *start_address, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(uint16));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *start_address += <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(uint16);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Read datum/isnull. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; prm-&gt;value = <a href="../utils/adt/datum.c.html#L521" title="utils/adt/datum.c:521">datumRestore</a>(start_address, &amp;prm-&gt;isnull);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> paramLI;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L335" title="nodes/params.c:335">BuildParamLogString</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Return a string that represents the parameter list, for logging.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If caller already knows textual representations for some parameters, it can<br/></li>
<li></span><span class="Comment"> * pass an array of exactly params-&gt;numParams <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> as knownTextValues, which<br/></li>
<li></span><span class="Comment"> * can contain NULLs for <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> unknown individual <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.&nbsp; NULL can be given if<br/></li>
<li></span><span class="Comment"> * no parameters are known.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If maxlen is &gt;= 0, that's the maximum number of bytes of <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> one<br/></li>
<li></span><span class="Comment"> * parameter value to be printed; an ellipsis is added if the string is<br/></li>
<li></span><span class="Comment"> * longer.&nbsp; (Added quotes are not considered in this calculation.)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L335">&#x200c;</a><span class="linkable">BuildParamLogString</span>(ParamListInfo params, <span class="Type">char</span> **knownTextValues, <span class="Type">int</span> maxlen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; MemoryContext tmpCxt,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldCxt;<br/></li>
<li>&nbsp; &nbsp; StringInfoData buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * NB: think not of returning params-&gt;paramValuesStr!&nbsp; It may have been<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * generated with a different maxlen, and so be unsuitable.&nbsp; Besides that,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * this is the function used to create that string.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * No work if the param fetch hook is in use.&nbsp; Also, it's not possible to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * do this in an aborted transaction.&nbsp; (It might be possible to improve on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * this last point when some knownTextValues exist, but it seems tricky.)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (params-&gt;paramFetch != <span class="Constant">NULL</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../access/transam/xact.c.html#L404" title="access/transam/xact.c:404">IsAbortedTransactionBlockState</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Initialize the output stringinfo, in caller's memory context */<br/></li>
<li></span>&nbsp; &nbsp; initStringInfo(&amp;buf);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Use a temporary context to call output <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>, just in case */<br/></li>
<li></span>&nbsp; &nbsp; tmpCxt = AllocSetContextCreate(<a href="../utils/mmgr/mcxt.c.html#L143" title="utils/mmgr/mcxt.c:143">CurrentMemoryContext</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;<a href="#L335" title="nodes/params.c:335">BuildParamLogString</a>&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ALLOCSET_DEFAULT_SIZES);<br/></li>
<li>&nbsp; &nbsp; oldCxt = MemoryContextSwitchTo(tmpCxt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> paramno = <span class="Constant">0</span>; paramno &lt; params-&gt;numParams; paramno++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ParamExternData *param = &amp;params-&gt;params[paramno];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; appendStringInfo(&amp;buf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">$</span><span class="Special">%d</span><span class="Constant"> = &quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; paramno &gt; <span class="Constant">0</span> ? <span class="Constant">&quot;, &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; paramno + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (param-&gt;isnull || !OidIsValid(param-&gt;ptype))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; appendStringInfoString(&amp;buf, <span class="Constant">&quot;NULL&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (knownTextValues != <span class="Constant">NULL</span> &amp;&amp; knownTextValues[paramno] != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mb/stringinfo_mb.c.html#L34" title="utils/mb/stringinfo_mb.c:34">appendStringInfoStringQuoted</a>(&amp;buf, knownTextValues[paramno],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; maxlen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typoutput;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; typisvarlena;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *pstring;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/cache/lsyscache.c.html#L2907" title="utils/cache/lsyscache.c:2907">getTypeOutputInfo</a>(param-&gt;ptype, &amp;typoutput, &amp;typisvarlena);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pstring = <a href="../utils/fmgr/fmgr.c.html#L1763" title="utils/fmgr/fmgr.c:1763">OidOutputFunctionCall</a>(typoutput, param-&gt;value);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mb/stringinfo_mb.c.html#L34" title="utils/mb/stringinfo_mb.c:34">appendStringInfoStringQuoted</a>(&amp;buf, pstring, maxlen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(oldCxt);<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L454" title="utils/mmgr/mcxt.c:454">MemoryContextDelete</a>(tmpCxt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> buf.data;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L407" title="nodes/params.c:407">ParamsErrorCallback</a> - callback for printing parameters in error context<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note that this is a no-op unless <a href="#L335" title="nodes/params.c:335">BuildParamLogString</a> has been called<br/></li>
<li></span><span class="Comment"> * beforehand.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L407">&#x200c;</a></span><span class="linkable">ParamsErrorCallback</span>(<span class="Type">void</span> *arg)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; ParamsErrorCbData *data = (ParamsErrorCbData *) arg;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (data == <span class="Constant">NULL</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data-&gt;params == <span class="Constant">NULL</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data-&gt;params-&gt;paramValuesStr == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (data-&gt;portalName &amp;&amp; data-&gt;portalName[<span class="Constant">0</span>] != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; errcontext(<span class="Constant">&quot;portal </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> with parameters: </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; data-&gt;portalName, data-&gt;params-&gt;paramValuesStr);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; errcontext(<span class="Constant">&quot;unnamed portal with parameters: </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; data-&gt;params-&gt;paramValuesStr);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
