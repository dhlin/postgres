<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>lib/rbtree.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>lib/rbtree.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L63">sentinel</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L41">RBTree</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L802">rbt_begin_iterate</a></li>
<li><a href="#L127">rbt_copy_data</a></li>
<li><a href="#L102">rbt_create</a></li>
<li><a href="#L695">rbt_delete</a></li>
<li><a href="#L521">rbt_delete_fixup</a></li>
<li><a href="#L619">rbt_delete_node</a></li>
<li><a href="#L145">rbt_find</a></li>
<li><a href="#L172">rbt_find_great</a></li>
<li><a href="#L203">rbt_find_less</a></li>
<li><a href="#L453">rbt_insert</a></li>
<li><a href="#L344">rbt_insert_fixup</a></li>
<li><a href="#L826">rbt_iterate</a></li>
<li><a href="#L705">rbt_left_right_iterator</a></li>
<li><a href="#L235">rbt_leftmost</a></li>
<li><a href="#L747">rbt_right_left_iterator</a></li>
<li><a href="#L263">rbt_rotate_left</a></li>
<li><a href="#L300">rbt_rotate_right</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L35">RBTBLACK</a></li>
<li><a href="#L61">RBTNIL</a></li>
<li><a href="#L36">RBTRED</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * rbtree.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; implementation for PostgreSQL generic Red-Black binary tree package<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Adopted from http://algolist.manual.ru/ds/rbtree.php<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This code comes from Thomas Niemann's &quot;Sorting and Searching Algorithms:<br/></li>
<li></span><span class="Comment"> * a Cookbook&quot;.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * See http://www.cs.auckland.ac.nz/software/AlgAnim/niemann/s_man.htm for<br/></li>
<li></span><span class="Comment"> * license terms: &quot;Source code, when part of a software project, may be used<br/></li>
<li></span><span class="Comment"> * freely without reference to the author.&quot;<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Red-black trees are a type of balanced binary tree wherein (1) <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> child of<br/></li>
<li></span><span class="Comment"> * a red node is always black, and (2) every path from root to leaf traverses<br/></li>
<li></span><span class="Comment"> * an <a href="../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> number of black nodes.&nbsp; From these properties, it follows that the<br/></li>
<li></span><span class="Comment"> * <a href="../regex/rege_dfa.c.html#L42" title="regex/rege_dfa.c:42">longest</a> path from root to leaf is only about twice as long as the <a href="../regex/rege_dfa.c.html#L204" title="regex/rege_dfa.c:204">shortest</a>,<br/></li>
<li></span><span class="Comment"> * so lookups are guaranteed to run in O(lg n) time.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2009-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/lib/rbtree.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lib/rbtree.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Colors of nodes (<a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> of RBTNode.color)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L35">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RBTBLACK</span>&nbsp; &nbsp; (</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li><a id="L36">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RBTRED</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L41" title="lib/rbtree.c:41">RBTree</a> control structure<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L41">&#x200c;</a></span><span class="Type">struct</span> <span class="linkable">RBTree</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *root;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* root node, or <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a> if tree is empty */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Remaining fields are constant after <a href="#L102" title="lib/rbtree.c:102">rbt_create</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; node_size;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* actual size of tree nodes */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* The caller-supplied manipulation <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> */<br/></li>
<li></span>&nbsp; &nbsp; rbt_comparator comparator;<br/></li>
<li>&nbsp; &nbsp; rbt_combiner combiner;<br/></li>
<li>&nbsp; &nbsp; rbt_allocfunc allocfunc;<br/></li>
<li>&nbsp; &nbsp; rbt_freefunc freefunc;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Passthrough arg passed to all manipulation <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp;&nbsp; *arg;<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * all leafs are sentinels, use customized NIL name to prevent<br/></li>
<li></span><span class="Comment"> * collision with system-wide constant NIL which is actually NULL<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L61">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RBTNIL</span> (&amp;<a href="#L63" title="lib/rbtree.c:63">sentinel</a>)<br/></li>
<li></span><br/></li>
<li><a id="L63">&#x200c;</a><span class="Type">static</span> RBTNode <span class="linkable">sentinel</span> =<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; .color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>,.left = <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>,.right = <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>,.parent = <span class="Constant">NULL<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L102" title="lib/rbtree.c:102">rbt_create</a>: create an empty <a href="#L41" title="lib/rbtree.c:41">RBTree</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Arguments are:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; node_size: actual size of tree nodes (&gt; <a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a>(RBTNode))<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; The manipulation <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; comparator: <a href="../optimizer/geqo/geqo_pool.c.html#L145" title="optimizer/geqo/geqo_pool.c:145">compare</a> two RBTNodes for less/<a href="../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a>/greater<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; combiner: <a href="pairingheap.c.html#L79" title="lib/pairingheap.c:79">merge</a> an existing tree entry with a new one<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; allocfunc: allocate a new RBTNode<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; freefunc: free an old RBTNode<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; arg: passthrough pointer that will be passed to the manipulation <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note that the combiner's righthand argument will be a &quot;proposed&quot; tree node,<br/></li>
<li></span><span class="Comment"> * ie the input to <a href="#L453" title="lib/rbtree.c:453">rbt_insert</a>, in which the RBTNode fields themselves aren't<br/></li>
<li></span><span class="Comment"> * valid.&nbsp; Similarly, either input to the comparator may be a &quot;proposed&quot; node.<br/></li>
<li></span><span class="Comment"> * This shouldn't matter since the <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> aren't supposed to look at the<br/></li>
<li></span><span class="Comment"> * RBTNode fields, only the extra fields of the struct the RBTNode is embedded<br/></li>
<li></span><span class="Comment"> * in.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The freefunc should just be <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a> or equivalent; it should NOT attempt<br/></li>
<li></span><span class="Comment"> * to free <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> subsidiary data, because the node passed to it may not contain<br/></li>
<li></span><span class="Comment"> * valid data!&nbsp; &nbsp; freefunc can be NULL if caller doesn't require retail<br/></li>
<li></span><span class="Comment"> * space reclamation.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The <a href="#L41" title="lib/rbtree.c:41">RBTree</a> node is <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'d in the caller's memory context.&nbsp; Note that<br/></li>
<li></span><span class="Comment"> * all contents of the tree are actually allocated by the caller, not here.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Since tree contents are managed by the caller, there is currently not<br/></li>
<li></span><span class="Comment"> * an explicit &quot;destroy&quot; operation; typically a tree would be freed by<br/></li>
<li></span><span class="Comment"> * resetting or deleting the memory context it's stored in.&nbsp; You can <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a><br/></li>
<li></span><span class="Comment"> * the <a href="#L41" title="lib/rbtree.c:41">RBTree</a> node if you feel the urge.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><a href="#L41" title="lib/rbtree.c:41">RBTree</a> *<br/></li>
<li><a id="L102">&#x200c;</a><span class="linkable">rbt_create</span>(Size node_size,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rbt_comparator comparator,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rbt_combiner combiner,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rbt_allocfunc allocfunc,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rbt_freefunc freefunc,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">void</span> *arg)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L41" title="lib/rbtree.c:41">RBTree</a>&nbsp; &nbsp; &nbsp;&nbsp; *tree = (<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(node_size &gt; <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(RBTNode));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; tree-&gt;root = <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>;<br/></li>
<li>&nbsp; &nbsp; tree-&gt;node_size = node_size;<br/></li>
<li>&nbsp; &nbsp; tree-&gt;comparator = comparator;<br/></li>
<li>&nbsp; &nbsp; tree-&gt;combiner = combiner;<br/></li>
<li>&nbsp; &nbsp; tree-&gt;allocfunc = allocfunc;<br/></li>
<li>&nbsp; &nbsp; tree-&gt;freefunc = freefunc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; tree-&gt;arg = arg;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> tree;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Copy the additional data fields from one RBTNode to another */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">inline</span> <span class="Type">void<br/></li>
<li><a id="L127">&#x200c;</a></span><span class="linkable">rbt_copy_data</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTNode *dest, <span class="Type">const</span> RBTNode *src)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; memcpy(dest + <span class="Constant">1</span>, src + <span class="Constant">1</span>, rbt-&gt;node_size - <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(RBTNode));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/**********************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Search&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment"> **********************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L145" title="lib/rbtree.c:145">rbt_find</a>: search for a value in an <a href="#L41" title="lib/rbtree.c:41">RBTree</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * data represents the value to try to <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>.&nbsp; Its RBTNode fields need not<br/></li>
<li></span><span class="Comment"> * be valid, it's the extra data in the larger struct that is of interest.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns the matching tree entry, or NULL if no match is found.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>RBTNode *<br/></li>
<li><a id="L145">&#x200c;</a><span class="linkable">rbt_find</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, <span class="Type">const</span> RBTNode *data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *node = rbt-&gt;root;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (node != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> = rbt-&gt;comparator(data, node, rbt-&gt;arg);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;left;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;right;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L172" title="lib/rbtree.c:172">rbt_find_great</a>: search for a greater value in an <a href="#L41" title="lib/rbtree.c:41">RBTree</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If equal_match is true, this will be a great or <a href="../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> search.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns the matching tree entry, or NULL if no match is found.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>RBTNode *<br/></li>
<li><a id="L172">&#x200c;</a><span class="linkable">rbt_find_great</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, <span class="Type">const</span> RBTNode *data, <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> equal_match)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *node = rbt-&gt;root;<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *greater = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (node != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> = rbt-&gt;comparator(data, node, rbt-&gt;arg);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (equal_match &amp;&amp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; greater = node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;left;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;right;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> greater;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L203" title="lib/rbtree.c:203">rbt_find_less</a>: search for a lesser value in an <a href="#L41" title="lib/rbtree.c:41">RBTree</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If equal_match is true, this will be a less or <a href="../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> search.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns the matching tree entry, or NULL if no match is found.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>RBTNode *<br/></li>
<li><a id="L203">&#x200c;</a><span class="linkable">rbt_find_less</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, <span class="Type">const</span> RBTNode *data, <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> equal_match)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *node = rbt-&gt;root;<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *lesser = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (node != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> = rbt-&gt;comparator(data, node, rbt-&gt;arg);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (equal_match &amp;&amp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lesser = node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;left;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> lesser;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L235" title="lib/rbtree.c:235">rbt_leftmost</a>: fetch the leftmost (smallest-valued) tree node.<br/></li>
<li></span><span class="Comment"> * Returns NULL if tree is empty.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note: in the original implementation this included an unlink step, but<br/></li>
<li></span><span class="Comment"> * that's a <a href="../utils/adt/varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> awkward.&nbsp; Just call <a href="#L695" title="lib/rbtree.c:695">rbt_delete</a> on the result if that's what<br/></li>
<li></span><span class="Comment"> * you want.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>RBTNode *<br/></li>
<li><a id="L235">&#x200c;</a><span class="linkable">rbt_leftmost</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *node = rbt-&gt;root;<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *leftmost = rbt-&gt;root;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (node != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; leftmost = node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;left;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (leftmost != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> leftmost;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/**********************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Insertion&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment"> **********************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Rotate node x to left.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * x's right child takes its place in the tree, and x becomes the left<br/></li>
<li></span><span class="Comment"> * child of that node.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L263">&#x200c;</a></span><span class="linkable">rbt_rotate_left</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTNode *x)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *y = x-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* establish x-&gt;right link */<br/></li>
<li></span>&nbsp; &nbsp; x-&gt;right = y-&gt;left;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (y-&gt;left != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; y-&gt;left-&gt;parent = x;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* establish y-&gt;parent link */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (y != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; y-&gt;parent = x-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (x-&gt;parent)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (x == x-&gt;parent-&gt;left)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;left = y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;right = y;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rbt-&gt;root = y;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* link x and y */<br/></li>
<li></span>&nbsp; &nbsp; y-&gt;left = x;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (x != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent = y;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Rotate node x to right.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * x's left right child takes its place in the tree, and x becomes the right<br/></li>
<li></span><span class="Comment"> * child of that node.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L300">&#x200c;</a></span><span class="linkable">rbt_rotate_right</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTNode *x)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *y = x-&gt;left;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* establish x-&gt;left link */<br/></li>
<li></span>&nbsp; &nbsp; x-&gt;left = y-&gt;right;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (y-&gt;right != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; y-&gt;right-&gt;parent = x;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* establish y-&gt;parent link */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (y != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; y-&gt;parent = x-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (x-&gt;parent)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (x == x-&gt;parent-&gt;right)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;right = y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;left = y;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rbt-&gt;root = y;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* link x and y */<br/></li>
<li></span>&nbsp; &nbsp; y-&gt;right = x;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (x != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent = y;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Maintain Red-Black tree balance after inserting node x.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The newly inserted node is always initially marked red.&nbsp; That may lead to<br/></li>
<li></span><span class="Comment"> * a situation where a red node has a red child, which is prohibited.&nbsp; We can<br/></li>
<li></span><span class="Comment"> * always fix the problem by a series of color changes and/or &quot;rotations&quot;,<br/></li>
<li></span><span class="Comment"> * which move the problem progressively higher up in the tree.&nbsp; If one of the<br/></li>
<li></span><span class="Comment"> * two red nodes is the root, we can always fix the problem by changing the<br/></li>
<li></span><span class="Comment"> * root from red to black.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * (This does not work <a href="../utils/adt/oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a> down in the tree because we must also maintain<br/></li>
<li></span><span class="Comment"> * the invariant that every leaf has <a href="../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> black-height.)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L344">&#x200c;</a></span><span class="linkable">rbt_insert_fixup</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTNode *x)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * x is always a red node.&nbsp; Initially, it is the newly inserted node. Each<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * iteration of this loop moves it higher up in the tree.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (x != rbt-&gt;root &amp;&amp; x-&gt;parent-&gt;color == <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * x and x-&gt;parent are both red.&nbsp; Fix depends on whether x-&gt;parent is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * a left or right child.&nbsp; In either case, we define y to be the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * &quot;uncle&quot; of x, that is, the other child of x's grandparent.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If the uncle is red, we flip the grandparent to red and its two<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * children to black.&nbsp; Then we loop around again to check whether the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * grandparent still has a problem.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If the uncle is black, we will perform one or two &quot;rotations&quot; to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * balance the tree.&nbsp; Either x or x-&gt;parent will take the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * grandparent's position in the tree and recolored black, and the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * original grandparent will be recolored red and become a child of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * that node. This always leaves us with a valid red-black tree, so<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the loop will terminate.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (x-&gt;parent == x-&gt;parent-&gt;parent-&gt;left)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RBTNode&nbsp; &nbsp; *y = x-&gt;parent-&gt;parent-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (y-&gt;color == <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* uncle is <a href="#L36" title="lib/rbtree.c:36">RBTRED</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;parent-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = x-&gt;parent-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* uncle is <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (x == x-&gt;parent-&gt;right)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* make x a left child */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = x-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L263" title="lib/rbtree.c:263">rbt_rotate_left</a>(rbt, x);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* recolor and rotate */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;parent-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L300" title="lib/rbtree.c:300">rbt_rotate_right</a>(rbt, x-&gt;parent-&gt;parent);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* mirror image of above code */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RBTNode&nbsp; &nbsp; *y = x-&gt;parent-&gt;parent-&gt;left;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (y-&gt;color == <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* uncle is <a href="#L36" title="lib/rbtree.c:36">RBTRED</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;parent-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = x-&gt;parent-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* uncle is <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (x == x-&gt;parent-&gt;left)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = x-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L300" title="lib/rbtree.c:300">rbt_rotate_right</a>(rbt, x);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;parent-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L263" title="lib/rbtree.c:263">rbt_rotate_left</a>(rbt, x-&gt;parent-&gt;parent);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * The root may already have been black; if not, the black-height of every<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * node in the tree increases by one.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; rbt-&gt;root-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L453" title="lib/rbtree.c:453">rbt_insert</a>: insert a new value into the tree.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * data represents the value to insert.&nbsp; Its RBTNode fields need not<br/></li>
<li></span><span class="Comment"> * be valid, it's the extra data in the larger struct that is of interest.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If the value represented by &quot;data&quot; is not present in the tree, then<br/></li>
<li></span><span class="Comment"> * we copy &quot;data&quot; into a new tree entry and return that node, setting *isNew<br/></li>
<li></span><span class="Comment"> * to true.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If the value represented by &quot;data&quot; is already present, then we call the<br/></li>
<li></span><span class="Comment"> * combiner function to <a href="pairingheap.c.html#L79" title="lib/pairingheap.c:79">merge</a> data into the existing node, and return the<br/></li>
<li></span><span class="Comment"> * existing node, setting *isNew to false.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * &quot;data&quot; is unmodified in either case; it's typically just a local<br/></li>
<li></span><span class="Comment"> * variable in the caller.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>RBTNode *<br/></li>
<li><a id="L453">&#x200c;</a><span class="linkable">rbt_insert</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, <span class="Type">const</span> RBTNode *data, <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> *isNew)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *current,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *parent,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *x;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> where node belongs */<br/></li>
<li></span>&nbsp; &nbsp; current = rbt-&gt;root;<br/></li>
<li>&nbsp; &nbsp; parent = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* just to prevent compiler warning */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (current != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> = rbt-&gt;comparator(data, current, rbt-&gt;arg);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Found node with given key.&nbsp; Apply combiner.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rbt-&gt;combiner(current, data, rbt-&gt;arg);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *isNew = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> current;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; parent = current;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; current = (<a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> &lt; <span class="Constant">0</span>) ? current-&gt;left : current-&gt;right;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Value is not present, so create a new node containing data.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; *isNew = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; x = rbt-&gt;allocfunc(rbt-&gt;arg);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; x-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; x-&gt;left = <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>;<br/></li>
<li>&nbsp; &nbsp; x-&gt;right = <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>;<br/></li>
<li>&nbsp; &nbsp; x-&gt;parent = parent;<br/></li>
<li>&nbsp; &nbsp; <a href="#L127" title="lib/rbtree.c:127">rbt_copy_data</a>(rbt, x, data);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* insert node in tree */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (parent)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../regex/regc_locale.c.html#L743" title="regex/regc_locale.c:743">cmp</a> &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; parent-&gt;left = x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; parent-&gt;right = x;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rbt-&gt;root = x;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L344" title="lib/rbtree.c:344">rbt_insert_fixup</a>(rbt, x);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> x;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/**********************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Deletion&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment"> **********************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Maintain Red-Black tree balance after deleting a black node.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L521">&#x200c;</a></span><span class="linkable">rbt_delete_fixup</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTNode *x)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * x is always a black node.&nbsp; Initially, it is the former child of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * deleted node.&nbsp; Each iteration of this loop moves it higher up in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * tree.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (x != rbt-&gt;root &amp;&amp; x-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Left and right cases are symmetric.&nbsp; Any nodes that are children of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * x have a black-height one less than the remainder of the nodes in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the tree.&nbsp; We rotate and recolor nodes to move the problem up the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * tree: at some stage we'll either fix the problem, or reach the root<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * (where the black-height is allowed to decrease).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (x == x-&gt;parent-&gt;left)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RBTNode&nbsp; &nbsp; *w = x-&gt;parent-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (w-&gt;color == <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L263" title="lib/rbtree.c:263">rbt_rotate_left</a>(rbt, x-&gt;parent);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = x-&gt;parent-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (w-&gt;left-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a> &amp;&amp; w-&gt;right-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = x-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (w-&gt;right-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;left-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L300" title="lib/rbtree.c:300">rbt_rotate_right</a>(rbt, w);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = x-&gt;parent-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = x-&gt;parent-&gt;color;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;right-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L263" title="lib/rbtree.c:263">rbt_rotate_left</a>(rbt, x-&gt;parent);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = rbt-&gt;root;&nbsp; &nbsp; <span class="Comment">/* Arrange for loop to terminate. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RBTNode&nbsp; &nbsp; *w = x-&gt;parent-&gt;left;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (w-&gt;color == <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L300" title="lib/rbtree.c:300">rbt_rotate_right</a>(rbt, x-&gt;parent);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = x-&gt;parent-&gt;left;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (w-&gt;right-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a> &amp;&amp; w-&gt;left-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = x-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (w-&gt;left-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;right-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = <a href="#L36" title="lib/rbtree.c:36">RBTRED</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L263" title="lib/rbtree.c:263">rbt_rotate_left</a>(rbt, w);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = x-&gt;parent-&gt;left;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;color = x-&gt;parent-&gt;color;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x-&gt;parent-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w-&gt;left-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L300" title="lib/rbtree.c:300">rbt_rotate_right</a>(rbt, x-&gt;parent);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = rbt-&gt;root;&nbsp; &nbsp; <span class="Comment">/* Arrange for loop to terminate. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; x-&gt;color = <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="../storage/file/fd.c.html#L1268" title="storage/file/fd.c:1268">Delete</a> node z from tree.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L619">&#x200c;</a></span><span class="linkable">rbt_delete_node</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTNode *z)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RBTNode&nbsp; &nbsp; *x,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *y;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* This is just paranoia: we should only get called on a valid node */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!z || z == <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * y is the node that will actually be removed from the tree.&nbsp; This will<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * be z if z has fewer than two children, or the tree successor of z<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * otherwise.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (z-&gt;left == <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a> || z-&gt;right == <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* y has a <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a> node as a child */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; y = z;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> tree successor */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; y = z-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (y-&gt;left != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y = y-&gt;left;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* x is y's only child */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (y-&gt;left != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x = y-&gt;left;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; x = y-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Remove y from the tree. */<br/></li>
<li></span>&nbsp; &nbsp; x-&gt;parent = y-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (y-&gt;parent)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (y == y-&gt;parent-&gt;left)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y-&gt;parent-&gt;left = x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y-&gt;parent-&gt;right = x;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rbt-&gt;root = x;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If we removed the tree successor of z rather than z itself, then move<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the data for the removed node to the one we were supposed to remove.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (y != z)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L127" title="lib/rbtree.c:127">rbt_copy_data</a>(rbt, z, y);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Removing a black node might make some paths from root to leaf contain<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * fewer black nodes than others, or it might make two red nodes adjacent.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (y-&gt;color == <a href="#L35" title="lib/rbtree.c:35">RBTBLACK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L521" title="lib/rbtree.c:521">rbt_delete_fixup</a>(rbt, x);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Now we can recycle the y node */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (rbt-&gt;freefunc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rbt-&gt;freefunc(y, rbt-&gt;arg);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L695" title="lib/rbtree.c:695">rbt_delete</a>: remove the given tree entry<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * &quot;node&quot; must have previously been found via <a href="#L145" title="lib/rbtree.c:145">rbt_find</a> or <a href="#L235" title="lib/rbtree.c:235">rbt_leftmost</a>.<br/></li>
<li></span><span class="Comment"> * It is caller's responsibility to free <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> subsidiary data attached<br/></li>
<li></span><span class="Comment"> * to the node <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> calling <a href="#L695" title="lib/rbtree.c:695">rbt_delete</a>.&nbsp; (Do *not* try to <a href="../regex/regc_nfa.c.html#L1884" title="regex/regc_nfa.c:1884">push</a> that<br/></li>
<li></span><span class="Comment"> * responsibility off to the freefunc, as some other physical node<br/></li>
<li></span><span class="Comment"> * may be the one actually freed!)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L695">&#x200c;</a></span><span class="linkable">rbt_delete</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTNode *node)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L619" title="lib/rbtree.c:619">rbt_delete_node</a>(rbt, node);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/**********************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Traverse&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br/></li>
<li></span><span class="Comment"> **********************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> RBTNode *<br/></li>
<li><a id="L705">&#x200c;</a><span class="linkable">rbt_left_right_iterator</span>(RBTreeIterator *iter)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;rbt-&gt;root;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (iter-&gt;last_visited-&gt;left != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;left;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> iter-&gt;last_visited;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited-&gt;right != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (iter-&gt;last_visited-&gt;left != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;left;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> iter-&gt;last_visited;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (;;)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; RBTNode&nbsp; &nbsp; *came_from = iter-&gt;last_visited;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;is_over = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited-&gt;left == came_from)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* came from left sub-tree, return current<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * node */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* else - came from right sub-tree, continue to move up */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> iter-&gt;last_visited;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> RBTNode *<br/></li>
<li><a id="L747">&#x200c;</a><span class="linkable">rbt_right_left_iterator</span>(RBTreeIterator *iter)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;rbt-&gt;root;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (iter-&gt;last_visited-&gt;right != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> iter-&gt;last_visited;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited-&gt;left != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;left;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (iter-&gt;last_visited-&gt;right != <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> iter-&gt;last_visited;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (;;)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; RBTNode&nbsp; &nbsp; *came_from = iter-&gt;last_visited;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;last_visited = iter-&gt;last_visited-&gt;parent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;is_over = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;last_visited-&gt;right == came_from)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* came from right sub-tree, return current<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * node */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* else - came from left sub-tree, continue to move up */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> iter-&gt;last_visited;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L802" title="lib/rbtree.c:802">rbt_begin_iterate</a>: prepare to traverse the tree in <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> of several orders<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * After calling <a href="#L802" title="lib/rbtree.c:802">rbt_begin_iterate</a>, call <a href="#L826" title="lib/rbtree.c:826">rbt_iterate</a> repeatedly until it<br/></li>
<li></span><span class="Comment"> * returns NULL or the traversal stops being of interest.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If the tree is changed during traversal, results of further calls to<br/></li>
<li></span><span class="Comment"> * <a href="#L826" title="lib/rbtree.c:826">rbt_iterate</a> are unspecified.&nbsp; Multiple concurrent iterators on the same<br/></li>
<li></span><span class="Comment"> * tree are allowed.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The iterator state is stored in the 'iter' struct.&nbsp; The caller should<br/></li>
<li></span><span class="Comment"> * treat it as an opaque struct.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L802">&#x200c;</a></span><span class="linkable">rbt_begin_iterate</span>(<a href="#L41" title="lib/rbtree.c:41">RBTree</a> *rbt, RBTOrderControl ctrl, RBTreeIterator *iter)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Common initialization for all traversal orders */<br/></li>
<li></span>&nbsp; &nbsp; iter-&gt;rbt = rbt;<br/></li>
<li>&nbsp; &nbsp; iter-&gt;last_visited = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; iter-&gt;is_over = (rbt-&gt;root == <a href="#L61" title="lib/rbtree.c:61">RBTNIL</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (ctrl)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> LeftRightWalk:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* visit left, then self, then right */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;iterate = <a href="#L705" title="lib/rbtree.c:705">rbt_left_right_iterator</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RightLeftWalk:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* visit right, then self, then left */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;iterate = <a href="#L747" title="lib/rbtree.c:747">rbt_right_left_iterator</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized rbtree iteration order: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, ctrl);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L826" title="lib/rbtree.c:826">rbt_iterate</a>: return the <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> node in traversal order, or NULL if no more<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>RBTNode *<br/></li>
<li><a id="L826">&#x200c;</a><span class="linkable">rbt_iterate</span>(RBTreeIterator *iter)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (iter-&gt;is_over)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> iter-&gt;iterate(iter);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
