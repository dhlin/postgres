<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../../../index.html">Top Level</a></span>
 </p>

  <h1>utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L22">gb18030_to_utf8</a></li>
<li><a href="#L23">utf8_to_gb18030</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L128">conv_18030_to_utf8</a></li>
<li><a href="#L155">conv_utf8_to_18030</a></li>
<li><a href="#L194">gb18030_to_utf8</a></li>
<li><a href="#L32">gb_linear</a></li>
<li><a href="#L44">gb_unlinear</a></li>
<li><a href="#L60">unicode_to_utf8word</a></li>
<li><a href="#L215">utf8_to_gb18030</a></li>
<li><a href="#L91">utf8word_to_unicode</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L130">conv18030</a></li>
<li><a href="#L159">convutf8</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; GB18030 &lt;--&gt; UTF8<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;fmgr.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;mb/pg_wchar.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;../../Unicode/<a href="#L22" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:22">gb18030_to_utf8</a>.map&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;../../Unicode/<a href="#L23" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:23">utf8_to_gb18030</a>.map&quot;<br/></li>
<li></span><br/></li>
<li>PG_MODULE_MAGIC;<br/></li>
<li><br/></li>
<li><a id="L22">&#x200c;</a>PG_FUNCTION_INFO_V1(<span class="linkable">gb18030_to_utf8</span>);<br/></li>
<li><a id="L23">&#x200c;</a>PG_FUNCTION_INFO_V1(<span class="linkable">utf8_to_gb18030</span>);<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Convert 4-byte GB18030 characters to and from a linear code space<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The first and third bytes can <a href="../../../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from 0x81 to 0xfe (126 <a href="../../../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>),<br/></li>
<li></span><span class="Comment"> * while the second and fourth bytes can <a href="../../../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from 0x30 to 0x39 (10 <a href="../../../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">inline</span> uint32<br/></li>
<li><a id="L32">&#x200c;</a><span class="linkable">gb_linear</span>(uint32 gb)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; b0 = (gb &amp; <span class="Constant">0xff000000</span>) &gt;&gt; <span class="Constant">24</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; b1 = (gb &amp; <span class="Constant">0x00ff0000</span>) &gt;&gt; <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; b2 = (gb &amp; <span class="Constant">0x0000ff00</span>) &gt;&gt; <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; b3 = (gb &amp; <span class="Constant">0x000000ff</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> b0 * <span class="Constant">12600</span> + b1 * <span class="Constant">1260</span> + b2 * <span class="Constant">10</span> + b3 -<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (<span class="Constant">0x81</span> * <span class="Constant">12600</span> + <span class="Constant">0x30</span> * <span class="Constant">1260</span> + <span class="Constant">0x81</span> * <span class="Constant">10</span> + <span class="Constant">0x30</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">inline</span> uint32<br/></li>
<li><a id="L44">&#x200c;</a><span class="linkable">gb_unlinear</span>(uint32 lin)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; r0 = <span class="Constant">0x81</span> + lin / <span class="Constant">12600</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; r1 = <span class="Constant">0x30</span> + (lin / <span class="Constant">1260</span>) % <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; r2 = <span class="Constant">0x81</span> + (lin / <span class="Constant">10</span>) % <span class="Constant">126</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; r3 = <span class="Constant">0x30</span> + lin % <span class="Constant">10</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (r0 &lt;&lt; <span class="Constant">24</span>) | (r1 &lt;&lt; <span class="Constant">16</span>) | (r2 &lt;&lt; <span class="Constant">8</span>) | r3;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Convert <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>-formatted UTF8 to and from Unicode code points<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Probably this should be somewhere else ...<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">inline</span> uint32<br/></li>
<li><a id="L60">&#x200c;</a><span class="linkable">unicode_to_utf8word</span>(uint32 c)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c &lt;= <span class="Constant">0x7F</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> = c;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &lt;= <span class="Constant">0x7FF</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> = (<span class="Constant">0xC0</span> | ((c &gt;&gt; <span class="Constant">6</span>) &amp; <span class="Constant">0x1F</span>)) &lt;&lt; <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> |= <span class="Constant">0x80</span> | (c &amp; <span class="Constant">0x3F</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &lt;= <span class="Constant">0xFFFF</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> = (<span class="Constant">0xE0</span> | ((c &gt;&gt; <span class="Constant">12</span>) &amp; <span class="Constant">0x0F</span>)) &lt;&lt; <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> |= (<span class="Constant">0x80</span> | ((c &gt;&gt; <span class="Constant">6</span>) &amp; <span class="Constant">0x3F</span>)) &lt;&lt; <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> |= <span class="Constant">0x80</span> | (c &amp; <span class="Constant">0x3F</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> = (<span class="Constant">0xF0</span> | ((c &gt;&gt; <span class="Constant">18</span>) &amp; <span class="Constant">0x07</span>)) &lt;&lt; <span class="Constant">24</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> |= (<span class="Constant">0x80</span> | ((c &gt;&gt; <span class="Constant">12</span>) &amp; <span class="Constant">0x3F</span>)) &lt;&lt; <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> |= (<span class="Constant">0x80</span> | ((c &gt;&gt; <span class="Constant">6</span>) &amp; <span class="Constant">0x3F</span>)) &lt;&lt; <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> |= <span class="Constant">0x80</span> | (c &amp; <span class="Constant">0x3F</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">inline</span> uint32<br/></li>
<li><a id="L91">&#x200c;</a><span class="linkable">utf8word_to_unicode</span>(uint32 c)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; ucs;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c &lt;= <span class="Constant">0x7F</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs = c;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &lt;= <span class="Constant">0xFFFF</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs = ((c &gt;&gt; <span class="Constant">8</span>) &amp; <span class="Constant">0x1F</span>) &lt;&lt; <span class="Constant">6</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs |= c &amp; <span class="Constant">0x3F</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &lt;= <span class="Constant">0xFFFFFF</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs = ((c &gt;&gt; <span class="Constant">16</span>) &amp; <span class="Constant">0x0F</span>) &lt;&lt; <span class="Constant">12</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs |= ((c &gt;&gt; <span class="Constant">8</span>) &amp; <span class="Constant">0x3F</span>) &lt;&lt; <span class="Constant">6</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs |= c &amp; <span class="Constant">0x3F</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs = ((c &gt;&gt; <span class="Constant">24</span>) &amp; <span class="Constant">0x07</span>) &lt;&lt; <span class="Constant">18</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs |= ((c &gt;&gt; <span class="Constant">16</span>) &amp; <span class="Constant">0x3F</span>) &lt;&lt; <span class="Constant">12</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs |= ((c &gt;&gt; <span class="Constant">8</span>) &amp; <span class="Constant">0x3F</span>) &lt;&lt; <span class="Constant">6</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ucs |= c &amp; <span class="Constant">0x3F</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> ucs;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Perform mapping of GB18030 ranges to UTF8<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The ranges we need to convert are specified in gb-18030-2000.xml.<br/></li>
<li></span><span class="Comment"> * All are ranges of 4-byte GB18030 codes.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> uint32<br/></li>
<li><a id="L128">&#x200c;</a><span class="linkable">conv_18030_to_utf8</span>(uint32 code)<br/></li>
<li>{<br/></li>
<li><a id="L130">&#x200c;</a><span class="PreProc">#define <span class="linkable">conv18030</span>(minunicode, mincode, maxcode) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (code &gt;= mincode &amp;&amp; code &lt;= maxcode) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">return</span><span class="PreProc"> <a href="#L60" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:60">unicode_to_utf8word</a>(<a href="#L32" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:32">gb_linear</a>(code) - <a href="#L32" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:32">gb_linear</a>(mincode) + minunicode)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x0452</span>, <span class="Constant">0x8130D330</span>, <span class="Constant">0x8136A531</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x2643</span>, <span class="Constant">0x8137A839</span>, <span class="Constant">0x8138FD38</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x361B</span>, <span class="Constant">0x8230A633</span>, <span class="Constant">0x8230F237</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x3CE1</span>, <span class="Constant">0x8231D438</span>, <span class="Constant">0x8232AF32</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x4160</span>, <span class="Constant">0x8232C937</span>, <span class="Constant">0x8232F837</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x44D7</span>, <span class="Constant">0x8233A339</span>, <span class="Constant">0x8233C931</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x478E</span>, <span class="Constant">0x8233E838</span>, <span class="Constant">0x82349638</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x49B8</span>, <span class="Constant">0x8234A131</span>, <span class="Constant">0x8234E733</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x9FA6</span>, <span class="Constant">0x82358F33</span>, <span class="Constant">0x8336C738</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0xE865</span>, <span class="Constant">0x8336D030</span>, <span class="Constant">0x84308534</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0xFA2A</span>, <span class="Constant">0x84309C38</span>, <span class="Constant">0x84318537</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0xFFE6</span>, <span class="Constant">0x8431A234</span>, <span class="Constant">0x8431A439</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L130" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:130">conv18030</a>(<span class="Constant">0x10000</span>, <span class="Constant">0x90308130</span>, <span class="Constant">0xE3329A35</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* No mapping exists */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Perform mapping of UTF8 ranges to GB18030<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> uint32<br/></li>
<li><a id="L155">&#x200c;</a><span class="linkable">conv_utf8_to_18030</span>(uint32 code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; ucs = <a href="#L91" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:91">utf8word_to_unicode</a>(code);<br/></li>
<li><br/></li>
<li><a id="L159">&#x200c;</a><span class="PreProc">#define <span class="linkable">convutf8</span>(minunicode, maxunicode, mincode) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (ucs &gt;= minunicode &amp;&amp; ucs &lt;= maxunicode) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">return</span><span class="PreProc"> <a href="#L44" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:44">gb_unlinear</a>(ucs - minunicode + <a href="#L32" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:32">gb_linear</a>(mincode))<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x0452</span>, <span class="Constant">0x200F</span>, <span class="Constant">0x8130D330</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x2643</span>, <span class="Constant">0x2E80</span>, <span class="Constant">0x8137A839</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x361B</span>, <span class="Constant">0x3917</span>, <span class="Constant">0x8230A633</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x3CE1</span>, <span class="Constant">0x4055</span>, <span class="Constant">0x8231D438</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x4160</span>, <span class="Constant">0x4336</span>, <span class="Constant">0x8232C937</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x44D7</span>, <span class="Constant">0x464B</span>, <span class="Constant">0x8233A339</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x478E</span>, <span class="Constant">0x4946</span>, <span class="Constant">0x8233E838</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x49B8</span>, <span class="Constant">0x4C76</span>, <span class="Constant">0x8234A131</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x9FA6</span>, <span class="Constant">0xD7FF</span>, <span class="Constant">0x82358F33</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0xE865</span>, <span class="Constant">0xF92B</span>, <span class="Constant">0x8336D030</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0xFA2A</span>, <span class="Constant">0xFE2F</span>, <span class="Constant">0x84309C38</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0xFFE6</span>, <span class="Constant">0xFFFF</span>, <span class="Constant">0x8431A234</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:159">convutf8</a>(<span class="Constant">0x10000</span>, <span class="Constant">0x10FFFF</span>, <span class="Constant">0x90308130</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* No mapping exists */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * conv_proc(<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; INTEGER,&nbsp; &nbsp; -- source encoding id<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; INTEGER,&nbsp; &nbsp; -- destination encoding id<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; CSTRING,&nbsp; &nbsp; -- source string (null terminated C string)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; CSTRING,&nbsp; &nbsp; -- destination string (null terminated C string)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; INTEGER,&nbsp; &nbsp; -- source string length<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; BOOL&nbsp; &nbsp; &nbsp; &nbsp; -- if true, don't throw an error if conversion fails<br/></li>
<li></span><span class="Comment"> * ) returns INTEGER;<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns the number of bytes successfully converted.<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L194">&#x200c;</a><span class="linkable">gb18030_to_utf8</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> *src = (<span class="Type">unsigned</span> <span class="Type">char</span> *) PG_GETARG_CSTRING(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> *dest = (<span class="Type">unsigned</span> <span class="Type">char</span> *) PG_GETARG_CSTRING(<span class="Constant">3</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = PG_GETARG_INT32(<span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../../../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; noError = PG_GETARG_BOOL(<span class="Constant">5</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; converted;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; CHECK_ENCODING_CONVERSION_ARGS(PG_GB18030, PG_UTF8);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; converted = <a href="../../conv.c.html#L717" title="utils/mb/conv.c:717">LocalToUtf</a>(src, len, dest,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;gb18030_to_unicode_tree,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">NULL</span>, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L128" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:128">conv_18030_to_utf8</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PG_GB18030,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; noError);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_INT32(converted);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L215">&#x200c;</a><span class="linkable">utf8_to_gb18030</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> *src = (<span class="Type">unsigned</span> <span class="Type">char</span> *) PG_GETARG_CSTRING(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> *dest = (<span class="Type">unsigned</span> <span class="Type">char</span> *) PG_GETARG_CSTRING(<span class="Constant">3</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = PG_GETARG_INT32(<span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../../../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; noError = PG_GETARG_BOOL(<span class="Constant">5</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; converted;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; CHECK_ENCODING_CONVERSION_ARGS(PG_UTF8, PG_GB18030);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; converted = <a href="../../conv.c.html#L507" title="utils/mb/conv.c:507">UtfToLocal</a>(src, len, dest,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;gb18030_from_unicode_tree,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">NULL</span>, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L155" title="utils/mb/conversion_procs/utf8_and_gb18030/utf8_and_gb18030.c:155">conv_utf8_to_18030</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PG_GB18030,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; noError);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_INT32(converted);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
