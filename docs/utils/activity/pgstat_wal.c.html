<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/activity/pgstat_wal.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/activity/pgstat_wal.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L24">PendingWalStats</a></li>
<li><a href="#L32">prevWalUsage</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L67">pgstat_fetch_stat_wal</a></li>
<li><a href="#L82">pgstat_flush_wal</a></li>
<li><a href="#L159">pgstat_have_pending_wal</a></li>
<li><a href="#L141">pgstat_init_wal</a></li>
<li><a href="#L48">pgstat_report_wal</a></li>
<li><a href="#L167">pgstat_wal_reset_all_cb</a></li>
<li><a href="#L178">pgstat_wal_snapshot_cb</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L110">WALSTAT_ACC</a></li>
<li><a href="#L123">WALSTAT_ACC</a></li>
<li><a href="#L112">WALSTAT_ACC_INSTR_TIME</a></li>
<li><a href="#L122">WALSTAT_ACC_INSTR_TIME</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/* -------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * pgstat_wal.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Implementation of WAL statistics.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This file contains the implementation of WAL statistics. It is kept<br/></li>
<li></span><span class="Comment"> * separate from pgstat.c to enforce the line between the statistics access /<br/></li>
<li></span><span class="Comment"> * storage implementation and the details about individual types of<br/></li>
<li></span><span class="Comment"> * statistics.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2001-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/utils/activity/pgstat_wal.c<br/></li>
<li></span><span class="Comment"> * -------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;executor/instrument.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/pgstat_internal.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L24">&#x200c;</a>PgStat_PendingWalStats <span class="linkable">PendingWalStats</span> = {<span class="Constant">0</span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * WAL usage counters saved from <a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a> at the previous call to<br/></li>
<li></span><span class="Comment"> * <a href="#L48" title="utils/activity/pgstat_wal.c:48">pgstat_report_wal</a>(). This is used to calculate how much WAL usage<br/></li>
<li></span><span class="Comment"> * happens between <a href="#L48" title="utils/activity/pgstat_wal.c:48">pgstat_report_wal</a>() calls, by subtracting<br/></li>
<li></span><span class="Comment"> * the previous counters from the current ones.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L32">&#x200c;</a></span><span class="Type">static</span> WalUsage <span class="linkable">prevWalUsage</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Calculate how much WAL usage counters have increased and update<br/></li>
<li></span><span class="Comment"> * shared WAL and IO statistics.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Must be called by processes that generate WAL, that do not call<br/></li>
<li></span><span class="Comment"> * <a href="pgstat.c.html#L579" title="utils/activity/pgstat.c:579">pgstat_report_stat</a>(), like walwriter.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * &quot;force&quot; set to true ensures that the statistics are flushed; note that<br/></li>
<li></span><span class="Comment"> * this needs to acquire the pgstat shmem LWLock, <a href="../../storage/ipc/latch.c.html#L162" title="storage/ipc/latch.c:162">waiting</a> on it.&nbsp; When<br/></li>
<li></span><span class="Comment"> * set to false, the statistics may not be flushed if the lock could not<br/></li>
<li></span><span class="Comment"> * be acquired.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L48">&#x200c;</a></span><span class="linkable">pgstat_report_wal</span>(<span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> force)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; nowait;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* like in pgstat.c, don't wait for lock acquisition when !force */<br/></li>
<li></span>&nbsp; &nbsp; nowait = !force;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* flush wal stats */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L82" title="utils/activity/pgstat_wal.c:82">pgstat_flush_wal</a>(nowait);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* flush IO stats */<br/></li>
<li></span>&nbsp; &nbsp; <a href="pgstat_io.c.html#L173" title="utils/activity/pgstat_io.c:173">pgstat_flush_io</a>(nowait);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Support function for the SQL-callable pgstat* <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>. Returns<br/></li>
<li></span><span class="Comment"> * a pointer to the WAL statistics struct.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>PgStat_WalStats *<br/></li>
<li><a id="L67">&#x200c;</a><span class="linkable">pgstat_fetch_stat_wal</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="pgstat.c.html#L938" title="utils/activity/pgstat.c:938">pgstat_snapshot_fixed</a>(PGSTAT_KIND_WAL);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> &amp;<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.snapshot.wal;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Calculate how much WAL usage counters have increased by subtracting the<br/></li>
<li></span><span class="Comment"> * previous counters from the current ones.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If nowait is true, this function returns true if the lock could not be<br/></li>
<li></span><span class="Comment"> * acquired. Otherwise return false.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L82">&#x200c;</a></span><span class="linkable">pgstat_flush_wal</span>(<span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> nowait)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStatShared_Wal *stats_shmem = &amp;<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.shmem-&gt;wal;<br/></li>
<li>&nbsp; &nbsp; WalUsage&nbsp; &nbsp; wal_usage_diff = {<span class="Constant">0</span>};<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(<a href="../init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a> || !<a href="../init/globals.c.html#L116" title="utils/init/globals.c:116">IsPostmasterEnvironment</a>);<br/></li>
<li>&nbsp; &nbsp; Assert(<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.shmem != <span class="Constant">NULL</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; !<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.shmem-&gt;is_shutdown);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This function can be called even if nothing at all has happened. Avoid<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * taking lock for nothing in that case.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L159" title="utils/activity/pgstat_wal.c:159">pgstat_have_pending_wal</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We don't update the WAL usage portion of the local WalStats elsewhere.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Calculate how much WAL usage counters were increased by subtracting the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * previous counters from the current ones.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../executor/instrument.c.html#L286" title="executor/instrument.c:286">WalUsageAccumDiff</a>(&amp;wal_usage_diff, &amp;<a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a>, &amp;<a href="#L32" title="utils/activity/pgstat_wal.c:32">prevWalUsage</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!nowait)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../storage/lmgr/lwlock.c.html#L1170" title="storage/lmgr/lwlock.c:1170">LWLockAcquire</a>(&amp;stats_shmem-&gt;lock, LW_EXCLUSIVE);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="../../storage/lmgr/lwlock.c.html#L1341" title="storage/lmgr/lwlock.c:1341">LWLockConditionalAcquire</a>(&amp;stats_shmem-&gt;lock, LW_EXCLUSIVE))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li><a id="L110">&#x200c;</a><span class="PreProc">#define <span class="linkable">WALSTAT_ACC</span>(fld, var_to_add) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (stats_shmem-&gt;stats.fld += var_to_add.fld)<br/></li>
<li><a id="L112">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">WALSTAT_ACC_INSTR_TIME</span>(fld) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (stats_shmem-&gt;stats.fld += INSTR_TIME_GET_MICROSEC(<a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>.fld))<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L110" title="utils/activity/pgstat_wal.c:110">WALSTAT_ACC</a>(wal_records, wal_usage_diff);<br/></li>
<li>&nbsp; &nbsp; <a href="#L110" title="utils/activity/pgstat_wal.c:110">WALSTAT_ACC</a>(wal_fpi, wal_usage_diff);<br/></li>
<li>&nbsp; &nbsp; <a href="#L110" title="utils/activity/pgstat_wal.c:110">WALSTAT_ACC</a>(wal_bytes, wal_usage_diff);<br/></li>
<li>&nbsp; &nbsp; <a href="#L110" title="utils/activity/pgstat_wal.c:110">WALSTAT_ACC</a>(wal_buffers_full, <a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L110" title="utils/activity/pgstat_wal.c:110">WALSTAT_ACC</a>(wal_write, <a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L110" title="utils/activity/pgstat_wal.c:110">WALSTAT_ACC</a>(wal_sync, <a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L112" title="utils/activity/pgstat_wal.c:112">WALSTAT_ACC_INSTR_TIME</a>(wal_write_time);<br/></li>
<li>&nbsp; &nbsp; <a href="#L112" title="utils/activity/pgstat_wal.c:112">WALSTAT_ACC_INSTR_TIME</a>(wal_sync_time);<br/></li>
<li><a id="L122">&#x200c;</a><span class="PreProc">#undef <span class="linkable">WALSTAT_ACC_INSTR_TIME</span><br/></li>
<li><a id="L123">&#x200c;</a></span><span class="PreProc">#undef <span class="linkable">WALSTAT_ACC</span><br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../../storage/lmgr/lwlock.c.html#L1783" title="storage/lmgr/lwlock.c:1783">LWLockRelease</a>(&amp;stats_shmem-&gt;lock);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Save the current counters for the subsequent calculation of WAL usage.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L32" title="utils/activity/pgstat_wal.c:32">prevWalUsage</a> = <a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Clear out the statistics buffer, so it can be re-used.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; MemSet(&amp;<a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>, <span class="Constant">0</span>, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L141">&#x200c;</a></span><span class="linkable">pgstat_init_wal</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Initialize <a href="#L32" title="utils/activity/pgstat_wal.c:32">prevWalUsage</a> with <a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a> so that <a href="#L82" title="utils/activity/pgstat_wal.c:82">pgstat_flush_wal</a>() can<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * calculate how much <a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a> counters are increased by subtracting<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="#L32" title="utils/activity/pgstat_wal.c:32">prevWalUsage</a> from <a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L32" title="utils/activity/pgstat_wal.c:32">prevWalUsage</a> = <a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * To determine whether <a href="../adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> WAL activity has occurred since last time, not<br/></li>
<li></span><span class="Comment"> * only the number of generated WAL <a href="../../access/transam/twophase.c.html#L1025" title="access/transam/twophase.c:1025">records</a> but also the numbers of WAL<br/></li>
<li></span><span class="Comment"> * writes and syncs need to be checked. Because even transaction that<br/></li>
<li></span><span class="Comment"> * generates no WAL <a href="../../access/transam/twophase.c.html#L1025" title="access/transam/twophase.c:1025">records</a> can write or sync WAL data when flushing the<br/></li>
<li></span><span class="Comment"> * data pages.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L159">&#x200c;</a></span><span class="linkable">pgstat_have_pending_wal</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../executor/instrument.c.html#L22" title="executor/instrument.c:22">pgWalUsage</a>.wal_records != <a href="#L32" title="utils/activity/pgstat_wal.c:32">prevWalUsage</a>.wal_records ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>.wal_write != <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L24" title="utils/activity/pgstat_wal.c:24">PendingWalStats</a>.wal_sync != <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L167">&#x200c;</a></span><span class="linkable">pgstat_wal_reset_all_cb</span>(TimestampTz ts)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStatShared_Wal *stats_shmem = &amp;<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.shmem-&gt;wal;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../storage/lmgr/lwlock.c.html#L1170" title="storage/lmgr/lwlock.c:1170">LWLockAcquire</a>(&amp;stats_shmem-&gt;lock, LW_EXCLUSIVE);<br/></li>
<li>&nbsp; &nbsp; memset(&amp;stats_shmem-&gt;stats, <span class="Constant">0</span>, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(stats_shmem-&gt;stats));<br/></li>
<li>&nbsp; &nbsp; stats_shmem-&gt;stats.stat_reset_timestamp = ts;<br/></li>
<li>&nbsp; &nbsp; <a href="../../storage/lmgr/lwlock.c.html#L1783" title="storage/lmgr/lwlock.c:1783">LWLockRelease</a>(&amp;stats_shmem-&gt;lock);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L178">&#x200c;</a></span><span class="linkable">pgstat_wal_snapshot_cb</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStatShared_Wal *stats_shmem = &amp;<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.shmem-&gt;wal;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../storage/lmgr/lwlock.c.html#L1170" title="storage/lmgr/lwlock.c:1170">LWLockAcquire</a>(&amp;stats_shmem-&gt;lock, LW_SHARED);<br/></li>
<li>&nbsp; &nbsp; memcpy(&amp;<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.snapshot.wal, &amp;stats_shmem-&gt;stats,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="pgstat.c.html#L193" title="utils/activity/pgstat.c:193">pgStatLocal</a>.snapshot.wal));<br/></li>
<li>&nbsp; &nbsp; <a href="../../storage/lmgr/lwlock.c.html#L1783" title="storage/lmgr/lwlock.c:1783">LWLockRelease</a>(&amp;stats_shmem-&gt;lock);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
