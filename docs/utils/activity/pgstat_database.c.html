<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/activity/pgstat_database.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/activity/pgstat_database.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L37">pgLastSessionReportTime</a></li>
<li><a href="#L30">pgStatActiveTime</a></li>
<li><a href="#L28">pgStatBlockReadTime</a></li>
<li><a href="#L29">pgStatBlockWriteTime</a></li>
<li><a href="#L32">pgStatSessionEndCause</a></li>
<li><a href="#L31">pgStatTransactionIdleTime</a></li>
<li><a href="#L35">pgStatXactCommit</a></li>
<li><a href="#L36">pgStatXactRollback</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L249">AtEOXact_PgStat_Database</a></li>
<li><a href="#L375">pgstat_database_flush_cb</a></li>
<li><a href="#L438">pgstat_database_reset_timestamp_cb</a></li>
<li><a href="#L44">pgstat_drop_database</a></li>
<li><a href="#L242">pgstat_fetch_stat_dbentry</a></li>
<li><a href="#L333">pgstat_prep_database_pending</a></li>
<li><a href="#L55">pgstat_report_autovac</a></li>
<li><a href="#L166">pgstat_report_checksum_failure</a></li>
<li><a href="#L140">pgstat_report_checksum_failures_in_db</a></li>
<li><a href="#L191">pgstat_report_connect</a></li>
<li><a href="#L125">pgstat_report_deadlock</a></li>
<li><a href="#L208">pgstat_report_disconnect</a></li>
<li><a href="#L81">pgstat_report_recovery_conflict</a></li>
<li><a href="#L175">pgstat_report_tempfile</a></li>
<li><a href="#L354">pgstat_reset_database_timestamp</a></li>
<li><a href="#L324">pgstat_should_report_connstat</a></li>
<li><a href="#L270">pgstat_update_dbstats</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L386">PGSTAT_ACCUM_DBCOUNT</a></li>
<li><a href="#L428">PGSTAT_ACCUM_DBCOUNT</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/* -------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * pgstat_database.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Implementation of database statistics.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This file contains the implementation of database statistics. It is kept<br/></li>
<li></span><span class="Comment"> * separate from pgstat.c to enforce the line between the statistics access /<br/></li>
<li></span><span class="Comment"> * storage implementation and the details about individual types of<br/></li>
<li></span><span class="Comment"> * statistics.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2001-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/utils/activity/pgstat_database.c<br/></li>
<li></span><span class="Comment"> * -------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;storage/procsignal.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/pgstat_internal.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/timestamp.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L324" title="utils/activity/pgstat_database.c:324">pgstat_should_report_connstat</a>(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L28">&#x200c;</a>PgStat_Counter <span class="linkable">pgStatBlockReadTime</span> = <span class="Constant">0</span>;<br/></li>
<li><a id="L29">&#x200c;</a>PgStat_Counter <span class="linkable">pgStatBlockWriteTime</span> = <span class="Constant">0</span>;<br/></li>
<li><a id="L30">&#x200c;</a>PgStat_Counter <span class="linkable">pgStatActiveTime</span> = <span class="Constant">0</span>;<br/></li>
<li><a id="L31">&#x200c;</a>PgStat_Counter <span class="linkable">pgStatTransactionIdleTime</span> = <span class="Constant">0</span>;<br/></li>
<li><a id="L32">&#x200c;</a>SessionEndType <span class="linkable">pgStatSessionEndCause</span> = DISCONNECT_NORMAL;<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L35">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">pgStatXactCommit</span> = <span class="Constant">0</span>;<br/></li>
<li><a id="L36">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">pgStatXactRollback</span> = <span class="Constant">0</span>;<br/></li>
<li><a id="L37">&#x200c;</a><span class="Type">static</span> PgStat_Counter <span class="linkable">pgLastSessionReportTime</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Remove entry for the database being dropped.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L44">&#x200c;</a></span><span class="linkable">pgstat_drop_database</span>(Oid databaseid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="pgstat_xact.c.html#L379" title="utils/activity/pgstat_xact.c:379">pgstat_drop_transactional</a>(PGSTAT_KIND_DATABASE, databaseid, InvalidOid);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Called from autovacuum.c to report startup of an autovacuum process.<br/></li>
<li></span><span class="Comment"> * We are called <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> <a href="../init/postinit.c.html#L736" title="utils/init/postinit.c:736">InitPostgres</a> is done, so can't rely on <a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>;<br/></li>
<li></span><span class="Comment"> * the db OID must be passed in, instead.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L55">&#x200c;</a></span><span class="linkable">pgstat_report_autovac</span>(Oid dboid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_EntryRef *entry_ref;<br/></li>
<li>&nbsp; &nbsp; PgStatShared_Database *dbentry;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* can't get here in single user mode */<br/></li>
<li></span>&nbsp; &nbsp; Assert(<a href="../init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * End-of-<a href="../../commands/vacuum.c.html#L478" title="commands/vacuum.c:478">vacuum</a> is reported instantly. Report the start the same way for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * consistency. Vacuum doesn't run frequently and is a long-lasting<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * operation so it doesn't matter if we get blocked here a little.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; entry_ref = <a href="pgstat_shmem.c.html#L613" title="utils/activity/pgstat_shmem.c:613">pgstat_get_entry_ref_locked</a>(PGSTAT_KIND_DATABASE,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dboid, InvalidOid, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbentry = (PgStatShared_Database *) entry_ref-&gt;shared_stats;<br/></li>
<li>&nbsp; &nbsp; dbentry-&gt;stats.last_autovac_time = <a href="../adt/timestamp.c.html#L1654" title="utils/adt/timestamp.c:1654">GetCurrentTimestamp</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="pgstat_shmem.c.html#L604" title="utils/activity/pgstat_shmem.c:604">pgstat_unlock_entry</a>(entry_ref);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Report a Hot Standby recovery conflict.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L81">&#x200c;</a></span><span class="linkable">pgstat_report_recovery_conflict</span>(<span class="Type">int</span> reason)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_StatDBEntry *dbentry;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(<a href="../init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="pgstat.c.html#L184" title="utils/activity/pgstat.c:184">pgstat_track_counts</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbentry = <a href="#L333" title="utils/activity/pgstat_database.c:333">pgstat_prep_database_pending</a>(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (reason)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PROCSIG_RECOVERY_CONFLICT_DATABASE:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Since we drop the information about the database as soon as it<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * replicates, there is no point in counting these conflicts.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PROCSIG_RECOVERY_CONFLICT_TABLESPACE:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;conflict_tablespace++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PROCSIG_RECOVERY_CONFLICT_LOCK:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;conflict_lock++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PROCSIG_RECOVERY_CONFLICT_SNAPSHOT:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;conflict_snapshot++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PROCSIG_RECOVERY_CONFLICT_BUFFERPIN:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;conflict_bufferpin++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PROCSIG_RECOVERY_CONFLICT_LOGICALSLOT:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;conflict_logicalslot++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PROCSIG_RECOVERY_CONFLICT_STARTUP_DEADLOCK:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;conflict_startup_deadlock++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Report a detected deadlock.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L125">&#x200c;</a></span><span class="linkable">pgstat_report_deadlock</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_StatDBEntry *dbent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="pgstat.c.html#L184" title="utils/activity/pgstat.c:184">pgstat_track_counts</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbent = <a href="#L333" title="utils/activity/pgstat_database.c:333">pgstat_prep_database_pending</a>(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>);<br/></li>
<li>&nbsp; &nbsp; dbent-&gt;deadlocks++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Report one or more checksum failures.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L140">&#x200c;</a></span><span class="linkable">pgstat_report_checksum_failures_in_db</span>(Oid dboid, <span class="Type">int</span> failurecount)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_EntryRef *entry_ref;<br/></li>
<li>&nbsp; &nbsp; PgStatShared_Database *sharedent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="pgstat.c.html#L184" title="utils/activity/pgstat.c:184">pgstat_track_counts</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Update the shared stats directly - checksum failures should never be<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * common enough for that to be a problem.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; entry_ref =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="pgstat_shmem.c.html#L613" title="utils/activity/pgstat_shmem.c:613">pgstat_get_entry_ref_locked</a>(PGSTAT_KIND_DATABASE, dboid, InvalidOid, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sharedent = (PgStatShared_Database *) entry_ref-&gt;shared_stats;<br/></li>
<li>&nbsp; &nbsp; sharedent-&gt;stats.checksum_failures += failurecount;<br/></li>
<li>&nbsp; &nbsp; sharedent-&gt;stats.last_checksum_failure = <a href="../adt/timestamp.c.html#L1654" title="utils/adt/timestamp.c:1654">GetCurrentTimestamp</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="pgstat_shmem.c.html#L604" title="utils/activity/pgstat_shmem.c:604">pgstat_unlock_entry</a>(entry_ref);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Report one checksum failure in the current database.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L166">&#x200c;</a></span><span class="linkable">pgstat_report_checksum_failure</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L140" title="utils/activity/pgstat_database.c:140">pgstat_report_checksum_failures_in_db</a>(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>, <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Report creation of temporary file.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L175">&#x200c;</a></span><span class="linkable">pgstat_report_tempfile</span>(<span class="Type">size_t</span> filesize)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_StatDBEntry *dbent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="pgstat.c.html#L184" title="utils/activity/pgstat.c:184">pgstat_track_counts</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbent = <a href="#L333" title="utils/activity/pgstat_database.c:333">pgstat_prep_database_pending</a>(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>);<br/></li>
<li>&nbsp; &nbsp; dbent-&gt;temp_bytes += filesize;<br/></li>
<li>&nbsp; &nbsp; dbent-&gt;temp_files++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Notify stats system of a new connection.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L191">&#x200c;</a></span><span class="linkable">pgstat_report_connect</span>(Oid dboid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_StatDBEntry *dbentry;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L324" title="utils/activity/pgstat_database.c:324">pgstat_should_report_connstat</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L37" title="utils/activity/pgstat_database.c:37">pgLastSessionReportTime</a> = <a href="../init/globals.c.html#L47" title="utils/init/globals.c:47">MyStartTimestamp</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbentry = <a href="#L333" title="utils/activity/pgstat_database.c:333">pgstat_prep_database_pending</a>(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>);<br/></li>
<li>&nbsp; &nbsp; dbentry-&gt;sessions++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Notify the stats system of a disconnect.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L208">&#x200c;</a></span><span class="linkable">pgstat_report_disconnect</span>(Oid dboid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_StatDBEntry *dbentry;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L324" title="utils/activity/pgstat_database.c:324">pgstat_should_report_connstat</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbentry = <a href="#L333" title="utils/activity/pgstat_database.c:333">pgstat_prep_database_pending</a>(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (<a href="#L32" title="utils/activity/pgstat_database.c:32">pgStatSessionEndCause</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DISCONNECT_NOT_YET:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DISCONNECT_NORMAL:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we don't collect these */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DISCONNECT_CLIENT_EOF:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;sessions_abandoned++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DISCONNECT_FATAL:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;sessions_fatal++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DISCONNECT_KILLED:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;sessions_killed++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Support function for the SQL-callable pgstat* <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>. Returns<br/></li>
<li></span><span class="Comment"> * the collected statistics for one database or NULL. NULL doesn't mean<br/></li>
<li></span><span class="Comment"> * that the database doesn't exist, just that there are no statistics, so the<br/></li>
<li></span><span class="Comment"> * caller is better off to report ZERO instead.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>PgStat_StatDBEntry *<br/></li>
<li><a id="L242">&#x200c;</a><span class="linkable">pgstat_fetch_stat_dbentry</span>(Oid dboid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (PgStat_StatDBEntry *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="pgstat.c.html#L812" title="utils/activity/pgstat.c:812">pgstat_fetch_entry</a>(PGSTAT_KIND_DATABASE, dboid, InvalidOid);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L249">&#x200c;</a></span><span class="linkable">AtEOXact_PgStat_Database</span>(<span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> isCommit, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> parallel)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Don't count parallel worker transaction stats */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!parallel)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Count transaction commit or abort.&nbsp; (We use counters, not just<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * bools, in case the reporting message isn't sent right away.)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (isCommit)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L35" title="utils/activity/pgstat_database.c:35">pgStatXactCommit</a>++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="utils/activity/pgstat_database.c:36">pgStatXactRollback</a>++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Subroutine for <a href="pgstat.c.html#L579" title="utils/activity/pgstat.c:579">pgstat_report_stat</a>(): Handle xact commit/rollback and I/O<br/></li>
<li></span><span class="Comment"> * timings.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L270">&#x200c;</a></span><span class="linkable">pgstat_update_dbstats</span>(TimestampTz ts)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_StatDBEntry *dbentry;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If not connected to a database yet, don't attribute time to &quot;shared<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * state&quot; (InvalidOid is used to track stats for shared relations, etc.).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbentry = <a href="#L333" title="utils/activity/pgstat_database.c:333">pgstat_prep_database_pending</a>(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Accumulate xact commit/rollback and I/O timings to stats entry of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * current database.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; dbentry-&gt;xact_commit += <a href="#L35" title="utils/activity/pgstat_database.c:35">pgStatXactCommit</a>;<br/></li>
<li>&nbsp; &nbsp; dbentry-&gt;xact_rollback += <a href="#L36" title="utils/activity/pgstat_database.c:36">pgStatXactRollback</a>;<br/></li>
<li>&nbsp; &nbsp; dbentry-&gt;blk_read_time += <a href="#L28" title="utils/activity/pgstat_database.c:28">pgStatBlockReadTime</a>;<br/></li>
<li>&nbsp; &nbsp; dbentry-&gt;blk_write_time += <a href="#L29" title="utils/activity/pgstat_database.c:29">pgStatBlockWriteTime</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L324" title="utils/activity/pgstat_database.c:324">pgstat_should_report_connstat</a>())<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; secs;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; usecs;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="#L37" title="utils/activity/pgstat_database.c:37">pgLastSessionReportTime</a> is initialized to <a href="../init/globals.c.html#L47" title="utils/init/globals.c:47">MyStartTimestamp</a> by<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="#L191" title="utils/activity/pgstat_database.c:191">pgstat_report_connect</a>().<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../adt/timestamp.c.html#L1730" title="utils/adt/timestamp.c:1730">TimestampDifference</a>(<a href="#L37" title="utils/activity/pgstat_database.c:37">pgLastSessionReportTime</a>, ts, &amp;secs, &amp;usecs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L37" title="utils/activity/pgstat_database.c:37">pgLastSessionReportTime</a> = ts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;session_time += (PgStat_Counter) secs * <span class="Constant">1000000</span> + usecs;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;active_time += <a href="#L30" title="utils/activity/pgstat_database.c:30">pgStatActiveTime</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dbentry-&gt;idle_in_transaction_time += <a href="#L31" title="utils/activity/pgstat_database.c:31">pgStatTransactionIdleTime</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L35" title="utils/activity/pgstat_database.c:35">pgStatXactCommit</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="utils/activity/pgstat_database.c:36">pgStatXactRollback</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L28" title="utils/activity/pgstat_database.c:28">pgStatBlockReadTime</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L29" title="utils/activity/pgstat_database.c:29">pgStatBlockWriteTime</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L30" title="utils/activity/pgstat_database.c:30">pgStatActiveTime</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L31" title="utils/activity/pgstat_database.c:31">pgStatTransactionIdleTime</a> = <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * We report session statistics only for normal backend processes.&nbsp; Parallel<br/></li>
<li></span><span class="Comment"> * workers run in parallel, so they don't contribute to session times, even<br/></li>
<li></span><span class="Comment"> * though they use CPU time. Walsender processes could be considered here,<br/></li>
<li></span><span class="Comment"> * but they have different session characteristics from normal backends (for<br/></li>
<li></span><span class="Comment"> * example, they are always &quot;active&quot;), so they would skew session statistics.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L324">&#x200c;</a></span><span class="linkable">pgstat_should_report_connstat</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../init/miscinit.c.html#L63" title="utils/init/miscinit.c:63">MyBackendType</a> == B_BACKEND;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Find or create a local PgStat_StatDBEntry entry for dboid.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>PgStat_StatDBEntry *<br/></li>
<li><a id="L333">&#x200c;</a><span class="linkable">pgstat_prep_database_pending</span>(Oid dboid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_EntryRef *entry_ref;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This should not report stats on database objects <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> having<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * connected to a database.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; Assert(!OidIsValid(dboid) || OidIsValid(<a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; entry_ref = <a href="pgstat.c.html#L1105" title="utils/activity/pgstat.c:1105">pgstat_prep_pending_entry</a>(PGSTAT_KIND_DATABASE, dboid, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> entry_ref-&gt;pending;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Reset the database's reset timestamp, without resetting the contents of the<br/></li>
<li></span><span class="Comment"> * database stats.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L354">&#x200c;</a></span><span class="linkable">pgstat_reset_database_timestamp</span>(Oid dboid, TimestampTz ts)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStat_EntryRef *dbref;<br/></li>
<li>&nbsp; &nbsp; PgStatShared_Database *dbentry;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbref = <a href="pgstat_shmem.c.html#L613" title="utils/activity/pgstat_shmem.c:613">pgstat_get_entry_ref_locked</a>(PGSTAT_KIND_DATABASE, <a href="../init/globals.c.html#L91" title="utils/init/globals.c:91">MyDatabaseId</a>, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dbentry = (PgStatShared_Database *) dbref-&gt;shared_stats;<br/></li>
<li>&nbsp; &nbsp; dbentry-&gt;stats.stat_reset_timestamp = ts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="pgstat_shmem.c.html#L604" title="utils/activity/pgstat_shmem.c:604">pgstat_unlock_entry</a>(dbref);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Flush out pending stats for the entry<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If nowait is true, this function returns false if lock could not<br/></li>
<li></span><span class="Comment"> * immediately acquired, otherwise true is returned.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L375">&#x200c;</a></span><span class="linkable">pgstat_database_flush_cb</span>(PgStat_EntryRef *entry_ref, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> nowait)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PgStatShared_Database *sharedent;<br/></li>
<li>&nbsp; &nbsp; PgStat_StatDBEntry *pendingent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pendingent = (PgStat_StatDBEntry *) entry_ref-&gt;pending;<br/></li>
<li>&nbsp; &nbsp; sharedent = (PgStatShared_Database *) entry_ref-&gt;shared_stats;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="pgstat_shmem.c.html#L576" title="utils/activity/pgstat_shmem.c:576">pgstat_lock_entry</a>(entry_ref, nowait))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li><a id="L386">&#x200c;</a><span class="PreProc">#define <span class="linkable">PGSTAT_ACCUM_DBCOUNT</span>(item)&nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (sharedent)-&gt;stats.item += (pendingent)-&gt;item<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(xact_commit);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(xact_rollback);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(blocks_fetched);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(blocks_hit);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(tuples_returned);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(tuples_fetched);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(tuples_inserted);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(tuples_updated);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(tuples_deleted);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* last_autovac_time is reported immediately */<br/></li>
<li></span>&nbsp; &nbsp; Assert(pendingent-&gt;last_autovac_time == <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(conflict_tablespace);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(conflict_lock);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(conflict_snapshot);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(conflict_logicalslot);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(conflict_bufferpin);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(conflict_startup_deadlock);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(temp_bytes);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(temp_files);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(deadlocks);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* checksum failures are reported immediately */<br/></li>
<li></span>&nbsp; &nbsp; Assert(pendingent-&gt;checksum_failures == <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Assert(pendingent-&gt;last_checksum_failure == <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(blk_read_time);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(blk_write_time);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(sessions);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(session_time);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(active_time);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(idle_in_transaction_time);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(sessions_abandoned);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(sessions_fatal);<br/></li>
<li>&nbsp; &nbsp; <a href="#L386" title="utils/activity/pgstat_database.c:386">PGSTAT_ACCUM_DBCOUNT</a>(sessions_killed);<br/></li>
<li><a id="L428">&#x200c;</a><span class="PreProc">#undef <span class="linkable">PGSTAT_ACCUM_DBCOUNT</span><br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="pgstat_shmem.c.html#L604" title="utils/activity/pgstat_shmem.c:604">pgstat_unlock_entry</a>(entry_ref);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memset(pendingent, <span class="Constant">0</span>, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(*pendingent));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L438">&#x200c;</a></span><span class="linkable">pgstat_database_reset_timestamp_cb</span>(PgStatShared_Common *header, TimestampTz ts)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; ((PgStatShared_Database *) header)-&gt;stats.stat_reset_timestamp = ts;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
