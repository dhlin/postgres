<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/activity/generate-wait_event_types.pl - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/activity/generate-wait_event_types.pl - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L335">usage</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="PreProc">#!/usr/bin/perl<br/></li>
<li></span><span class="Comment">#----------------------------------------------------------------------<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Generate wait events support files from wait_event_names.txt:<br/></li>
<li></span><span class="Comment"># - wait_event_types.h (if --code is passed)<br/></li>
<li></span><span class="Comment"># - pgstat_wait_event.c (if --code is passed)<br/></li>
<li></span><span class="Comment"># - wait_event_funcs_data.c (if --code is passed)<br/></li>
<li></span><span class="Comment"># - wait_event_types.sgml (if --docs is passed)<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># src/backend/utils/activity/generate-wait_event_types.pl<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment">#----------------------------------------------------------------------<br/></li>
<li></span><br/></li>
<li><span class="Statement">use strict</span>;<br/></li>
<li><span class="Statement">use warnings</span> <span class="Constant">FATAL</span> =&gt; <span class="Constant">'all'</span>;<br/></li>
<li><span class="Statement">use </span>Getopt::Long;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$output_path</span> = <span class="Constant">'.'</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$gen_docs</span> = <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$gen_code</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$continue</span> = <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%hashwe</span>;<br/></li>
<li><br/></li>
<li>GetOptions(<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">'outdir:s'</span> =&gt; \<span class="Identifier">$output_path</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">'docs'</span> =&gt; \<span class="Identifier">$gen_docs</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">'code'</span> =&gt; \<span class="Identifier">$gen_code</span>) || <a href="../../catalog/genbki.pl.html#L1174" title="catalog/genbki.pl:1174">usage</a>();<br/></li>
<li><br/></li>
<li><span class="Statement">die</span> <span class="Constant">&quot;Needs to specify --docs or --code&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (!<span class="Identifier">$gen_docs</span> &amp;&amp; !<span class="Identifier">$gen_code</span>);<br/></li>
<li><br/></li>
<li><span class="Statement">die</span> <span class="Constant">&quot;Not possible to specify --docs and --code simultaneously&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<span class="Identifier">$gen_docs</span> &amp;&amp; <span class="Identifier">$gen_code</span>);<br/></li>
<li><br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$wait_event_names</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$ARGV[</span><span class="Constant">0</span><span class="Identifier">]</span> <span class="Statement">or</span> <span class="Statement">die</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">@abi_compatibility_lines</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">@lines</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$abi_compatibility</span> = <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$section_name</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$note</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$note_name</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Remove comments and empty lines and add waitclassname based on the section<br/></li>
<li></span><span class="Statement">while</span> (&lt;<span class="Identifier">$wait_event_names</span>&gt;)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">chomp</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Skip comments<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Statement">/</span><span class="Constant">^#</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Skip empty lines<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">$</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Get waitclassname based on the section<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^Section: ClassName</span><span class="Special">(.*)</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$section_name</span> = <span class="Identifier">$_</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$section_name</span> =~ <span class="Statement">s/</span><span class="Constant">^</span><span class="Special">.*</span><span class="Constant">- </span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$abi_compatibility</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># ABI_compatibility region, preserving ABI compatibility of the code<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># generated.&nbsp; Any wait events listed in this part of the file will<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># not be sorted during the code generation.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^ABI_compatibility:$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$abi_compatibility</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$gen_code</span> &amp;&amp; <span class="Identifier">$abi_compatibility</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span>(<span class="Identifier">@abi_compatibility_lines</span>, <span class="Identifier">$section_name</span> . <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">&quot;</span> . <span class="Identifier">$_</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span>(<span class="Identifier">@lines</span>, <span class="Identifier">$section_name</span> . <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">&quot;</span> . <span class="Identifier">$_</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Sort the lines based on the second column.<br/></li>
<li></span><span class="Comment"># uc() is being used to force the comparison to be case-insensitive.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@lines_sorted</span> =<br/></li>
<li>&nbsp; <span class="Statement">sort</span> <span class="Statement">{</span> <span class="Statement">uc</span>((<span class="Statement">split</span>(<span class="Statement">/</span><span class="Special">\t</span><span class="Statement">/</span>, <span class="Identifier">$a</span>))[<span class="Constant">1</span>]) <span class="Statement">cmp</span> <span class="Statement">uc</span>((<span class="Statement">split</span>(<span class="Statement">/</span><span class="Special">\t</span><span class="Statement">/</span>, <span class="Identifier">$b</span>))[<span class="Constant">1</span>]) <span class="Statement">}</span> <span class="Identifier">@lines</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># If we are generating code, concat @lines_sorted and then<br/></li>
<li></span><span class="Comment"># @abi_compatibility_lines.<br/></li>
<li></span><span class="Statement">if</span> (<span class="Identifier">$gen_code</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">push</span>(<span class="Identifier">@lines_sorted</span>, <span class="Identifier">@abi_compatibility_lines</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Read the sorted lines and populate the hash table<br/></li>
<li></span><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$line</span> (<span class="Identifier">@lines_sorted</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;unable to parse wait_event_names.txt for line </span><span class="Identifier">$line</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">(\w+)\t+(\w+)\t+(</span><span class="Constant">&quot;</span><span class="Special">\w.*\.</span><span class="Constant">&quot;</span><span class="Special">)</span><span class="Constant">$</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; (<span class="Statement">my</span> <span class="Identifier">$waitclassname</span>, <span class="Statement">my</span> <span class="Identifier">$waiteventname</span>, <span class="Statement">my</span> <span class="Identifier">$waitevendocsentence</span>) =<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">split</span>(<span class="Statement">/</span><span class="Special">\t</span><span class="Statement">/</span>, <span class="Identifier">$line</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Generate the element name for the enums based on the<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># description.&nbsp; The C symbols are prefixed with &quot;WAIT_EVENT_&quot;.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$waiteventenumname</span> = <span class="Constant">&quot;WAIT_EVENT_</span><span class="Identifier">$waiteventname</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Build the descriptions.&nbsp; These are in camel-case.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># LWLock and Lock classes do not need any modifications.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$waiteventdescription</span> = <span class="Constant">''</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (&nbsp;&nbsp; <span class="Identifier">$waitclassname</span> <span class="Statement">eq</span> <span class="Constant">'WaitEventLWLock'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$waitclassname</span> <span class="Statement">eq</span> <span class="Constant">'WaitEventLock'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$waiteventdescription</span> = <span class="Identifier">$waiteventname</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@waiteventparts</span> = <span class="Statement">split</span>(<span class="Constant">&quot;_&quot;</span>, <span class="Identifier">$waiteventname</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$waiteventpart</span> (<span class="Identifier">@waiteventparts</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$waiteventdescription</span> .= <span class="Statement">substr</span>(<span class="Identifier">$waiteventpart</span>, <span class="Constant">0</span>, <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . <span class="Statement">lc</span>(<span class="Statement">substr</span>(<span class="Identifier">$waiteventpart</span>, <span class="Constant">1</span>, <span class="Statement">length</span>(<span class="Identifier">$waiteventpart</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Store the event into the list for each class.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">@waiteventlist</span> =<br/></li>
<li>&nbsp; &nbsp; &nbsp; [ <span class="Identifier">$waiteventenumname</span>, <span class="Identifier">$waiteventdescription</span>, <span class="Identifier">$waitevendocsentence</span> ];<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">push</span>(<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$hashwe{$waitclassname}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, <span class="Identifier">@waiteventlist</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># Generate the .c and .h files.<br/></li>
<li></span><span class="Statement">if</span> (<span class="Identifier">$gen_code</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Include PID in suffix in case parallel make runs this script<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># multiple times.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$htmp</span> = <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_types.h.tmp</span><span class="Identifier">$$</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$ctmp</span> = <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/pgstat_wait_event.c.tmp</span><span class="Identifier">$$</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$wctmp</span> = <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_funcs_data.c.tmp</span><span class="Identifier">$$</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$h</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$htmp</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$htmp</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$c</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$ctmp</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$ctmp</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$wc</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$wctmp</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$wctmp</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$header_comment</span> =<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">'/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * %s<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; Generated wait events infrastructure code<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * NOTES<br/></li>
<li></span><span class="Constant"> *&nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *&nbsp; *** DO NOT EDIT THIS FILE! ***<br/></li>
<li></span><span class="Constant"> *&nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *&nbsp; It has been GENERATED by src/backend/utils/activity/generate-wait_event_types.pl<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> */<br/></li>
<li></span><br/></li>
<li><span class="Constant">'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'wait_event_types.h'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;#ifndef WAIT_EVENT_TYPES_H</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;#define WAIT_EVENT_TYPES_H</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;#include </span><span class="Special">\&quot;</span><span class="Constant">utils/wait_event.h</span><span class="Special">\&quot;\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'pgstat_wait_event.c'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$wc</span> <span class="Identifier">$header_comment</span>, <span class="Constant">'wait_event_funcs_data.c'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Generate the pgstat_wait_event.c and wait_event_types.h files<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># uc() is being used to force the comparison to be case-insensitive.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$waitclass</span> (<span class="Statement">sort</span> <span class="Statement">{</span> <span class="Statement">uc</span>(<span class="Identifier">$a</span>) <span class="Statement">cmp</span> <span class="Statement">uc</span>(<span class="Identifier">$b</span>) <span class="Statement">}</span> <span class="Statement">keys</span> <span class="Identifier">%hashwe</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Don't generate the pgstat_wait_event.c and wait_event_types.h files<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># for Extension, LWLock and Lock, these are handled independently.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ( <span class="Identifier">$waitclass</span> <span class="Statement">eq</span> <span class="Constant">'WaitEventExtension'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$waitclass</span> <span class="Statement">eq</span> <span class="Constant">'WaitEventLWLock'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <span class="Identifier">$waitclass</span> <span class="Statement">eq</span> <span class="Constant">'WaitEventLock'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$last</span> = <span class="Identifier">$waitclass</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$last</span> =~ <span class="Statement">s/</span><span class="Constant">^WaitEvent</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$lastuc</span> = <span class="Statement">uc</span> <span class="Identifier">$last</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$lastlc</span> = <span class="Statement">lc</span> <span class="Identifier">$last</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$firstpass</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$pg_wait_class</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;static const char *</span><span class="Special">\n</span><span class="Constant">pgstat_get_wait_</span><span class="Identifier">$lastlc</span><span class="Constant">(</span><span class="Identifier">$waitclass</span><span class="Constant"> w)</span><span class="Special">\n</span><span class="Constant">{</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">const char *event_name = </span><span class="Special">\&quot;</span><span class="Constant">unknown wait event</span><span class="Special">\&quot;</span><span class="Constant">;</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">switch (w)</span><span class="Special">\n\t</span><span class="Constant">{</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$wev</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$hashwe{$waitclass}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$firstpass</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;typedef enum</span><span class="Special">\n</span><span class="Constant">{</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$pg_wait_class</span> = <span class="Constant">&quot;PG_WAIT_&quot;</span> . <span class="Identifier">$lastuc</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">%s = %s&quot;</span>, <span class="Identifier">$wev-&gt;[</span><span class="Constant">0</span><span class="Identifier">]</span>, <span class="Identifier">$pg_wait_class</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$continue</span> = <span class="Constant">&quot;,</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;%s</span><span class="Special">\t</span><span class="Constant">%s&quot;</span>, <span class="Identifier">$continue</span>, <span class="Identifier">$wev-&gt;[</span><span class="Constant">0</span><span class="Identifier">]</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$continue</span> = <span class="Constant">&quot;,</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$firstpass</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Constant">&quot;</span><span class="Special">\t\t</span><span class="Constant"> case %s:</span><span class="Special">\n</span><span class="Constant">&quot;</span>, <span class="Identifier">$wev-&gt;[</span><span class="Constant">0</span><span class="Identifier">]</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Apply quotes to the wait event name string.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant"> event_name = </span><span class="Special">\&quot;</span><span class="Constant">%s</span><span class="Special">\&quot;</span><span class="Constant">;</span><span class="Special">\n\t\t\t</span><span class="Constant"> break;</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$wev-&gt;[</span><span class="Constant">1</span><span class="Identifier">]</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">} </span><span class="Identifier">$waitclass</span><span class="Constant">;</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\t\t\t</span><span class="Constant"> /* no default case, so that compiler will warn */</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">}</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">return event_name;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$c</span> <span class="Constant">&quot;}</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Generate wait_event_funcs_data.c, building the contents of a static<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># C structure holding all the information about the wait events.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># uc() is being used to force the comparison to be case-insensitive,<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># even though it is not required here.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$waitclass</span> (<span class="Statement">sort</span> <span class="Statement">{</span> <span class="Statement">uc</span>(<span class="Identifier">$a</span>) <span class="Statement">cmp</span> <span class="Statement">uc</span>(<span class="Identifier">$b</span>) <span class="Statement">}</span> <span class="Statement">keys</span> <span class="Identifier">%hashwe</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$last</span> = <span class="Identifier">$waitclass</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$last</span> =~ <span class="Statement">s/</span><span class="Constant">^WaitEvent</span><span class="Statement">//</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$wev</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$hashwe{$waitclass}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$new_desc</span> = <span class="Statement">substr</span> <span class="Identifier">$wev-&gt;[</span><span class="Constant">2</span><span class="Identifier">]</span>, <span class="Constant">1</span>, -<span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Escape single quotes.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$new_desc</span> =~ <span class="Statement">s/</span><span class="Constant">'</span><span class="Statement">/</span><span class="Special">\\</span><span class="Constant">'</span><span class="Statement">/g</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Replace the &quot;quote&quot; markups by real ones.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$new_desc</span> =~ <span class="Statement">s/</span><span class="Constant">&lt;quote&gt;</span><span class="Special">(.*?)</span><span class="Constant">&lt;</span><span class="Special">\/</span><span class="Constant">quote&gt;</span><span class="Statement">/</span><span class="Special">\\</span><span class="Constant">&quot;</span><span class="Identifier">$1</span><span class="Special">\\</span><span class="Constant">&quot;</span><span class="Statement">/g</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Remove SGML markups.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$new_desc</span> =~ <span class="Statement">s/</span><span class="Constant">&lt;</span><span class="Special">.*?</span><span class="Constant">&gt;</span><span class="Special">(.*?)</span><span class="Constant">&lt;</span><span class="Special">.*?</span><span class="Constant">&gt;</span><span class="Statement">/</span><span class="Identifier">$1</span><span class="Statement">/g</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Tweak contents about links &lt;xref linkend=&quot;text&quot;/&gt;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># on GUCs,<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (<span class="Statement">my</span> (<span class="Identifier">$capture</span>) =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$new_desc</span> =~ <span class="Statement">m/</span><span class="Constant">&lt;xref linkend=&quot;guc-</span><span class="Special">(.*?)</span><span class="Constant">&quot;</span><span class="Special">\/</span><span class="Constant">&gt;</span><span class="Statement">/g</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$capture</span> =~ <span class="Statement">s/</span><span class="Constant">-</span><span class="Statement">/</span><span class="Constant">_</span><span class="Statement">/g</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$new_desc</span> =~ <span class="Statement">s/</span><span class="Constant">&lt;xref linkend=&quot;guc-</span><span class="Special">.*?</span><span class="Constant">&quot;</span><span class="Special">\/</span><span class="Constant">&gt;</span><span class="Statement">/</span><span class="Identifier">$capture</span><span class="Statement">/g</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Then remove any reference to<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># &quot;see &lt;xref linkend=&quot;text&quot;/&gt;&quot;.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$new_desc</span> =~ <span class="Statement">s/</span><span class="Constant">; see</span><span class="Special">.*</span><span class="Constant">$</span><span class="Statement">//</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Build one element of the C structure holding the<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># wait event info, as of (type, name, description).<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$wc</span> <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">{</span><span class="Special">\&quot;</span><span class="Constant">%s</span><span class="Special">\&quot;</span><span class="Constant">, </span><span class="Special">\&quot;</span><span class="Constant">%s</span><span class="Special">\&quot;</span><span class="Constant">, </span><span class="Special">\&quot;</span><span class="Constant">%s</span><span class="Special">\&quot;</span><span class="Constant">},</span><span class="Special">\n</span><span class="Constant">&quot;</span>, <span class="Identifier">$last</span>, <span class="Identifier">$wev-&gt;[</span><span class="Constant">1</span><span class="Identifier">]</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$new_desc</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;#endif&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* WAIT_EVENT_TYPES_H */</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$h</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$c</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$wc</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">rename</span>(<span class="Identifier">$htmp</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_types.h&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; || <span class="Statement">die</span> <span class="Constant">&quot;rename: </span><span class="Identifier">$htmp</span><span class="Constant"> to </span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_types.h: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">rename</span>(<span class="Identifier">$ctmp</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/pgstat_wait_event.c&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; || <span class="Statement">die</span> <span class="Constant">&quot;rename: </span><span class="Identifier">$ctmp</span><span class="Constant"> to </span><span class="Identifier">$output_path</span><span class="Constant">/pgstat_wait_event.c: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">rename</span>(<span class="Identifier">$wctmp</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_funcs_data.c&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; || <span class="Statement">die</span> <span class="Constant">&quot;rename: </span><span class="Identifier">$wctmp</span><span class="Constant"> to </span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_funcs_data.c: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>}<br/></li>
<li><span class="Comment"># Generate the .sgml file.<br/></li>
<li></span><span class="Statement">elsif</span> (<span class="Identifier">$gen_docs</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Include PID in suffix in case parallel make runs this multiple times.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$stmp</span> = <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_names.s.tmp</span><span class="Identifier">$$</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$s</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$stmp</span> <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$stmp</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># uc() is being used to force the comparison to be case-insensitive.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$waitclass</span> (<span class="Statement">sort</span> <span class="Statement">{</span> <span class="Statement">uc</span>(<span class="Identifier">$a</span>) <span class="Statement">cmp</span> <span class="Statement">uc</span>(<span class="Identifier">$b</span>) <span class="Statement">}</span> <span class="Statement">keys</span> <span class="Identifier">%hashwe</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$last</span> = <span class="Identifier">$waitclass</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$last</span> =~ <span class="Statement">s/</span><span class="Constant">^WaitEvent</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$lastlc</span> = <span class="Statement">lc</span> <span class="Identifier">$last</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &lt;table id=</span><span class="Special">\&quot;</span><span class="Constant">wait-event-%s-table</span><span class="Special">\&quot;</span><span class="Constant">&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>, <span class="Identifier">$lastlc</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp;&nbsp; &lt;title&gt;Wait Events of Type &lt;literal&gt;%s&lt;/literal&gt;&lt;/title&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">ucfirst</span>(<span class="Identifier">$lastlc</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp;&nbsp; &lt;tgroup cols=</span><span class="Special">\&quot;</span><span class="Constant">2</span><span class="Special">\&quot;</span><span class="Constant">&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp; &lt;thead&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp;&nbsp; &lt;row&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;literal&gt;</span><span class="Identifier">$last</span><span class="Constant">&lt;/literal&gt; Wait Event&lt;/entry&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp; &nbsp; &lt;entry&gt;Description&lt;/entry&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp;&nbsp; &lt;/row&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp; &lt;/thead&gt;</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp; &lt;tbody&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$wev</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$hashwe{$waitclass}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp;&nbsp; &lt;row&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;literal&gt;%s&lt;/literal&gt;&lt;/entry&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$wev-&gt;[</span><span class="Constant">1</span><span class="Identifier">]</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp; &nbsp; &lt;entry&gt;%s&lt;/entry&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>, <span class="Statement">substr</span> <span class="Identifier">$wev-&gt;[</span><span class="Constant">2</span><span class="Identifier">]</span>, <span class="Constant">1</span>, -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp;&nbsp; &lt;/row&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &nbsp; &lt;/tbody&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp;&nbsp; &lt;/tgroup&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">printf</span> <span class="Identifier">$s</span> <span class="Constant">&quot;&nbsp; &lt;/table&gt;</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">close</span> <span class="Identifier">$s</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">rename</span>(<span class="Identifier">$stmp</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_types.sgml&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; || <span class="Statement">die</span> <span class="Constant">&quot;rename: </span><span class="Identifier">$stmp</span><span class="Constant"> to </span><span class="Identifier">$output_path</span><span class="Constant">/wait_event_types.sgml: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$wait_event_names</span>;<br/></li>
<li><br/></li>
<li><a id="L335">&#x200c;</a><span class="Statement">sub </span><span class="Identifier"><span class="linkable">usage</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&lt;&lt;EOM</span><span class="perlHereDocStart">;<br/></li>
<li></span><span class="Constant">Usage: perl&nbsp; [--output &lt;path&gt;] [--code ] [ --sgml ] input_file<br/></li>
<li></span><br/></li>
<li><span class="Constant">Options:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; --outdir&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Output directory (default '.')<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; --code&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Generate C and header files.<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; --sgml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Generate wait_event_types.sgml.<br/></li>
<li></span><br/></li>
<li><span class="Constant">generate-wait_event_types.pl generates the SGML documentation and code<br/></li>
<li></span><span class="Constant">related to wait events.&nbsp; This should use wait_event_names.txt in input, or<br/></li>
<li></span><span class="Constant">an input file with a compatible format.<br/></li>
<li></span><br/></li>
<li><span class="Constant">Report bugs to &lt;pgsql-bugs</span><span class="Special">\@</span><span class="Constant">lists.postgresql.org&gt;.<br/></li>
<li></span><span class="Constant">EOM<br/></li>
<li></span>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
