<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/misc/ps_status.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/misc/ps_status.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L80">last_status_len</a></li>
<li><a href="#L75">ps_buffer</a></li>
<li><a href="#L78">ps_buffer</a></li>
<li><a href="#L83">ps_buffer_cur_len</a></li>
<li><a href="#L85">ps_buffer_fixed_size</a></li>
<li><a href="#L91">ps_buffer_nosuffix_len</a></li>
<li><a href="#L76">ps_buffer_size</a></li>
<li><a href="#L79">ps_buffer_size</a></li>
<li><a href="#L98">save_argc</a></li>
<li><a href="#L99">save_argv</a></li>
<li><a href="#L29">update_process_title</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L486">flush_ps_display</a></li>
<li><a href="#L530">get_ps_display</a></li>
<li><a href="#L267">init_ps_display</a></li>
<li><a href="#L117">save_ps_display_args</a></li>
<li><a href="#L421">set_ps_display_remove_suffix</a></li>
<li><a href="#L369">set_ps_display_suffix</a></li>
<li><a href="#L451">set_ps_display_with_len</a></li>
<li><a href="#L343">update_ps_display_precheck</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L306">PROGRAM_NAME_PREFIX</a></li>
<li><a href="#L74">PS_BUFFER_SIZE</a></li>
<li><a href="#L64">PS_PADDING</a></li>
<li><a href="#L66">PS_PADDING</a></li>
<li><a href="#L54">PS_USE_CLOBBER_ARGV</a></li>
<li><a href="#L58">PS_USE_NONE</a></li>
<li><a href="#L52">PS_USE_SETPROCTITLE</a></li>
<li><a href="#L50">PS_USE_SETPROCTITLE_FAST</a></li>
<li><a href="#L56">PS_USE_WIN32</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*--------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> * ps_status.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Routines to support changing the ps display of PostgreSQL backends<br/></li>
<li></span><span class="Comment"> * to contain some useful information. Mechanism differs wildly across<br/></li>
<li></span><span class="Comment"> * platforms.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * src/backend/utils/misc/ps_status.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2000-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * various details abducted from various places<br/></li>
<li></span><span class="Comment"> *--------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;unistd.h&gt;<br/></li>
<li></span><span class="PreProc">#if defined(__darwin__)<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;crt_externs.h&gt;<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;miscadmin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/guc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/ps_status.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Type">extern</span> <span class="Type">char</span> **environ;<br/></li>
<li><br/></li>
<li><span class="Comment">/* GUC variable */<br/></li>
<li><a id="L29">&#x200c;</a></span><span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">update_process_title</span> = DEFAULT_UPDATE_PROCESS_TITLE;<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Alternative ways of updating ps display:<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * <a href="#L50" title="utils/misc/ps_status.c:50">PS_USE_SETPROCTITLE_FAST</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; use the function setproctitle_fast(const char *, ...)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; (FreeBSD)<br/></li>
<li></span><span class="Comment"> * <a href="#L52" title="utils/misc/ps_status.c:52">PS_USE_SETPROCTITLE</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; use the function setproctitle(const char *, ...)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; (other BSDs)<br/></li>
<li></span><span class="Comment"> * <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; write over the argv and environment area<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; (Linux and most SysV-like systems)<br/></li>
<li></span><span class="Comment"> * <a href="#L56" title="utils/misc/ps_status.c:56">PS_USE_WIN32</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; <a href="../../regex/regc_nfa.c.html#L1884" title="regex/regc_nfa.c:1884">push</a> the string out as the name of a Windows event<br/></li>
<li></span><span class="Comment"> * <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; don't update ps display<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp;&nbsp; (This is the default, as it is safest.)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#if defined(HAVE_SETPROCTITLE_FAST)<br/></li>
<li><a id="L50">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_USE_SETPROCTITLE_FAST</span><br/></li>
<li></span><span class="PreProc">#elif defined(HAVE_SETPROCTITLE)<br/></li>
<li><a id="L52">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_USE_SETPROCTITLE</span><br/></li>
<li></span><span class="PreProc">#elif defined(__linux__) || defined(__sun) || defined(__darwin__)<br/></li>
<li><a id="L54">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_USE_CLOBBER_ARGV</span><br/></li>
<li></span><span class="PreProc">#elif defined(WIN32)<br/></li>
<li><a id="L56">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_USE_WIN32</span><br/></li>
<li></span><span class="PreProc">#else<br/></li>
<li><a id="L58">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_USE_NONE</span><br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* Different systems want the buffer padded differently */<br/></li>
<li></span><span class="PreProc">#if defined(__linux__) || defined(__darwin__)<br/></li>
<li><a id="L64">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_PADDING</span> </span><span class="Special">'\0'<br/></li>
<li></span><span class="PreProc">#else<br/></li>
<li><a id="L66">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_PADDING</span> </span><span class="Constant">' '<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifndef <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a><br/></li>
<li></span><span class="Comment">/* all but one option need a buffer to write their ps line in */<br/></li>
<li><a id="L74">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PS_BUFFER_SIZE</span> </span><span class="Constant">256<br/></li>
<li><a id="L75">&#x200c;</a></span><span class="Type">static</span> <span class="Type">char</span> <span class="linkable">ps_buffer</span>[<a href="#L74" title="utils/misc/ps_status.c:74">PS_BUFFER_SIZE</a>];<br/></li>
<li><a id="L76">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">size_t</span> <span class="linkable">ps_buffer_size</span> = <a href="#L74" title="utils/misc/ps_status.c:74">PS_BUFFER_SIZE</a>;<br/></li>
<li><span class="PreProc">#else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a> */<br/></li>
<li><a id="L78">&#x200c;</a></span><span class="Type">static</span> <span class="Type">char</span> *<span class="linkable">ps_buffer</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* will point to argv area */<br/></li>
<li><a id="L79">&#x200c;</a></span><span class="Type">static</span> <span class="Type">size_t</span> <span class="linkable">ps_buffer_size</span>;&nbsp; &nbsp; <span class="Comment">/* space determined at run time */<br/></li>
<li><a id="L80">&#x200c;</a></span><span class="Type">static</span> <span class="Type">size_t</span> <span class="linkable">last_status_len</span>;&nbsp; &nbsp; <span class="Comment">/* use to minimize length of clobber */<br/></li>
<li></span><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a> */<br/></li>
<li></span><br/></li>
<li><a id="L83">&#x200c;</a><span class="Type">static</span> <span class="Type">size_t</span> <span class="linkable">ps_buffer_cur_len</span>;&nbsp; &nbsp; <span class="Comment">/* nominal strlen(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>) */<br/></li>
<li></span><br/></li>
<li><a id="L85">&#x200c;</a><span class="Type">static</span> <span class="Type">size_t</span> <span class="linkable">ps_buffer_fixed_size</span>; <span class="Comment">/* size of the constant prefix */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Length of <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> the suffix was appended to the end, or 0 if we<br/></li>
<li></span><span class="Comment"> * didn't set a suffix.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L91">&#x200c;</a></span><span class="Type">static</span> <span class="Type">size_t</span> <span class="linkable">ps_buffer_nosuffix_len</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L486" title="utils/misc/ps_status.c:486">flush_ps_display</a>(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* save the original argv[] location here */<br/></li>
<li><a id="L98">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">save_argc</span>;<br/></li>
<li><a id="L99">&#x200c;</a><span class="Type">static</span> <span class="Type">char</span> **<span class="linkable">save_argv</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Call this early in startup to save the original argc/argv <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> * If needed, we make a copy of the original argv[] array to preserve it<br/></li>
<li></span><span class="Comment"> * from being clobbered by subsequent ps_display actions.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * (The original argv[] will not be overwritten by this routine, but may be<br/></li>
<li></span><span class="Comment"> * overwritten during <a href="#L267" title="utils/misc/ps_status.c:267">init_ps_display</a>.&nbsp; Also, the physical location of the<br/></li>
<li></span><span class="Comment"> * environment strings may be moved, so this should be called <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> <a href="../adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> code<br/></li>
<li></span><span class="Comment"> * that might try to hang onto a getenv() result.&nbsp; But see hack for musl<br/></li>
<li></span><span class="Comment"> * within.)<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note that in case of failure this cannot call elog() as that is not<br/></li>
<li></span><span class="Comment"> * initialized yet.&nbsp; We rely on <a href="../error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>() instead.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span>&nbsp; &nbsp; &nbsp; **<br/></li>
<li><a id="L117">&#x200c;</a><span class="linkable">save_ps_display_args</span>(<span class="Type">int</span> argc, <span class="Type">char</span> **argv)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L98" title="utils/misc/ps_status.c:98">save_argc</a> = argc;<br/></li>
<li>&nbsp; &nbsp; <a href="#L99" title="utils/misc/ps_status.c:99">save_argv</a> = argv;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if defined(<a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a>)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If we're going to overwrite the argv area, count the available space.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Also move the environment strings to make additional room.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *end_of_area = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **new_environ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * check for contiguous argv strings<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; argc; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i == <span class="Constant">0</span> || end_of_area + <span class="Constant">1</span> == argv[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end_of_area = argv[i] + strlen(argv[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end_of_area == <span class="Constant">NULL</span>)&nbsp; &nbsp; <span class="Comment">/* probably can't happen? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> argv;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * check for contiguous environ strings following argv<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; environ[i] != <span class="Constant">NULL</span>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end_of_area + <span class="Constant">1</span> == environ[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * The musl dynamic linker keeps a static pointer to the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * initial value of LD_LIBRARY_PATH, if that is defined in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * process's environment. Therefore, we must not overwrite the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * value of that setting and thus cannot advance end_of_area<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * beyond it.&nbsp; Musl does not define <a href="../adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> identifying compiler<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * symbol, so we have to do this unless we see a symbol<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * identifying a Linux libc we know is safe.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#if defined(__linux__) &amp;&amp; (!defined(__GLIBC__) &amp;&amp; !defined(__UCLIBC__))<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(environ[i], <span class="Constant">&quot;LD_LIBRARY_PATH=&quot;</span>, <span class="Constant">16</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We can overwrite the name, but stop at the equals sign.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Future loop iterations will not <a href="../../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> <a href="../adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> more<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * contiguous space, but we don't break early because we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * need to count the total number of environ[] entries.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end_of_area = environ[i] + <span class="Constant">15</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end_of_area = environ[i] + strlen(environ[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> = argv[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L80" title="utils/misc/ps_status.c:80">last_status_len</a> = <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> = end_of_area - argv[<span class="Constant">0</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * move the environment out of the way<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; new_environ = (<span class="Type">char</span> **) malloc((i + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!new_environ)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;out of memory</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; environ[i] != <span class="Constant">NULL</span>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new_environ[i] = strdup(environ[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!new_environ[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;out of memory</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; new_environ[i] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; environ = new_environ;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If we're going to change the original argv[] then make a copy for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * argument parsing purposes.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * NB: do NOT think to remove the copying of argv[], even though<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * postmaster.c finishes looking at argv[] long <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> we ever consider<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * changing the ps display.&nbsp; On some platforms, getopt() keeps pointers<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * into the argv array, and will get horribly confused when it is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * re-called to <a href="../../regex/regc_nfa.c.html#L3016" title="regex/regc_nfa.c:3016">analyze</a> a subprocess' argument string if the argv storage<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * has been clobbered meanwhile.&nbsp; Other platforms have other dependencies<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * on argv[].<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **new_argv;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; new_argv = (<span class="Type">char</span> **) malloc((argc + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!new_argv)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;out of memory</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; argc; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new_argv[i] = strdup(argv[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!new_argv[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;out of memory</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; new_argv[argc] = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if defined(__darwin__)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * macOS has a static copy of the argv pointer, which we may fix like<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * so:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *_NSGetArgv() = new_argv;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; argv = new_argv;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> argv;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Call this once during subprocess startup to set the identification<br/></li>
<li></span><span class="Comment"> * <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If fixed_part is NULL, a default will be obtained from <a href="../init/miscinit.c.html#L63" title="utils/init/miscinit.c:63">MyBackendType</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * At this point, the original argv[] array may be overwritten.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L267">&#x200c;</a></span><span class="linkable">init_ps_display</span>(<span class="Type">const</span> <span class="Type">char</span> *fixed_part)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; save_update_process_title;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; Assert(fixed_part || <a href="../init/miscinit.c.html#L63" title="utils/init/miscinit.c:63">MyBackendType</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!fixed_part)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fixed_part = <a href="../init/miscinit.c.html#L263" title="utils/init/miscinit.c:263">GetBackendTypeDesc</a>(<a href="../init/miscinit.c.html#L63" title="utils/init/miscinit.c:63">MyBackendType</a>);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* no ps display for stand-alone backend */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* no ps display if you didn't call <a href="#L117" title="utils/misc/ps_status.c:117">save_ps_display_args</a>() */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L99" title="utils/misc/ps_status.c:99">save_argv</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* If <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> is a pointer, it might still be null */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* make extra argv slots point at end_of_area (a NUL) */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">1</span>; i &lt; <a href="#L98" title="utils/misc/ps_status.c:98">save_argc</a>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L99" title="utils/misc/ps_status.c:99">save_argv</a>[i] = <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> + <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a>;<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Make fixed prefix of ps display.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(<a href="#L52" title="utils/misc/ps_status.c:52">PS_USE_SETPROCTITLE</a>) || defined(<a href="#L50" title="utils/misc/ps_status.c:50">PS_USE_SETPROCTITLE_FAST</a>)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * apparently setproctitle() already adds a `<a href="../../main/main.c.html#L44" title="main/main.c:44">progname</a>:' prefix to the ps<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * line<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li><a id="L306">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PROGRAM_NAME_PREFIX</span> </span><span class="Constant">&quot;&quot;<br/></li>
<li></span><span class="PreProc">#else<br/></li>
<li></span><span class="PreProc">#define <a href="#L306" title="utils/misc/ps_status.c:306">PROGRAM_NAME_PREFIX</a> </span><span class="Constant">&quot;postgres: &quot;<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*<a href="guc_tables.c.html#L540" title="utils/misc/guc_tables.c:540">cluster_name</a> == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; snprintf(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>, <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L306" title="utils/misc/ps_status.c:306">PROGRAM_NAME_PREFIX</a> <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> &quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fixed_part);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; snprintf(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>, <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L306" title="utils/misc/ps_status.c:306">PROGRAM_NAME_PREFIX</a> <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">: </span><span class="Special">%s</span><span class="Constant"> &quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="guc_tables.c.html#L540" title="utils/misc/guc_tables.c:540">cluster_name</a>, fixed_part);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> = <a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a> = strlen(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * On the first run, force the update.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; save_update_process_title = <a href="#L29" title="utils/misc/ps_status.c:29">update_process_title</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L29" title="utils/misc/ps_status.c:29">update_process_title</a> = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; set_ps_display(<span class="Constant">&quot;&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L29" title="utils/misc/ps_status.c:29">update_process_title</a> = save_update_process_title;<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a> */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L343" title="utils/misc/ps_status.c:343">update_ps_display_precheck</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Helper function to determine if updating the process title is<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; something that we need to do.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L343">&#x200c;</a></span><span class="linkable">update_ps_display_precheck</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="#L29" title="utils/misc/ps_status.c:29">update_process_title</a>=off disables updates */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L29" title="utils/misc/ps_status.c:29">update_process_title</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* no ps display for stand-alone backend */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* If <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> is a pointer, it might still be null */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L369" title="utils/misc/ps_status.c:369">set_ps_display_suffix</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Adjust the process title to append 'suffix' onto the end with a space<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; between it and the current process title.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L369">&#x200c;</a></span><span class="linkable">set_ps_display_suffix</span>(<span class="Type">const</span> <span class="Type">char</span> *suffix)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* first, check if we need to update the process title */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L343" title="utils/misc/ps_status.c:343">update_ps_display_precheck</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* if there's already a suffix, overwrite it */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a> &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> = <a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a> = <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = strlen(suffix);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* check if we have enough space to append the suffix */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> + len + <span class="Constant">1</span> &gt;= <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not enough space.&nbsp; Check the buffer isn't full already */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> &lt; <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* append a space <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> the suffix */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>[<a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>++] = <span class="Constant">' '</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* just add what we can and fill the <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> + <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>, suffix,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> - <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>[<a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> - <span class="Constant">1</span>] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> = <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>[<a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>++] = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> + <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>, suffix, len + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> = <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> + len;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(strlen(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>) == <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* and set the new title */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L486" title="utils/misc/ps_status.c:486">flush_ps_display</a>();<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a> */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L421" title="utils/misc/ps_status.c:421">set_ps_display_remove_suffix</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Remove the process display suffix added by <a href="#L369" title="utils/misc/ps_status.c:369">set_ps_display_suffix</a><br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L421">&#x200c;</a></span><span class="linkable">set_ps_display_remove_suffix</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* first, check if we need to update the process title */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L343" title="utils/misc/ps_status.c:343">update_ps_display_precheck</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* check we added a suffix */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a> == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* no suffix */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* remove the suffix from <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>[<a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a>] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> = <a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(<a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> == strlen(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* and set the new title */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L486" title="utils/misc/ps_status.c:486">flush_ps_display</a>();<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a> */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Call this to update the ps status display to a fixed prefix plus an<br/></li>
<li></span><span class="Comment"> * indication of what you're currently doing passed in the argument.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * 'len' must be the same as strlen(activity)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L451">&#x200c;</a></span><span class="linkable">set_ps_display_with_len</span>(<span class="Type">const</span> <span class="Type">char</span> *activity, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Assert(strlen(activity) == len);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* first, check if we need to update the process title */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L343" title="utils/misc/ps_status.c:343">update_ps_display_precheck</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* wipe out <a href="../adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> suffix when the title is completely changed */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L91" title="utils/misc/ps_status.c:91">ps_buffer_nosuffix_len</a> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Update <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> to contain both fixed part and activity */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a> + len &gt;= <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* handle the case where <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> doesn't have enough space */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> + <a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a>, activity,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> - <a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a> - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>[<a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> - <span class="Constant">1</span>] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> = <a href="#L76" title="utils/misc/ps_status.c:76">ps_buffer_size</a> - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> + <a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a>, activity, len + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> = <a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a> + len;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; Assert(strlen(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>) == <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Transmit new setting to kernel, if necessary */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L486" title="utils/misc/ps_status.c:486">flush_ps_display</a>();<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a> */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L486">&#x200c;</a></span><span class="linkable">flush_ps_display</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef <a href="#L52" title="utils/misc/ps_status.c:52">PS_USE_SETPROCTITLE</a><br/></li>
<li></span>&nbsp; &nbsp; setproctitle(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">&quot;</span>, <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>);<br/></li>
<li><span class="PreProc">#elif defined(<a href="#L50" title="utils/misc/ps_status.c:50">PS_USE_SETPROCTITLE_FAST</a>)<br/></li>
<li></span>&nbsp; &nbsp; setproctitle_fast(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">&quot;</span>, <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* pad unused memory; need only clobber remainder of old status string */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L80" title="utils/misc/ps_status.c:80">last_status_len</a> &gt; <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; MemSet(<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> + <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>, <a href="#L64" title="utils/misc/ps_status.c:64">PS_PADDING</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L80" title="utils/misc/ps_status.c:80">last_status_len</a> - <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L80" title="utils/misc/ps_status.c:80">last_status_len</a> = <a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a>;<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef <a href="#L56" title="utils/misc/ps_status.c:56">PS_USE_WIN32</a><br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Win32 does not support showing <a href="../adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> changed arguments. To make it at<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * all possible to track which backend is doing what, we create a<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * named object that can be viewed with for example Process Explorer.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">static</span> HANDLE ident_handle = INVALID_HANDLE_VALUE;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; name[<a href="#L74" title="utils/misc/ps_status.c:74">PS_BUFFER_SIZE</a> + <span class="Constant">32</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ident_handle != INVALID_HANDLE_VALUE)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CloseHandle(ident_handle);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(name, <span class="Constant">&quot;pgident(</span><span class="Special">%d</span><span class="Constant">): </span><span class="Special">%s</span><span class="Constant">&quot;</span>, <a href="../init/globals.c.html#L45" title="utils/init/globals.c:45">MyProcPid</a>, <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ident_handle = CreateEvent(<span class="Constant">NULL</span>, TRUE, FALSE, name);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L56" title="utils/misc/ps_status.c:56">PS_USE_WIN32</a> */<br/></li>
<li></span>}<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Returns what's currently in the ps display, in case someone needs<br/></li>
<li></span><span class="Comment"> * it.&nbsp; Note that only the activity part is returned.&nbsp; On some platforms<br/></li>
<li></span><span class="Comment"> * the string will not be null-terminated, so return the effective<br/></li>
<li></span><span class="Comment"> * length into *displen.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">const</span> <span class="Type">char</span> *<br/></li>
<li><a id="L530">&#x200c;</a><span class="linkable">get_ps_display</span>(<span class="Type">int</span> *displen)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifdef <a href="#L54" title="utils/misc/ps_status.c:54">PS_USE_CLOBBER_ARGV</a><br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* If <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> is a pointer, it might still be null */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *displen = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifndef <a href="#L58" title="utils/misc/ps_status.c:58">PS_USE_NONE</a><br/></li>
<li></span>&nbsp; &nbsp; *displen = (<span class="Type">int</span>) (<a href="#L83" title="utils/misc/ps_status.c:83">ps_buffer_cur_len</a> - <a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L75" title="utils/misc/ps_status.c:75">ps_buffer</a> + <a href="#L85" title="utils/misc/ps_status.c:85">ps_buffer_fixed_size</a>;<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; *displen = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;&quot;</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
