<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/inet_cidr_ntop.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/inet_cidr_ntop.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L21">rcsid</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L85">inet_cidr_ntop_ipv4</a></li>
<li><a href="#L165">inet_cidr_ntop_ipv6</a></li>
<li><a href="#L56">pg_inet_cidr_ntop</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L35">SPRINTF</a></li>
<li><a href="#L37">SPRINTF</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2004 by Internet Systems Consortium, Inc. (&quot;ISC&quot;)<br/></li>
<li></span><span class="Comment"> * Copyright (c) 1996,1999 by Internet Software Consortium.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Permission to use, copy, modify, and distribute this software for <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a><br/></li>
<li></span><span class="Comment"> * purpose with or without fee is hereby granted, provided that the above<br/></li>
<li></span><span class="Comment"> * copyright notice and this permission notice appear in all copies.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ISC DISCLAIMS ALL WARRANTIES<br/></li>
<li></span><span class="Comment"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF<br/></li>
<li></span><span class="Comment"> * MERCHANTABILITY AND FITNESS.&nbsp; IN NO EVENT SHALL ISC BE LIABLE FOR<br/></li>
<li></span><span class="Comment"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES<br/></li>
<li></span><span class="Comment"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN<br/></li>
<li></span><span class="Comment"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT<br/></li>
<li></span><span class="Comment"> * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/utils/adt/inet_cidr_ntop.c<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(LIBC_SCCS) &amp;&amp; !defined(lint)<br/></li>
<li><a id="L21">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> <span class="linkable">rcsid</span>[] = <span class="Constant">&quot;Id: inet_net_ntop.c,v 1.1.2.2 2004/03/09 09:17:27 marka Exp $&quot;</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;sys/<a href="../../port/win32/socket.c.html#L31" title="port/win32/socket.c:31">socket</a>.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;netinet/in.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;arpa/inet.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/inet.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef SPRINTF_CHAR<br/></li>
<li><a id="L35">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SPRINTF</span>(x) strlen(sprintf</span><span class="Comment">/**/</span><span class="PreProc">x)<br/></li>
<li></span><span class="PreProc">#else<br/></li>
<li><a id="L37">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SPRINTF</span>(x) ((</span><span class="Type">size_t</span><span class="PreProc">)sprintf x)<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L85" title="utils/adt/inet_cidr_ntop.c:85">inet_cidr_ntop_ipv4</a>(<span class="Type">const</span> u_char *src, <span class="Type">int</span> bits,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">char</span> *dst, <span class="Type">size_t</span> size);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L165" title="utils/adt/inet_cidr_ntop.c:165">inet_cidr_ntop_ipv6</a>(<span class="Type">const</span> u_char *src, <span class="Type">int</span> bits,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">char</span> *dst, <span class="Type">size_t</span> size);<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * char *<br/></li>
<li></span><span class="Comment"> * <a href="#L56" title="utils/adt/inet_cidr_ntop.c:56">pg_inet_cidr_ntop</a>(af, src, bits, dst, size)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; convert network number from network to presentation format.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; generates CIDR style result always.<br/></li>
<li></span><span class="Comment"> * return:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; pointer to dst, or NULL if an error occurred (check errno).<br/></li>
<li></span><span class="Comment"> * author:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Paul Vixie (ISC), July 1996<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L56">&#x200c;</a><span class="linkable">pg_inet_cidr_ntop</span>(<span class="Type">int</span> af, <span class="Type">const</span> <span class="Type">void</span> *src, <span class="Type">int</span> bits, <span class="Type">char</span> *dst, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (af)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PGSQL_AF_INET:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L85" title="utils/adt/inet_cidr_ntop.c:85">inet_cidr_ntop_ipv4</a>(src, bits, dst, size);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PGSQL_AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L165" title="utils/adt/inet_cidr_ntop.c:165">inet_cidr_ntop_ipv6</a>(src, bits, dst, size);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errno = <span class="Constant">EAFNOSUPPORT</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * static char *<br/></li>
<li></span><span class="Comment"> * <a href="#L85" title="utils/adt/inet_cidr_ntop.c:85">inet_cidr_ntop_ipv4</a>(src, bits, dst, size)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; convert IPv4 network number from network to presentation format.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; generates CIDR style result always.<br/></li>
<li></span><span class="Comment"> * return:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; pointer to dst, or NULL if an error occurred (check errno).<br/></li>
<li></span><span class="Comment"> * note:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; network byte order assumed.&nbsp; this means 192.5.5.240/28 has<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0b11110000 in its fourth octet.<br/></li>
<li></span><span class="Comment"> * author:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Paul Vixie (ISC), July 1996<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L85">&#x200c;</a><span class="linkable">inet_cidr_ntop_ipv4</span>(<span class="Type">const</span> u_char *src, <span class="Type">int</span> bits, <span class="Type">char</span> *dst, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *odst = dst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *t;<br/></li>
<li>&nbsp; &nbsp; u_int&nbsp; &nbsp; &nbsp; &nbsp; m;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bits &lt; <span class="Constant">0</span> || bits &gt; <span class="Constant">32</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; errno = <span class="Constant">EINVAL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bits == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size &lt; <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span> <span class="Constant">&quot;0&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Format whole octets. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (b = bits / <span class="Constant">8</span>; b &gt; <span class="Constant">0</span>; b--)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size &lt;= <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span> <span class="Constant">&quot;255.&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; t = dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst += <a href="#L35" title="utils/adt/inet_cidr_ntop.c:35">SPRINTF</a>((dst, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">&quot;</span>, *src++));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (b &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size -= (<span class="Type">size_t</span>) (dst - t);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Format partial octet. */<br/></li>
<li></span>&nbsp; &nbsp; b = bits % <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (b &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size &lt;= <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span> <span class="Constant">&quot;.255&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; t = dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dst != odst)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; m = ((<span class="Constant">1</span> &lt;&lt; b) - <span class="Constant">1</span>) &lt;&lt; (<span class="Constant">8</span> - b);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst += <a href="#L35" title="utils/adt/inet_cidr_ntop.c:35">SPRINTF</a>((dst, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">&quot;</span>, *src &amp; m));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size -= (<span class="Type">size_t</span>) (dst - t);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Format CIDR /width. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (size &lt;= <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span> <span class="Constant">&quot;/32&quot;</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; dst += <a href="#L35" title="utils/adt/inet_cidr_ntop.c:35">SPRINTF</a>((dst, <span class="Constant">&quot;/</span><span class="Special">%u</span><span class="Constant">&quot;</span>, bits));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> odst;<br/></li>
<li><br/></li>
<li><span class="Statement">emsgsize</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">EMSGSIZE</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * static char *<br/></li>
<li></span><span class="Comment"> * <a href="#L165" title="utils/adt/inet_cidr_ntop.c:165">inet_cidr_ntop_ipv6</a>(src, bits, dst, size)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; convert IPv6 network number from network to presentation format.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; generates CIDR style result always. Picks the <a href="../../regex/rege_dfa.c.html#L204" title="regex/rege_dfa.c:204">shortest</a> representation<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; unless the IP is really IPv4.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; always prints specified number of bits (bits).<br/></li>
<li></span><span class="Comment"> * return:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; pointer to dst, or NULL if an error occurred (check errno).<br/></li>
<li></span><span class="Comment"> * note:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; network byte order assumed.&nbsp; this means 192.5.5.240/28 has<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0x11110000 in its fourth octet.<br/></li>
<li></span><span class="Comment"> * author:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Vadim Kogan (UCB), June 2001<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Original version (IPv4) by Paul Vixie (ISC), July 1996<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L165">&#x200c;</a><span class="linkable">inet_cidr_ntop_ipv6</span>(<span class="Type">const</span> u_char *src, <span class="Type">int</span> bits, <span class="Type">char</span> *dst, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_int&nbsp; &nbsp; &nbsp; &nbsp; m;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_s,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_l,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp_zero_s,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp_zero_l;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is_ipv4 = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> inbuf[<span class="Constant">16</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; outbuf[<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Constant">&quot;xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:255.255.255.255/128&quot;</span>)];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *cp;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; words;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp;&nbsp; *s;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bits &lt; <span class="Constant">0</span> || bits &gt; <span class="Constant">128</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; errno = <span class="Constant">EINVAL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cp = outbuf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bits == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *cp = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Copy src to private buffer.&nbsp; Zero host part. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; p = (bits + <span class="Constant">7</span>) / <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(inbuf, src, p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memset(inbuf + p, <span class="Constant">0</span>, <span class="Constant">16</span> - p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b = bits % <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (b != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m = ((u_int) ~<span class="Constant">0</span>) &lt;&lt; (<span class="Constant">8</span> - b);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inbuf[p - <span class="Constant">1</span>] &amp;= m;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s = inbuf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* how many words need to be displayed in output */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; words = (bits + <span class="Constant">15</span>) / <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (words == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; words = <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Find the <a href="../../regex/rege_dfa.c.html#L42" title="regex/rege_dfa.c:42">longest</a> substring of zero's */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; zero_s = zero_l = tmp_zero_s = tmp_zero_l = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; (words * <span class="Constant">2</span>); i += <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((s[i] | s[i + <span class="Constant">1</span>]) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmp_zero_l == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp_zero_s = i / <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp_zero_l++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmp_zero_l &amp;&amp; zero_l &lt; tmp_zero_l)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_s = tmp_zero_s;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_l = tmp_zero_l;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp_zero_l = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmp_zero_l &amp;&amp; zero_l &lt; tmp_zero_l)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_s = tmp_zero_s;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_l = tmp_zero_l;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (zero_l != words &amp;&amp; zero_s == <span class="Constant">0</span> &amp;&amp; ((zero_l == <span class="Constant">6</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((zero_l == <span class="Constant">5</span> &amp;&amp; s[<span class="Constant">10</span>] == <span class="Constant">0xff</span> &amp;&amp; s[<span class="Constant">11</span>] == <span class="Constant">0xff</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((zero_l == <span class="Constant">7</span> &amp;&amp; s[<span class="Constant">14</span>] != <span class="Constant">0</span> &amp;&amp; s[<span class="Constant">15</span>] != <span class="Constant">1</span>)))))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is_ipv4 = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Format whole words. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = <span class="Constant">0</span>; p &lt; words; p++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (zero_l != <span class="Constant">0</span> &amp;&amp; p &gt;= zero_s &amp;&amp; p &lt; zero_s + zero_l)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Time to <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> some zeros */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == zero_s)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == words - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (is_ipv4 &amp;&amp; p &gt; <span class="Constant">5</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp++ = (p == <span class="Constant">6</span>) ? <span class="Constant">':'</span> : <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp += <a href="#L35" title="utils/adt/inet_cidr_ntop.c:35">SPRINTF</a>((cp, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">&quot;</span>, *s++));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we can potentially drop the last octet */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p != <span class="Constant">7</span> || bits &gt; <span class="Constant">120</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp += <a href="#L35" title="utils/adt/inet_cidr_ntop.c:35">SPRINTF</a>((cp, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">&quot;</span>, *s++));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cp != outbuf)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp += <a href="#L35" title="utils/adt/inet_cidr_ntop.c:35">SPRINTF</a>((cp, <span class="Constant">&quot;</span><span class="Special">%x</span><span class="Constant">&quot;</span>, *s * <span class="Constant">256</span> + s[<span class="Constant">1</span>]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Format CIDR /width. */<br/></li>
<li></span>&nbsp; &nbsp; (<span class="Type">void</span>) <a href="#L35" title="utils/adt/inet_cidr_ntop.c:35">SPRINTF</a>((cp, <span class="Constant">&quot;/</span><span class="Special">%u</span><span class="Constant">&quot;</span>, bits));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (strlen(outbuf) + <span class="Constant">1</span> &gt; size)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; strcpy(dst, outbuf);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li><br/></li>
<li><span class="Statement">emsgsize</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">EMSGSIZE</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
