<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/tsgistidx.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/tsgistidx.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L103">outbuf_maxlen</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L43">BITVECP</a></li>
<li><a href="#L573">CACHESIGN</a></li>
<li><a href="#L279">CHKVAL</a></li>
<li><a href="#L33">GistTsVectorOptions</a></li>
<li><a href="#L592">SPLITCOST</a></li>
<li><a href="#L68">SignTSVector</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L285">checkcondition_arr</a></li>
<li><a href="#L317">checkcondition_bit</a></li>
<li><a href="#L595">comparecost</a></li>
<li><a href="#L135">compareint</a></li>
<li><a href="#L576">fillcache</a></li>
<li><a href="#L156">gtsvector_alloc</a></li>
<li><a href="#L172">gtsvector_compress</a></li>
<li><a href="#L334">gtsvector_consistent</a></li>
<li><a href="#L803">gtsvector_consistent_oldsig</a></li>
<li><a href="#L252">gtsvector_decompress</a></li>
<li><a href="#L809">gtsvector_options</a></li>
<li><a href="#L533">gtsvector_penalty</a></li>
<li><a href="#L621">gtsvector_picksplit</a></li>
<li><a href="#L429">gtsvector_same</a></li>
<li><a href="#L402">gtsvector_union</a></li>
<li><a href="#L89">gtsvectorin</a></li>
<li><a href="#L106">gtsvectorout</a></li>
<li><a href="#L512">hemdist</a></li>
<li><a href="#L605">hemdistcache</a></li>
<li><a href="#L496">hemdistsign</a></li>
<li><a href="#L144">makesign</a></li>
<li><a href="#L490">sizebitvec</a></li>
<li><a href="#L374">unionkey</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L72">ALLISTRUE</a></li>
<li><a href="#L70">ARRKEY</a></li>
<li><a href="#L84">ARRNELEM</a></li>
<li><a href="#L100">ARROUTSTR</a></li>
<li><a href="#L79">CALCGTSIZE</a></li>
<li><a href="#L50">CLRBIT</a></li>
<li><a href="#L101">EXTRALEN</a></li>
<li><a href="#L83">GETARR</a></li>
<li><a href="#L52">GETBIT</a></li>
<li><a href="#L49">GETBITBYTE</a></li>
<li><a href="#L48">GETBYTE</a></li>
<li><a href="#L57">GETENTRY</a></li>
<li><a href="#L82">GETSIGLEN</a></li>
<li><a href="#L81">GETSIGN</a></li>
<li><a href="#L37">GET_SIGLEN</a></li>
<li><a href="#L78">GTHDRSIZE</a></li>
<li><a href="#L55">HASH</a></li>
<li><a href="#L54">HASHVAL</a></li>
<li><a href="#L76">ISALLTRUE</a></li>
<li><a href="#L74">ISARRKEY</a></li>
<li><a href="#L75">ISSIGNKEY</a></li>
<li><a href="#L45">LOOPBYTE</a></li>
<li><a href="#L51">SETBIT</a></li>
<li><a href="#L41">SIGLENBIT</a></li>
<li><a href="#L35">SIGLEN_DEFAULT</a></li>
<li><a href="#L36">SIGLEN_MAX</a></li>
<li><a href="#L71">SIGNKEY</a></li>
<li><a href="#L99">SINGOUTSTR</a></li>
<li><a href="#L587">WISH_F</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * tsgistidx.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; GiST support <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> for tsvector_ops<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/utils/adt/tsgistidx.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;access/gist.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/heaptoast.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/reloptions.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;common/int.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lib/qunique.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;port/pg_bitutils.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;tsearch/ts_utils.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/fmgrprotos.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/pg_crc.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* tsvector_ops opclass options */<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; vl_len_;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* varlena header (do not touch directly!) */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* signature length */<br/></li>
<li><a id="L33">&#x200c;</a></span>} <span class="linkable">GistTsVectorOptions</span>;<br/></li>
<li><br/></li>
<li><a id="L35">&#x200c;</a><span class="PreProc">#define <span class="linkable">SIGLEN_DEFAULT</span>&nbsp; &nbsp; (</span><span class="Constant">31</span><span class="PreProc"> * </span><span class="Constant">4</span><span class="PreProc">)<br/></li>
<li><a id="L36">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SIGLEN_MAX</span>&nbsp; &nbsp; &nbsp; &nbsp; GISTMaxIndexKeySize<br/></li>
<li><a id="L37">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">GET_SIGLEN</span>()&nbsp; &nbsp; (PG_HAS_OPCLASS_OPTIONS() ? \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((<a href="#L33" title="utils/adt/tsgistidx.c:33">GistTsVectorOptions</a> *) PG_GET_OPCLASS_OPTIONS())-&gt;siglen : \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L35" title="utils/adt/tsgistidx.c:35">SIGLEN_DEFAULT</a>)<br/></li>
<li></span><br/></li>
<li><a id="L41">&#x200c;</a><span class="PreProc">#define <span class="linkable">SIGLENBIT</span>(siglen) ((siglen) * BITS_PER_BYTE)<br/></li>
<li></span><br/></li>
<li><a id="L43">&#x200c;</a><span class="Type">typedef</span> <span class="Type">char</span> *<span class="linkable">BITVECP</span>;<br/></li>
<li><br/></li>
<li><a id="L45">&#x200c;</a><span class="PreProc">#define <span class="linkable">LOOPBYTE</span>(siglen) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">for</span><span class="PreProc"> (i = </span><span class="Constant">0</span><span class="PreProc">; i &lt; siglen; i++)<br/></li>
<li></span><br/></li>
<li><a id="L48">&#x200c;</a><span class="PreProc">#define <span class="linkable">GETBYTE</span>(x,i) ( *( (<a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>)(x) + (</span><span class="Type">int</span><span class="PreProc">)( (i) / BITS_PER_BYTE ) ) )<br/></li>
<li><a id="L49">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">GETBITBYTE</span>(x,i) ( ((</span><span class="Type">char</span><span class="PreProc">)(x)) &gt;&gt; (i) &amp; </span><span class="Constant">0x01</span><span class="PreProc"> )<br/></li>
<li><a id="L50">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">CLRBIT</span>(x,i)&nbsp;&nbsp; <a href="#L48" title="utils/adt/tsgistidx.c:48">GETBYTE</a>(x,i) &amp;= ~( </span><span class="Constant">0x01</span><span class="PreProc"> &lt;&lt; ( (i) % BITS_PER_BYTE ) )<br/></li>
<li><a id="L51">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SETBIT</span>(x,i)&nbsp;&nbsp; <a href="#L48" title="utils/adt/tsgistidx.c:48">GETBYTE</a>(x,i) |=&nbsp; ( </span><span class="Constant">0x01</span><span class="PreProc"> &lt;&lt; ( (i) % BITS_PER_BYTE ) )<br/></li>
<li><a id="L52">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">GETBIT</span>(x,i) ( (<a href="#L48" title="utils/adt/tsgistidx.c:48">GETBYTE</a>(x,i) &gt;&gt; ( (i) % BITS_PER_BYTE )) &amp; </span><span class="Constant">0x01</span><span class="PreProc"> )<br/></li>
<li></span><br/></li>
<li><a id="L54">&#x200c;</a><span class="PreProc">#define <span class="linkable">HASHVAL</span>(val, siglen) (((</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">int</span><span class="PreProc">)(val)) % <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglen))<br/></li>
<li><a id="L55">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">HASH</span>(sign, val, siglen) <a href="#L51" title="utils/adt/tsgistidx.c:51">SETBIT</a>((sign), <a href="#L54" title="utils/adt/tsgistidx.c:54">HASHVAL</a>(val, siglen))<br/></li>
<li></span><br/></li>
<li><a id="L57">&#x200c;</a><span class="PreProc">#define <span class="linkable">GETENTRY</span>(vec,pos) ((<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) DatumGetPointer((vec)-&gt;vector[(pos)].key))<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * type of GiST index key<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; vl_len_;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* varlena header (do not touch directly!) */<br/></li>
<li></span>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; flag;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; data[FLEXIBLE_ARRAY_MEMBER];<br/></li>
<li><a id="L68">&#x200c;</a>} <span class="linkable">SignTSVector</span>;<br/></li>
<li><br/></li>
<li><a id="L70">&#x200c;</a><span class="PreProc">#define <span class="linkable">ARRKEY</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x01<br/></li>
<li><a id="L71">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SIGNKEY</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x02<br/></li>
<li><a id="L72">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ALLISTRUE</span>&nbsp; &nbsp; </span><span class="Constant">0x04<br/></li>
<li></span><br/></li>
<li><a id="L74">&#x200c;</a><span class="PreProc">#define <span class="linkable">ISARRKEY</span>(x) ( ((<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a>*)(x))-&gt;flag &amp; <a href="#L70" title="utils/adt/tsgistidx.c:70">ARRKEY</a> )<br/></li>
<li><a id="L75">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ISSIGNKEY</span>(x)&nbsp; &nbsp; ( ((<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a>*)(x))-&gt;flag &amp; <a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a> )<br/></li>
<li><a id="L76">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ISALLTRUE</span>(x)&nbsp; &nbsp; ( ((<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a>*)(x))-&gt;flag &amp; <a href="#L72" title="utils/adt/tsgistidx.c:72">ALLISTRUE</a> )<br/></li>
<li></span><br/></li>
<li><a id="L78">&#x200c;</a><span class="PreProc">#define <span class="linkable">GTHDRSIZE</span>&nbsp; &nbsp; ( VARHDRSZ + </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(int32) )<br/></li>
<li><a id="L79">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">CALCGTSIZE</span>(flag, len) ( <a href="#L78" title="utils/adt/tsgistidx.c:78">GTHDRSIZE</a> + ( ( (flag) &amp; <a href="#L70" title="utils/adt/tsgistidx.c:70">ARRKEY</a> ) ? ((len)*</span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(int32)) : (((flag) &amp; <a href="#L72" title="utils/adt/tsgistidx.c:72">ALLISTRUE</a>) ? </span><span class="Constant">0</span><span class="PreProc"> : (len)) ) )<br/></li>
<li></span><br/></li>
<li><a id="L81">&#x200c;</a><span class="PreProc">#define <span class="linkable">GETSIGN</span>(x)&nbsp; &nbsp; ( (<a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>)( (</span><span class="Type">char</span><span class="PreProc">*)(x)+<a href="#L78" title="utils/adt/tsgistidx.c:78">GTHDRSIZE</a> ) )<br/></li>
<li><a id="L82">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">GETSIGLEN</span>(x)( VARSIZE(x) - <a href="#L78" title="utils/adt/tsgistidx.c:78">GTHDRSIZE</a> )<br/></li>
<li><a id="L83">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">GETARR</span>(x)&nbsp; &nbsp; ( (int32*)( (</span><span class="Type">char</span><span class="PreProc">*)(x)+<a href="#L78" title="utils/adt/tsgistidx.c:78">GTHDRSIZE</a> ) )<br/></li>
<li><a id="L84">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ARRNELEM</span>(x) ( ( VARSIZE(x) - <a href="#L78" title="utils/adt/tsgistidx.c:78">GTHDRSIZE</a> )/</span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(int32) )<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> int32 <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>(<a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a> sign, <span class="Type">int</span> siglen);<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L89">&#x200c;</a><span class="linkable">gtsvectorin</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* There's no need to support input of gtsvectors */<br/></li>
<li></span>&nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot <a href="../../port/win32/socket.c.html#L34" title="port/win32/socket.c:34">accept</a> a value of type </span><span class="Special">%s</span><span class="Constant">&quot;</span>, <span class="Constant">&quot;gtsvector&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* keep compiler quiet */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L99">&#x200c;</a><span class="PreProc">#define <span class="linkable">SINGOUTSTR</span>&nbsp; &nbsp; </span><span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant"> true bits, </span><span class="Special">%d</span><span class="Constant"> false bits&quot;<br/></li>
<li><a id="L100">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ARROUTSTR</span>&nbsp; &nbsp; </span><span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant"> unique words&quot;<br/></li>
<li><a id="L101">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">EXTRALEN</span>&nbsp; &nbsp; ( </span><span class="Constant">2</span><span class="PreProc">*</span><span class="Constant">13</span><span class="PreProc"> )<br/></li>
<li></span><br/></li>
<li><a id="L103">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">outbuf_maxlen</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L106">&#x200c;</a><span class="linkable">gtsvectorout</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *key = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) PG_DETOAST_DATUM(PG_GETARG_DATUM(<span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *outbuf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L103" title="utils/adt/tsgistidx.c:103">outbuf_maxlen</a> == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L103" title="utils/adt/tsgistidx.c:103">outbuf_maxlen</a> = <span class="Constant">2</span> * <a href="#L101" title="utils/adt/tsgistidx.c:101">EXTRALEN</a> + Max(strlen(<a href="#L99" title="utils/adt/tsgistidx.c:99">SINGOUTSTR</a>), strlen(<a href="#L100" title="utils/adt/tsgistidx.c:100">ARROUTSTR</a>)) + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; outbuf = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<a href="#L103" title="utils/adt/tsgistidx.c:103">outbuf_maxlen</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L74" title="utils/adt/tsgistidx.c:74">ISARRKEY</a>(key))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(outbuf, <a href="#L100" title="utils/adt/tsgistidx.c:100">ARROUTSTR</a>, (<span class="Type">int</span>) <a href="#L84" title="utils/adt/tsgistidx.c:84">ARRNELEM</a>(key));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(key))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(outbuf, <span class="Constant">&quot;all true bits&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen = <a href="#L82" title="utils/adt/tsgistidx.c:82">GETSIGLEN</a>(key);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnttrue = <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(key), siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(outbuf, <a href="#L99" title="utils/adt/tsgistidx.c:99">SINGOUTSTR</a>, cnttrue, (<span class="Type">int</span>) <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglen) - cnttrue);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_FREE_IF_COPY(key, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(outbuf);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L135">&#x200c;</a></span><span class="linkable">compareint</span>(<span class="Type">const</span> <span class="Type">void</span> *va, <span class="Type">const</span> <span class="Type">void</span> *vb)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; a = *((<span class="Type">const</span> int32 *) va);<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; b = *((<span class="Type">const</span> int32 *) vb);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> pg_cmp_s32(a, b);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L144">&#x200c;</a></span><span class="linkable">makesign</span>(<a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a> sign, <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *a, <span class="Type">int</span> siglen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; k,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L84" title="utils/adt/tsgistidx.c:84">ARRNELEM</a>(a);<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *ptr = <a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(a);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; MemSet(sign, <span class="Constant">0</span>, siglen);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (k = <span class="Constant">0</span>; k &lt; len; k++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../regex/regexec.c.html#L49" title="regex/regexec.c:49">HASH</a>(sign, ptr[k], siglen);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *<br/></li>
<li><a id="L156">&#x200c;</a><span class="linkable">gtsvector_alloc</span>(<span class="Type">int</span> flag, <span class="Type">int</span> len, <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a> sign)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size = <a href="#L79" title="utils/adt/tsgistidx.c:79">CALCGTSIZE</a>(flag, len);<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *res = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; SET_VARSIZE(res, size);<br/></li>
<li>&nbsp; &nbsp; res-&gt;flag = flag;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((flag &amp; (<a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a> | <a href="#L72" title="utils/adt/tsgistidx.c:72">ALLISTRUE</a>)) == <a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a> &amp;&amp; sign)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(res), sign, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L172">&#x200c;</a><span class="linkable">gtsvector_compress</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; GISTENTRY&nbsp; *entry = (GISTENTRY *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen = <a href="#L37" title="utils/adt/tsgistidx.c:37">GET_SIGLEN</a>();<br/></li>
<li>&nbsp; &nbsp; GISTENTRY&nbsp; *retval = entry;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (entry-&gt;leafkey)<br/></li>
<li>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* tsvector */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; TSVector&nbsp; &nbsp; val = DatumGetTSVector(entry-&gt;key);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *res = <a href="#L156" title="utils/adt/tsgistidx.c:156">gtsvector_alloc</a>(<a href="#L70" title="utils/adt/tsgistidx.c:70">ARRKEY</a>, val-&gt;size, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *arr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; WordEntry&nbsp; *ptr = ARRPTR(val);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *words = STRPTR(val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; arr = <a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(res);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = val-&gt;size;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (len--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pg_crc32&nbsp; &nbsp; c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INIT_LEGACY_CRC32(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMP_LEGACY_CRC32(c, words + ptr-&gt;pos, ptr-&gt;len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FIN_LEGACY_CRC32(c);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *arr = *(int32 *) &amp;c;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; qsort(<a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(res), val-&gt;size, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>), <a href="#L135" title="utils/adt/tsgistidx.c:135">compareint</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = qunique(<a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(res), val-&gt;size, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>), <a href="#L135" title="utils/adt/tsgistidx.c:135">compareint</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len != val-&gt;size)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * there is a collision of <a href="../../regex/rege_dfa.c.html#L715" title="regex/rege_dfa.c:715">hash</a>-function; len is always less than<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * val-&gt;size<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L79" title="utils/adt/tsgistidx.c:79">CALCGTSIZE</a>(<a href="#L70" title="utils/adt/tsgistidx.c:70">ARRKEY</a>, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) <a href="../mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(res, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET_VARSIZE(res, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* make signature, if array is too long */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (VARSIZE(res) &gt; TOAST_INDEX_TARGET)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *ressign = <a href="#L156" title="utils/adt/tsgistidx.c:156">gtsvector_alloc</a>(<a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a>, siglen, <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L144" title="utils/adt/tsgistidx.c:144">makesign</a>(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(ressign), res, siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res = ressign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; retval = (GISTENTRY *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(GISTENTRY));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; gistentryinit(*retval, PointerGetDatum(res),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;rel, entry-&gt;page,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;offset, <span class="Constant">false</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L75" title="utils/adt/tsgistidx.c:75">ISSIGNKEY</a>(DatumGetPointer(entry-&gt;key)) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; !<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(DatumGetPointer(entry-&gt;key)))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *res;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; sign = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(DatumGetPointer(entry-&gt;key));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L45" title="utils/adt/tsgistidx.c:45">LOOPBYTE</a>(siglen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((sign[i] &amp; <span class="Constant">0xff</span>) != <span class="Constant">0xff</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_POINTER(retval);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; res = <a href="#L156" title="utils/adt/tsgistidx.c:156">gtsvector_alloc</a>(<a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a> | <a href="#L72" title="utils/adt/tsgistidx.c:72">ALLISTRUE</a>, siglen, sign);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; retval = (GISTENTRY *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(GISTENTRY));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; gistentryinit(*retval, PointerGetDatum(res),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;rel, entry-&gt;page,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;offset, <span class="Constant">false</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(retval);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L252">&#x200c;</a><span class="linkable">gtsvector_decompress</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We need to detoast the stored value, because the other gtsvector<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * support <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> don't cope with toasted <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; GISTENTRY&nbsp; *entry = (GISTENTRY *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *key = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) PG_DETOAST_DATUM(entry-&gt;key);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (key != (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) DatumGetPointer(entry-&gt;key))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; GISTENTRY&nbsp; *retval = (GISTENTRY *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(GISTENTRY));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; gistentryinit(*retval, PointerGetDatum(key),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;rel, entry-&gt;page,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;offset, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_POINTER(retval);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(entry);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *arrb;<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *arre;<br/></li>
<li><a id="L279">&#x200c;</a>} <span class="linkable">CHKVAL</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="tsvector_op.c.html#L1854" title="utils/adt/tsvector_op.c:1854">TS_execute</a> callback for matching a tsquery operand to GIST leaf-page data<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> TSTernaryValue<br/></li>
<li><a id="L285">&#x200c;</a><span class="linkable">checkcondition_arr</span>(<span class="Type">void</span> *checkval, QueryOperand *val, ExecPhraseData *data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *StopLow = ((<a href="tsvector_op.c.html#L42" title="utils/adt/tsvector_op.c:42">CHKVAL</a> *) checkval)-&gt;arrb;<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *StopHigh = ((<a href="tsvector_op.c.html#L42" title="utils/adt/tsvector_op.c:42">CHKVAL</a> *) checkval)-&gt;arre;<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *StopMiddle;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Loop invariant: StopLow &lt;= val &lt; StopHigh */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * we are not able to <a href="../../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> a prefix by <a href="../../regex/rege_dfa.c.html#L715" title="regex/rege_dfa.c:715">hash</a> value<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (val-&gt;prefix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TS_MAYBE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (StopLow &lt; StopHigh)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StopMiddle = StopLow + (StopHigh - StopLow) / <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*StopMiddle == val-&gt;valcrc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TS_MAYBE;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*StopMiddle &lt; val-&gt;valcrc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopLow = StopMiddle + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopHigh = StopMiddle;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> TS_NO;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="tsvector_op.c.html#L1854" title="utils/adt/tsvector_op.c:1854">TS_execute</a> callback for matching a tsquery operand to GIST non-leaf data<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> TSTernaryValue<br/></li>
<li><a id="L317">&#x200c;</a><span class="linkable">checkcondition_bit</span>(<span class="Type">void</span> *checkval, QueryOperand *val, ExecPhraseData *data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp;&nbsp; *key = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) checkval;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * we are not able to <a href="../../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> a prefix in signature tree<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (val-&gt;prefix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TS_MAYBE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L52" title="utils/adt/tsgistidx.c:52">GETBIT</a>(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(key), <a href="#L54" title="utils/adt/tsgistidx.c:54">HASHVAL</a>(val-&gt;valcrc, <a href="#L82" title="utils/adt/tsgistidx.c:82">GETSIGLEN</a>(key))))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TS_MAYBE;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TS_NO;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L334">&#x200c;</a><span class="linkable">gtsvector_consistent</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; GISTENTRY&nbsp; *entry = (GISTENTRY *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; TSQuery&nbsp; &nbsp; &nbsp; &nbsp; query = PG_GETARG_TSQUERY(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* StrategyNumber strategy = (StrategyNumber) PG_GETARG_UINT16(2); */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* Oid&nbsp; &nbsp; &nbsp; &nbsp; subtype = PG_GETARG_OID(3); */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp;&nbsp; *recheck = (<span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> *) PG_GETARG_POINTER(<span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *key = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) DatumGetPointer(entry-&gt;key);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* All cases served by this function are inexact */<br/></li>
<li></span>&nbsp; &nbsp; *recheck = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!query-&gt;size)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_BOOL(<span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="utils/adt/tsgistidx.c:75">ISSIGNKEY</a>(key))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(key))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_BOOL(<span class="Constant">true</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_BOOL(<a href="tsvector_op.c.html#L1854" title="utils/adt/tsvector_op.c:1854">TS_execute</a>(GETQUERY(query),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; key,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TS_EXEC_PHRASE_NO_POS,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L317" title="utils/adt/tsgistidx.c:317">checkcondition_bit</a>));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* only leaf pages */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="tsvector_op.c.html#L42" title="utils/adt/tsvector_op.c:42">CHKVAL</a>&nbsp; &nbsp; &nbsp; &nbsp; chkval;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; chkval.arrb = <a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(key);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; chkval.arre = chkval.arrb + <a href="#L84" title="utils/adt/tsgistidx.c:84">ARRNELEM</a>(key);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_BOOL(<a href="tsvector_op.c.html#L1854" title="utils/adt/tsvector_op.c:1854">TS_execute</a>(GETQUERY(query),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span> *) &amp;chkval,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TS_EXEC_PHRASE_NO_POS,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L285" title="utils/adt/tsgistidx.c:285">checkcondition_arr</a>));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> int32<br/></li>
<li><a id="L374">&#x200c;</a><span class="linkable">unionkey</span>(<a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a> sbase, <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *add, <span class="Type">int</span> siglen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="utils/adt/tsgistidx.c:75">ISSIGNKEY</a>(add))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; sadd = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(add);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(add))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Assert(<a href="#L82" title="utils/adt/tsgistidx.c:82">GETSIGLEN</a>(add) == siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L45" title="utils/adt/tsgistidx.c:45">LOOPBYTE</a>(siglen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbase[i] |= sadd[i];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *ptr = <a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(add);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L84" title="utils/adt/tsgistidx.c:84">ARRNELEM</a>(add); i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../regex/regexec.c.html#L49" title="regex/regexec.c:49">HASH</a>(sbase, ptr[i], siglen);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L402">&#x200c;</a><span class="linkable">gtsvector_union</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; GistEntryVector *entryvec = (GistEntryVector *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *size = (<span class="Type">int</span> *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen = <a href="#L37" title="utils/adt/tsgistidx.c:37">GET_SIGLEN</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *result = <a href="#L156" title="utils/adt/tsgistidx.c:156">gtsvector_alloc</a>(<a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a>, siglen, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; base = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(result);<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memset(base, <span class="Constant">0</span>, siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; entryvec-&gt;n; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L374" title="utils/adt/tsgistidx.c:374">unionkey</a>(base, <a href="tsquery_gist.c.html#L23" title="utils/adt/tsquery_gist.c:23">GETENTRY</a>(entryvec, i), siglen))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result-&gt;flag |= <a href="#L72" title="utils/adt/tsgistidx.c:72">ALLISTRUE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET_VARSIZE(result, <a href="#L79" title="utils/adt/tsgistidx.c:79">CALCGTSIZE</a>(result-&gt;flag, siglen));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *size = VARSIZE(result);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L429">&#x200c;</a><span class="linkable">gtsvector_same</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *a = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *b = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp;&nbsp; *result = (<span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> *) PG_GETARG_POINTER(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen = <a href="#L37" title="utils/adt/tsgistidx.c:37">GET_SIGLEN</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="utils/adt/tsgistidx.c:75">ISSIGNKEY</a>(a))<br/></li>
<li>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* then b also <a href="#L75" title="utils/adt/tsgistidx.c:75">ISSIGNKEY</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(a) &amp;&amp; <a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(b))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(a))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(b))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; sa = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(a),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sb = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(b);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(<a href="#L82" title="utils/adt/tsgistidx.c:82">GETSIGLEN</a>(a) == siglen &amp;&amp; <a href="#L82" title="utils/adt/tsgistidx.c:82">GETSIGLEN</a>(b) == siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L45" title="utils/adt/tsgistidx.c:45">LOOPBYTE</a>(siglen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sa[i] != sb[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* a and b <a href="#L74" title="utils/adt/tsgistidx.c:74">ISARRKEY</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; lena = <a href="#L84" title="utils/adt/tsgistidx.c:84">ARRNELEM</a>(a),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lenb = <a href="#L84" title="utils/adt/tsgistidx.c:84">ARRNELEM</a>(b);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lena != lenb)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp;&nbsp; *ptra = <a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(a),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *ptrb = <a href="#L83" title="utils/adt/tsgistidx.c:83">GETARR</a>(b);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; lena; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ptra[i] != ptrb[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> int32<br/></li>
<li><a id="L490">&#x200c;</a><span class="linkable">sizebitvec</span>(<a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a> sign, <span class="Type">int</span> siglen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> pg_popcount(sign, siglen);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L496">&#x200c;</a></span><span class="linkable">hemdistsign</span>(<a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a> a, <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a> b, <span class="Type">int</span> siglen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; diff,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dist = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L45" title="utils/adt/tsgistidx.c:45">LOOPBYTE</a>(siglen)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; diff = (<span class="Type">unsigned</span> <span class="Type">char</span>) (a[i] ^ b[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Using the popcount <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> here isn't likely to win */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; dist += pg_number_of_ones[diff];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dist;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L512">&#x200c;</a></span><span class="linkable">hemdist</span>(<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *a, <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *b)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglena = <a href="#L82" title="utils/adt/tsgistidx.c:82">GETSIGLEN</a>(a);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglenb = <a href="#L82" title="utils/adt/tsgistidx.c:82">GETSIGLEN</a>(b);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(a))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(b))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglenb) - <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(b), siglenb);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(b))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglena) - <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(a), siglena);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(siglena == siglenb);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L496" title="utils/adt/tsgistidx.c:496">hemdistsign</a>(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(a), <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(b), siglena);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L533">&#x200c;</a><span class="linkable">gtsvector_penalty</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; GISTENTRY&nbsp; *origentry = (GISTENTRY *) PG_GETARG_POINTER(<span class="Constant">0</span>); <span class="Comment">/* always <a href="#L75" title="utils/adt/tsgistidx.c:75">ISSIGNKEY</a> */<br/></li>
<li></span>&nbsp; &nbsp; GISTENTRY&nbsp; *newentry = (GISTENTRY *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">float</span>&nbsp; &nbsp; &nbsp;&nbsp; *penalty = (<span class="Type">float</span> *) PG_GETARG_POINTER(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen = <a href="#L37" title="utils/adt/tsgistidx.c:37">GET_SIGLEN</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *origval = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) DatumGetPointer(origentry-&gt;key);<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *<a href="../misc/guc.c.html#L3703" title="utils/misc/guc.c:3703">newval</a> = (<a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *) DatumGetPointer(newentry-&gt;key);<br/></li>
<li>&nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; orig = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(origval);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *penalty = <span class="Constant">0.0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L74" title="utils/adt/tsgistidx.c:74">ISARRKEY</a>(<a href="../misc/guc.c.html#L3703" title="utils/misc/guc.c:3703">newval</a>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; sign = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L144" title="utils/adt/tsgistidx.c:144">makesign</a>(sign, <a href="../misc/guc.c.html#L3703" title="utils/misc/guc.c:3703">newval</a>, siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(origval))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglenbit = <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *penalty =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">float</span>) (siglenbit - <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>(sign, siglen)) /<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">float</span>) (siglenbit + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *penalty = <a href="#L496" title="utils/adt/tsgistidx.c:496">hemdistsign</a>(sign, orig, siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(sign);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *penalty = <a href="tsquery_gist.c.html#L131" title="utils/adt/tsquery_gist.c:131">hemdist</a>(origval, <a href="../misc/guc.c.html#L3703" title="utils/misc/guc.c:3703">newval</a>);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(penalty);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; allistrue;<br/></li>
<li>&nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; sign;<br/></li>
<li><a id="L573">&#x200c;</a>} <span class="linkable">CACHESIGN</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L576">&#x200c;</a></span><span class="linkable">fillcache</span>(<a href="#L573" title="utils/adt/tsgistidx.c:573">CACHESIGN</a> *item, <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *key, <span class="Type">int</span> siglen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; item-&gt;allistrue = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L74" title="utils/adt/tsgistidx.c:74">ISARRKEY</a>(key))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L144" title="utils/adt/tsgistidx.c:144">makesign</a>(item-&gt;sign, key, siglen);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(key))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; item-&gt;allistrue = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(item-&gt;sign, <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(key), siglen);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L587">&#x200c;</a><span class="PreProc">#define <span class="linkable">WISH_F</span>(a,b,c) (</span><span class="Type">double</span><span class="PreProc">)( -(</span><span class="Type">double</span><span class="PreProc">)(((a)-(b))*((a)-(b))*((a)-(b)))*(c) )<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; OffsetNumber pos;<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; cost;<br/></li>
<li><a id="L592">&#x200c;</a>} <span class="linkable">SPLITCOST</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L595">&#x200c;</a></span><span class="linkable">comparecost</span>(<span class="Type">const</span> <span class="Type">void</span> *va, <span class="Type">const</span> <span class="Type">void</span> *vb)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a> *a = (<span class="Type">const</span> <a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a> *) va;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a> *b = (<span class="Type">const</span> <a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a> *) vb;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> pg_cmp_s32(a-&gt;cost, b-&gt;cost);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L605">&#x200c;</a></span><span class="linkable">hemdistcache</span>(<a href="#L573" title="utils/adt/tsgistidx.c:573">CACHESIGN</a> *a, <a href="#L573" title="utils/adt/tsgistidx.c:573">CACHESIGN</a> *b, <span class="Type">int</span> siglen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (a-&gt;allistrue)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (b-&gt;allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglen) - <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>(b-&gt;sign, siglen);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (b-&gt;allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglen) - <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>(a-&gt;sign, siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L496" title="utils/adt/tsgistidx.c:496">hemdistsign</a>(a-&gt;sign, b-&gt;sign, siglen);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L621">&#x200c;</a><span class="linkable">gtsvector_picksplit</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; GistEntryVector *entryvec = (GistEntryVector *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; GIST_SPLITVEC *v = (GIST_SPLITVEC *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen = <a href="#L37" title="utils/adt/tsgistidx.c:37">GET_SIGLEN</a>();<br/></li>
<li>&nbsp; &nbsp; OffsetNumber k,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j;<br/></li>
<li>&nbsp; &nbsp; <a href="#L68" title="utils/adt/tsgistidx.c:68">SignTSVector</a> *datum_l,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *datum_r;<br/></li>
<li>&nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; union_l,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; union_r;<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; size_alpha,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_beta;<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; size_waste,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; waste = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; nbytes;<br/></li>
<li>&nbsp; &nbsp; OffsetNumber seed_1 = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; seed_2 = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; OffsetNumber *left,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *right;<br/></li>
<li>&nbsp; &nbsp; OffsetNumber maxoff;<br/></li>
<li>&nbsp; &nbsp; <a href="#L43" title="utils/adt/tsgistidx.c:43">BITVECP</a>&nbsp; &nbsp; &nbsp; &nbsp; ptr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="#L573" title="utils/adt/tsgistidx.c:573">CACHESIGN</a>&nbsp; *cache;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *cache_sign;<br/></li>
<li>&nbsp; &nbsp; <a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a>&nbsp; *costvector;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; maxoff = entryvec-&gt;n - <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; nbytes = (maxoff + <span class="Constant">2</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(OffsetNumber);<br/></li>
<li>&nbsp; &nbsp; v-&gt;spl_left = (OffsetNumber *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(nbytes);<br/></li>
<li>&nbsp; &nbsp; v-&gt;spl_right = (OffsetNumber *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(nbytes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cache = (<a href="#L573" title="utils/adt/tsgistidx.c:573">CACHESIGN</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L573" title="utils/adt/tsgistidx.c:573">CACHESIGN</a>) * (maxoff + <span class="Constant">2</span>));<br/></li>
<li>&nbsp; &nbsp; cache_sign = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(siglen * (maxoff + <span class="Constant">2</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (j = <span class="Constant">0</span>; j &lt; maxoff + <span class="Constant">2</span>; j++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cache[j].sign = &amp;cache_sign[siglen * j];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L576" title="utils/adt/tsgistidx.c:576">fillcache</a>(&amp;cache[FirstOffsetNumber], <a href="tsquery_gist.c.html#L23" title="utils/adt/tsquery_gist.c:23">GETENTRY</a>(entryvec, FirstOffsetNumber),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (k = FirstOffsetNumber; k &lt; maxoff; k = OffsetNumberNext(k))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (j = OffsetNumberNext(k); j &lt;= maxoff; j = OffsetNumberNext(j))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (k == FirstOffsetNumber)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L576" title="utils/adt/tsgistidx.c:576">fillcache</a>(&amp;cache[j], <a href="tsquery_gist.c.html#L23" title="utils/adt/tsquery_gist.c:23">GETENTRY</a>(entryvec, j), siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_waste = <a href="#L605" title="utils/adt/tsgistidx.c:605">hemdistcache</a>(&amp;(cache[j]), &amp;(cache[k]), siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size_waste &gt; waste)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; waste = size_waste;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; seed_1 = k;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; seed_2 = j;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; left = v-&gt;spl_left;<br/></li>
<li>&nbsp; &nbsp; v-&gt;spl_nleft = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; right = v-&gt;spl_right;<br/></li>
<li>&nbsp; &nbsp; v-&gt;spl_nright = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (seed_1 == <span class="Constant">0</span> || seed_2 == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; seed_1 = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; seed_2 = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* form initial .. */<br/></li>
<li></span>&nbsp; &nbsp; datum_l = <a href="#L156" title="utils/adt/tsgistidx.c:156">gtsvector_alloc</a>(<a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a> | (cache[seed_1].allistrue ? <a href="#L72" title="utils/adt/tsgistidx.c:72">ALLISTRUE</a> : <span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen, cache[seed_1].sign);<br/></li>
<li>&nbsp; &nbsp; datum_r = <a href="#L156" title="utils/adt/tsgistidx.c:156">gtsvector_alloc</a>(<a href="#L71" title="utils/adt/tsgistidx.c:71">SIGNKEY</a> | (cache[seed_2].allistrue ? <a href="#L72" title="utils/adt/tsgistidx.c:72">ALLISTRUE</a> : <span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; siglen, cache[seed_2].sign);<br/></li>
<li>&nbsp; &nbsp; union_l = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_l);<br/></li>
<li>&nbsp; &nbsp; union_r = <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_r);<br/></li>
<li>&nbsp; &nbsp; maxoff = OffsetNumberNext(maxoff);<br/></li>
<li>&nbsp; &nbsp; <a href="#L576" title="utils/adt/tsgistidx.c:576">fillcache</a>(&amp;cache[maxoff], <a href="tsquery_gist.c.html#L23" title="utils/adt/tsquery_gist.c:23">GETENTRY</a>(entryvec, maxoff), siglen);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* sort <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> ... */<br/></li>
<li></span>&nbsp; &nbsp; costvector = (<a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a>) * maxoff);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (j = FirstOffsetNumber; j &lt;= maxoff; j = OffsetNumberNext(j))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; costvector[j - <span class="Constant">1</span>].pos = j;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size_alpha = <a href="#L605" title="utils/adt/tsgistidx.c:605">hemdistcache</a>(&amp;(cache[seed_1]), &amp;(cache[j]), siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size_beta = <a href="#L605" title="utils/adt/tsgistidx.c:605">hemdistcache</a>(&amp;(cache[seed_2]), &amp;(cache[j]), siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; costvector[j - <span class="Constant">1</span>].cost = abs(size_alpha - size_beta);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; qsort(costvector, maxoff, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="tsquery_gist.c.html#L155" title="utils/adt/tsquery_gist.c:155">SPLITCOST</a>), <a href="tsquery_gist.c.html#L158" title="utils/adt/tsquery_gist.c:158">comparecost</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (k = <span class="Constant">0</span>; k &lt; maxoff; k++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; j = costvector[k].pos;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (j == seed_1)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *left++ = j;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;spl_nleft++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (j == seed_2)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *right++ = j;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;spl_nright++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_l) || cache[j].allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_l) &amp;&amp; cache[j].allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_alpha = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_alpha = <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglen) -<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>((cache[j].allistrue) ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_l) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cache[j].sign,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_alpha = <a href="#L496" title="utils/adt/tsgistidx.c:496">hemdistsign</a>(cache[j].sign, <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_l), siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_r) || cache[j].allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_r) &amp;&amp; cache[j].allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_beta = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_beta = <a href="#L41" title="utils/adt/tsgistidx.c:41">SIGLENBIT</a>(siglen) -<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="tsquery_gist.c.html#L119" title="utils/adt/tsquery_gist.c:119">sizebitvec</a>((cache[j].allistrue) ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_r) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cache[j].sign,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size_beta = <a href="#L496" title="utils/adt/tsgistidx.c:496">hemdistsign</a>(cache[j].sign, <a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_r), siglen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size_alpha &lt; size_beta + <a href="tsquery_gist.c.html#L164" title="utils/adt/tsquery_gist.c:164">WISH_F</a>(v-&gt;spl_nleft, v-&gt;spl_nright, <span class="Constant">0.1</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_l) || cache[j].allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_l))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memset(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_l), <span class="Constant">0xff</span>, siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr = cache[j].sign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L45" title="utils/adt/tsgistidx.c:45">LOOPBYTE</a>(siglen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; union_l[i] |= ptr[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *left++ = j;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;spl_nleft++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_r) || cache[j].allistrue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L76" title="utils/adt/tsgistidx.c:76">ISALLTRUE</a>(datum_r))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memset(<a href="#L81" title="utils/adt/tsgistidx.c:81">GETSIGN</a>(datum_r), <span class="Constant">0xff</span>, siglen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr = cache[j].sign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L45" title="utils/adt/tsgistidx.c:45">LOOPBYTE</a>(siglen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; union_r[i] |= ptr[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *right++ = j;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;spl_nright++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *right = *left = FirstOffsetNumber;<br/></li>
<li>&nbsp; &nbsp; v-&gt;spl_ldatum = PointerGetDatum(datum_l);<br/></li>
<li>&nbsp; &nbsp; v-&gt;spl_rdatum = PointerGetDatum(datum_r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(v);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Formerly, <a href="#L334" title="utils/adt/tsgistidx.c:334">gtsvector_consistent</a> was declared in pg_proc.h with arguments<br/></li>
<li></span><span class="Comment"> * that did not match the documented conventions for GiST support <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>.<br/></li>
<li></span><span class="Comment"> * We fixed that, but we still need a pg_proc entry with the old signature<br/></li>
<li></span><span class="Comment"> * to support reloading pre-9.6 contrib/tsearch2 opclass declarations.<br/></li>
<li></span><span class="Comment"> * This compatibility function should go away eventually.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L803">&#x200c;</a><span class="linkable">gtsvector_consistent_oldsig</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L334" title="utils/adt/tsgistidx.c:334">gtsvector_consistent</a>(fcinfo);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L809">&#x200c;</a><span class="linkable">gtsvector_options</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; local_relopts *relopts = (local_relopts *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../access/common/reloptions.c.html#L734" title="access/common/reloptions.c:734">init_local_reloptions</a>(relopts, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L33" title="utils/adt/tsgistidx.c:33">GistTsVectorOptions</a>));<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/common/reloptions.c.html#L918" title="access/common/reloptions.c:918">add_local_int_reloption</a>(relopts, <span class="Constant">&quot;siglen&quot;</span>, <span class="Constant">&quot;signature length&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L35" title="utils/adt/tsgistidx.c:35">SIGLEN_DEFAULT</a>, <span class="Constant">1</span>, <a href="#L36" title="utils/adt/tsgistidx.c:36">SIGLEN_MAX</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; offsetof(<a href="#L33" title="utils/adt/tsgistidx.c:33">GistTsVectorOptions</a>, siglen));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
