<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/pg_upgrade_support.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/pg_upgrade_support.c - pgsql17devel-backend</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L325">binary_upgrade_add_sub_rel_state</a></li>
<li><a href="#L185">binary_upgrade_create_empty_extension</a></li>
<li><a href="#L285">binary_upgrade_logical_slot_has_caught_up</a></li>
<li><a href="#L369">binary_upgrade_replorigin_advance</a></li>
<li><a href="#L261">binary_upgrade_set_missing_value</a></li>
<li><a href="#L65">binary_upgrade_set_next_array_pg_type_oid</a></li>
<li><a href="#L98">binary_upgrade_set_next_heap_pg_class_oid</a></li>
<li><a href="#L109">binary_upgrade_set_next_heap_relfilenode</a></li>
<li><a href="#L120">binary_upgrade_set_next_index_pg_class_oid</a></li>
<li><a href="#L131">binary_upgrade_set_next_index_relfilenode</a></li>
<li><a href="#L87">binary_upgrade_set_next_multirange_array_pg_type_oid</a></li>
<li><a href="#L76">binary_upgrade_set_next_multirange_pg_type_oid</a></li>
<li><a href="#L175">binary_upgrade_set_next_pg_authid_oid</a></li>
<li><a href="#L164">binary_upgrade_set_next_pg_enum_oid</a></li>
<li><a href="#L43">binary_upgrade_set_next_pg_tablespace_oid</a></li>
<li><a href="#L54">binary_upgrade_set_next_pg_type_oid</a></li>
<li><a href="#L142">binary_upgrade_set_next_toast_pg_class_oid</a></li>
<li><a href="#L153">binary_upgrade_set_next_toast_relfilenode</a></li>
<li><a href="#L250">binary_upgrade_set_record_init_privs</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L34">CHECK_IS_BINARY_UPGRADE</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; pg_upgrade_support.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; server-side <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> to set backend global variables<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; to control oid and relfilenumber assignment, and do other special<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; hacks needed for pg_upgrade.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Copyright (c) 2010-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; src/backend/utils/adt/pg_upgrade_support.c<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;access/relation.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/table.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/binary_upgrade.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/heap.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/namespace.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_subscription_rel.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_type.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;commands/extension.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;miscadmin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/logical.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/origin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/worker_internal.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/lmgr.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/array.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/lsyscache.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/pg_lsn.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/syscache.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L34">&#x200c;</a><span class="PreProc">#define <span class="linkable">CHECK_IS_BINARY_UPGRADE</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (!<a href="../init/globals.c.html#L118" title="utils/init/globals.c:118">IsBinaryUpgrade</a>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CANT_CHANGE_RUNTIME_PARAM),&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(</span><span class="Constant">&quot;function can only be called when server is in binary upgrade mode&quot;</span><span class="PreProc">))); \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc"> (</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li>Datum<br/></li>
<li><a id="L43">&#x200c;</a><span class="linkable">binary_upgrade_set_next_pg_tablespace_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tbspoid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../commands/tablespace.c.html#L87" title="commands/tablespace.c:87">binary_upgrade_next_pg_tablespace_oid</a> = tbspoid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L54">&#x200c;</a><span class="linkable">binary_upgrade_set_next_pg_type_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typoid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/pg_type.c.html#L41" title="catalog/pg_type.c:41">binary_upgrade_next_pg_type_oid</a> = typoid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L65">&#x200c;</a><span class="linkable">binary_upgrade_set_next_array_pg_type_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typoid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../commands/typecmds.c.html#L109" title="commands/typecmds.c:109">binary_upgrade_next_array_pg_type_oid</a> = typoid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L76">&#x200c;</a><span class="linkable">binary_upgrade_set_next_multirange_pg_type_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typoid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../commands/typecmds.c.html#L110" title="commands/typecmds.c:110">binary_upgrade_next_mrng_pg_type_oid</a> = typoid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L87">&#x200c;</a><span class="linkable">binary_upgrade_set_next_multirange_array_pg_type_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typoid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../commands/typecmds.c.html#L111" title="commands/typecmds.c:111">binary_upgrade_next_mrng_array_pg_type_oid</a> = typoid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L98">&#x200c;</a><span class="linkable">binary_upgrade_set_next_heap_pg_class_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reloid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/heap.c.html#L80" title="catalog/heap.c:80">binary_upgrade_next_heap_pg_class_oid</a> = reloid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L109">&#x200c;</a><span class="linkable">binary_upgrade_set_next_heap_relfilenode</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RelFileNumber relfilenumber = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/heap.c.html#L82" title="catalog/heap.c:82">binary_upgrade_next_heap_pg_class_relfilenumber</a> = relfilenumber;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L120">&#x200c;</a><span class="linkable">binary_upgrade_set_next_index_pg_class_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reloid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/index.c.html#L84" title="catalog/index.c:84">binary_upgrade_next_index_pg_class_oid</a> = reloid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L131">&#x200c;</a><span class="linkable">binary_upgrade_set_next_index_relfilenode</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RelFileNumber relfilenumber = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/index.c.html#L85" title="catalog/index.c:85">binary_upgrade_next_index_pg_class_relfilenumber</a> = relfilenumber;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L142">&#x200c;</a><span class="linkable">binary_upgrade_set_next_toast_pg_class_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reloid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/heap.c.html#L81" title="catalog/heap.c:81">binary_upgrade_next_toast_pg_class_oid</a> = reloid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L153">&#x200c;</a><span class="linkable">binary_upgrade_set_next_toast_relfilenode</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; RelFileNumber relfilenumber = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/heap.c.html#L83" title="catalog/heap.c:83">binary_upgrade_next_toast_pg_class_relfilenumber</a> = relfilenumber;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L164">&#x200c;</a><span class="linkable">binary_upgrade_set_next_pg_enum_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; enumoid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/pg_enum.c.html#L36" title="catalog/pg_enum.c:36">binary_upgrade_next_pg_enum_oid</a> = enumoid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L175">&#x200c;</a><span class="linkable">binary_upgrade_set_next_pg_authid_oid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; authoid = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../commands/user.c.html#L70" title="commands/user.c:70">binary_upgrade_next_pg_authid_oid</a> = authoid;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L185">&#x200c;</a><span class="linkable">binary_upgrade_create_empty_extension</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *extName;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *schemaName;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; relocatable;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *extVersion;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; extConfig;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; extCondition;<br/></li>
<li>&nbsp; &nbsp; List&nbsp; &nbsp; &nbsp;&nbsp; *requiredExtensions;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* We must check these things <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> dereferencing the arguments */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (PG_ARGISNULL(<span class="Constant">0</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_ARGISNULL(<span class="Constant">1</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_ARGISNULL(<span class="Constant">2</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_ARGISNULL(<span class="Constant">3</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;null argument to <a href="#L185" title="utils/adt/pg_upgrade_support.c:185">binary_upgrade_create_empty_extension</a> is not allowed&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; extName = PG_GETARG_TEXT_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; schemaName = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; relocatable = PG_GETARG_BOOL(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; extVersion = PG_GETARG_TEXT_PP(<span class="Constant">3</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (PG_ARGISNULL(<span class="Constant">4</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; extConfig = PointerGetDatum(<span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; extConfig = PG_GETARG_DATUM(<span class="Constant">4</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (PG_ARGISNULL(<span class="Constant">5</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; extCondition = PointerGetDatum(<span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; extCondition = PG_GETARG_DATUM(<span class="Constant">5</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; requiredExtensions = NIL;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!PG_ARGISNULL(<span class="Constant">6</span>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ArrayType&nbsp; *textArray = PG_GETARG_ARRAYTYPE_P(<span class="Constant">6</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp;&nbsp; *textDatums;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ndatums;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="arrayfuncs.c.html#L3678" title="utils/adt/arrayfuncs.c:3678">deconstruct_array_builtin</a>(textArray, TEXTOID, &amp;textDatums, <span class="Constant">NULL</span>, &amp;ndatums);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; ndatums; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *extName = TextDatumGetCString(textDatums[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extOid = <a href="../../commands/extension.c.html#L145" title="commands/extension.c:145">get_extension_oid</a>(extName, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; requiredExtensions = <a href="../../nodes/list.c.html#L375" title="nodes/list.c:375">lappend_oid</a>(requiredExtensions, extOid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../commands/extension.c.html#L1866" title="commands/extension.c:1866">InsertExtensionTuple</a>(<a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(extName),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../init/miscinit.c.html#L514" title="utils/init/miscinit.c:514">GetUserId</a>(),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../../catalog/namespace.c.html#L3520" title="catalog/namespace.c:3520">get_namespace_oid</a>(<a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(schemaName), <span class="Constant">false</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; relocatable,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(extVersion),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; extConfig,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; extCondition,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; requiredExtensions);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L250">&#x200c;</a><span class="linkable">binary_upgrade_set_record_init_privs</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; record_init_privs = PG_GETARG_BOOL(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/aclchk.c.html#L109" title="catalog/aclchk.c:109">binary_upgrade_record_init_privs</a> = record_init_privs;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L261">&#x200c;</a><span class="linkable">binary_upgrade_set_missing_value</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; table_id = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *attname = PG_GETARG_TEXT_P(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *value = PG_GETARG_TEXT_P(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *cattname = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(attname);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *cvalue = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(value);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../../catalog/heap.c.html#L2005" title="catalog/heap.c:2005">SetAttrMissing</a>(table_id, cattname, cvalue);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Verify the given slot has already consumed all the WAL changes.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true if there are no decodable WAL <a href="../../access/transam/twophase.c.html#L1025" title="access/transam/twophase.c:1025">records</a> after the<br/></li>
<li></span><span class="Comment"> * confirmed_flush_lsn. Otherwise false.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This is a special purpose function to ensure that the given slot can be<br/></li>
<li></span><span class="Comment"> * upgraded without data loss.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L285">&#x200c;</a><span class="linkable">binary_upgrade_logical_slot_has_caught_up</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Name&nbsp; &nbsp; &nbsp; &nbsp; slot_name;<br/></li>
<li>&nbsp; &nbsp; XLogRecPtr&nbsp; &nbsp; end_of_wal;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; found_pending_wal;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Binary upgrades only allowed super-user connections so we must have<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * permission to use replication slots.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; Assert(<a href="../init/miscinit.c.html#L711" title="utils/init/miscinit.c:711">has_rolreplication</a>(<a href="../init/miscinit.c.html#L514" title="utils/init/miscinit.c:514">GetUserId</a>()));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; slot_name = PG_GETARG_NAME(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Acquire the given slot */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../replication/slot.c.html#L540" title="replication/slot.c:540">ReplicationSlotAcquire</a>(NameStr(*slot_name), <span class="Constant">true</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(SlotIsLogical(<a href="../../replication/slot.c.html#L138" title="replication/slot.c:138">MyReplicationSlot</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Slots must be valid as otherwise we won't be able to scan the WAL */<br/></li>
<li></span>&nbsp; &nbsp; Assert(<a href="../../replication/slot.c.html#L138" title="replication/slot.c:138">MyReplicationSlot</a>-&gt;data.invalidated == RS_INVAL_NONE);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; end_of_wal = <a href="../../access/transam/xlog.c.html#L6455" title="access/transam/xlog.c:6455">GetFlushRecPtr</a>(<span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; found_pending_wal = <a href="../../replication/logical/logical.c.html#L1978" title="replication/logical/logical.c:1978">LogicalReplicationSlotHasPendingWal</a>(end_of_wal);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Clean up */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../replication/slot.c.html#L652" title="replication/slot.c:652">ReplicationSlotRelease</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(!found_pending_wal);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L325" title="utils/adt/pg_upgrade_support.c:325">binary_upgrade_add_sub_rel_state</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Add the relation with the specified relation state to pg_subscription_rel<br/></li>
<li></span><span class="Comment"> * catalog.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L325">&#x200c;</a><span class="linkable">binary_upgrade_add_sub_rel_state</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Relation&nbsp; &nbsp; subrel;<br/></li>
<li>&nbsp; &nbsp; Relation&nbsp; &nbsp; rel;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; subid;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *subname;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; relid;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; relstate;<br/></li>
<li>&nbsp; &nbsp; XLogRecPtr&nbsp; &nbsp; sublsn;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* We must check these things <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> dereferencing the arguments */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (PG_ARGISNULL(<span class="Constant">0</span>) || PG_ARGISNULL(<span class="Constant">1</span>) || PG_ARGISNULL(<span class="Constant">2</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;null argument to <a href="#L325" title="utils/adt/pg_upgrade_support.c:325">binary_upgrade_add_sub_rel_state</a> is not allowed&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; subname = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(PG_GETARG_TEXT_PP(<span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; relid = PG_GETARG_OID(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; relstate = PG_GETARG_CHAR(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; sublsn = PG_ARGISNULL(<span class="Constant">3</span>) ? InvalidXLogRecPtr : PG_GETARG_LSN(<span class="Constant">3</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; subrel = <a href="../../access/table/table.c.html#L40" title="access/table/table.c:40">table_open</a>(SubscriptionRelationId, RowExclusiveLock);<br/></li>
<li>&nbsp; &nbsp; subid = <a href="../cache/lsyscache.c.html#L3675" title="utils/cache/lsyscache.c:3675">get_subscription_oid</a>(subname, <span class="Constant">false</span>);<br/></li>
<li>&nbsp; &nbsp; rel = <a href="../../access/common/relation.c.html#L47" title="access/common/relation.c:47">relation_open</a>(relid, AccessShareLock);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Since there are no concurrent ALTER/DROP SUBSCRIPTION commands during<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the upgrade process, and the apply worker (which builds cache based on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the subscription catalog) is not running, the locks can be released<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * immediately.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../catalog/pg_subscription.c.html#L236" title="catalog/pg_subscription.c:236">AddSubscriptionRelState</a>(subid, relid, relstate, sublsn, <span class="Constant">false</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/common/relation.c.html#L205" title="access/common/relation.c:205">relation_close</a>(rel, AccessShareLock);<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/table/table.c.html#L126" title="access/table/table.c:126">table_close</a>(subrel, RowExclusiveLock);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L369" title="utils/adt/pg_upgrade_support.c:369">binary_upgrade_replorigin_advance</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Update the remote_lsn for the subscriber's replication origin.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L369">&#x200c;</a><span class="linkable">binary_upgrade_replorigin_advance</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Relation&nbsp; &nbsp; rel;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; subid;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *subname;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; originname[NAMEDATALEN];<br/></li>
<li>&nbsp; &nbsp; RepOriginId node;<br/></li>
<li>&nbsp; &nbsp; XLogRecPtr&nbsp; &nbsp; remote_commit;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="utils/adt/pg_upgrade_support.c:34">CHECK_IS_BINARY_UPGRADE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We must ensure a non-NULL subscription name <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> dereferencing the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * arguments.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (PG_ARGISNULL(<span class="Constant">0</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;null argument to <a href="#L369" title="utils/adt/pg_upgrade_support.c:369">binary_upgrade_replorigin_advance</a> is not allowed&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; subname = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(PG_GETARG_TEXT_PP(<span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; remote_commit = PG_ARGISNULL(<span class="Constant">1</span>) ? InvalidXLogRecPtr : PG_GETARG_LSN(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rel = <a href="../../access/table/table.c.html#L40" title="access/table/table.c:40">table_open</a>(SubscriptionRelationId, RowExclusiveLock);<br/></li>
<li>&nbsp; &nbsp; subid = <a href="../cache/lsyscache.c.html#L3675" title="utils/cache/lsyscache.c:3675">get_subscription_oid</a>(subname, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../replication/logical/worker.c.html#L428" title="replication/logical/worker.c:428">ReplicationOriginNameForLogicalRep</a>(subid, InvalidOid, originname, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(originname));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Lock to prevent the replication origin from vanishing */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../storage/lmgr/lmgr.c.html#L108" title="storage/lmgr/lmgr.c:108">LockRelationOid</a>(ReplicationOriginRelationId, RowExclusiveLock);<br/></li>
<li>&nbsp; &nbsp; node = <a href="../../replication/logical/origin.c.html#L221" title="replication/logical/origin.c:221">replorigin_by_name</a>(originname, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * The server will be stopped after setting up the objects in the new<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="../../commands/cluster.c.html#L108" title="commands/cluster.c:108">cluster</a> and the origins will be flushed during the shutdown checkpoint.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This will ensure that the latest LSN <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> for origin will be<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * available after the upgrade.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../replication/logical/origin.c.html#L888" title="replication/logical/origin.c:888">replorigin_advance</a>(node, remote_commit, InvalidXLogRecPtr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">false</span> <span class="Comment">/* backward */</span> ,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">false</span> <span class="Comment">/* WAL log */</span> );<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../storage/lmgr/lmgr.c.html#L227" title="storage/lmgr/lmgr.c:227">UnlockRelationOid</a>(ReplicationOriginRelationId, RowExclusiveLock);<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/table/table.c.html#L126" title="access/table/table.c:126">table_close</a>(rel, RowExclusiveLock);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
