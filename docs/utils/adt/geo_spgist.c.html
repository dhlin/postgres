<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/geo_spgist.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/geo_spgist.c - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L107">Range</a></li>
<li><a href="#L113">RangeBox</a></li>
<li><a href="#L119">RectBox</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L360">above4D</a></li>
<li><a href="#L346">below4D</a></li>
<li><a href="#L93">compareDoubles</a></li>
<li><a href="#L252">contain2D</a></li>
<li><a href="#L260">contain4D</a></li>
<li><a href="#L268">contained2D</a></li>
<li><a href="#L278">contained4D</a></li>
<li><a href="#L130">getQuadrant</a></li>
<li><a href="#L157">getRangeBox</a></li>
<li><a href="#L302">higher2D</a></li>
<li><a href="#L177">initRectBox</a></li>
<li><a href="#L508">is_bounding_box_test_exact</a></li>
<li><a href="#L318">left4D</a></li>
<li><a href="#L286">lower2D</a></li>
<li><a href="#L205">nextRectBox</a></li>
<li><a href="#L367">overAbove4D</a></li>
<li><a href="#L353">overBelow4D</a></li>
<li><a href="#L310">overHigher2D</a></li>
<li><a href="#L325">overLeft4D</a></li>
<li><a href="#L294">overLower2D</a></li>
<li><a href="#L339">overRight4D</a></li>
<li><a href="#L236">overlap2D</a></li>
<li><a href="#L244">overlap4D</a></li>
<li><a href="#L374">pointToRectBoxDistance</a></li>
<li><a href="#L332">right4D</a></li>
<li><a href="#L859">spg_bbox_quad_config</a></li>
<li><a href="#L417">spg_box_quad_choose</a></li>
<li><a href="#L401">spg_box_quad_config</a></li>
<li><a href="#L531">spg_box_quad_get_scankey_bbox</a></li>
<li><a href="#L553">spg_box_quad_inner_consistent</a></li>
<li><a href="#L741">spg_box_quad_leaf_consistent</a></li>
<li><a href="#L441">spg_box_quad_picksplit</a></li>
<li><a href="#L876">spg_poly_quad_compress</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * geo_spgist.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; SP-GiST implementation of 4-dimensional quad tree over boxes<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This module provides SP-GiST implementation for boxes using quad tree<br/></li>
<li></span><span class="Comment"> * analogy in 4-dimensional space.&nbsp; SP-GiST doesn't allow indexing of<br/></li>
<li></span><span class="Comment"> * overlapping objects.&nbsp; We are making 2D objects never-overlapping in<br/></li>
<li></span><span class="Comment"> * 4D space.&nbsp; This technique has some benefits compared to traditional<br/></li>
<li></span><span class="Comment"> * R-Tree which is implemented as GiST.&nbsp; The performance tests reveal<br/></li>
<li></span><span class="Comment"> * that this technique especially beneficial with too much overlapping<br/></li>
<li></span><span class="Comment"> * objects, so called &quot;spaghetti data&quot;.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Unlike the original quad tree, we are splitting the tree into 16<br/></li>
<li></span><span class="Comment"> * quadrants in 4D space.&nbsp; It is easier to imagine it as splitting space<br/></li>
<li></span><span class="Comment"> * two times into 4:<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; |<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; |<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | -----+-----<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; |<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; |<br/></li>
<li></span><span class="Comment"> * -------------+-------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We are using box datatype as the prefix, but we are treating them<br/></li>
<li></span><span class="Comment"> * as points in 4-dimensional space, because 2D boxes are not enough<br/></li>
<li></span><span class="Comment"> * to represent the quadrant boundaries in 4D space.&nbsp; They however are<br/></li>
<li></span><span class="Comment"> * sufficient to point out the additional boundaries of the <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a><br/></li>
<li></span><span class="Comment"> * quadrant.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We are using traversal <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> provided by SP-GiST to calculate and<br/></li>
<li></span><span class="Comment"> * to store the bounds of the quadrants, while traversing into the tree.<br/></li>
<li></span><span class="Comment"> * Traversal value has all the boundaries in the 4D space, and is capable<br/></li>
<li></span><span class="Comment"> * of transferring the required boundaries to the following traversal<br/></li>
<li></span><span class="Comment"> * <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.&nbsp; In conclusion, three things are necessary to calculate the<br/></li>
<li></span><span class="Comment"> * <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> traversal value:<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; (1) the traversal value of the parent<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; (2) the quadrant of the current node<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; (3) the prefix of the current node<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If we visualize them on our simplified drawing (see the drawing above);<br/></li>
<li></span><span class="Comment"> * transferred boundaries of (1) would be the outer axis, relevant part<br/></li>
<li></span><span class="Comment"> * of (2) would be the up right part of the other axis, and (3) would be<br/></li>
<li></span><span class="Comment"> * the inner axis.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * For example, consider the case of overlapping.&nbsp; When recursion<br/></li>
<li></span><span class="Comment"> * descends deeper and deeper down the tree, all quadrants in<br/></li>
<li></span><span class="Comment"> * the current node will be checked for overlapping.&nbsp; The boundaries<br/></li>
<li></span><span class="Comment"> * will be re-calculated for all quadrants.&nbsp; Overlap check answers<br/></li>
<li></span><span class="Comment"> * the question: can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> box from this quadrant overlap with the given<br/></li>
<li></span><span class="Comment"> * box?&nbsp; If yes, then this quadrant will be walked.&nbsp; If no, then this<br/></li>
<li></span><span class="Comment"> * quadrant will be skipped.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This method provides restrictions for minimum and maximum <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> of<br/></li>
<li></span><span class="Comment"> * every dimension of every corner of the box on every level of the tree<br/></li>
<li></span><span class="Comment"> * except the root.&nbsp; For the root node, we are setting the boundaries<br/></li>
<li></span><span class="Comment"> * that we don't yet have as infinity.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src/backend/utils/adt/geo_spgist.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;access/spgist.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/spgist_private.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/stratnum.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_type.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/float.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/fmgroids.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/fmgrprotos.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/geo_decls.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Comparator for qsort<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We don't need to use the floating point macros in here, because this<br/></li>
<li></span><span class="Comment"> * is only going to be used in a place to effect the performance<br/></li>
<li></span><span class="Comment"> * of the index, not the correctness.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L93">&#x200c;</a></span><span class="linkable">compareDoubles</span>(<span class="Type">const</span> <span class="Type">void</span> *a, <span class="Type">const</span> <span class="Type">void</span> *b)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; x = *(float8 *) a;<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; y = *(float8 *) b;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (x == y)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (x &gt; y) ? <span class="Constant">1</span> : -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; low;<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; high;<br/></li>
<li><a id="L107">&#x200c;</a>} <span class="linkable">Range</span>;<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a>&nbsp; &nbsp; &nbsp; &nbsp; left;<br/></li>
<li>&nbsp; &nbsp; <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a>&nbsp; &nbsp; &nbsp; &nbsp; right;<br/></li>
<li><a id="L113">&#x200c;</a>} <span class="linkable">RangeBox</span>;<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a>&nbsp; &nbsp; range_box_x;<br/></li>
<li>&nbsp; &nbsp; <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a>&nbsp; &nbsp; range_box_y;<br/></li>
<li><a id="L119">&#x200c;</a>} <span class="linkable">RectBox</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Calculate the quadrant<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The quadrant is 8 <a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> unsigned integer with 4 least bits in use.<br/></li>
<li></span><span class="Comment"> * This function accepts BOXes as input.&nbsp; They are not casted to<br/></li>
<li></span><span class="Comment"> * RangeBoxes, yet.&nbsp; All 4 bits are set by comparing a corner of the box.<br/></li>
<li></span><span class="Comment"> * This makes 16 quadrants in total.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> uint8<br/></li>
<li><a id="L130">&#x200c;</a><span class="linkable">getQuadrant</span>(BOX *centroid, BOX *inBox)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint8&nbsp; &nbsp; &nbsp; &nbsp; quadrant = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (inBox-&gt;low.x &gt; centroid-&gt;low.x)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; quadrant |= <span class="Constant">0x8</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (inBox-&gt;high.x &gt; centroid-&gt;high.x)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; quadrant |= <span class="Constant">0x4</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (inBox-&gt;low.y &gt; centroid-&gt;low.y)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; quadrant |= <span class="Constant">0x2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (inBox-&gt;high.y &gt; centroid-&gt;high.y)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; quadrant |= <span class="Constant">0x1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> quadrant;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Get <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> using BOX<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We are turning the BOX to our structures to emphasize their function<br/></li>
<li></span><span class="Comment"> * of representing points in 4D space.&nbsp; It also is more convenient to<br/></li>
<li></span><span class="Comment"> * access the <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> with this structure.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *<br/></li>
<li><a id="L157">&#x200c;</a><span class="linkable">getRangeBox</span>(BOX *box)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a>&nbsp;&nbsp; *range_box = (<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; range_box-&gt;left.low = box-&gt;low.x;<br/></li>
<li>&nbsp; &nbsp; range_box-&gt;left.high = box-&gt;high.x;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; range_box-&gt;right.low = box-&gt;low.y;<br/></li>
<li>&nbsp; &nbsp; range_box-&gt;right.high = box-&gt;high.y;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> range_box;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Initialize the traversal value<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * In the beginning, we don't have <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> restrictions.&nbsp; We have to<br/></li>
<li></span><span class="Comment"> * <a href="../../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> the struct to cover the whole 4D space.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *<br/></li>
<li><a id="L177">&#x200c;</a><span class="linkable">initRectBox</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>&nbsp; &nbsp; *rect_box = (<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>));<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; infinity = get_float8_infinity();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_x.left.low = -infinity;<br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_x.left.high = infinity;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_x.right.low = -infinity;<br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_x.right.high = infinity;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_y.left.low = -infinity;<br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_y.left.high = infinity;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_y.right.low = -infinity;<br/></li>
<li>&nbsp; &nbsp; rect_box-&gt;range_box_y.right.high = infinity;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> rect_box;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Calculate the <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> traversal value<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * All centroids are bounded by <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>, but SP-GiST only keeps<br/></li>
<li></span><span class="Comment"> * boxes.&nbsp; When we are traversing the tree, we must calculate <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>,<br/></li>
<li></span><span class="Comment"> * using centroid and quadrant.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *<br/></li>
<li><a id="L205">&#x200c;</a><span class="linkable">nextRectBox</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *centroid, uint8 quadrant)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>&nbsp; &nbsp; *next_rect_box = (<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memcpy(next_rect_box, rect_box, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (quadrant &amp; <span class="Constant">0x8</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_x.left.low = centroid-&gt;left.low;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_x.left.high = centroid-&gt;left.low;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (quadrant &amp; <span class="Constant">0x4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_x.right.low = centroid-&gt;left.high;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_x.right.high = centroid-&gt;left.high;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (quadrant &amp; <span class="Constant">0x2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_y.left.low = centroid-&gt;right.low;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_y.left.high = centroid-&gt;right.low;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (quadrant &amp; <span class="Constant">0x1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_y.right.low = centroid-&gt;right.high;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; next_rect_box-&gt;range_box_y.right.high = centroid-&gt;right.high;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> next_rect_box;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from range_box overlap with this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L236">&#x200c;</a></span><span class="linkable">overlap2D</span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *range_box, <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> FPge(range_box-&gt;right.high, query-&gt;low) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPle(range_box-&gt;left.low, query-&gt;high);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box overlap with this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L244">&#x200c;</a></span><span class="linkable">overlap4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L236" title="utils/adt/geo_spgist.c:236">overlap2D</a>(&amp;rect_box-&gt;range_box_x, &amp;query-&gt;left) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L236" title="utils/adt/geo_spgist.c:236">overlap2D</a>(&amp;rect_box-&gt;range_box_y, &amp;query-&gt;right);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from range_box contain this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L252">&#x200c;</a></span><span class="linkable">contain2D</span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *range_box, <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> FPge(range_box-&gt;right.high, query-&gt;high) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPle(range_box-&gt;left.low, query-&gt;low);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box contain this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L260">&#x200c;</a></span><span class="linkable">contain4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L252" title="utils/adt/geo_spgist.c:252">contain2D</a>(&amp;rect_box-&gt;range_box_x, &amp;query-&gt;left) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L252" title="utils/adt/geo_spgist.c:252">contain2D</a>(&amp;rect_box-&gt;range_box_y, &amp;query-&gt;right);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from range_box be contained by this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L268">&#x200c;</a></span><span class="linkable">contained2D</span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *range_box, <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> FPle(range_box-&gt;left.low, query-&gt;high) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPge(range_box-&gt;left.high, query-&gt;low) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPle(range_box-&gt;right.low, query-&gt;high) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPge(range_box-&gt;right.high, query-&gt;low);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box be contained by this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L278">&#x200c;</a></span><span class="linkable">contained4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L268" title="utils/adt/geo_spgist.c:268">contained2D</a>(&amp;rect_box-&gt;range_box_x, &amp;query-&gt;left) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L268" title="utils/adt/geo_spgist.c:268">contained2D</a>(&amp;rect_box-&gt;range_box_y, &amp;query-&gt;right);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from range_box to be <a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a> than this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L286">&#x200c;</a></span><span class="linkable">lower2D</span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *range_box, <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> FPlt(range_box-&gt;left.low, query-&gt;low) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPlt(range_box-&gt;right.low, query-&gt;low);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from range_box not extend to the right side of the query? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L294">&#x200c;</a></span><span class="linkable">overLower2D</span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *range_box, <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> FPle(range_box-&gt;left.low, query-&gt;high) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPle(range_box-&gt;right.low, query-&gt;high);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from range_box to be higher than this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L302">&#x200c;</a></span><span class="linkable">higher2D</span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *range_box, <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> FPgt(range_box-&gt;left.high, query-&gt;high) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPgt(range_box-&gt;right.high, query-&gt;high);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> from range_box not extend to the left side of the query? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L310">&#x200c;</a></span><span class="linkable">overHigher2D</span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *range_box, <a href="#L107" title="utils/adt/geo_spgist.c:107">Range</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> FPge(range_box-&gt;left.high, query-&gt;low) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FPge(range_box-&gt;right.high, query-&gt;low);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box be left of this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L318">&#x200c;</a></span><span class="linkable">left4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L286" title="utils/adt/geo_spgist.c:286">lower2D</a>(&amp;rect_box-&gt;range_box_x, &amp;query-&gt;left);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box does not extend the right of this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L325">&#x200c;</a></span><span class="linkable">overLeft4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L294" title="utils/adt/geo_spgist.c:294">overLower2D</a>(&amp;rect_box-&gt;range_box_x, &amp;query-&gt;left);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box be right of this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L332">&#x200c;</a></span><span class="linkable">right4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L302" title="utils/adt/geo_spgist.c:302">higher2D</a>(&amp;rect_box-&gt;range_box_x, &amp;query-&gt;left);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box does not extend the left of this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L339">&#x200c;</a></span><span class="linkable">overRight4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L310" title="utils/adt/geo_spgist.c:310">overHigher2D</a>(&amp;rect_box-&gt;range_box_x, &amp;query-&gt;left);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box be below of this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L346">&#x200c;</a></span><span class="linkable">below4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L286" title="utils/adt/geo_spgist.c:286">lower2D</a>(&amp;rect_box-&gt;range_box_y, &amp;query-&gt;right);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box does not extend above this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L353">&#x200c;</a></span><span class="linkable">overBelow4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L294" title="utils/adt/geo_spgist.c:294">overLower2D</a>(&amp;rect_box-&gt;range_box_y, &amp;query-&gt;right);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box be above of this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L360">&#x200c;</a></span><span class="linkable">above4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L302" title="utils/adt/geo_spgist.c:302">higher2D</a>(&amp;rect_box-&gt;range_box_y, &amp;query-&gt;right);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Can <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> rectangle from rect_box does not extend below of this argument? */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L367">&#x200c;</a></span><span class="linkable">overAbove4D</span>(<a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box, <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *query)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L310" title="utils/adt/geo_spgist.c:310">overHigher2D</a>(&amp;rect_box-&gt;range_box_y, &amp;query-&gt;right);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Lower bound for the distance between point and rect_box */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">double<br/></li>
<li><a id="L374">&#x200c;</a></span><span class="linkable">pointToRectBoxDistance</span>(Point *point, <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a> *rect_box)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; dx;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; dy;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (point-&gt;x &lt; rect_box-&gt;range_box_x.left.low)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dx = rect_box-&gt;range_box_x.left.low - point-&gt;x;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (point-&gt;x &gt; rect_box-&gt;range_box_x.right.high)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dx = point-&gt;x - rect_box-&gt;range_box_x.right.high;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; dx = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (point-&gt;y &lt; rect_box-&gt;range_box_y.left.low)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dy = rect_box-&gt;range_box_y.left.low - point-&gt;y;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (point-&gt;y &gt; rect_box-&gt;range_box_y.right.high)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dy = point-&gt;y - rect_box-&gt;range_box_y.right.high;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; dy = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> HYPOT(dx, dy);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SP-GiST config function<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L401">&#x200c;</a><span class="linkable">spg_box_quad_config</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; spgConfigOut *cfg = (spgConfigOut *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cfg-&gt;prefixType = BOXOID;<br/></li>
<li>&nbsp; &nbsp; cfg-&gt;labelType = VOIDOID;&nbsp; &nbsp; <span class="Comment">/* We don't need node labels. */<br/></li>
<li></span>&nbsp; &nbsp; cfg-&gt;canReturnData = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; cfg-&gt;longValuesOK = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SP-GiST choose function<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L417">&#x200c;</a><span class="linkable">spg_box_quad_choose</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; spgChooseIn *in = (spgChooseIn *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; spgChooseOut *out = (spgChooseOut *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; BOX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *centroid = DatumGetBoxP(in-&gt;prefixDatum),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *box = DatumGetBoxP(in-&gt;leafDatum);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; out-&gt;resultType = spgMatchNode;<br/></li>
<li>&nbsp; &nbsp; out-&gt;result.matchNode.restDatum = BoxPGetDatum(box);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* nodeN will be set by core, when allTheSame. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!in-&gt;allTheSame)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;result.matchNode.nodeN = <a href="../../access/spgist/spgquadtreeproc.c.html#L55" title="access/spgist/spgquadtreeproc.c:55">getQuadrant</a>(centroid, box);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SP-GiST pick-split function<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * It splits a list of boxes into quadrants by choosing a central 4D<br/></li>
<li></span><span class="Comment"> * point as the median of the coordinates of the boxes.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L441">&#x200c;</a><span class="linkable">spg_box_quad_picksplit</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; spgPickSplitIn *in = (spgPickSplitIn *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; spgPickSplitOut *out = (spgPickSplitOut *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; BOX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *centroid;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; median,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp;&nbsp; *lowXs = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8) * in-&gt;nTuples);<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp;&nbsp; *highXs = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8) * in-&gt;nTuples);<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp;&nbsp; *lowYs = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8) * in-&gt;nTuples);<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp;&nbsp; *highYs = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8) * in-&gt;nTuples);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Calculate median of all 4D coordinates */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; in-&gt;nTuples; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; BOX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *box = DatumGetBoxP(in-&gt;datums[i]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lowXs[i] = box-&gt;low.x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; highXs[i] = box-&gt;high.x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lowYs[i] = box-&gt;low.y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; highYs[i] = box-&gt;high.y;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; qsort(lowXs, in-&gt;nTuples, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8), <a href="#L93" title="utils/adt/geo_spgist.c:93">compareDoubles</a>);<br/></li>
<li>&nbsp; &nbsp; qsort(highXs, in-&gt;nTuples, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8), <a href="#L93" title="utils/adt/geo_spgist.c:93">compareDoubles</a>);<br/></li>
<li>&nbsp; &nbsp; qsort(lowYs, in-&gt;nTuples, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8), <a href="#L93" title="utils/adt/geo_spgist.c:93">compareDoubles</a>);<br/></li>
<li>&nbsp; &nbsp; qsort(highYs, in-&gt;nTuples, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(float8), <a href="#L93" title="utils/adt/geo_spgist.c:93">compareDoubles</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; median = in-&gt;nTuples / <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; centroid = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(BOX));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; centroid-&gt;low.x = lowXs[median];<br/></li>
<li>&nbsp; &nbsp; centroid-&gt;high.x = highXs[median];<br/></li>
<li>&nbsp; &nbsp; centroid-&gt;low.y = lowYs[median];<br/></li>
<li>&nbsp; &nbsp; centroid-&gt;high.y = highYs[median];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Fill the output */<br/></li>
<li></span>&nbsp; &nbsp; out-&gt;hasPrefix = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; out-&gt;prefixDatum = BoxPGetDatum(centroid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; out-&gt;nNodes = <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; out-&gt;nodeLabels = <span class="Constant">NULL</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We don't need node labels. */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; out-&gt;mapTuplesToNodes = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>) * in-&gt;nTuples);<br/></li>
<li>&nbsp; &nbsp; out-&gt;leafTupleDatums = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Datum) * in-&gt;nTuples);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Assign ranges to corresponding nodes according to quadrants relative to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the &quot;centroid&quot; <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; in-&gt;nTuples; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; BOX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *box = DatumGetBoxP(in-&gt;datums[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; uint8&nbsp; &nbsp; &nbsp; &nbsp; quadrant = <a href="../../access/spgist/spgquadtreeproc.c.html#L55" title="access/spgist/spgquadtreeproc.c:55">getQuadrant</a>(centroid, box);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;leafTupleDatums[i] = BoxPGetDatum(box);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;mapTuplesToNodes[i] = quadrant;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Check if result of consistent method based on bounding box is exact.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L508">&#x200c;</a></span><span class="linkable">is_bounding_box_test_exact</span>(StrategyNumber strategy)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (strategy)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTLeftStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverLeftStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverRightStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTRightStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverBelowStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTBelowStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTAboveStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverAboveStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Get bounding box for ScanKey.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> BOX *<br/></li>
<li><a id="L531">&#x200c;</a><span class="linkable">spg_box_quad_get_scankey_bbox</span>(ScanKey sk, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> *recheck)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (sk-&gt;sk_subtype)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> BOXOID:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> DatumGetBoxP(sk-&gt;sk_argument);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> POLYGONOID:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (recheck &amp;&amp; !<a href="#L508" title="utils/adt/geo_spgist.c:508">is_bounding_box_test_exact</a>(sk-&gt;sk_strategy))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *recheck = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> &amp;DatumGetPolygonP(sk-&gt;sk_argument)-&gt;boundbox;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized scankey subtype: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, sk-&gt;sk_subtype);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SP-GiST inner consistent function<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L553">&#x200c;</a><span class="linkable">spg_box_quad_inner_consistent</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; spgInnerConsistentIn *in = (spgInnerConsistentIn *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; spgInnerConsistentOut *out = (spgInnerConsistentOut *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; MemoryContext old_ctx;<br/></li>
<li>&nbsp; &nbsp; <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>&nbsp; &nbsp; *rect_box;<br/></li>
<li>&nbsp; &nbsp; uint8&nbsp; &nbsp; &nbsp; &nbsp; quadrant;<br/></li>
<li>&nbsp; &nbsp; <a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a>&nbsp;&nbsp; *centroid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; **queries;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We are saving the traversal value or <a href="../../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> it an unbounded one, if<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * we have just begun to walk the tree.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (in-&gt;traversalValue)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rect_box = in-&gt;traversalValue;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; rect_box = <a href="#L177" title="utils/adt/geo_spgist.c:177">initRectBox</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (in-&gt;allTheSame)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Report that all nodes should be visited */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;nNodes = in-&gt;nNodes;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;nodeNumbers = (<span class="Type">int</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>) * in-&gt;nNodes);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; in-&gt;nNodes; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;nodeNumbers[i] = i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (in-&gt;norderbys &gt; <span class="Constant">0</span> &amp;&amp; in-&gt;nNodes &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp;&nbsp; *distances = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">double</span>) * in-&gt;norderbys);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (j = <span class="Constant">0</span>; j &lt; in-&gt;norderbys; j++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Point&nbsp; &nbsp; &nbsp;&nbsp; *pt = DatumGetPointP(in-&gt;orderbys[j].sk_argument);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; distances[j] = <a href="#L374" title="utils/adt/geo_spgist.c:374">pointToRectBoxDistance</a>(pt, rect_box);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;distances = (<span class="Type">double</span> **) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">double</span> *) * in-&gt;nNodes);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;distances[<span class="Constant">0</span>] = distances;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt; in-&gt;nNodes; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;distances[i] = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">double</span>) * in-&gt;norderbys);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(out-&gt;distances[i], distances,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">double</span>) * in-&gt;norderbys);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We are casting the prefix and queries to RangeBoxes for ease of the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * following operations.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; centroid = <a href="#L157" title="utils/adt/geo_spgist.c:157">getRangeBox</a>(DatumGetBoxP(in-&gt;prefixDatum));<br/></li>
<li>&nbsp; &nbsp; queries = (<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> **) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(in-&gt;nkeys * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L113" title="utils/adt/geo_spgist.c:113">RangeBox</a> *));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; in-&gt;nkeys; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; BOX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *box = <a href="#L531" title="utils/adt/geo_spgist.c:531">spg_box_quad_get_scankey_bbox</a>(&amp;in-&gt;scankeys[i], <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; queries[i] = <a href="#L157" title="utils/adt/geo_spgist.c:157">getRangeBox</a>(box);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Allocate enough memory for nodes */<br/></li>
<li></span>&nbsp; &nbsp; out-&gt;nNodes = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; out-&gt;nodeNumbers = (<span class="Type">int</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">int</span>) * in-&gt;nNodes);<br/></li>
<li>&nbsp; &nbsp; out-&gt;traversalValues = (<span class="Type">void</span> **) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">void</span> *) * in-&gt;nNodes);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (in-&gt;norderbys &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;distances = (<span class="Type">double</span> **) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">double</span> *) * in-&gt;nNodes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We switch memory context, because we want to allocate memory for new<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * traversal <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> (next_rect_box) and pass these pieces of memory to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * further call of this function.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; old_ctx = MemoryContextSwitchTo(in-&gt;traversalMemoryContext);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (quadrant = <span class="Constant">0</span>; quadrant &lt; in-&gt;nNodes; quadrant++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L119" title="utils/adt/geo_spgist.c:119">RectBox</a>&nbsp; &nbsp; *next_rect_box = <a href="#L205" title="utils/adt/geo_spgist.c:205">nextRectBox</a>(rect_box, centroid, quadrant);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; flag = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; in-&gt;nkeys; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StrategyNumber strategy = in-&gt;scankeys[i].sk_strategy;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (strategy)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverlapStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L244" title="utils/adt/geo_spgist.c:244">overlap4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTContainsStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L260" title="utils/adt/geo_spgist.c:260">contain4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTSameStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTContainedByStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L278" title="utils/adt/geo_spgist.c:278">contained4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTLeftStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L318" title="utils/adt/geo_spgist.c:318">left4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverLeftStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L325" title="utils/adt/geo_spgist.c:325">overLeft4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTRightStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L332" title="utils/adt/geo_spgist.c:332">right4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverRightStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L339" title="utils/adt/geo_spgist.c:339">overRight4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTAboveStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L360" title="utils/adt/geo_spgist.c:360">above4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverAboveStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L367" title="utils/adt/geo_spgist.c:367">overAbove4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTBelowStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L346" title="utils/adt/geo_spgist.c:346">below4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverBelowStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <a href="#L353" title="utils/adt/geo_spgist.c:353">overBelow4D</a>(next_rect_box, queries[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized strategy: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, strategy);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> check is failed, we have found our answer. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!flag)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flag)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;traversalValues[out-&gt;nNodes] = next_rect_box;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;nodeNumbers[out-&gt;nNodes] = quadrant;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (in-&gt;norderbys &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp;&nbsp; *distances = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">double</span>) * in-&gt;norderbys);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;distances[out-&gt;nNodes] = distances;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (j = <span class="Constant">0</span>; j &lt; in-&gt;norderbys; j++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Point&nbsp; &nbsp; &nbsp;&nbsp; *pt = DatumGetPointP(in-&gt;orderbys[j].sk_argument);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; distances[j] = <a href="#L374" title="utils/adt/geo_spgist.c:374">pointToRectBoxDistance</a>(pt, next_rect_box);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;nNodes++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If this node is not selected, we don't need to keep the <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * traversal value in the memory context.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(next_rect_box);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Switch back */<br/></li>
<li></span>&nbsp; &nbsp; MemoryContextSwitchTo(old_ctx);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SP-GiST inner consistent function<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L741">&#x200c;</a><span class="linkable">spg_box_quad_leaf_consistent</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; spgLeafConsistentIn *in = (spgLeafConsistentIn *) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; spgLeafConsistentOut *out = (spgLeafConsistentOut *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; leaf = in-&gt;leafDatum;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; flag = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* All tests are exact. */<br/></li>
<li></span>&nbsp; &nbsp; out-&gt;recheck = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Don't return leafValue unless told to; this is used for both box and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * polygon opclasses, and in the latter case the leaf datum is not even of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the right type to return.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (in-&gt;returnData)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;leafValue = leaf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Perform the required comparison(s) */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; in-&gt;nkeys; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StrategyNumber strategy = in-&gt;scankeys[i].sk_strategy;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; BOX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *box = <a href="#L531" title="utils/adt/geo_spgist.c:531">spg_box_quad_get_scankey_bbox</a>(&amp;in-&gt;scankeys[i],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;out-&gt;recheck);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; query = BoxPGetDatum(box);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (strategy)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverlapStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L563" title="utils/adt/geo_ops.c:563">box_overlap</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTContainsStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L692" title="utils/adt/geo_ops.c:692">box_contain</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTContainedByStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L681" title="utils/adt/geo_ops.c:681">box_contained</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTSameStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L551" title="utils/adt/geo_ops.c:551">box_same</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTLeftStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L583" title="utils/adt/geo_ops.c:583">box_left</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverLeftStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L598" title="utils/adt/geo_ops.c:598">box_overleft</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTRightStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L609" title="utils/adt/geo_ops.c:609">box_right</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverRightStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L624" title="utils/adt/geo_ops.c:624">box_overright</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTAboveStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L658" title="utils/adt/geo_ops.c:658">box_above</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverAboveStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L670" title="utils/adt/geo_ops.c:670">box_overabove</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTBelowStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L635" title="utils/adt/geo_ops.c:635">box_below</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> RTOverBelowStrategyNumber:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = DatumGetBool(DirectFunctionCall2(<a href="geo_ops.c.html#L647" title="utils/adt/geo_ops.c:647">box_overbelow</a>, leaf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; query));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized strategy: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, strategy);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> check is failed, we have found our answer. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!flag)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flag &amp;&amp; in-&gt;norderbys &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; distfnoid = in-&gt;orderbys[<span class="Constant">0</span>].sk_func.fn_oid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;distances = <a href="../../access/spgist/spgproc.c.html#L63" title="access/spgist/spgproc.c:63">spg_key_orderbys_distances</a>(leaf, <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in-&gt;orderbys, in-&gt;norderbys);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Recheck is necessary when computing distance to polygon */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;recheckDistances = distfnoid == F_DIST_POLYP;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(flag);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SP-GiST config function for 2-D types that are lossy represented by their<br/></li>
<li></span><span class="Comment"> * bounding boxes<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L859">&#x200c;</a><span class="linkable">spg_bbox_quad_config</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; spgConfigOut *cfg = (spgConfigOut *) PG_GETARG_POINTER(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cfg-&gt;prefixType = BOXOID;&nbsp; &nbsp; <span class="Comment">/* A type represented by its bounding box */<br/></li>
<li></span>&nbsp; &nbsp; cfg-&gt;labelType = VOIDOID;&nbsp; &nbsp; <span class="Comment">/* We don't need node labels. */<br/></li>
<li></span>&nbsp; &nbsp; cfg-&gt;leafType = BOXOID;<br/></li>
<li>&nbsp; &nbsp; cfg-&gt;canReturnData = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; cfg-&gt;longValuesOK = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SP-GiST compress function for polygons<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L876">&#x200c;</a><span class="linkable">spg_poly_quad_compress</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; POLYGON&nbsp; &nbsp; *polygon = PG_GETARG_POLYGON_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; BOX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *box;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; box = (BOX *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(BOX));<br/></li>
<li>&nbsp; &nbsp; *box = polygon-&gt;boundbox;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOX_P(box);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
