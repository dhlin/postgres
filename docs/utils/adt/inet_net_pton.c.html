<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/inet_net_pton.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/inet_net_pton.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L21">rcsid</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L349">getbits</a></li>
<li><a href="#L382">getv4</a></li>
<li><a href="#L97">inet_cidr_pton_ipv4</a></li>
<li><a href="#L439">inet_cidr_pton_ipv6</a></li>
<li><a href="#L260">inet_net_pton_ipv4</a></li>
<li><a href="#L429">inet_net_pton_ipv6</a></li>
<li><a href="#L62">pg_inet_net_pton</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L434">NS_IN6ADDRSZ</a></li>
<li><a href="#L436">NS_INADDRSZ</a></li>
<li><a href="#L435">NS_INT16SZ</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2004 by Internet Systems Consortium, Inc. (&quot;ISC&quot;)<br/></li>
<li></span><span class="Comment"> * Copyright (c) 1996,1999 by Internet Software Consortium.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Permission to use, copy, modify, and distribute this software for <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a><br/></li>
<li></span><span class="Comment"> * purpose with or without fee is hereby granted, provided that the above<br/></li>
<li></span><span class="Comment"> * copyright notice and this permission notice appear in all copies.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ISC DISCLAIMS ALL WARRANTIES<br/></li>
<li></span><span class="Comment"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF<br/></li>
<li></span><span class="Comment"> * MERCHANTABILITY AND FITNESS.&nbsp; IN NO EVENT SHALL ISC BE LIABLE FOR<br/></li>
<li></span><span class="Comment"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES<br/></li>
<li></span><span class="Comment"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN<br/></li>
<li></span><span class="Comment"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT<br/></li>
<li></span><span class="Comment"> * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/utils/adt/inet_net_pton.c<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(LIBC_SCCS) &amp;&amp; !defined(lint)<br/></li>
<li><a id="L21">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> <span class="linkable">rcsid</span>[] = <span class="Constant">&quot;Id: inet_net_pton.c,v 1.4.2.3 2004/03/17 00:40:11 marka Exp $&quot;</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;sys/<a href="../../port/win32/socket.c.html#L31" title="port/win32/socket.c:31">socket</a>.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;netinet/in.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;arpa/inet.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;assert.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ctype.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;</span> <span class="Comment">/* pgrminclude ignore */</span>&nbsp; &nbsp; <span class="Comment">/* needed on some<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * platforms */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/inet.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L260" title="utils/adt/inet_net_pton.c:260">inet_net_pton_ipv4</a>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L97" title="utils/adt/inet_net_pton.c:97">inet_cidr_pton_ipv4</a>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst, <span class="Type">size_t</span> size);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L429" title="utils/adt/inet_net_pton.c:429">inet_net_pton_ipv6</a>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L439" title="utils/adt/inet_net_pton.c:439">inet_cidr_pton_ipv6</a>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst, <span class="Type">size_t</span> size);<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * int<br/></li>
<li></span><span class="Comment"> * <a href="#L62" title="utils/adt/inet_net_pton.c:62">pg_inet_net_pton</a>(af, src, dst, size)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; convert network number from presentation to network format.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; accepts hex octets, hex strings, decimal octets, and /CIDR.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &quot;size&quot; is in bytes and describes &quot;dst&quot;.<br/></li>
<li></span><span class="Comment"> * return:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; number of bits, either imputed classfully or specified with /CIDR,<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; or -1 if some failure occurred (check errno).&nbsp; ENOENT means it was<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; not a valid network specification.<br/></li>
<li></span><span class="Comment"> * author:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Paul Vixie (ISC), June 1996<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Changes:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; I added the inet_cidr_pton function (also from Paul) and changed<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; the names to reflect their current use.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">int<br/></li>
<li><a id="L62">&#x200c;</a></span><span class="linkable">pg_inet_net_pton</span>(<span class="Type">int</span> af, <span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">void</span> *dst, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (af)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PGSQL_AF_INET:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> size == -<span class="Constant">1</span> ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L260" title="utils/adt/inet_net_pton.c:260">inet_net_pton_ipv4</a>(src, dst) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L97" title="utils/adt/inet_net_pton.c:97">inet_cidr_pton_ipv4</a>(src, dst, size);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> PGSQL_AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> size == -<span class="Constant">1</span> ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L429" title="utils/adt/inet_net_pton.c:429">inet_net_pton_ipv6</a>(src, dst) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L439" title="utils/adt/inet_net_pton.c:439">inet_cidr_pton_ipv6</a>(src, dst, size);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errno = <span class="Constant">EAFNOSUPPORT</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * static int<br/></li>
<li></span><span class="Comment"> * <a href="#L97" title="utils/adt/inet_net_pton.c:97">inet_cidr_pton_ipv4</a>(src, dst, size)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; convert IPv4 network number from presentation to network format.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; accepts hex octets, hex strings, decimal octets, and /CIDR.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &quot;size&quot; is in bytes and describes &quot;dst&quot;.<br/></li>
<li></span><span class="Comment"> * return:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; number of bits, either imputed classfully or specified with /CIDR,<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; or -1 if some failure occurred (check errno).&nbsp; ENOENT means it was<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; not an IPv4 network specification.<br/></li>
<li></span><span class="Comment"> * note:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; network byte order assumed.&nbsp; this means 192.5.5.240/28 has<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0b11110000 in its fourth octet.<br/></li>
<li></span><span class="Comment"> * author:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Paul Vixie (ISC), June 1996<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L97">&#x200c;</a></span><span class="linkable">inet_cidr_pton_ipv4</span>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> xdigits[] = <span class="Constant">&quot;0123456789abcdef&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> digits[] = <span class="Constant">&quot;0123456789&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dirty,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> u_char *odst = dst;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ch = *src++;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'0'</span> &amp;&amp; (src[<span class="Constant">0</span>] == <span class="Constant">'x'</span> || src[<span class="Constant">0</span>] == <span class="Constant">'X'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; isxdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) src[<span class="Constant">1</span>]))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Hexadecimal: Eat nybble string. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size &lt;= <span class="Constant">0U</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dirty = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; src++;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> x or X. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span> &amp;&amp; isxdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (isupper((<span class="Type">unsigned</span> <span class="Type">char</span>) ch))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) ch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = strchr(xdigits, ch) - xdigits;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(n &gt;= <span class="Constant">0</span> &amp;&amp; n &lt;= <span class="Constant">15</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dirty == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp = n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp = (tmp &lt;&lt; <span class="Constant">4</span>) | n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (++dirty == <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size-- &lt;= <span class="Constant">0U</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = (u_char) tmp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dirty = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dirty)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Odd trailing nybble? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size-- &lt;= <span class="Constant">0U</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = (u_char) (tmp &lt;&lt; <span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Decimal: eat dotted digit string. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (;;)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = strchr(digits, ch) - digits;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(n &gt;= <span class="Constant">0</span> &amp;&amp; n &lt;= <span class="Constant">9</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp += n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmp &gt; <span class="Constant">255</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size-- &lt;= <span class="Constant">0U</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = (u_char) tmp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Special">'\0'</span> || ch == <span class="Constant">'/'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch != <span class="Constant">'.'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = *src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; bits = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'/'</span> &amp;&amp; isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) src[<span class="Constant">0</span>]) &amp;&amp; dst &gt; odst)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* CIDR width specifier.&nbsp; Nothing can follow it. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ch = *src++;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Skip over the /. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = strchr(digits, ch) - digits;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(n &gt;= <span class="Constant">0</span> &amp;&amp; n &lt;= <span class="Constant">9</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits += n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span> &amp;&amp; isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bits &gt; <span class="Constant">32</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Fiery death and destruction unless we prefetched <a href="../../regex/regcomp.c.html#L329" title="regex/regcomp.c:329">EOS</a>. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (ch != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If nothing was written to the destination, we found no address. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (dst == odst)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If no CIDR spec was given, infer width from net class. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (bits == -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*odst &gt;= <span class="Constant">240</span>)&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Class E */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">32</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*odst &gt;= <span class="Constant">224</span>)&nbsp; &nbsp; <span class="Comment">/* Class D */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*odst &gt;= <span class="Constant">192</span>)&nbsp; &nbsp; <span class="Comment">/* Class C */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">24</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*odst &gt;= <span class="Constant">128</span>)&nbsp; &nbsp; <span class="Comment">/* Class B */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Class A */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If imputed mask is narrower than specified octets, widen. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bits &lt; ((dst - odst) * <span class="Constant">8</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = (dst - odst) * <span class="Constant">8</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If there are no additional bits specified for a class D address<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * adjust bits to 4.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bits == <span class="Constant">8</span> &amp;&amp; *odst == <span class="Constant">224</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Extend network to cover the actual mask. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (bits &gt; ((dst - odst) * <span class="Constant">8</span>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size-- &lt;= <span class="Constant">0U</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> bits;<br/></li>
<li><br/></li>
<li><span class="Statement">enoent</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">ENOENT</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">emsgsize</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">EMSGSIZE</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * int<br/></li>
<li></span><span class="Comment"> * <a href="#L260" title="utils/adt/inet_net_pton.c:260">inet_net_pton_ipv4</a>(af, src, dst, *bits)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; convert network address from presentation to network format.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; accepts inet_pton()'s input for this &quot;af&quot; plus trailing &quot;/CIDR&quot;.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &quot;dst&quot; is assumed large enough for its &quot;af&quot;.&nbsp; &quot;bits&quot; is set to the<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; /CIDR prefix length, which can have defaults (like /32 for IPv4).<br/></li>
<li></span><span class="Comment"> * return:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; -1 if an error occurred (inspect errno; ENOENT means bad format).<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0 if successful conversion occurred.<br/></li>
<li></span><span class="Comment"> * note:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 192.5.5.1/28 has a nonzero host part, which means it isn't a network<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; as called for by inet_cidr_pton() but it can be a host address with<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; an included netmask.<br/></li>
<li></span><span class="Comment"> * author:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Paul Vixie (ISC), October 1998<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L260">&#x200c;</a></span><span class="linkable">inet_net_pton_ipv4</span>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> digits[] = <span class="Constant">&quot;0123456789&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> u_char *odst = dst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; size = <span class="Constant">4</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Get the mantissa. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (ch = *src++, isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tmp = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = strchr(digits, ch) - digits;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(n &gt;= <span class="Constant">0</span> &amp;&amp; n &lt;= <span class="Constant">9</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp += n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmp &gt; <span class="Constant">255</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span> &amp;&amp; isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (size-- == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = (u_char) tmp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Special">'\0'</span> || ch == <span class="Constant">'/'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch != <span class="Constant">'.'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Get the prefix length if <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a>. */<br/></li>
<li></span>&nbsp; &nbsp; bits = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'/'</span> &amp;&amp; isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) src[<span class="Constant">0</span>]) &amp;&amp; dst &gt; odst)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* CIDR width specifier.&nbsp; Nothing can follow it. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ch = *src++;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Skip over the /. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = strchr(digits, ch) - digits;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(n &gt;= <span class="Constant">0</span> &amp;&amp; n &lt;= <span class="Constant">9</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits += n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span> &amp;&amp; isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) ch));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bits &gt; <span class="Constant">32</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Fiery death and destruction unless we prefetched <a href="../../regex/regcomp.c.html#L329" title="regex/regcomp.c:329">EOS</a>. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (ch != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Prefix length can default to /32 only if all four octets spec'd. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (bits == -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dst - odst == <span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">32</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If nothing was written to the destination, we found no address. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (dst == odst)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* If prefix length overspecifies mantissa, life is bad. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> ((bits / <span class="Constant">8</span>) &gt; (dst - odst))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Extend address to four octets. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (size-- &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> bits;<br/></li>
<li><br/></li>
<li><span class="Statement">enoent</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">ENOENT</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">emsgsize</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">EMSGSIZE</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L349">&#x200c;</a></span><span class="linkable">getbits</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">int</span> *bitsp)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> digits[] = <span class="Constant">&quot;0123456789&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; ch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; val = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *pch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pch = strchr(digits, ch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pch != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n++ != <span class="Constant">0</span> &amp;&amp; val == <span class="Constant">0</span>)&nbsp; &nbsp; <span class="Comment">/* no leading zeros */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val += (pch - digits);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (val &gt; <span class="Constant">128</span>)&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; *bitsp = val;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L382">&#x200c;</a></span><span class="linkable">getv4</span>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst, <span class="Type">int</span> *bitsp)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> digits[] = <span class="Constant">&quot;0123456789&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp;&nbsp; *odst = dst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; u_int&nbsp; &nbsp; &nbsp; &nbsp; val;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; ch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; val = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *pch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pch = strchr(digits, ch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pch != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n++ != <span class="Constant">0</span> &amp;&amp; val == <span class="Constant">0</span>)&nbsp; &nbsp; <span class="Comment">/* no leading zeros */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val += (pch - digits);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (val &gt; <span class="Constant">255</span>)&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'.'</span> || ch == <span class="Constant">'/'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dst - odst &gt; <span class="Constant">3</span>) <span class="Comment">/* too many octets? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = val;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'/'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L349" title="utils/adt/inet_net_pton.c:349">getbits</a>(src, bitsp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dst - odst &gt; <span class="Constant">3</span>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* too many octets? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; *dst++ = val;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L429">&#x200c;</a></span><span class="linkable">inet_net_pton_ipv6</span>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L439" title="utils/adt/inet_net_pton.c:439">inet_cidr_pton_ipv6</a>(src, dst, <span class="Constant">16</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L434">&#x200c;</a><span class="PreProc">#define <span class="linkable">NS_IN6ADDRSZ</span> </span><span class="Constant">16<br/></li>
<li><a id="L435">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NS_INT16SZ</span> </span><span class="Constant">2<br/></li>
<li><a id="L436">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NS_INADDRSZ</span> </span><span class="Constant">4<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L439">&#x200c;</a></span><span class="linkable">inet_cidr_pton_ipv6</span>(<span class="Type">const</span> <span class="Type">char</span> *src, u_char *dst, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> xdigits_l[] = <span class="Constant">&quot;0123456789abcdef&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xdigits_u[] = <span class="Constant">&quot;0123456789ABCDEF&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; tmp[<a href="#L434" title="utils/adt/inet_net_pton.c:434">NS_IN6ADDRSZ</a>],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *tp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *endp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *colonp;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *xdigits,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *curtok;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saw_xdigit;<br/></li>
<li>&nbsp; &nbsp; u_int&nbsp; &nbsp; &nbsp; &nbsp; val;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digits;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size &lt; <a href="#L434" title="utils/adt/inet_net_pton.c:434">NS_IN6ADDRSZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> emsgsize;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memset((tp = tmp), <span class="Special">'\0'</span>, <a href="#L434" title="utils/adt/inet_net_pton.c:434">NS_IN6ADDRSZ</a>);<br/></li>
<li>&nbsp; &nbsp; endp = tp + <a href="#L434" title="utils/adt/inet_net_pton.c:434">NS_IN6ADDRSZ</a>;<br/></li>
<li>&nbsp; &nbsp; colonp = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Leading :: requires some special handling. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (*src == <span class="Constant">':'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*++src != <span class="Constant">':'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; curtok = src;<br/></li>
<li>&nbsp; &nbsp; saw_xdigit = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; val = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; digits = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; bits = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((ch = *src++) != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *pch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((pch = strchr((xdigits = xdigits_l), ch)) == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pch = strchr((xdigits = xdigits_u), ch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pch != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val &lt;&lt;= <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val |= (pch - xdigits);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (++digits &gt; <span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saw_xdigit = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">':'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curtok = src;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!saw_xdigit)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (colonp)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; colonp = tp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*src == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tp + <a href="#L435" title="utils/adt/inet_net_pton.c:435">NS_INT16SZ</a> &gt; endp)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *tp++ = (u_char) (val &gt;&gt; <span class="Constant">8</span>) &amp; <span class="Constant">0xff</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *tp++ = (u_char) val &amp; <span class="Constant">0xff</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saw_xdigit = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digits = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'.'</span> &amp;&amp; ((tp + <a href="#L436" title="utils/adt/inet_net_pton.c:436">NS_INADDRSZ</a>) &lt;= endp) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L382" title="utils/adt/inet_net_pton.c:382">getv4</a>(curtok, tp, &amp;bits) &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tp += <a href="#L436" title="utils/adt/inet_net_pton.c:436">NS_INADDRSZ</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saw_xdigit = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* '\0' was seen by inet_pton4(). */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'/'</span> &amp;&amp; <a href="#L349" title="utils/adt/inet_net_pton.c:349">getbits</a>(src, &amp;bits) &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (saw_xdigit)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tp + <a href="#L435" title="utils/adt/inet_net_pton.c:435">NS_INT16SZ</a> &gt; endp)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *tp++ = (u_char) (val &gt;&gt; <span class="Constant">8</span>) &amp; <span class="Constant">0xff</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *tp++ = (u_char) val &amp; <span class="Constant">0xff</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bits == -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; bits = <span class="Constant">128</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; endp = tmp + <span class="Constant">16</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (colonp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Since some memmove()'s erroneously fail to handle overlapping<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * regions, we'll do the shift by hand.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">int</span>&nbsp; &nbsp; n = tp - colonp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tp == endp)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt;= n; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; endp[-i] = colonp[n - i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; colonp[n - i] = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tp = endp;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tp != endp)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> enoent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Copy out the result.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; memcpy(dst, tmp, <a href="#L434" title="utils/adt/inet_net_pton.c:434">NS_IN6ADDRSZ</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> bits;<br/></li>
<li><br/></li>
<li><span class="Statement">enoent</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">ENOENT</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">emsgsize</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; errno = <span class="Constant">EMSGSIZE</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
