<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/cash.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/cash.c - pgsql17devel-backend</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L593">cash_cmp</a></li>
<li><a href="#L643">cash_div_cash</a></li>
<li><a href="#L744">cash_div_flt4</a></li>
<li><a href="#L693">cash_div_flt8</a></li>
<li><a href="#L895">cash_div_int2</a></li>
<li><a href="#L845">cash_div_int4</a></li>
<li><a href="#L793">cash_div_int8</a></li>
<li><a href="#L539">cash_eq</a></li>
<li><a href="#L584">cash_ge</a></li>
<li><a href="#L575">cash_gt</a></li>
<li><a href="#L96">cash_in</a></li>
<li><a href="#L566">cash_le</a></li>
<li><a href="#L557">cash_lt</a></li>
<li><a href="#L627">cash_mi</a></li>
<li><a href="#L713">cash_mul_flt4</a></li>
<li><a href="#L663">cash_mul_flt8</a></li>
<li><a href="#L866">cash_mul_int2</a></li>
<li><a href="#L814">cash_mul_int4</a></li>
<li><a href="#L764">cash_mul_int8</a></li>
<li><a href="#L548">cash_ne</a></li>
<li><a href="#L1032">cash_numeric</a></li>
<li><a href="#L310">cash_out</a></li>
<li><a href="#L611">cash_pl</a></li>
<li><a href="#L513">cash_recv</a></li>
<li><a href="#L524">cash_send</a></li>
<li><a href="#L945">cash_words</a></li>
<li><a href="#L914">cashlarger</a></li>
<li><a href="#L929">cashsmaller</a></li>
<li><a href="#L728">flt4_mul_cash</a></li>
<li><a href="#L678">flt8_mul_cash</a></li>
<li><a href="#L880">int2_mul_cash</a></li>
<li><a href="#L1122">int4_cash</a></li>
<li><a href="#L829">int4_mul_cash</a></li>
<li><a href="#L1152">int8_cash</a></li>
<li><a href="#L779">int8_mul_cash</a></li>
<li><a href="#L38">num_word</a></li>
<li><a href="#L1088">numeric_cash</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * cash.c<br/></li>
<li></span><span class="Comment"> * Written by D'Arcy J.M. Cain<br/></li>
<li></span><span class="Comment"> * darcy@druid.net<br/></li>
<li></span><span class="Comment"> * http://www.druid.net/darcy/<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Functions to allow input and output of money normally but store<br/></li>
<li></span><span class="Comment"> * and handle it as 64 <a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> ints<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * A slightly modified version of this file and a discussion of the<br/></li>
<li></span><span class="Comment"> * workings can be found in the book &quot;Software Solutions in C&quot; by<br/></li>
<li></span><span class="Comment"> * Dale Schumacher, Academic Press, ISBN: 0-12-632360-7 except that<br/></li>
<li></span><span class="Comment"> * this version handles 64 <a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> numbers and so can hold <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> up to<br/></li>
<li></span><span class="Comment"> * $92,233,720,368,547,758.07.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * src/backend/utils/adt/cash.c<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;limits.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ctype.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;math.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;common/int.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;libpq/pqformat.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/cash.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/<a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a>.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/pg_locale.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*************************************************************************<br/></li>
<li></span><span class="Comment"> * Private routines<br/></li>
<li></span><span class="Comment"> ************************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<br/></li>
<li><a id="L38">&#x200c;</a><span class="linkable">num_word</span>(Cash value)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">char</span> buf[<span class="Constant">128</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> small[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;zero&quot;</span>, <span class="Constant">&quot;one&quot;</span>, <span class="Constant">&quot;two&quot;</span>, <span class="Constant">&quot;three&quot;</span>, <span class="Constant">&quot;four&quot;</span>, <span class="Constant">&quot;five&quot;</span>, <span class="Constant">&quot;six&quot;</span>, <span class="Constant">&quot;seven&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;eight&quot;</span>, <span class="Constant">&quot;nine&quot;</span>, <span class="Constant">&quot;ten&quot;</span>, <span class="Constant">&quot;eleven&quot;</span>, <span class="Constant">&quot;twelve&quot;</span>, <span class="Constant">&quot;thirteen&quot;</span>, <span class="Constant">&quot;fourteen&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fifteen&quot;</span>, <span class="Constant">&quot;sixteen&quot;</span>, <span class="Constant">&quot;seventeen&quot;</span>, <span class="Constant">&quot;eighteen&quot;</span>, <span class="Constant">&quot;nineteen&quot;</span>, <span class="Constant">&quot;twenty&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;thirty&quot;</span>, <span class="Constant">&quot;forty&quot;</span>, <span class="Constant">&quot;fifty&quot;</span>, <span class="Constant">&quot;sixty&quot;</span>, <span class="Constant">&quot;seventy&quot;</span>, <span class="Constant">&quot;eighty&quot;</span>, <span class="Constant">&quot;ninety&quot;<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> *big = small + <span class="Constant">18</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tu = value % <span class="Constant">100</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* deal with the simple cases first */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt;= <span class="Constant">20</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> small[value];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* is it an even multiple of 100? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!tu)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> hundred&quot;</span>, small[value / <span class="Constant">100</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> buf;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* more than 99? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (value &gt; <span class="Constant">99</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* is it an even multiple of 10 other than 10? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (value % <span class="Constant">10</span> == <span class="Constant">0</span> &amp;&amp; tu &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> hundred </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; small[value / <span class="Constant">100</span>], big[tu / <span class="Constant">10</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (tu &lt; <span class="Constant">20</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> hundred and </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; small[value / <span class="Constant">100</span>], small[tu]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> hundred </span><span class="Special">%s</span><span class="Constant"> </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; small[value / <span class="Constant">100</span>], big[tu / <span class="Constant">10</span>], small[tu % <span class="Constant">10</span>]);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* is it an even multiple of 10 other than 10? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (value % <span class="Constant">10</span> == <span class="Constant">0</span> &amp;&amp; tu &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">&quot;</span>, big[tu / <span class="Constant">10</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (tu &lt; <span class="Constant">20</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">&quot;</span>, small[tu]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> </span><span class="Special">%s</span><span class="Constant">&quot;</span>, big[tu / <span class="Constant">10</span>], small[tu % <span class="Constant">10</span>]);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> buf;<br/></li>
<li>}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L38" title="utils/adt/cash.c:38">num_word</a>() */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* <a href="#L96" title="utils/adt/cash.c:96">cash_in</a>()<br/></li>
<li></span><span class="Comment"> * Convert a string to a cash data type.<br/></li>
<li></span><span class="Comment"> * Format is [$]###[,]###[.##]<br/></li>
<li></span><span class="Comment"> * Examples: 123.45 $123.45 $123,456.78<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L96">&#x200c;</a><span class="linkable">cash_in</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = PG_GETARG_CSTRING(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Node&nbsp; &nbsp; &nbsp;&nbsp; *escontext = fcinfo-&gt;context;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; value = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; dec = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; sgn = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; seen_dot = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *s = str;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fpoint;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; dsymbol;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *ssymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *psymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *nsymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *csymbol;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> lconv *lconvert = <a href="pg_locale.c.html#L524" title="utils/adt/pg_locale.c:524">PGLC_localeconv</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * frac_digits will be CHAR_MAX in some locales, notably C.&nbsp; However, just<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * testing for == CHAR_MAX is risky, because of compilers like gcc that<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;helpfully&quot; let you alter the platform-standard definition of whether<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * char is signed or not.&nbsp; If we are so unfortunate as to get compiled<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * with a nonstandard -fsigned-char or -funsigned-char switch, then our<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * idea of CHAR_MAX will not agree with libc's. The safest course is not<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * to test for CHAR_MAX at all, but to impose a <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> check for plausible<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * frac_digits <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; fpoint = lconvert-&gt;frac_digits;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fpoint &lt; <span class="Constant">0</span> || fpoint &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fpoint = <span class="Constant">2</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* best guess in this case, I think */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* we restrict dsymbol to be a single byte, but not the other symbols */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (*lconvert-&gt;mon_decimal_point != <span class="Special">'\0'</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lconvert-&gt;mon_decimal_point[<span class="Constant">1</span>] == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dsymbol = *lconvert-&gt;mon_decimal_point;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; dsymbol = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*lconvert-&gt;mon_thousands_sep != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ssymbol = lconvert-&gt;mon_thousands_sep;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ssymbol should not <a href="../../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> dsymbol */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ssymbol = (dsymbol != <span class="Constant">','</span>) ? <span class="Constant">&quot;,&quot;</span> : <span class="Constant">&quot;.&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; csymbol = (*lconvert-&gt;currency_symbol != <span class="Special">'\0'</span>) ? lconvert-&gt;currency_symbol : <span class="Constant">&quot;$&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; psymbol = (*lconvert-&gt;positive_sign != <span class="Special">'\0'</span>) ? lconvert-&gt;positive_sign : <span class="Constant">&quot;+&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; nsymbol = (*lconvert-&gt;negative_sign != <span class="Special">'\0'</span>) ? lconvert-&gt;negative_sign : <span class="Constant">&quot;-&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef CASHDEBUG<br/></li>
<li></span>&nbsp; &nbsp; printf(<span class="Constant">&quot;cashin- precision '</span><span class="Special">%d</span><span class="Constant">'; decimal '</span><span class="Special">%c</span><span class="Constant">'; thousands '</span><span class="Special">%s</span><span class="Constant">'; currency '</span><span class="Special">%s</span><span class="Constant">'; positive '</span><span class="Special">%s</span><span class="Constant">'; negative '</span><span class="Special">%s</span><span class="Constant">'</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fpoint, dsymbol, ssymbol, csymbol, psymbol, nsymbol);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* we need to add all sorts of checking here.&nbsp; For <a href="timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> just */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* strip all leading whitespace and <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> leading currency symbol */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (strncmp(s, csymbol, strlen(csymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += strlen(csymbol);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef CASHDEBUG<br/></li>
<li></span>&nbsp; &nbsp; printf(<span class="Constant">&quot;cashin- string is '</span><span class="Special">%s</span><span class="Constant">'</span><span class="Special">\n</span><span class="Constant">&quot;</span>, s);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* a leading minus or paren signifies a negative number */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* again, better heuristics needed */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* </span><span class="Todo">XXX</span><span class="Comment"> - doesn't properly check for balanced parens - djmc */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (strncmp(s, nsymbol, strlen(nsymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sgn = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += strlen(nsymbol);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*s == <span class="Constant">'('</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sgn = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (strncmp(s, psymbol, strlen(psymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += strlen(psymbol);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef CASHDEBUG<br/></li>
<li></span>&nbsp; &nbsp; printf(<span class="Constant">&quot;cashin- string is '</span><span class="Special">%s</span><span class="Constant">'</span><span class="Special">\n</span><span class="Constant">&quot;</span>, s);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* allow whitespace and currency symbol after the sign, too */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (strncmp(s, csymbol, strlen(csymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += strlen(csymbol);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef CASHDEBUG<br/></li>
<li></span>&nbsp; &nbsp; printf(<span class="Constant">&quot;cashin- string is '</span><span class="Special">%s</span><span class="Constant">'</span><span class="Special">\n</span><span class="Constant">&quot;</span>, s);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We accumulate the absolute amount in &quot;value&quot; and then apply the sign at<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the end.&nbsp; (The sign can appear <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> or after the digits, so it would<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * be more complicated to do otherwise.)&nbsp; Because of the larger <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * negative signed integers, we build &quot;value&quot; in the negative and then<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * flip the sign at the end, catching most-negative-number overflow if<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * necessary.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (; *s; s++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We look for digits as long as we have found less than the required<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * number of decimal places.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) *s) &amp;&amp; (!seen_dot || dec &lt; fpoint))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int8&nbsp; &nbsp; &nbsp; &nbsp; digit = *s - <span class="Constant">'0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pg_mul_s64_overflow(value, <span class="Constant">10</span>, &amp;value) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pg_sub_s64_overflow(value, digit, &amp;value))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> is out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> for type </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str, <span class="Constant">&quot;money&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (seen_dot)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dec++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* decimal point? then start counting fractions... */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*s == dsymbol &amp;&amp; !seen_dot)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; seen_dot = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ignore if &quot;thousands&quot; separator, else we're done */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (strncmp(s, ssymbol, strlen(ssymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(ssymbol) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* round off if there's another digit */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) *s) &amp;&amp; *s &gt;= <span class="Constant">'5'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* remember we build the value in the negative */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pg_sub_s64_overflow(value, <span class="Constant">1</span>, &amp;value))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> is out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> for type </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str, <span class="Constant">&quot;money&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* adjust for less than required decimal places */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (; dec &lt; fpoint; dec++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pg_mul_s64_overflow(value, <span class="Constant">10</span>, &amp;value))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> is out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> for type </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str, <span class="Constant">&quot;money&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * should only be trailing digits followed by whitespace, right paren,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * trailing sign, and/or trailing currency symbol<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*s)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s) || *s == <span class="Constant">')'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (strncmp(s, nsymbol, strlen(nsymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sgn = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(nsymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (strncmp(s, psymbol, strlen(psymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(psymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (strncmp(s, csymbol, strlen(csymbol)) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(csymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_TEXT_REPRESENTATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid input syntax for type </span><span class="Special">%s</span><span class="Constant">: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;money&quot;</span>, str)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If the value is supposed to be positive, flip the sign, but check for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the most negative number.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (sgn &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (value == PG_INT64_MIN)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> is out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> for type </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str, <span class="Constant">&quot;money&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = -value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; result = value;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef CASHDEBUG<br/></li>
<li></span>&nbsp; &nbsp; printf(<span class="Constant">&quot;cashin- result is &quot;</span> INT64_FORMAT <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>, result);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L310" title="utils/adt/cash.c:310">cash_out</a>()<br/></li>
<li></span><span class="Comment"> * Function to convert cash to a dollars and cents representation, using<br/></li>
<li></span><span class="Comment"> * the lc_monetary locale's formatting.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L310">&#x200c;</a><span class="linkable">cash_out</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; value = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; buf[<span class="Constant">128</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *bufptr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digit_pos;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; points,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mon_group;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; dsymbol;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *ssymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *signsymbol;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; sign_posn,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cs_precedes,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sep_by_space;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> lconv *lconvert = <a href="pg_locale.c.html#L524" title="utils/adt/pg_locale.c:524">PGLC_localeconv</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* see comments about frac_digits in <a href="#L96" title="utils/adt/cash.c:96">cash_in</a>() */<br/></li>
<li></span>&nbsp; &nbsp; points = lconvert-&gt;frac_digits;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (points &lt; <span class="Constant">0</span> || points &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; points = <span class="Constant">2</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* best guess in this case, I think */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * As with frac_digits, must apply a <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> check to mon_grouping to avoid<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * being fooled by variant CHAR_MAX <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; mon_group = *lconvert-&gt;mon_grouping;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (mon_group &lt;= <span class="Constant">0</span> || mon_group &gt; <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; mon_group = <span class="Constant">3</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* we restrict dsymbol to be a single byte, but not the other symbols */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (*lconvert-&gt;mon_decimal_point != <span class="Special">'\0'</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lconvert-&gt;mon_decimal_point[<span class="Constant">1</span>] == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dsymbol = *lconvert-&gt;mon_decimal_point;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; dsymbol = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*lconvert-&gt;mon_thousands_sep != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ssymbol = lconvert-&gt;mon_thousands_sep;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ssymbol should not <a href="../../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> dsymbol */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ssymbol = (dsymbol != <span class="Constant">','</span>) ? <span class="Constant">&quot;,&quot;</span> : <span class="Constant">&quot;.&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; csymbol = (*lconvert-&gt;currency_symbol != <span class="Special">'\0'</span>) ? lconvert-&gt;currency_symbol : <span class="Constant">&quot;$&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* make the amount positive for digit-reconstruction loop */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; value = -value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* set up formatting data */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; signsymbol = (*lconvert-&gt;negative_sign != <span class="Special">'\0'</span>) ? lconvert-&gt;negative_sign : <span class="Constant">&quot;-&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sign_posn = lconvert-&gt;n_sign_posn;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cs_precedes = lconvert-&gt;n_cs_precedes;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sep_by_space = lconvert-&gt;n_sep_by_space;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; signsymbol = lconvert-&gt;positive_sign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sign_posn = lconvert-&gt;p_sign_posn;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cs_precedes = lconvert-&gt;p_cs_precedes;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sep_by_space = lconvert-&gt;p_sep_by_space;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* we build the digits+decimal-point+sep string right-to-left in buf[] */<br/></li>
<li></span>&nbsp; &nbsp; bufptr = buf + <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(buf) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; *bufptr = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Generate digits till there are no non-zero digits left and we emitted<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * at least one to the left of the decimal point.&nbsp; digit_pos is the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * current digit position, with zero as the digit just left of the decimal<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * point, increasing to the right.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; digit_pos = points;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (points &amp;&amp; digit_pos == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* insert decimal point, but not if value cannot be fractional */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(--bufptr) = dsymbol;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (digit_pos &lt; <span class="Constant">0</span> &amp;&amp; (digit_pos % mon_group) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* insert thousands sep, but only to left of radix point */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr -= strlen(ssymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(bufptr, ssymbol, strlen(ssymbol));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *(--bufptr) = ((uint64) value % <span class="Constant">10</span>) + <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = ((uint64) value) / <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; digit_pos--;<br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (value || digit_pos &gt;= <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*----------<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Now, attach currency symbol and sign symbol in the correct order.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * The POSIX spec defines these <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> controlling this code:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * p/n_sign_posn:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 0&nbsp; &nbsp; Parentheses enclose the quantity and the currency_symbol.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 1&nbsp; &nbsp; The sign string precedes the quantity and the currency_symbol.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 2&nbsp; &nbsp; The sign string succeeds the quantity and the currency_symbol.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 3&nbsp; &nbsp; The sign string precedes the currency_symbol.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 4&nbsp; &nbsp; The sign string succeeds the currency_symbol.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * p/n_cs_precedes: 0 means currency symbol after value, else <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> it.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * p/n_sep_by_space:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 0&nbsp; &nbsp; No &lt;space&gt; separates the currency symbol and value.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 1&nbsp; &nbsp; If the currency symbol and sign string are adjacent, a &lt;space&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; separates them from the value; otherwise, a &lt;space&gt; separates<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; the currency symbol from the value.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; 2&nbsp; &nbsp; If the currency symbol and sign string are adjacent, a &lt;space&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; separates them; otherwise, a &lt;space&gt; separates the sign string<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; from the value.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *----------<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">switch</span> (sign_posn)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">0</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cs_precedes)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;(</span><span class="Special">%s%s%s</span><span class="Constant">)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;(</span><span class="Special">%s%s%s</span><span class="Constant">)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">1</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cs_precedes)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">2</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cs_precedes)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">3</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cs_precedes)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">4</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cs_precedes)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = psprintf(<span class="Constant">&quot;</span><span class="Special">%s%s%s%s%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">1</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csymbol,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sep_by_space == <span class="Constant">2</span>) ? <span class="Constant">&quot; &quot;</span> : <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signsymbol);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CSTRING(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L513" title="utils/adt/cash.c:513">cash_recv</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - converts external binary format to cash<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L513">&#x200c;</a><span class="linkable">cash_recv</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; StringInfo&nbsp; &nbsp; buf = (StringInfo) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH((Cash) <a href="../../libpq/pqformat.c.html#L453" title="libpq/pqformat.c:453">pq_getmsgint64</a>(buf));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L524" title="utils/adt/cash.c:524">cash_send</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - converts cash to binary format<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L524">&#x200c;</a><span class="linkable">cash_send</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; arg1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; StringInfoData buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../libpq/pqformat.c.html#L326" title="libpq/pqformat.c:326">pq_begintypsend</a>(&amp;buf);<br/></li>
<li>&nbsp; &nbsp; pq_sendint64(&amp;buf, arg1);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BYTEA_P(<a href="../../libpq/pqformat.c.html#L346" title="libpq/pqformat.c:346">pq_endtypsend</a>(&amp;buf));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Comparison <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a><br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>Datum<br/></li>
<li><a id="L539">&#x200c;</a><span class="linkable">cash_eq</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(c1 == c2);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L548">&#x200c;</a><span class="linkable">cash_ne</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(c1 != c2);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L557">&#x200c;</a><span class="linkable">cash_lt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(c1 &lt; c2);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L566">&#x200c;</a><span class="linkable">cash_le</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(c1 &lt;= c2);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L575">&#x200c;</a><span class="linkable">cash_gt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(c1 &gt; c2);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L584">&#x200c;</a><span class="linkable">cash_ge</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(c1 &gt;= c2);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L593">&#x200c;</a><span class="linkable">cash_cmp</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c1 &gt; c2)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT32(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c1 == c2)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT32(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT32(-<span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L611" title="utils/adt/cash.c:611">cash_pl</a>()<br/></li>
<li></span><span class="Comment"> * Add two cash <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L611">&#x200c;</a><span class="linkable">cash_pl</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c1 + c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L627" title="utils/adt/cash.c:627">cash_mi</a>()<br/></li>
<li></span><span class="Comment"> * Subtract two cash <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L627">&#x200c;</a><span class="linkable">cash_mi</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c1 - c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L643" title="utils/adt/cash.c:643">cash_div_cash</a>()<br/></li>
<li></span><span class="Comment"> * Divide cash by cash, returning float8.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L643">&#x200c;</a><span class="linkable">cash_div_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; dividend = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; divisor = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; quotient;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (divisor == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DIVISION_BY_ZERO),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;division by zero&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; quotient = (float8) dividend / (float8) divisor;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_FLOAT8(quotient);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L663" title="utils/adt/cash.c:663">cash_mul_flt8</a>()<br/></li>
<li></span><span class="Comment"> * Multiply cash by float8.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L663">&#x200c;</a><span class="linkable">cash_mul_flt8</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; f = PG_GETARG_FLOAT8(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = rint(c * f);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L678" title="utils/adt/cash.c:678">flt8_mul_cash</a>()<br/></li>
<li></span><span class="Comment"> * Multiply float8 by cash.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L678">&#x200c;</a><span class="linkable">flt8_mul_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; f = PG_GETARG_FLOAT8(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = rint(f * c);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L693" title="utils/adt/cash.c:693">cash_div_flt8</a>()<br/></li>
<li></span><span class="Comment"> * Divide cash by float8.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L693">&#x200c;</a><span class="linkable">cash_div_flt8</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; f = PG_GETARG_FLOAT8(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (f == <span class="Constant">0.0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DIVISION_BY_ZERO),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;division by zero&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = rint(c / f);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L713" title="utils/adt/cash.c:713">cash_mul_flt4</a>()<br/></li>
<li></span><span class="Comment"> * Multiply cash by float4.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L713">&#x200c;</a><span class="linkable">cash_mul_flt4</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; float4&nbsp; &nbsp; &nbsp; &nbsp; f = PG_GETARG_FLOAT4(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = rint(c * (float8) f);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L728" title="utils/adt/cash.c:728">flt4_mul_cash</a>()<br/></li>
<li></span><span class="Comment"> * Multiply float4 by cash.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L728">&#x200c;</a><span class="linkable">flt4_mul_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; float4&nbsp; &nbsp; &nbsp; &nbsp; f = PG_GETARG_FLOAT4(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = rint((float8) f * c);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L744" title="utils/adt/cash.c:744">cash_div_flt4</a>()<br/></li>
<li></span><span class="Comment"> * Divide cash by float4.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L744">&#x200c;</a><span class="linkable">cash_div_flt4</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; float4&nbsp; &nbsp; &nbsp; &nbsp; f = PG_GETARG_FLOAT4(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (f == <span class="Constant">0.0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DIVISION_BY_ZERO),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;division by zero&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = rint(c / (float8) f);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L764" title="utils/adt/cash.c:764">cash_mul_int8</a>()<br/></li>
<li></span><span class="Comment"> * Multiply cash by int8.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L764">&#x200c;</a><span class="linkable">cash_mul_int8</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; i = PG_GETARG_INT64(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c * i;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L779" title="utils/adt/cash.c:779">int8_mul_cash</a>()<br/></li>
<li></span><span class="Comment"> * Multiply int8 by cash.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L779">&#x200c;</a><span class="linkable">int8_mul_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; i = PG_GETARG_INT64(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = i * c;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L793" title="utils/adt/cash.c:793">cash_div_int8</a>()<br/></li>
<li></span><span class="Comment"> * Divide cash by 8-byte integer.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L793">&#x200c;</a><span class="linkable">cash_div_int8</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; i = PG_GETARG_INT64(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (i == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DIVISION_BY_ZERO),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;division by zero&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c / i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L814" title="utils/adt/cash.c:814">cash_mul_int4</a>()<br/></li>
<li></span><span class="Comment"> * Multiply cash by int4.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L814">&#x200c;</a><span class="linkable">cash_mul_int4</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i = PG_GETARG_INT32(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c * i;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L829" title="utils/adt/cash.c:829">int4_mul_cash</a>()<br/></li>
<li></span><span class="Comment"> * Multiply int4 by cash.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L829">&#x200c;</a><span class="linkable">int4_mul_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i = PG_GETARG_INT32(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = i * c;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L845" title="utils/adt/cash.c:845">cash_div_int4</a>()<br/></li>
<li></span><span class="Comment"> * Divide cash by 4-byte integer.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L845">&#x200c;</a><span class="linkable">cash_div_int4</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; i = PG_GETARG_INT32(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (i == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DIVISION_BY_ZERO),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;division by zero&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c / i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L866" title="utils/adt/cash.c:866">cash_mul_int2</a>()<br/></li>
<li></span><span class="Comment"> * Multiply cash by int2.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L866">&#x200c;</a><span class="linkable">cash_mul_int2</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; s = PG_GETARG_INT16(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c * s;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L880" title="utils/adt/cash.c:880">int2_mul_cash</a>()<br/></li>
<li></span><span class="Comment"> * Multiply int2 by cash.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L880">&#x200c;</a><span class="linkable">int2_mul_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; s = PG_GETARG_INT16(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = s * c;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L895" title="utils/adt/cash.c:895">cash_div_int2</a>()<br/></li>
<li></span><span class="Comment"> * Divide cash by int2.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L895">&#x200c;</a><span class="linkable">cash_div_int2</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; s = PG_GETARG_INT16(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (s == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DIVISION_BY_ZERO),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;division by zero&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = c / s;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L914" title="utils/adt/cash.c:914">cashlarger</a>()<br/></li>
<li></span><span class="Comment"> * Return larger of two cash <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L914">&#x200c;</a><span class="linkable">cashlarger</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (c1 &gt; c2) ? c1 : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L929" title="utils/adt/cash.c:929">cashsmaller</a>()<br/></li>
<li></span><span class="Comment"> * Return smaller of two cash <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L929">&#x200c;</a><span class="linkable">cashsmaller</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c1 = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; c2 = PG_GETARG_CASH(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (c1 &lt; c2) ? c1 : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L945" title="utils/adt/cash.c:945">cash_words</a>()<br/></li>
<li></span><span class="Comment"> * This converts an int4 as well but to a representation using words<br/></li>
<li></span><span class="Comment"> * Obviously way North American centric - sorry<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L945">&#x200c;</a><span class="linkable">cash_words</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; value = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; val;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; buf[<span class="Constant">256</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p = buf;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; m0;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; m1;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; m2;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; m3;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; m4;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; m5;<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; m6;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* work with positive numbers */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = -value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcpy(buf, <span class="Constant">&quot;minus &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p += <span class="Constant">6</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; buf[<span class="Constant">0</span>] = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Now treat as unsigned, to avoid trouble at INT_MIN */<br/></li>
<li></span>&nbsp; &nbsp; val = (uint64) value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; m0 = val % INT64CONST(<span class="Constant">100</span>); <span class="Comment">/* cents */<br/></li>
<li></span>&nbsp; &nbsp; m1 = (val / INT64CONST(<span class="Constant">100</span>)) % <span class="Constant">1000</span>;&nbsp; &nbsp; <span class="Comment">/* hundreds */<br/></li>
<li></span>&nbsp; &nbsp; m2 = (val / INT64CONST(<span class="Constant">100000</span>)) % <span class="Constant">1000</span>; <span class="Comment">/* thousands */<br/></li>
<li></span>&nbsp; &nbsp; m3 = (val / INT64CONST(<span class="Constant">100000000</span>)) % <span class="Constant">1000</span>;&nbsp; &nbsp; <span class="Comment">/* millions */<br/></li>
<li></span>&nbsp; &nbsp; m4 = (val / INT64CONST(<span class="Constant">100000000000</span>)) % <span class="Constant">1000</span>;&nbsp; &nbsp; <span class="Comment">/* billions */<br/></li>
<li></span>&nbsp; &nbsp; m5 = (val / INT64CONST(<span class="Constant">100000000000000</span>)) % <span class="Constant">1000</span>;&nbsp; &nbsp; <span class="Comment">/* trillions */<br/></li>
<li></span>&nbsp; &nbsp; m6 = (val / INT64CONST(<span class="Constant">100000000000000000</span>)) % <span class="Constant">1000</span>; <span class="Comment">/* quadrillions */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m6)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <a href="#L38" title="utils/adt/cash.c:38">num_word</a>(m6));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <span class="Constant">&quot; quadrillion &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m5)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <a href="#L38" title="utils/adt/cash.c:38">num_word</a>(m5));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <span class="Constant">&quot; trillion &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m4)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <a href="#L38" title="utils/adt/cash.c:38">num_word</a>(m4));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <span class="Constant">&quot; billion &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m3)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <a href="#L38" title="utils/adt/cash.c:38">num_word</a>(m3));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <span class="Constant">&quot; million &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m2)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <a href="#L38" title="utils/adt/cash.c:38">num_word</a>(m2));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <span class="Constant">&quot; thousand &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m1)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <a href="#L38" title="utils/adt/cash.c:38">num_word</a>(m1));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!*p)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(buf, <span class="Constant">&quot;zero&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; strcat(buf, (val / <span class="Constant">100</span>) == <span class="Constant">1</span> ? <span class="Constant">&quot; dollar and &quot;</span> : <span class="Constant">&quot; dollars and &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; strcat(buf, <a href="#L38" title="utils/adt/cash.c:38">num_word</a>(m0));<br/></li>
<li>&nbsp; &nbsp; strcat(buf, m0 == <span class="Constant">1</span> ? <span class="Constant">&quot; cent&quot;</span> : <span class="Constant">&quot; cents&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* capitalize output */<br/></li>
<li></span>&nbsp; &nbsp; buf[<span class="Constant">0</span>] = pg_toupper((<span class="Type">unsigned</span> <span class="Type">char</span>) buf[<span class="Constant">0</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* return as text datum */<br/></li>
<li></span>&nbsp; &nbsp; PG_RETURN_TEXT_P(<a href="varlena.c.html#L184" title="utils/adt/varlena.c:184">cstring_to_text</a>(buf));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L1032" title="utils/adt/cash.c:1032">cash_numeric</a>()<br/></li>
<li></span><span class="Comment"> * Convert cash to <a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L1032">&#x200c;</a><span class="linkable">cash_numeric</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; money = PG_GETARG_CASH(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fpoint;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> lconv *lconvert = <a href="pg_locale.c.html#L524" title="utils/adt/pg_locale.c:524">PGLC_localeconv</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* see comments about frac_digits in <a href="#L96" title="utils/adt/cash.c:96">cash_in</a>() */<br/></li>
<li></span>&nbsp; &nbsp; fpoint = lconvert-&gt;frac_digits;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fpoint &lt; <span class="Constant">0</span> || fpoint &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fpoint = <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* convert the integral money value to <a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a> */<br/></li>
<li></span>&nbsp; &nbsp; result = NumericGetDatum(<a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(money));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* scale appropriately, if needed */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (fpoint &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; scale;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; quotient;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* compute required scale factor */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; scale = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; fpoint; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a> = NumericGetDatum(<a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(scale));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Given integral inputs approaching INT64_MAX, <a href="numeric.c.html#L9777" title="utils/adt/numeric.c:9777">select_div_scale</a>()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * might choose a result scale of zero, causing loss of fractional<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * digits in the quotient.&nbsp; We can ensure an exact result by setting<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the dscale of either input to be at least as large as the desired<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * result scale.&nbsp; <a href="numeric.c.html#L1534" title="utils/adt/numeric.c:1534">numeric_round</a>() will do that for us.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a> = DirectFunctionCall2(<a href="numeric.c.html#L1534" title="utils/adt/numeric.c:1534">numeric_round</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Int32GetDatum(fpoint));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Now we can safely divide ... */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; quotient = DirectFunctionCall2(<a href="numeric.c.html#L3124" title="utils/adt/numeric.c:3124">numeric_div</a>, result, <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ... and forcibly round to exactly the intended number of digits */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; result = DirectFunctionCall2(<a href="numeric.c.html#L1534" title="utils/adt/numeric.c:1534">numeric_round</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; quotient,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Int32GetDatum(fpoint));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L1088" title="utils/adt/cash.c:1088">numeric_cash</a>()<br/></li>
<li></span><span class="Comment"> * Convert <a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a> to cash.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L1088">&#x200c;</a><span class="linkable">numeric_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; amount = PG_GETARG_DATUM(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fpoint;<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; scale;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> lconv *lconvert = <a href="pg_locale.c.html#L524" title="utils/adt/pg_locale.c:524">PGLC_localeconv</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* see comments about frac_digits in <a href="#L96" title="utils/adt/cash.c:96">cash_in</a>() */<br/></li>
<li></span>&nbsp; &nbsp; fpoint = lconvert-&gt;frac_digits;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fpoint &lt; <span class="Constant">0</span> || fpoint &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fpoint = <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* compute required scale factor */<br/></li>
<li></span>&nbsp; &nbsp; scale = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; fpoint; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; scale *= <span class="Constant">10</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* multiply the input amount by scale factor */<br/></li>
<li></span>&nbsp; &nbsp; <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a> = NumericGetDatum(<a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(scale));<br/></li>
<li>&nbsp; &nbsp; amount = DirectFunctionCall2(<a href="numeric.c.html#L3003" title="utils/adt/numeric.c:3003">numeric_mul</a>, amount, <a href="numeric.c.html#L4122" title="utils/adt/numeric.c:4122">numeric_scale</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* note that <a href="numeric.c.html#L4535" title="utils/adt/numeric.c:4535">numeric_int8</a> will round to nearest integer for us */<br/></li>
<li></span>&nbsp; &nbsp; result = DatumGetInt64(DirectFunctionCall1(<a href="numeric.c.html#L4535" title="utils/adt/numeric.c:4535">numeric_int8</a>, amount));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L1122" title="utils/adt/cash.c:1122">int4_cash</a>()<br/></li>
<li></span><span class="Comment"> * Convert int4 (int) to cash<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L1122">&#x200c;</a><span class="linkable">int4_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; amount = PG_GETARG_INT32(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fpoint;<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; scale;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> lconv *lconvert = <a href="pg_locale.c.html#L524" title="utils/adt/pg_locale.c:524">PGLC_localeconv</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* see comments about frac_digits in <a href="#L96" title="utils/adt/cash.c:96">cash_in</a>() */<br/></li>
<li></span>&nbsp; &nbsp; fpoint = lconvert-&gt;frac_digits;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fpoint &lt; <span class="Constant">0</span> || fpoint &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fpoint = <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* compute required scale factor */<br/></li>
<li></span>&nbsp; &nbsp; scale = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; fpoint; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; scale *= <span class="Constant">10</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* compute amount * scale, checking for overflow */<br/></li>
<li></span>&nbsp; &nbsp; result = DatumGetInt64(DirectFunctionCall2(<a href="int8.c.html#L490" title="utils/adt/int8.c:490">int8mul</a>, <a href="../fmgr/fmgr.c.html#L1807" title="utils/fmgr/fmgr.c:1807">Int64GetDatum</a>(amount),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../fmgr/fmgr.c.html#L1807" title="utils/fmgr/fmgr.c:1807">Int64GetDatum</a>(scale)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L1152" title="utils/adt/cash.c:1152">int8_cash</a>()<br/></li>
<li></span><span class="Comment"> * Convert int8 (bigint) to cash<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L1152">&#x200c;</a><span class="linkable">int8_cash</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; amount = PG_GETARG_INT64(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Cash&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fpoint;<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; scale;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> lconv *lconvert = <a href="pg_locale.c.html#L524" title="utils/adt/pg_locale.c:524">PGLC_localeconv</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* see comments about frac_digits in <a href="#L96" title="utils/adt/cash.c:96">cash_in</a>() */<br/></li>
<li></span>&nbsp; &nbsp; fpoint = lconvert-&gt;frac_digits;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fpoint &lt; <span class="Constant">0</span> || fpoint &gt; <span class="Constant">10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fpoint = <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* compute required scale factor */<br/></li>
<li></span>&nbsp; &nbsp; scale = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; fpoint; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; scale *= <span class="Constant">10</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* compute amount * scale, checking for overflow */<br/></li>
<li></span>&nbsp; &nbsp; result = DatumGetInt64(DirectFunctionCall2(<a href="int8.c.html#L490" title="utils/adt/int8.c:490">int8mul</a>, <a href="../fmgr/fmgr.c.html#L1807" title="utils/fmgr/fmgr.c:1807">Int64GetDatum</a>(amount),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../fmgr/fmgr.c.html#L1807" title="utils/fmgr/fmgr.c:1807">Int64GetDatum</a>(scale)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CASH(result);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
