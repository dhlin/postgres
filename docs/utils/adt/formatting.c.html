<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/formatting.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/formatting.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L387">DCHCache</a></li>
<li><a href="#L389">DCHCounter</a></li>
<li><a href="#L948">DCH_index</a></li>
<li><a href="#L775">DCH_keywords</a></li>
<li><a href="#L568">DCH_suff</a></li>
<li><a href="#L392">NUMCache</a></li>
<li><a href="#L394">NUMCounter</a></li>
<li><a href="#L972">NUM_index</a></li>
<li><a href="#L900">NUM_keywords</a></li>
<li><a href="#L216">adbc_strings</a></li>
<li><a href="#L217">adbc_strings_long</a></li>
<li><a href="#L243">ampm_strings</a></li>
<li><a href="#L244">ampm_strings_long</a></li>
<li><a href="#L183">days_short</a></li>
<li><a href="#L178">months_full</a></li>
<li><a href="#L388">n_DCHCache</a></li>
<li><a href="#L393">n_NUMCache</a></li>
<li><a href="#L270">numTH</a></li>
<li><a href="#L271">numth</a></li>
<li><a href="#L262">rm1</a></li>
<li><a href="#L263">rm10</a></li>
<li><a href="#L264">rm100</a></li>
<li><a href="#L255">rm_months_lower</a></li>
<li><a href="#L252">rm_months_upper</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L375">DCHCacheEntry</a></li>
<li><a href="#L726">DCH_poz</a></li>
<li><a href="#L159">FormatNode</a></li>
<li><a href="#L142">FromCharDateMode</a></li>
<li><a href="#L1575">ICU_Convert_Func</a></li>
<li><a href="#L128">KeySuffix</a></li>
<li><a href="#L151">KeyWord</a></li>
<li><a href="#L384">NUMCacheEntry</a></li>
<li><a href="#L295">NUMDesc</a></li>
<li><a href="#L996">NUMProc</a></li>
<li><a href="#L1023">NUMProc</a></li>
<li><a href="#L769">NUM_poz</a></li>
<li><a href="#L430">TmFromChar</a></li>
<li><a href="#L482">TmToChar</a></li>
<li><a href="#L487">TmToChar</a></li>
<li><a href="#L1925">WordBoundaryState</a></li>
<li><a href="#L469">fmt_tm</a></li>
<li><a href="#L434">fmt_tz</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L4154">DCH_cache_fetch</a></li>
<li><a href="#L4073">DCH_cache_getnew</a></li>
<li><a href="#L4133">DCH_cache_search</a></li>
<li><a href="#L3976">DCH_datetime_type</a></li>
<li><a href="#L3412">DCH_from_char</a></li>
<li><a href="#L3962">DCH_prevent_counter_overflow</a></li>
<li><a href="#L2765">DCH_to_char</a></li>
<li><a href="#L1153">NUMDesc_prepare</a></li>
<li><a href="#L5180">NUM_cache</a></li>
<li><a href="#L5152">NUM_cache_fetch</a></li>
<li><a href="#L5072">NUM_cache_getnew</a></li>
<li><a href="#L5131">NUM_cache_search</a></li>
<li><a href="#L5810">NUM_eat_non_data_chars</a></li>
<li><a href="#L5405">NUM_numpart_from_char</a></li>
<li><a href="#L5620">NUM_numpart_to_char</a></li>
<li><a href="#L5287">NUM_prepare_locale</a></li>
<li><a href="#L5060">NUM_prevent_counter_overflow</a></li>
<li><a href="#L5823">NUM_processor</a></li>
<li><a href="#L2354">adjust_partial_year_to_2020</a></li>
<li><a href="#L2204">asc_initcap</a></li>
<li><a href="#L2158">asc_tolower</a></li>
<li><a href="#L2253">asc_tolower_z</a></li>
<li><a href="#L2181">asc_toupper</a></li>
<li><a href="#L2259">asc_toupper_z</a></li>
<li><a href="#L4618">datetime_format_has_tz</a></li>
<li><a href="#L4181">datetime_to_char_body</a></li>
<li><a href="#L4681">do_to_timestamp</a></li>
<li><a href="#L2290">dump_index</a></li>
<li><a href="#L1480">dump_node</a></li>
<li><a href="#L5038">fill_str</a></li>
<li><a href="#L6727">float4_to_char</a></li>
<li><a href="#L6829">float8_to_char</a></li>
<li><a href="#L2560">from_char_parse_int</a></li>
<li><a href="#L2463">from_char_parse_int_len</a></li>
<li><a href="#L2719">from_char_seq_search</a></li>
<li><a href="#L2427">from_char_set_int</a></li>
<li><a href="#L2400">from_char_set_mode</a></li>
<li><a href="#L5369">get_last_relevant_decnum</a></li>
<li><a href="#L1516">get_th</a></li>
<li><a href="#L1581">icu_convert_case</a></li>
<li><a href="#L1099">index_seq_search</a></li>
<li><a href="#L1939">initcap_wbnext</a></li>
<li><a href="#L6527">int4_to_char</a></li>
<li><a href="#L6621">int8_to_char</a></li>
<li><a href="#L5238">int_to_roman</a></li>
<li><a href="#L4326">interval_to_char</a></li>
<li><a href="#L2321">is_next_separator</a></li>
<li><a href="#L1139">is_separator_char</a></li>
<li><a href="#L6402">numeric_to_char</a></li>
<li><a href="#L6343">numeric_to_number</a></li>
<li><a href="#L4455">parse_datetime</a></li>
<li><a href="#L1328">parse_format</a></li>
<li><a href="#L2578">seq_search_ascii</a></li>
<li><a href="#L2635">seq_search_localized</a></li>
<li><a href="#L1973">str_initcap</a></li>
<li><a href="#L2247">str_initcap_z</a></li>
<li><a href="#L1561">str_numth</a></li>
<li><a href="#L1636">str_tolower</a></li>
<li><a href="#L2235">str_tolower_z</a></li>
<li><a href="#L1784">str_toupper</a></li>
<li><a href="#L2241">str_toupper_z</a></li>
<li><a href="#L2378">strspace_len</a></li>
<li><a href="#L1123">suff_search</a></li>
<li><a href="#L4250">timestamp_to_char</a></li>
<li><a href="#L4285">timestamptz_to_char</a></li>
<li><a href="#L4407">to_date</a></li>
<li><a href="#L4368">to_timestamp</a></li>
<li><a href="#L1608">u_strToTitle_default_BI</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L194">ADJUST_YEAR</a></li>
<li><a href="#L198">AD_STR</a></li>
<li><a href="#L5398">AMOUNT_TEST</a></li>
<li><a href="#L225">AM_STR</a></li>
<li><a href="#L196">A_D_STR</a></li>
<li><a href="#L223">A_M_STR</a></li>
<li><a href="#L203">BC_STR</a></li>
<li><a href="#L201">B_C_STR</a></li>
<li><a href="#L171">CLOCK_12_HOUR</a></li>
<li><a href="#L170">CLOCK_24_HOUR</a></li>
<li><a href="#L494">COPY_tm</a></li>
<li><a href="#L365">DCH_CACHE_ENTRIES</a></li>
<li><a href="#L355">DCH_CACHE_OVERHEAD</a></li>
<li><a href="#L360">DCH_CACHE_SIZE</a></li>
<li><a href="#L1026">DCH_DATED</a></li>
<li><a href="#L99">DCH_FLAG</a></li>
<li><a href="#L114">DCH_MAX_ITEM_SIZ</a></li>
<li><a href="#L542">DCH_S_FM</a></li>
<li><a href="#L545">DCH_S_SP</a></li>
<li><a href="#L543">DCH_S_TH</a></li>
<li><a href="#L546">DCH_S_TM</a></li>
<li><a href="#L544">DCH_S_th</a></li>
<li><a href="#L1027">DCH_TIMED</a></li>
<li><a href="#L1028">DCH_ZONED</a></li>
<li><a href="#L2848">DCH_to_char_fsec</a></li>
<li><a href="#L2874">DCH_to_char_fsec</a></li>
<li><a href="#L451">DEBUG_TM</a></li>
<li><a href="#L458">DEBUG_TM</a></li>
<li><a href="#L445">DEBUG_TMFC</a></li>
<li><a href="#L457">DEBUG_TMFC</a></li>
<li><a href="#L62">DEBUG_elog_output</a></li>
<li><a href="#L1477">DUMP_FM</a></li>
<li><a href="#L1476">DUMP_THth</a></li>
<li><a href="#L525">INVALID_FOR_INTERVAL</a></li>
<li><a href="#L327">IS_BLANK</a></li>
<li><a href="#L329">IS_BRACKET</a></li>
<li><a href="#L324">IS_DECIMAL</a></li>
<li><a href="#L335">IS_EEEE</a></li>
<li><a href="#L328">IS_FILLMODE</a></li>
<li><a href="#L325">IS_LDECIMAL</a></li>
<li><a href="#L331">IS_LSIGN</a></li>
<li><a href="#L330">IS_MINUS</a></li>
<li><a href="#L334">IS_MULTI</a></li>
<li><a href="#L332">IS_PLUS</a></li>
<li><a href="#L5609">IS_PREDEC_SPACE</a></li>
<li><a href="#L333">IS_ROMAN</a></li>
<li><a href="#L326">IS_ZERO</a></li>
<li><a href="#L108">KeyWord_INDEX_FILTER</a></li>
<li><a href="#L107">KeyWord_INDEX_SIZE</a></li>
<li><a href="#L162">NODE_TYPE_ACTION</a></li>
<li><a href="#L163">NODE_TYPE_CHAR</a></li>
<li><a href="#L161">NODE_TYPE_END</a></li>
<li><a href="#L164">NODE_TYPE_SEPARATOR</a></li>
<li><a href="#L165">NODE_TYPE_SPACE</a></li>
<li><a href="#L366">NUM_CACHE_ENTRIES</a></li>
<li><a href="#L357">NUM_CACHE_OVERHEAD</a></li>
<li><a href="#L362">NUM_CACHE_SIZE</a></li>
<li><a href="#L100">NUM_FLAG</a></li>
<li><a href="#L304">NUM_F_BLANK</a></li>
<li><a href="#L307">NUM_F_BRACKET</a></li>
<li><a href="#L301">NUM_F_DECIMAL</a></li>
<li><a href="#L314">NUM_F_EEEE</a></li>
<li><a href="#L305">NUM_F_FILLMODE</a></li>
<li><a href="#L302">NUM_F_LDECIMAL</a></li>
<li><a href="#L306">NUM_F_LSIGN</a></li>
<li><a href="#L308">NUM_F_MINUS</a></li>
<li><a href="#L313">NUM_F_MINUS_POST</a></li>
<li><a href="#L311">NUM_F_MULTI</a></li>
<li><a href="#L309">NUM_F_PLUS</a></li>
<li><a href="#L312">NUM_F_PLUS_POST</a></li>
<li><a href="#L310">NUM_F_ROMAN</a></li>
<li><a href="#L303">NUM_F_ZERO</a></li>
<li><a href="#L318">NUM_LSIGN_NONE</a></li>
<li><a href="#L317">NUM_LSIGN_POST</a></li>
<li><a href="#L316">NUM_LSIGN_PRE</a></li>
<li><a href="#L115">NUM_MAX_ITEM_SIZ</a></li>
<li><a href="#L6320">NUM_TOCHAR_finish</a></li>
<li><a href="#L6307">NUM_TOCHAR_prepare</a></li>
<li><a href="#L5397">OVERLOAD_TEST</a></li>
<li><a href="#L230">PM_STR</a></li>
<li><a href="#L228">P_M_STR</a></li>
<li><a href="#L2273">SKIP_THth</a></li>
<li><a href="#L101">STD_FLAG</a></li>
<li><a href="#L168">SUFFTYPE_POSTFIX</a></li>
<li><a href="#L167">SUFFTYPE_PREFIX</a></li>
<li><a href="#L558">S_FM</a></li>
<li><a href="#L559">S_SP</a></li>
<li><a href="#L553">S_TH</a></li>
<li><a href="#L555">S_TH_TYPE</a></li>
<li><a href="#L552">S_THth</a></li>
<li><a href="#L560">S_TM</a></li>
<li><a href="#L554">S_th</a></li>
<li><a href="#L278">TH_LOWER</a></li>
<li><a href="#L277">TH_UPPER</a></li>
<li><a href="#L566">TM_SUFFIX_LEN</a></li>
<li><a href="#L508">ZERO_tm</a></li>
<li><a href="#L432">ZERO_tmfc</a></li>
<li><a href="#L514">ZERO_tmtc</a></li>
<li><a href="#L197">a_d_STR</a></li>
<li><a href="#L224">a_m_STR</a></li>
<li><a href="#L199">ad_STR</a></li>
<li><a href="#L226">am_STR</a></li>
<li><a href="#L202">b_c_STR</a></li>
<li><a href="#L204">bc_STR</a></li>
<li><a href="#L229">p_m_STR</a></li>
<li><a href="#L231">pm_STR</a></li>
<li><a href="#L491">tmtcFsec</a></li>
<li><a href="#L489">tmtcTm</a></li>
<li><a href="#L490">tmtcTzn</a></li>
<li><a href="#L5045">zeroize_NUM</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/* -----------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> * formatting.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * src/backend/utils/adt/formatting.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; Portions Copyright (c) 1999-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; TO_CHAR(); TO_TIMESTAMP(); TO_DATE(); TO_NUMBER();<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; The PostgreSQL routines for a timestamp/int/float/<a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a> formatting,<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; inspired by the Oracle TO_CHAR() / TO_DATE() / TO_NUMBER() routines.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; Cache &amp; Memory:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Routines use (itself) <a href="pseudotypes.c.html#L373" title="utils/adt/pseudotypes.c:373">internal</a> cache for format pictures.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; The cache uses a static buffer and is persistent across transactions.&nbsp; If<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; the format-picture is bigger than the cache buffer, the parser is called<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; always.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; <a href="../../regex/regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> for Number version:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; All in this version is implemented as keywords ( =&gt; not used<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; suffixes), because a format picture is for *one* item (number)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; only. It not is as a timestamp version, where each keyword (can)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; has suffix.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; <a href="../../regex/regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> for Timestamp routines:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; In this module the POSIX 'struct tm' type is *not* used, but rather<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; PgSQL type, which has tm_mon based on one (*non* zero) and<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; year *not* based on 1900, but is used full year number.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Module supports AD / BC / AM / PM.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Supported types for to_char():<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Timestamp, Numeric, int4, int8, float4, float8<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Supported types for reverse conversion:<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Timestamp&nbsp; &nbsp; - <a href="#L4368" title="utils/adt/formatting.c:4368">to_timestamp</a>()<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Date&nbsp; &nbsp; &nbsp; &nbsp; - <a href="#L4407" title="utils/adt/formatting.c:4407">to_date</a>()<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; - to_number()<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Karel Zak<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * </span><span class="Todo">TODO<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - better number building (formatting) / parsing, <a href="timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> it isn't<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ideal code<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - use Assert()<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - add support for roman number to standard number conversion<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - add support for number spelling<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - add support for string to string formatting (we must be better<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; than Oracle :-),<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; to_char('Hello', 'X X X X X') -&gt; 'H e l l o'<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * -----------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li><a id="L62">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DEBUG_elog_output</span>&nbsp; &nbsp; DEBUG3<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ctype.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;unistd.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;math.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;float.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;limits.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;wctype.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef USE_ICU<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;unicode/ustring.h&gt;<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_collation.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_type.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;common/unicode_case.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;common/unicode_category.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;mb/pg_wchar.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;nodes/miscnodes.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;parser/scansup.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/date.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/datetime.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/formatting.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/memutils.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/<a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a>.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/pg_locale.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;varatt.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Routines flags<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L99">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_FLAG</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x1</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* DATE-TIME flag&nbsp; &nbsp; */<br/></li>
<li><a id="L100">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_FLAG</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x2</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* NUMBER flag&nbsp; &nbsp; */<br/></li>
<li><a id="L101">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">STD_FLAG</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x4</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* STANDARD flag&nbsp; &nbsp; */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> Index (<a href="oracle_compat.c.html#L925" title="utils/adt/oracle_compat.c:925">ascii</a> from position 32 (' ') to 126 (~))<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L107">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">KeyWord_INDEX_SIZE</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">'~'</span><span class="PreProc"> - </span><span class="Constant">' '</span><span class="PreProc">)<br/></li>
<li><a id="L108">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">KeyWord_INDEX_FILTER</span>(_c)&nbsp; &nbsp; ((_c) &lt;= </span><span class="Constant">' '</span><span class="PreProc"> || (_c) &gt;= </span><span class="Constant">'~'</span><span class="PreProc"> ? </span><span class="Constant">0</span><span class="PreProc"> : </span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Maximal length of one node<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L114">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_MAX_ITEM_SIZ</span>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">12</span><span class="PreProc">&nbsp; &nbsp; </span><span class="Comment">/* max localized day name&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L115">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_MAX_ITEM_SIZ</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">8</span><span class="PreProc">&nbsp; &nbsp; </span><span class="Comment">/* roman number (RN has 15 chars)&nbsp; &nbsp; */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Format parser structs<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *name;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* suffix string&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* suffix length&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; id,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* used in node-&gt;suffix */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* prefix / postfix&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L128">&#x200c;</a></span>} <span class="linkable">KeySuffix</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * <a href="#L142" title="utils/adt/formatting.c:142">FromCharDateMode</a><br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This value is used to nominate one of several distinct (and mutually<br/></li>
<li></span><span class="Comment"> * exclusive) date conventions that a keyword can belong to.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">enum<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; FROM_CHAR_DATE_NONE = <span class="Constant">0</span>,&nbsp; &nbsp; <span class="Comment">/* Value does not affect date mode. */<br/></li>
<li></span>&nbsp; &nbsp; FROM_CHAR_DATE_GREGORIAN,&nbsp; &nbsp; <span class="Comment">/* Gregorian (day, month, year) style date */<br/></li>
<li></span>&nbsp; &nbsp; FROM_CHAR_DATE_ISOWEEK,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ISO 8601 week date */<br/></li>
<li><a id="L142">&#x200c;</a></span>} <span class="linkable">FromCharDateMode</span>;<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *name;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; id;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; is_digit;<br/></li>
<li>&nbsp; &nbsp; <a href="#L142" title="utils/adt/formatting.c:142">FromCharDateMode</a> date_mode;<br/></li>
<li><a id="L151">&#x200c;</a>} <span class="linkable">KeyWord</span>;<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; uint8&nbsp; &nbsp; &nbsp; &nbsp; type;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* NODE_TYPE_XXX, see below */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; character[MAX_MULTIBYTE_CHAR_LEN + <span class="Constant">1</span>];&nbsp; &nbsp; <span class="Comment">/* if type is CHAR */<br/></li>
<li></span>&nbsp; &nbsp; uint8&nbsp; &nbsp; &nbsp; &nbsp; suffix;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* keyword prefix/suffix code, if <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *key;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* if type is ACTION */<br/></li>
<li><a id="L159">&#x200c;</a></span>} <span class="linkable">FormatNode</span>;<br/></li>
<li><br/></li>
<li><a id="L161">&#x200c;</a><span class="PreProc">#define <span class="linkable">NODE_TYPE_END</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">1<br/></li>
<li><a id="L162">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NODE_TYPE_ACTION</span>&nbsp; &nbsp; </span><span class="Constant">2<br/></li>
<li><a id="L163">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NODE_TYPE_CHAR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">3<br/></li>
<li><a id="L164">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NODE_TYPE_SEPARATOR</span>&nbsp; &nbsp; </span><span class="Constant">4<br/></li>
<li><a id="L165">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NODE_TYPE_SPACE</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">5<br/></li>
<li></span><br/></li>
<li><a id="L167">&#x200c;</a><span class="PreProc">#define <span class="linkable">SUFFTYPE_PREFIX</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">1<br/></li>
<li><a id="L168">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SUFFTYPE_POSTFIX</span>&nbsp; &nbsp; </span><span class="Constant">2<br/></li>
<li></span><br/></li>
<li><a id="L170">&#x200c;</a><span class="PreProc">#define <span class="linkable">CLOCK_24_HOUR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0<br/></li>
<li><a id="L171">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">CLOCK_12_HOUR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">1<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Full <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a><br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L178">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">months_full</span>[] = {<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">&quot;January&quot;</span>, <span class="Constant">&quot;February&quot;</span>, <span class="Constant">&quot;March&quot;</span>, <span class="Constant">&quot;April&quot;</span>, <span class="Constant">&quot;May&quot;</span>, <span class="Constant">&quot;June&quot;</span>, <span class="Constant">&quot;July&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">&quot;August&quot;</span>, <span class="Constant">&quot;September&quot;</span>, <span class="Constant">&quot;October&quot;</span>, <span class="Constant">&quot;November&quot;</span>, <span class="Constant">&quot;December&quot;</span>, <span class="Constant">NULL<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><a id="L183">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">days_short</span>[] = {<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">&quot;Sun&quot;</span>, <span class="Constant">&quot;Mon&quot;</span>, <span class="Constant">&quot;Tue&quot;</span>, <span class="Constant">&quot;Wed&quot;</span>, <span class="Constant">&quot;Thu&quot;</span>, <span class="Constant">&quot;Fri&quot;</span>, <span class="Constant">&quot;Sat&quot;</span>, <span class="Constant">NULL<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * AD / BC<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; There is no 0 AD.&nbsp; Years go from 1 BC to 1 AD, so we make it<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; positive and map year == -1 to year zero, and shift all negative<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; years up one.&nbsp; For interval years, we just return the year.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L194">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ADJUST_YEAR</span>(year, is_interval)&nbsp; &nbsp; ((is_interval) ? (year) : ((year) &lt;= </span><span class="Constant">0</span><span class="PreProc"> ? -((year) - </span><span class="Constant">1</span><span class="PreProc">) : (year)))<br/></li>
<li></span><br/></li>
<li><a id="L196">&#x200c;</a><span class="PreProc">#define <span class="linkable">A_D_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;A.D.&quot;<br/></li>
<li><a id="L197">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">a_d_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;a.d.&quot;<br/></li>
<li><a id="L198">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">AD_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;AD&quot;<br/></li>
<li><a id="L199">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ad_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;ad&quot;<br/></li>
<li></span><br/></li>
<li><a id="L201">&#x200c;</a><span class="PreProc">#define <span class="linkable">B_C_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;B.C.&quot;<br/></li>
<li><a id="L202">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">b_c_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;b.c.&quot;<br/></li>
<li><a id="L203">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">BC_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;BC&quot;<br/></li>
<li><a id="L204">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">bc_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;bc&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * AD / BC strings for seq_search.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * These are given in two variants, a long form with periods and a standard<br/></li>
<li></span><span class="Comment"> * form without.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The array is laid out such that matches for AD have an even index, and<br/></li>
<li></span><span class="Comment"> * matches for BC have an odd index.&nbsp; So the boolean value for BC is given by<br/></li>
<li></span><span class="Comment"> * taking the array index of the match, modulo 2.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L216">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">adbc_strings</span>[] = {<a href="#L199" title="utils/adt/formatting.c:199">ad_STR</a>, <a href="#L204" title="utils/adt/formatting.c:204">bc_STR</a>, <a href="#L198" title="utils/adt/formatting.c:198">AD_STR</a>, <a href="#L203" title="utils/adt/formatting.c:203">BC_STR</a>, <span class="Constant">NULL</span>};<br/></li>
<li><a id="L217">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">adbc_strings_long</span>[] = {<a href="#L197" title="utils/adt/formatting.c:197">a_d_STR</a>, <a href="#L202" title="utils/adt/formatting.c:202">b_c_STR</a>, <a href="#L196" title="utils/adt/formatting.c:196">A_D_STR</a>, <a href="#L201" title="utils/adt/formatting.c:201">B_C_STR</a>, <span class="Constant">NULL</span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * AM / PM<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L223">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">A_M_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;A.M.&quot;<br/></li>
<li><a id="L224">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">a_m_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;a.m.&quot;<br/></li>
<li><a id="L225">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">AM_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;AM&quot;<br/></li>
<li><a id="L226">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">am_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;am&quot;<br/></li>
<li></span><br/></li>
<li><a id="L228">&#x200c;</a><span class="PreProc">#define <span class="linkable">P_M_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;P.M.&quot;<br/></li>
<li><a id="L229">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">p_m_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;p.m.&quot;<br/></li>
<li><a id="L230">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PM_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;PM&quot;<br/></li>
<li><a id="L231">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">pm_STR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;pm&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * AM / PM strings for seq_search.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * These are given in two variants, a long form with periods and a standard<br/></li>
<li></span><span class="Comment"> * form without.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The array is laid out such that matches for AM have an even index, and<br/></li>
<li></span><span class="Comment"> * matches for PM have an odd index.&nbsp; So the boolean value for PM is given by<br/></li>
<li></span><span class="Comment"> * taking the array index of the match, modulo 2.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L243">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">ampm_strings</span>[] = {<a href="#L226" title="utils/adt/formatting.c:226">am_STR</a>, <a href="#L231" title="utils/adt/formatting.c:231">pm_STR</a>, <a href="#L225" title="utils/adt/formatting.c:225">AM_STR</a>, <a href="#L230" title="utils/adt/formatting.c:230">PM_STR</a>, <span class="Constant">NULL</span>};<br/></li>
<li><a id="L244">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">ampm_strings_long</span>[] = {<a href="#L224" title="utils/adt/formatting.c:224">a_m_STR</a>, <a href="#L229" title="utils/adt/formatting.c:229">p_m_STR</a>, <a href="#L223" title="utils/adt/formatting.c:223">A_M_STR</a>, <a href="#L228" title="utils/adt/formatting.c:228">P_M_STR</a>, <span class="Constant">NULL</span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Months in roman-numeral<br/></li>
<li></span><span class="Comment"> * (Must be in reverse order for seq_search (in FROM_CHAR), because<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 'VIII' must have higher precedence than 'V')<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L252">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">rm_months_upper</span>[] =<br/></li>
<li>{<span class="Constant">&quot;XII&quot;</span>, <span class="Constant">&quot;XI&quot;</span>, <span class="Constant">&quot;X&quot;</span>, <span class="Constant">&quot;IX&quot;</span>, <span class="Constant">&quot;VIII&quot;</span>, <span class="Constant">&quot;VII&quot;</span>, <span class="Constant">&quot;VI&quot;</span>, <span class="Constant">&quot;V&quot;</span>, <span class="Constant">&quot;IV&quot;</span>, <span class="Constant">&quot;III&quot;</span>, <span class="Constant">&quot;II&quot;</span>, <span class="Constant">&quot;I&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li><br/></li>
<li><a id="L255">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">rm_months_lower</span>[] =<br/></li>
<li>{<span class="Constant">&quot;xii&quot;</span>, <span class="Constant">&quot;xi&quot;</span>, <span class="Constant">&quot;x&quot;</span>, <span class="Constant">&quot;ix&quot;</span>, <span class="Constant">&quot;viii&quot;</span>, <span class="Constant">&quot;vii&quot;</span>, <span class="Constant">&quot;vi&quot;</span>, <span class="Constant">&quot;v&quot;</span>, <span class="Constant">&quot;iv&quot;</span>, <span class="Constant">&quot;iii&quot;</span>, <span class="Constant">&quot;ii&quot;</span>, <span class="Constant">&quot;i&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Roman numbers<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L262">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">rm1</span>[] = {<span class="Constant">&quot;I&quot;</span>, <span class="Constant">&quot;II&quot;</span>, <span class="Constant">&quot;III&quot;</span>, <span class="Constant">&quot;IV&quot;</span>, <span class="Constant">&quot;V&quot;</span>, <span class="Constant">&quot;VI&quot;</span>, <span class="Constant">&quot;VII&quot;</span>, <span class="Constant">&quot;VIII&quot;</span>, <span class="Constant">&quot;IX&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li><a id="L263">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">rm10</span>[] = {<span class="Constant">&quot;X&quot;</span>, <span class="Constant">&quot;XX&quot;</span>, <span class="Constant">&quot;XXX&quot;</span>, <span class="Constant">&quot;XL&quot;</span>, <span class="Constant">&quot;L&quot;</span>, <span class="Constant">&quot;LX&quot;</span>, <span class="Constant">&quot;LXX&quot;</span>, <span class="Constant">&quot;LXXX&quot;</span>, <span class="Constant">&quot;XC&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li><a id="L264">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">rm100</span>[] = {<span class="Constant">&quot;C&quot;</span>, <span class="Constant">&quot;CC&quot;</span>, <span class="Constant">&quot;CCC&quot;</span>, <span class="Constant">&quot;CD&quot;</span>, <span class="Constant">&quot;D&quot;</span>, <span class="Constant">&quot;DC&quot;</span>, <span class="Constant">&quot;DCC&quot;</span>, <span class="Constant">&quot;DCCC&quot;</span>, <span class="Constant">&quot;CM&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Ordinal postfixes<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L270">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">numTH</span>[] = {<span class="Constant">&quot;ST&quot;</span>, <span class="Constant">&quot;ND&quot;</span>, <span class="Constant">&quot;RD&quot;</span>, <span class="Constant">&quot;TH&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li><a id="L271">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> <span class="linkable">numth</span>[] = {<span class="Constant">&quot;st&quot;</span>, <span class="Constant">&quot;nd&quot;</span>, <span class="Constant">&quot;rd&quot;</span>, <span class="Constant">&quot;th&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Flags &amp; Options:<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L277">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">TH_UPPER</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">1<br/></li>
<li><a id="L278">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">TH_LOWER</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">2<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Number description struct<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pre,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* (count) numbers <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> decimal */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; post,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* (count) numbers after decimal&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lsign,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* want locales sign&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* number parameters&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pre_lsign_num,&nbsp; &nbsp; <span class="Comment">/* tmp value for lsign&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; multi,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* multiplier for 'V'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_start,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* position of first zero&nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero_end,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* position of last zero&nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; need_locale;&nbsp; &nbsp; <span class="Comment">/* needs it locale&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L295">&#x200c;</a></span>} <span class="linkable">NUMDesc</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Flags for NUMBER version<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L301">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_DECIMAL</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li><a id="L302">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_LDECIMAL</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">2</span><span class="PreProc">)<br/></li>
<li><a id="L303">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_ZERO</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">3</span><span class="PreProc">)<br/></li>
<li><a id="L304">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_BLANK</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">4</span><span class="PreProc">)<br/></li>
<li><a id="L305">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_FILLMODE</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">5</span><span class="PreProc">)<br/></li>
<li><a id="L306">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_LSIGN</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">6</span><span class="PreProc">)<br/></li>
<li><a id="L307">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_BRACKET</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">7</span><span class="PreProc">)<br/></li>
<li><a id="L308">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_MINUS</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">8</span><span class="PreProc">)<br/></li>
<li><a id="L309">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_PLUS</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">9</span><span class="PreProc">)<br/></li>
<li><a id="L310">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_ROMAN</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">10</span><span class="PreProc">)<br/></li>
<li><a id="L311">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_MULTI</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">11</span><span class="PreProc">)<br/></li>
<li><a id="L312">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_PLUS_POST</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">12</span><span class="PreProc">)<br/></li>
<li><a id="L313">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_MINUS_POST</span>&nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">13</span><span class="PreProc">)<br/></li>
<li><a id="L314">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_F_EEEE</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">1</span><span class="PreProc"> &lt;&lt; </span><span class="Constant">14</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><a id="L316">&#x200c;</a><span class="PreProc">#define <span class="linkable">NUM_LSIGN_PRE</span>&nbsp; &nbsp; (-</span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li><a id="L317">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_LSIGN_POST</span>&nbsp; &nbsp; </span><span class="Constant">1<br/></li>
<li><a id="L318">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_LSIGN_NONE</span>&nbsp; &nbsp; </span><span class="Constant">0<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Tests<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L324">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_DECIMAL</span>(_f)&nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L301" title="utils/adt/formatting.c:301">NUM_F_DECIMAL</a>)<br/></li>
<li><a id="L325">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_LDECIMAL</span>(_f) ((_f)-&gt;flag &amp; <a href="#L302" title="utils/adt/formatting.c:302">NUM_F_LDECIMAL</a>)<br/></li>
<li><a id="L326">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_ZERO</span>(_f) ((_f)-&gt;flag &amp; <a href="#L303" title="utils/adt/formatting.c:303">NUM_F_ZERO</a>)<br/></li>
<li><a id="L327">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_BLANK</span>(_f)&nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L304" title="utils/adt/formatting.c:304">NUM_F_BLANK</a>)<br/></li>
<li><a id="L328">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_FILLMODE</span>(_f) ((_f)-&gt;flag &amp; <a href="#L305" title="utils/adt/formatting.c:305">NUM_F_FILLMODE</a>)<br/></li>
<li><a id="L329">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_BRACKET</span>(_f)&nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L307" title="utils/adt/formatting.c:307">NUM_F_BRACKET</a>)<br/></li>
<li><a id="L330">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_MINUS</span>(_f)&nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L308" title="utils/adt/formatting.c:308">NUM_F_MINUS</a>)<br/></li>
<li><a id="L331">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_LSIGN</span>(_f)&nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L306" title="utils/adt/formatting.c:306">NUM_F_LSIGN</a>)<br/></li>
<li><a id="L332">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_PLUS</span>(_f) ((_f)-&gt;flag &amp; <a href="#L309" title="utils/adt/formatting.c:309">NUM_F_PLUS</a>)<br/></li>
<li><a id="L333">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_ROMAN</span>(_f)&nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L310" title="utils/adt/formatting.c:310">NUM_F_ROMAN</a>)<br/></li>
<li><a id="L334">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_MULTI</span>(_f)&nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L311" title="utils/adt/formatting.c:311">NUM_F_MULTI</a>)<br/></li>
<li><a id="L335">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">IS_EEEE</span>(_f)&nbsp; &nbsp; &nbsp; &nbsp; ((_f)-&gt;flag &amp; <a href="#L314" title="utils/adt/formatting.c:314">NUM_F_EEEE</a>)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Format picture cache<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We will cache datetime format pictures up to <a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a> bytes long;<br/></li>
<li></span><span class="Comment"> * likewise number format pictures up to <a href="#L362" title="utils/adt/formatting.c:362">NUM_CACHE_SIZE</a> bytes long.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * For simplicity, the cache entries are fixed-size, so they allow for the<br/></li>
<li></span><span class="Comment"> * worst case of a <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> for each byte in the picture string.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The CACHE_SIZE constants are computed to make <a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a>(<a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a>) and<br/></li>
<li></span><span class="Comment"> * <a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a>(<a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a>) be powers of 2, or just less than that, so that<br/></li>
<li></span><span class="Comment"> * we don't waste too much space by <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'ing them individually.&nbsp; Be sure<br/></li>
<li></span><span class="Comment"> * to adjust those macros if you add fields to those structs.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The max number of entries in each cache is <a href="#L365" title="utils/adt/formatting.c:365">DCH_CACHE_ENTRIES</a><br/></li>
<li></span><span class="Comment"> * resp. <a href="#L366" title="utils/adt/formatting.c:366">NUM_CACHE_ENTRIES</a>.<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L355">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_CACHE_OVERHEAD</span> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; MAXALIGN(</span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(</span><span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span><span class="PreProc">) + </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(</span><span class="Type">int</span><span class="PreProc">))<br/></li>
<li><a id="L357">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_CACHE_OVERHEAD</span> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; MAXALIGN(</span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(</span><span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span><span class="PreProc">) + </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(</span><span class="Type">int</span><span class="PreProc">) + </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(<a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>))<br/></li>
<li></span><br/></li>
<li><a id="L360">&#x200c;</a><span class="PreProc">#define <span class="linkable">DCH_CACHE_SIZE</span> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; ((</span><span class="Constant">2048</span><span class="PreProc"> - <a href="#L355" title="utils/adt/formatting.c:355">DCH_CACHE_OVERHEAD</a>) / (</span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>) + </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(</span><span class="Type">char</span><span class="PreProc">)) - </span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li><a id="L362">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_CACHE_SIZE</span> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; ((</span><span class="Constant">1024</span><span class="PreProc"> - <a href="#L357" title="utils/adt/formatting.c:357">NUM_CACHE_OVERHEAD</a>) / (</span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>) + </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(</span><span class="Type">char</span><span class="PreProc">)) - </span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><a id="L365">&#x200c;</a><span class="PreProc">#define <span class="linkable">DCH_CACHE_ENTRIES</span>&nbsp; &nbsp; </span><span class="Constant">20<br/></li>
<li><a id="L366">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_CACHE_ENTRIES</span>&nbsp; &nbsp; </span><span class="Constant">20<br/></li>
<li></span><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>&nbsp; &nbsp; format[<a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a> + <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; str[<a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a> + <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; std;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; valid;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; age;<br/></li>
<li><a id="L375">&#x200c;</a>} <span class="linkable">DCHCacheEntry</span>;<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>&nbsp; &nbsp; format[<a href="#L362" title="utils/adt/formatting.c:362">NUM_CACHE_SIZE</a> + <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; str[<a href="#L362" title="utils/adt/formatting.c:362">NUM_CACHE_SIZE</a> + <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; valid;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; age;<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; &nbsp; &nbsp; Num;<br/></li>
<li><a id="L384">&#x200c;</a>} <span class="linkable">NUMCacheEntry</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/* global cache for date/time format pictures */<br/></li>
<li><a id="L387">&#x200c;</a></span><span class="Type">static</span> <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *<span class="linkable">DCHCache</span>[<a href="#L365" title="utils/adt/formatting.c:365">DCH_CACHE_ENTRIES</a>];<br/></li>
<li><a id="L388">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">n_DCHCache</span> = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* current number of entries */<br/></li>
<li><a id="L389">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">DCHCounter</span> = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* aging-event counter */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* global cache for number format pictures */<br/></li>
<li><a id="L392">&#x200c;</a></span><span class="Type">static</span> <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *<span class="linkable">NUMCache</span>[<a href="#L366" title="utils/adt/formatting.c:366">NUM_CACHE_ENTRIES</a>];<br/></li>
<li><a id="L393">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">n_NUMCache</span> = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* current number of entries */<br/></li>
<li><a id="L394">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <span class="linkable">NUMCounter</span> = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* aging-event counter */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * For char-&gt;date/time conversion<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L142" title="utils/adt/formatting.c:142">FromCharDateMode</a> mode;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hh,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mi,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ssss,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* stored as 1-7, Sunday = 1, 0 means missing */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ddd,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ms,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; year,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bc,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ww,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cc,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; us,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yysz,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* is it YY or YYYY ? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clock,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 12 or 24 hour clock? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tzsign,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* +1, -1, or 0 if no TZH/TZM fields */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tzh,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tzm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ff;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fractional precision */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; has_tz;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* was there a TZ field? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gmtoffset;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* GMT offset of fixed-offset zone abbrev */<br/></li>
<li></span>&nbsp; &nbsp; pg_tz&nbsp; &nbsp; &nbsp;&nbsp; *tzp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* pg_tz for dynamic abbrev */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *abbrev;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* dynamic abbrev */<br/></li>
<li><a id="L430">&#x200c;</a></span>} <span class="linkable">TmFromChar</span>;<br/></li>
<li><br/></li>
<li><a id="L432">&#x200c;</a><span class="PreProc">#define <span class="linkable">ZERO_tmfc</span>(_X) memset(_X, </span><span class="Constant">0</span><span class="PreProc">, </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(<a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a>))<br/></li>
<li></span><br/></li>
<li><a id="L434">&#x200c;</a><span class="Type">struct</span> <span class="linkable">fmt_tz</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>'s timezone info output */<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; has_tz;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* was there <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> TZ/TZH/TZM field? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gmtoffset;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* GMT offset in seconds */<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Debug<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li><a id="L445">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DEBUG_TMFC</span>(_X) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, </span><span class="Constant">&quot;TMFC:</span><span class="Special">\n</span><span class="Constant">mode </span><span class="Special">%d\n</span><span class="Constant">hh </span><span class="Special">%d\n</span><span class="Constant">pm </span><span class="Special">%d\n</span><span class="Constant">mi </span><span class="Special">%d\n</span><span class="Constant">ss </span><span class="Special">%d\n</span><span class="Constant">ssss </span><span class="Special">%d\n</span><span class="Constant">d </span><span class="Special">%d\n</span><span class="Constant">dd </span><span class="Special">%d\n</span><span class="Constant">ddd </span><span class="Special">%d\n</span><span class="Constant">mm </span><span class="Special">%d\n</span><span class="Constant">ms: </span><span class="Special">%d\n</span><span class="Constant">year </span><span class="Special">%d\n</span><span class="Constant">bc </span><span class="Special">%d\n</span><span class="Constant">ww </span><span class="Special">%d\n</span><span class="Constant">w </span><span class="Special">%d\n</span><span class="Constant">cc </span><span class="Special">%d\n</span><span class="Constant">j </span><span class="Special">%d\n</span><span class="Constant">us: </span><span class="Special">%d\n</span><span class="Constant">yysz: </span><span class="Special">%d\n</span><span class="Constant">clock: </span><span class="Special">%d</span><span class="Constant">&quot;</span><span class="PreProc">, \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (_X)-&gt;mode, (_X)-&gt;hh, (_X)-&gt;pm, (_X)-&gt;mi, (_X)-&gt;ss, (_X)-&gt;ssss, \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (_X)-&gt;d, (_X)-&gt;dd, (_X)-&gt;ddd, (_X)-&gt;mm, (_X)-&gt;ms, (_X)-&gt;year, \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (_X)-&gt;bc, (_X)-&gt;ww, (_X)-&gt;w, (_X)-&gt;cc, (_X)-&gt;j, (_X)-&gt;us, \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (_X)-&gt;yysz, (_X)-&gt;clock)<br/></li>
<li><a id="L451">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DEBUG_TM</span>(_X) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, </span><span class="Constant">&quot;TM:</span><span class="Special">\n</span><span class="Constant">sec </span><span class="Special">%d\n</span><span class="Constant">year </span><span class="Special">%d\n</span><span class="Constant">min </span><span class="Special">%d\n</span><span class="Constant">wday </span><span class="Special">%d\n</span><span class="Constant">hour </span><span class="Special">%d\n</span><span class="Constant">yday </span><span class="Special">%d\n</span><span class="Constant">mday </span><span class="Special">%d\n</span><span class="Constant">nisdst </span><span class="Special">%d\n</span><span class="Constant">mon </span><span class="Special">%d\n</span><span class="Constant">&quot;</span><span class="PreProc">,\<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (_X)-&gt;tm_sec, (_X)-&gt;tm_year,\<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (_X)-&gt;tm_min, (_X)-&gt;tm_wday, (_X)-&gt;tm_hour, (_X)-&gt;tm_yday,\<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (_X)-&gt;tm_mday, (_X)-&gt;tm_isdst, (_X)-&gt;tm_mon)<br/></li>
<li></span><span class="PreProc">#else<br/></li>
<li><a id="L457">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DEBUG_TMFC</span>(_X)<br/></li>
<li><a id="L458">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DEBUG_TM</span>(_X)<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Datetime to char conversion<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * To support intervals as well as timestamps, we use a custom &quot;tm&quot; struct<br/></li>
<li></span><span class="Comment"> * that is almost like struct pg_tm, but has a 64-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> tm_hour field.<br/></li>
<li></span><span class="Comment"> * We omit the tm_isdst and tm_zone fields, which are not used here.<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L469">&#x200c;</a></span><span class="Type">struct</span> <span class="linkable">fmt_tm</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm_sec;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm_min;<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; tm_hour;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm_mday;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm_mon;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm_year;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm_wday;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm_yday;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">long</span> <span class="Type">int</span>&nbsp; &nbsp; tm_gmtoff;<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><a id="L482">&#x200c;</a><span class="Type">typedef</span> <span class="Type">struct</span> <span class="linkable">TmToChar</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L469" title="utils/adt/formatting.c:469">fmt_tm</a> tm;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* almost the classic 'tm' struct */<br/></li>
<li></span>&nbsp; &nbsp; fsec_t&nbsp; &nbsp; &nbsp; &nbsp; fsec;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fractional seconds */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *tzn;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* timezone */<br/></li>
<li><a id="L487">&#x200c;</a></span>} <span class="linkable">TmToChar</span>;<br/></li>
<li><br/></li>
<li><a id="L489">&#x200c;</a><span class="PreProc">#define <span class="linkable">tmtcTm</span>(_X)&nbsp; &nbsp; (&amp;(_X)-&gt;tm)<br/></li>
<li><a id="L490">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">tmtcTzn</span>(_X) ((_X)-&gt;tzn)<br/></li>
<li><a id="L491">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">tmtcFsec</span>(_X)&nbsp; &nbsp; ((_X)-&gt;fsec)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Note: this is used to copy pg_tm to <a href="#L469" title="utils/adt/formatting.c:469">fmt_tm</a>, so not quite a bitwise copy */<br/></li>
<li><a id="L494">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">COPY_tm</span>(_DST, _SRC) \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> {&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_sec = (_SRC)-&gt;tm_sec; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_min = (_SRC)-&gt;tm_min; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_hour = (_SRC)-&gt;tm_hour; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_mday = (_SRC)-&gt;tm_mday; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_mon = (_SRC)-&gt;tm_mon; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_year = (_SRC)-&gt;tm_year; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_wday = (_SRC)-&gt;tm_wday; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_yday = (_SRC)-&gt;tm_yday; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_DST)-&gt;tm_gmtoff = (_SRC)-&gt;tm_gmtoff; \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Caution: this is used to zero both pg_tm and <a href="#L469" title="utils/adt/formatting.c:469">fmt_tm</a> structs */<br/></li>
<li><a id="L508">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ZERO_tm</span>(_X) \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> {&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; memset(_X, </span><span class="Constant">0</span><span class="PreProc">, </span><span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span><span class="PreProc">(*(_X))); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_X)-&gt;tm_mday = (_X)-&gt;tm_mon = </span><span class="Constant">1</span><span class="PreProc">; \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><a id="L514">&#x200c;</a><span class="PreProc">#define <span class="linkable">ZERO_tmtc</span>(_X) \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> { \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="#L508" title="utils/adt/formatting.c:508">ZERO_tm</a>( <a href="#L489" title="utils/adt/formatting.c:489">tmtcTm</a>(_X) ); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="#L491" title="utils/adt/formatting.c:491">tmtcFsec</a>(_X) = </span><span class="Constant">0</span><span class="PreProc">; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="#L490" title="utils/adt/formatting.c:490">tmtcTzn</a>(_X) = </span><span class="Constant">NULL</span><span class="PreProc">; \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; to_char(time) appears to to_char() as an interval, so this check<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; is really for interval and time data types.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L525">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">INVALID_FOR_INTERVAL</span>&nbsp; \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> { \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (is_interval) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR, \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT), \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(</span><span class="Constant">&quot;invalid format specification for an interval value&quot;</span><span class="PreProc">), \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(</span><span class="Constant">&quot;Intervals are not tied to specific calendar dates.&quot;</span><span class="PreProc">))); \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*****************************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> definitions<br/></li>
<li></span><span class="Comment"> *****************************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Suffixes (<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>.suffix is an OR of these codes)<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L542">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_S_FM</span>&nbsp; &nbsp; </span><span class="Constant">0x01<br/></li>
<li><a id="L543">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_S_TH</span>&nbsp; &nbsp; </span><span class="Constant">0x02<br/></li>
<li><a id="L544">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_S_th</span>&nbsp; &nbsp; </span><span class="Constant">0x04<br/></li>
<li><a id="L545">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_S_SP</span>&nbsp; &nbsp; </span><span class="Constant">0x08<br/></li>
<li><a id="L546">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_S_TM</span>&nbsp; &nbsp; </span><span class="Constant">0x10<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Suffix tests<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L552">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">S_THth</span>(_s)&nbsp; &nbsp; ((((_s) &amp; <a href="#L543" title="utils/adt/formatting.c:543">DCH_S_TH</a>) || ((_s) &amp; <a href="#L544" title="utils/adt/formatting.c:544">DCH_S_th</a>)) ? </span><span class="Constant">1</span><span class="PreProc"> : </span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li><a id="L553">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">S_TH</span>(_s)&nbsp; &nbsp; (((_s) &amp; <a href="#L543" title="utils/adt/formatting.c:543">DCH_S_TH</a>) ? </span><span class="Constant">1</span><span class="PreProc"> : </span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li><a id="L554">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">S_th</span>(_s)&nbsp; &nbsp; (((_s) &amp; <a href="#L544" title="utils/adt/formatting.c:544">DCH_S_th</a>) ? </span><span class="Constant">1</span><span class="PreProc"> : </span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li><a id="L555">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">S_TH_TYPE</span>(_s)&nbsp; &nbsp; (((_s) &amp; <a href="#L543" title="utils/adt/formatting.c:543">DCH_S_TH</a>) ? <a href="#L277" title="utils/adt/formatting.c:277">TH_UPPER</a> : <a href="#L278" title="utils/adt/formatting.c:278">TH_LOWER</a>)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Oracle toggles FM behavior, we don't; see docs. */<br/></li>
<li><a id="L558">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">S_FM</span>(_s)&nbsp; &nbsp; (((_s) &amp; <a href="#L542" title="utils/adt/formatting.c:542">DCH_S_FM</a>) ? </span><span class="Constant">1</span><span class="PreProc"> : </span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li><a id="L559">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">S_SP</span>(_s)&nbsp; &nbsp; (((_s) &amp; <a href="#L545" title="utils/adt/formatting.c:545">DCH_S_SP</a>) ? </span><span class="Constant">1</span><span class="PreProc"> : </span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li><a id="L560">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">S_TM</span>(_s)&nbsp; &nbsp; (((_s) &amp; <a href="#L546" title="utils/adt/formatting.c:546">DCH_S_TM</a>) ? </span><span class="Constant">1</span><span class="PreProc"> : </span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Suffixes definition for DATE-TIME TO/FROM CHAR<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L566">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">TM_SUFFIX_LEN</span>&nbsp; &nbsp; </span><span class="Constant">2<br/></li>
<li></span><br/></li>
<li><a id="L568">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> <span class="linkable">DCH_suff</span>[] = {<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;FM&quot;</span>, <span class="Constant">2</span>, <a href="#L542" title="utils/adt/formatting.c:542">DCH_S_FM</a>, <a href="#L167" title="utils/adt/formatting.c:167">SUFFTYPE_PREFIX</a>},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;fm&quot;</span>, <span class="Constant">2</span>, <a href="#L542" title="utils/adt/formatting.c:542">DCH_S_FM</a>, <a href="#L167" title="utils/adt/formatting.c:167">SUFFTYPE_PREFIX</a>},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;TM&quot;</span>, <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>, <a href="#L546" title="utils/adt/formatting.c:546">DCH_S_TM</a>, <a href="#L167" title="utils/adt/formatting.c:167">SUFFTYPE_PREFIX</a>},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;tm&quot;</span>, <span class="Constant">2</span>, <a href="#L546" title="utils/adt/formatting.c:546">DCH_S_TM</a>, <a href="#L167" title="utils/adt/formatting.c:167">SUFFTYPE_PREFIX</a>},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;TH&quot;</span>, <span class="Constant">2</span>, <a href="#L543" title="utils/adt/formatting.c:543">DCH_S_TH</a>, <a href="#L168" title="utils/adt/formatting.c:168">SUFFTYPE_POSTFIX</a>},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;th&quot;</span>, <span class="Constant">2</span>, <a href="#L544" title="utils/adt/formatting.c:544">DCH_S_th</a>, <a href="#L168" title="utils/adt/formatting.c:168">SUFFTYPE_POSTFIX</a>},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;SP&quot;</span>, <span class="Constant">2</span>, <a href="#L545" title="utils/adt/formatting.c:545">DCH_S_SP</a>, <a href="#L168" title="utils/adt/formatting.c:168">SUFFTYPE_POSTFIX</a>},<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* last */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">NULL</span>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span>}<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Format-pictures (<a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a>).<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> field; alphabetic sorted, *BUT* strings alike is sorted<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; complicated -to-&gt; easy:<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; (example: &quot;DDD&quot;,&quot;DD&quot;,&quot;Day&quot;,&quot;D&quot; )<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * (this specific sort needs the algorithm for sequential search for strings,<br/></li>
<li></span><span class="Comment"> * which not has exact end; -&gt; How keyword is in &quot;HH12blabla&quot; ? - &quot;HH&quot;<br/></li>
<li></span><span class="Comment"> * or &quot;HH12&quot;? You must first try &quot;HH12&quot;, because &quot;HH&quot; is in string, but<br/></li>
<li></span><span class="Comment"> * it is not good.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * (!)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; - Position for the keyword is similar as position in the enum DCH/<a href="#L769" title="utils/adt/formatting.c:769">NUM_poz</a>.<br/></li>
<li></span><span class="Comment"> * (!)<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * For fast search is used the 'int index[]', index is <a href="oracle_compat.c.html#L925" title="utils/adt/oracle_compat.c:925">ascii</a> table from position<br/></li>
<li></span><span class="Comment"> * 32 (' ') to 126 (~), in this index is DCH_ / NUM_ enums for each ASCII<br/></li>
<li></span><span class="Comment"> * position or -1 if char is not used in the <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a>. Search example for<br/></li>
<li></span><span class="Comment"> * string &quot;MM&quot;:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 1)&nbsp; &nbsp; see in index to index['M' - 32],<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 2)&nbsp; &nbsp; take keywords position (enum DCH_MI) from index<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 3)&nbsp; &nbsp; run sequential search in keywords[] from this position<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Type">typedef</span> <span class="Type">enum<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; DCH_A_D,<br/></li>
<li>&nbsp; &nbsp; DCH_A_M,<br/></li>
<li>&nbsp; &nbsp; DCH_AD,<br/></li>
<li>&nbsp; &nbsp; DCH_AM,<br/></li>
<li>&nbsp; &nbsp; DCH_B_C,<br/></li>
<li>&nbsp; &nbsp; DCH_BC,<br/></li>
<li>&nbsp; &nbsp; DCH_CC,<br/></li>
<li>&nbsp; &nbsp; DCH_DAY,<br/></li>
<li>&nbsp; &nbsp; DCH_DDD,<br/></li>
<li>&nbsp; &nbsp; DCH_DD,<br/></li>
<li>&nbsp; &nbsp; DCH_DY,<br/></li>
<li>&nbsp; &nbsp; DCH_Day,<br/></li>
<li>&nbsp; &nbsp; DCH_Dy,<br/></li>
<li>&nbsp; &nbsp; DCH_D,<br/></li>
<li>&nbsp; &nbsp; DCH_FF1,<br/></li>
<li>&nbsp; &nbsp; DCH_FF2,<br/></li>
<li>&nbsp; &nbsp; DCH_FF3,<br/></li>
<li>&nbsp; &nbsp; DCH_FF4,<br/></li>
<li>&nbsp; &nbsp; DCH_FF5,<br/></li>
<li>&nbsp; &nbsp; DCH_FF6,<br/></li>
<li>&nbsp; &nbsp; DCH_FX,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* global suffix */<br/></li>
<li></span>&nbsp; &nbsp; DCH_HH24,<br/></li>
<li>&nbsp; &nbsp; DCH_HH12,<br/></li>
<li>&nbsp; &nbsp; DCH_HH,<br/></li>
<li>&nbsp; &nbsp; DCH_IDDD,<br/></li>
<li>&nbsp; &nbsp; DCH_ID,<br/></li>
<li>&nbsp; &nbsp; DCH_IW,<br/></li>
<li>&nbsp; &nbsp; DCH_IYYY,<br/></li>
<li>&nbsp; &nbsp; DCH_IYY,<br/></li>
<li>&nbsp; &nbsp; DCH_IY,<br/></li>
<li>&nbsp; &nbsp; DCH_I,<br/></li>
<li>&nbsp; &nbsp; DCH_J,<br/></li>
<li>&nbsp; &nbsp; DCH_MI,<br/></li>
<li>&nbsp; &nbsp; DCH_MM,<br/></li>
<li>&nbsp; &nbsp; DCH_MONTH,<br/></li>
<li>&nbsp; &nbsp; DCH_MON,<br/></li>
<li>&nbsp; &nbsp; DCH_MS,<br/></li>
<li>&nbsp; &nbsp; DCH_Month,<br/></li>
<li>&nbsp; &nbsp; DCH_Mon,<br/></li>
<li>&nbsp; &nbsp; DCH_OF,<br/></li>
<li>&nbsp; &nbsp; DCH_P_M,<br/></li>
<li>&nbsp; &nbsp; DCH_PM,<br/></li>
<li>&nbsp; &nbsp; DCH_Q,<br/></li>
<li>&nbsp; &nbsp; DCH_RM,<br/></li>
<li>&nbsp; &nbsp; DCH_SSSSS,<br/></li>
<li>&nbsp; &nbsp; DCH_SSSS,<br/></li>
<li>&nbsp; &nbsp; DCH_SS,<br/></li>
<li>&nbsp; &nbsp; DCH_TZH,<br/></li>
<li>&nbsp; &nbsp; DCH_TZM,<br/></li>
<li>&nbsp; &nbsp; DCH_TZ,<br/></li>
<li>&nbsp; &nbsp; DCH_US,<br/></li>
<li>&nbsp; &nbsp; DCH_WW,<br/></li>
<li>&nbsp; &nbsp; DCH_W,<br/></li>
<li>&nbsp; &nbsp; DCH_Y_YYY,<br/></li>
<li>&nbsp; &nbsp; DCH_YYYY,<br/></li>
<li>&nbsp; &nbsp; DCH_YYY,<br/></li>
<li>&nbsp; &nbsp; DCH_YY,<br/></li>
<li>&nbsp; &nbsp; DCH_Y,<br/></li>
<li>&nbsp; &nbsp; DCH_a_d,<br/></li>
<li>&nbsp; &nbsp; DCH_a_m,<br/></li>
<li>&nbsp; &nbsp; DCH_ad,<br/></li>
<li>&nbsp; &nbsp; DCH_am,<br/></li>
<li>&nbsp; &nbsp; DCH_b_c,<br/></li>
<li>&nbsp; &nbsp; DCH_bc,<br/></li>
<li>&nbsp; &nbsp; DCH_cc,<br/></li>
<li>&nbsp; &nbsp; DCH_day,<br/></li>
<li>&nbsp; &nbsp; DCH_ddd,<br/></li>
<li>&nbsp; &nbsp; DCH_dd,<br/></li>
<li>&nbsp; &nbsp; DCH_dy,<br/></li>
<li>&nbsp; &nbsp; DCH_d,<br/></li>
<li>&nbsp; &nbsp; DCH_ff1,<br/></li>
<li>&nbsp; &nbsp; DCH_ff2,<br/></li>
<li>&nbsp; &nbsp; DCH_ff3,<br/></li>
<li>&nbsp; &nbsp; DCH_ff4,<br/></li>
<li>&nbsp; &nbsp; DCH_ff5,<br/></li>
<li>&nbsp; &nbsp; DCH_ff6,<br/></li>
<li>&nbsp; &nbsp; DCH_fx,<br/></li>
<li>&nbsp; &nbsp; DCH_hh24,<br/></li>
<li>&nbsp; &nbsp; DCH_hh12,<br/></li>
<li>&nbsp; &nbsp; DCH_hh,<br/></li>
<li>&nbsp; &nbsp; DCH_iddd,<br/></li>
<li>&nbsp; &nbsp; DCH_id,<br/></li>
<li>&nbsp; &nbsp; DCH_iw,<br/></li>
<li>&nbsp; &nbsp; DCH_iyyy,<br/></li>
<li>&nbsp; &nbsp; DCH_iyy,<br/></li>
<li>&nbsp; &nbsp; DCH_iy,<br/></li>
<li>&nbsp; &nbsp; DCH_i,<br/></li>
<li>&nbsp; &nbsp; DCH_j,<br/></li>
<li>&nbsp; &nbsp; DCH_mi,<br/></li>
<li>&nbsp; &nbsp; DCH_mm,<br/></li>
<li>&nbsp; &nbsp; DCH_month,<br/></li>
<li>&nbsp; &nbsp; DCH_mon,<br/></li>
<li>&nbsp; &nbsp; DCH_ms,<br/></li>
<li>&nbsp; &nbsp; DCH_of,<br/></li>
<li>&nbsp; &nbsp; DCH_p_m,<br/></li>
<li>&nbsp; &nbsp; DCH_pm,<br/></li>
<li>&nbsp; &nbsp; DCH_q,<br/></li>
<li>&nbsp; &nbsp; DCH_rm,<br/></li>
<li>&nbsp; &nbsp; DCH_sssss,<br/></li>
<li>&nbsp; &nbsp; DCH_ssss,<br/></li>
<li>&nbsp; &nbsp; DCH_ss,<br/></li>
<li>&nbsp; &nbsp; DCH_tzh,<br/></li>
<li>&nbsp; &nbsp; DCH_tzm,<br/></li>
<li>&nbsp; &nbsp; DCH_tz,<br/></li>
<li>&nbsp; &nbsp; DCH_us,<br/></li>
<li>&nbsp; &nbsp; DCH_ww,<br/></li>
<li>&nbsp; &nbsp; DCH_w,<br/></li>
<li>&nbsp; &nbsp; DCH_y_yyy,<br/></li>
<li>&nbsp; &nbsp; DCH_yyyy,<br/></li>
<li>&nbsp; &nbsp; DCH_yyy,<br/></li>
<li>&nbsp; &nbsp; DCH_yy,<br/></li>
<li>&nbsp; &nbsp; DCH_y,<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* last */<br/></li>
<li></span>&nbsp; &nbsp; _DCH_last_<br/></li>
<li><a id="L726">&#x200c;</a>}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">DCH_poz</span>;<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">enum<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; NUM_COMMA,<br/></li>
<li>&nbsp; &nbsp; NUM_DEC,<br/></li>
<li>&nbsp; &nbsp; NUM_0,<br/></li>
<li>&nbsp; &nbsp; NUM_9,<br/></li>
<li>&nbsp; &nbsp; NUM_B,<br/></li>
<li>&nbsp; &nbsp; NUM_C,<br/></li>
<li>&nbsp; &nbsp; NUM_D,<br/></li>
<li>&nbsp; &nbsp; NUM_E,<br/></li>
<li>&nbsp; &nbsp; NUM_FM,<br/></li>
<li>&nbsp; &nbsp; NUM_G,<br/></li>
<li>&nbsp; &nbsp; NUM_L,<br/></li>
<li>&nbsp; &nbsp; NUM_MI,<br/></li>
<li>&nbsp; &nbsp; NUM_PL,<br/></li>
<li>&nbsp; &nbsp; NUM_PR,<br/></li>
<li>&nbsp; &nbsp; NUM_RN,<br/></li>
<li>&nbsp; &nbsp; NUM_SG,<br/></li>
<li>&nbsp; &nbsp; NUM_SP,<br/></li>
<li>&nbsp; &nbsp; NUM_S,<br/></li>
<li>&nbsp; &nbsp; NUM_TH,<br/></li>
<li>&nbsp; &nbsp; NUM_V,<br/></li>
<li>&nbsp; &nbsp; NUM_b,<br/></li>
<li>&nbsp; &nbsp; NUM_c,<br/></li>
<li>&nbsp; &nbsp; NUM_d,<br/></li>
<li>&nbsp; &nbsp; NUM_e,<br/></li>
<li>&nbsp; &nbsp; NUM_fm,<br/></li>
<li>&nbsp; &nbsp; NUM_g,<br/></li>
<li>&nbsp; &nbsp; NUM_l,<br/></li>
<li>&nbsp; &nbsp; NUM_mi,<br/></li>
<li>&nbsp; &nbsp; NUM_pl,<br/></li>
<li>&nbsp; &nbsp; NUM_pr,<br/></li>
<li>&nbsp; &nbsp; NUM_rn,<br/></li>
<li>&nbsp; &nbsp; NUM_sg,<br/></li>
<li>&nbsp; &nbsp; NUM_sp,<br/></li>
<li>&nbsp; &nbsp; NUM_s,<br/></li>
<li>&nbsp; &nbsp; NUM_th,<br/></li>
<li>&nbsp; &nbsp; NUM_v,<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* last */<br/></li>
<li></span>&nbsp; &nbsp; _NUM_last_<br/></li>
<li><a id="L769">&#x200c;</a>}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">NUM_poz</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * KeyWords for DATE-TIME version<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L775">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> <span class="linkable">DCH_keywords</span>[] = {<br/></li>
<li><span class="Comment">/*&nbsp; &nbsp; name, len, id, is_digit, date_mode */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;A.D.&quot;</span>, <span class="Constant">4</span>, DCH_A_D, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* A */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;A.M.&quot;</span>, <span class="Constant">4</span>, DCH_A_M, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;AD&quot;</span>, <span class="Constant">2</span>, DCH_AD, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;AM&quot;</span>, <span class="Constant">2</span>, DCH_AM, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;B.C.&quot;</span>, <span class="Constant">4</span>, DCH_B_C, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* B */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;BC&quot;</span>, <span class="Constant">2</span>, DCH_BC, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;CC&quot;</span>, <span class="Constant">2</span>, DCH_CC, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* C */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;DAY&quot;</span>, <span class="Constant">3</span>, DCH_DAY, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* D */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;DDD&quot;</span>, <span class="Constant">3</span>, DCH_DDD, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;DD&quot;</span>, <span class="Constant">2</span>, DCH_DD, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;DY&quot;</span>, <span class="Constant">2</span>, DCH_DY, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;Day&quot;</span>, <span class="Constant">3</span>, DCH_Day, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;Dy&quot;</span>, <span class="Constant">2</span>, DCH_Dy, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;D&quot;</span>, <span class="Constant">1</span>, DCH_D, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;FF1&quot;</span>, <span class="Constant">3</span>, DCH_FF1, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* F */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;FF2&quot;</span>, <span class="Constant">3</span>, DCH_FF2, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;FF3&quot;</span>, <span class="Constant">3</span>, DCH_FF3, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;FF4&quot;</span>, <span class="Constant">3</span>, DCH_FF4, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;FF5&quot;</span>, <span class="Constant">3</span>, DCH_FF5, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;FF6&quot;</span>, <span class="Constant">3</span>, DCH_FF6, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;FX&quot;</span>, <span class="Constant">2</span>, DCH_FX, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;HH24&quot;</span>, <span class="Constant">4</span>, DCH_HH24, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* H */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;HH12&quot;</span>, <span class="Constant">4</span>, DCH_HH12, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;HH&quot;</span>, <span class="Constant">2</span>, DCH_HH, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;IDDD&quot;</span>, <span class="Constant">4</span>, DCH_IDDD, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},&nbsp; &nbsp; <span class="Comment">/* I */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;ID&quot;</span>, <span class="Constant">2</span>, DCH_ID, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;IW&quot;</span>, <span class="Constant">2</span>, DCH_IW, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;IYYY&quot;</span>, <span class="Constant">4</span>, DCH_IYYY, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;IYY&quot;</span>, <span class="Constant">3</span>, DCH_IYY, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;IY&quot;</span>, <span class="Constant">2</span>, DCH_IY, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;I&quot;</span>, <span class="Constant">1</span>, DCH_I, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;J&quot;</span>, <span class="Constant">1</span>, DCH_J, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE}, <span class="Comment">/* J */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;MI&quot;</span>, <span class="Constant">2</span>, DCH_MI, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* M */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;MM&quot;</span>, <span class="Constant">2</span>, DCH_MM, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;MONTH&quot;</span>, <span class="Constant">5</span>, DCH_MONTH, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;MON&quot;</span>, <span class="Constant">3</span>, DCH_MON, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;MS&quot;</span>, <span class="Constant">2</span>, DCH_MS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;Month&quot;</span>, <span class="Constant">5</span>, DCH_Month, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;Mon&quot;</span>, <span class="Constant">3</span>, DCH_Mon, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;OF&quot;</span>, <span class="Constant">2</span>, DCH_OF, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* O */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;P.M.&quot;</span>, <span class="Constant">4</span>, DCH_P_M, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* P */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;PM&quot;</span>, <span class="Constant">2</span>, DCH_PM, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;Q&quot;</span>, <span class="Constant">1</span>, DCH_Q, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE}, <span class="Comment">/* Q */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;RM&quot;</span>, <span class="Constant">2</span>, DCH_RM, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN}, <span class="Comment">/* R */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;SSSSS&quot;</span>, <span class="Constant">5</span>, DCH_SSSS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* S */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;SSSS&quot;</span>, <span class="Constant">4</span>, DCH_SSSS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;SS&quot;</span>, <span class="Constant">2</span>, DCH_SS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;TZH&quot;</span>, <span class="Constant">3</span>, DCH_TZH, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* T */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;TZM&quot;</span>, <span class="Constant">3</span>, DCH_TZM, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;TZ&quot;</span>, <span class="Constant">2</span>, DCH_TZ, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;US&quot;</span>, <span class="Constant">2</span>, DCH_US, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* U */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;WW&quot;</span>, <span class="Constant">2</span>, DCH_WW, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},&nbsp; &nbsp; <span class="Comment">/* W */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;W&quot;</span>, <span class="Constant">1</span>, DCH_W, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;Y,YYY&quot;</span>, <span class="Constant">5</span>, DCH_Y_YYY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},&nbsp; &nbsp; <span class="Comment">/* Y */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;YYYY&quot;</span>, <span class="Constant">4</span>, DCH_YYYY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;YYY&quot;</span>, <span class="Constant">3</span>, DCH_YYY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;YY&quot;</span>, <span class="Constant">2</span>, DCH_YY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;Y&quot;</span>, <span class="Constant">1</span>, DCH_Y, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;a.d.&quot;</span>, <span class="Constant">4</span>, DCH_a_d, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* a */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;a.m.&quot;</span>, <span class="Constant">4</span>, DCH_a_m, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ad&quot;</span>, <span class="Constant">2</span>, DCH_ad, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;am&quot;</span>, <span class="Constant">2</span>, DCH_am, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;b.c.&quot;</span>, <span class="Constant">4</span>, DCH_b_c, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* b */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;bc&quot;</span>, <span class="Constant">2</span>, DCH_bc, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;cc&quot;</span>, <span class="Constant">2</span>, DCH_CC, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* c */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;day&quot;</span>, <span class="Constant">3</span>, DCH_day, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* d */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;ddd&quot;</span>, <span class="Constant">3</span>, DCH_DDD, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;dd&quot;</span>, <span class="Constant">2</span>, DCH_DD, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;dy&quot;</span>, <span class="Constant">2</span>, DCH_dy, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;d&quot;</span>, <span class="Constant">1</span>, DCH_D, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ff1&quot;</span>, <span class="Constant">3</span>, DCH_FF1, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* f */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;ff2&quot;</span>, <span class="Constant">3</span>, DCH_FF2, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ff3&quot;</span>, <span class="Constant">3</span>, DCH_FF3, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ff4&quot;</span>, <span class="Constant">3</span>, DCH_FF4, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ff5&quot;</span>, <span class="Constant">3</span>, DCH_FF5, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ff6&quot;</span>, <span class="Constant">3</span>, DCH_FF6, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;fx&quot;</span>, <span class="Constant">2</span>, DCH_FX, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;hh24&quot;</span>, <span class="Constant">4</span>, DCH_HH24, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* h */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;hh12&quot;</span>, <span class="Constant">4</span>, DCH_HH12, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;hh&quot;</span>, <span class="Constant">2</span>, DCH_HH, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;iddd&quot;</span>, <span class="Constant">4</span>, DCH_IDDD, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},&nbsp; &nbsp; <span class="Comment">/* i */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;id&quot;</span>, <span class="Constant">2</span>, DCH_ID, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;iw&quot;</span>, <span class="Constant">2</span>, DCH_IW, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;iyyy&quot;</span>, <span class="Constant">4</span>, DCH_IYYY, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;iyy&quot;</span>, <span class="Constant">3</span>, DCH_IYY, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;iy&quot;</span>, <span class="Constant">2</span>, DCH_IY, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;i&quot;</span>, <span class="Constant">1</span>, DCH_I, <span class="Constant">true</span>, FROM_CHAR_DATE_ISOWEEK},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;j&quot;</span>, <span class="Constant">1</span>, DCH_J, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE}, <span class="Comment">/* j */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;mi&quot;</span>, <span class="Constant">2</span>, DCH_MI, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* m */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;mm&quot;</span>, <span class="Constant">2</span>, DCH_MM, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;month&quot;</span>, <span class="Constant">5</span>, DCH_month, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;mon&quot;</span>, <span class="Constant">3</span>, DCH_mon, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ms&quot;</span>, <span class="Constant">2</span>, DCH_MS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;of&quot;</span>, <span class="Constant">2</span>, DCH_OF, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* o */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;p.m.&quot;</span>, <span class="Constant">4</span>, DCH_p_m, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* p */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;pm&quot;</span>, <span class="Constant">2</span>, DCH_pm, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;q&quot;</span>, <span class="Constant">1</span>, DCH_Q, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE}, <span class="Comment">/* q */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;rm&quot;</span>, <span class="Constant">2</span>, DCH_rm, <span class="Constant">false</span>, FROM_CHAR_DATE_GREGORIAN}, <span class="Comment">/* r */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;sssss&quot;</span>, <span class="Constant">5</span>, DCH_SSSS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* s */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;ssss&quot;</span>, <span class="Constant">4</span>, DCH_SSSS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;ss&quot;</span>, <span class="Constant">2</span>, DCH_SS, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;tzh&quot;</span>, <span class="Constant">3</span>, DCH_TZH, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* t */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;tzm&quot;</span>, <span class="Constant">3</span>, DCH_TZM, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;tz&quot;</span>, <span class="Constant">2</span>, DCH_tz, <span class="Constant">false</span>, FROM_CHAR_DATE_NONE},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;us&quot;</span>, <span class="Constant">2</span>, DCH_US, <span class="Constant">true</span>, FROM_CHAR_DATE_NONE},&nbsp; &nbsp; <span class="Comment">/* u */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;ww&quot;</span>, <span class="Constant">2</span>, DCH_WW, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},&nbsp; &nbsp; <span class="Comment">/* w */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;w&quot;</span>, <span class="Constant">1</span>, DCH_W, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;y,yyy&quot;</span>, <span class="Constant">5</span>, DCH_Y_YYY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},&nbsp; &nbsp; <span class="Comment">/* y */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;yyyy&quot;</span>, <span class="Constant">4</span>, DCH_YYYY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;yyy&quot;</span>, <span class="Constant">3</span>, DCH_YYY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;yy&quot;</span>, <span class="Constant">2</span>, DCH_YY, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;y&quot;</span>, <span class="Constant">1</span>, DCH_Y, <span class="Constant">true</span>, FROM_CHAR_DATE_GREGORIAN},<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* last */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">NULL</span>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span>}<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * KeyWords for NUMBER version<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The is_digit and date_mode fields are not relevant here.<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L900">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> <span class="linkable">NUM_keywords</span>[] = {<br/></li>
<li><span class="Comment">/*&nbsp; &nbsp; name, len, id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is in Index */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;,&quot;</span>, <span class="Constant">1</span>, NUM_COMMA},&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* , */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;.&quot;</span>, <span class="Constant">1</span>, NUM_DEC},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* . */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;0&quot;</span>, <span class="Constant">1</span>, NUM_0},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 0 */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;9&quot;</span>, <span class="Constant">1</span>, NUM_9},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 9 */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;B&quot;</span>, <span class="Constant">1</span>, NUM_B},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* B */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;C&quot;</span>, <span class="Constant">1</span>, NUM_C},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* C */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;D&quot;</span>, <span class="Constant">1</span>, NUM_D},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* D */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;EEEE&quot;</span>, <span class="Constant">4</span>, NUM_E},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* E */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;FM&quot;</span>, <span class="Constant">2</span>, NUM_FM},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* F */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;G&quot;</span>, <span class="Constant">1</span>, NUM_G},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* G */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;L&quot;</span>, <span class="Constant">1</span>, NUM_L},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* L */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;MI&quot;</span>, <span class="Constant">2</span>, NUM_MI},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* M */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;PL&quot;</span>, <span class="Constant">2</span>, NUM_PL},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* P */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;PR&quot;</span>, <span class="Constant">2</span>, NUM_PR},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;RN&quot;</span>, <span class="Constant">2</span>, NUM_RN},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* R */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;SG&quot;</span>, <span class="Constant">2</span>, NUM_SG},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* S */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;SP&quot;</span>, <span class="Constant">2</span>, NUM_SP},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;S&quot;</span>, <span class="Constant">1</span>, NUM_S},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;TH&quot;</span>, <span class="Constant">2</span>, NUM_TH},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* T */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;V&quot;</span>, <span class="Constant">1</span>, NUM_V},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* V */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;b&quot;</span>, <span class="Constant">1</span>, NUM_B},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* b */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;c&quot;</span>, <span class="Constant">1</span>, NUM_C},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* c */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;d&quot;</span>, <span class="Constant">1</span>, NUM_D},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* d */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;eeee&quot;</span>, <span class="Constant">4</span>, NUM_E},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* e */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;fm&quot;</span>, <span class="Constant">2</span>, NUM_FM},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* f */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;g&quot;</span>, <span class="Constant">1</span>, NUM_G},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* g */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;l&quot;</span>, <span class="Constant">1</span>, NUM_L},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* l */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;mi&quot;</span>, <span class="Constant">2</span>, NUM_MI},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* m */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;pl&quot;</span>, <span class="Constant">2</span>, NUM_PL},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* p */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;pr&quot;</span>, <span class="Constant">2</span>, NUM_PR},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;rn&quot;</span>, <span class="Constant">2</span>, NUM_rn},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* r */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;sg&quot;</span>, <span class="Constant">2</span>, NUM_SG},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* s */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;sp&quot;</span>, <span class="Constant">2</span>, NUM_SP},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;s&quot;</span>, <span class="Constant">1</span>, NUM_S},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;th&quot;</span>, <span class="Constant">2</span>, NUM_th},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* t */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">&quot;v&quot;</span>, <span class="Constant">1</span>, NUM_V},&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* v */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* last */<br/></li>
<li></span>&nbsp; &nbsp; {<span class="Constant">NULL</span>, <span class="Constant">0</span>, <span class="Constant">0</span>}<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * KeyWords index for DATE-TIME version<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L948">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">int</span> <span class="linkable">DCH_index</span>[<a href="#L107" title="utils/adt/formatting.c:107">KeyWord_INDEX_SIZE</a>] = {<br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">0&nbsp; &nbsp; 1&nbsp; &nbsp; 2&nbsp; &nbsp; 3&nbsp; &nbsp; 4&nbsp; &nbsp; 5&nbsp; &nbsp; 6&nbsp; &nbsp; 7&nbsp; &nbsp; 8&nbsp; &nbsp; 9<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/*---- first 0..31 chars are skipped ----*/<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, DCH_A_D, DCH_B_C, DCH_CC, DCH_DAY, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; DCH_FF1, -<span class="Constant">1</span>, DCH_HH24, DCH_IDDD, DCH_J, -<span class="Constant">1</span>, -<span class="Constant">1</span>, DCH_MI, -<span class="Constant">1</span>, DCH_OF,<br/></li>
<li>&nbsp; &nbsp; DCH_P_M, DCH_Q, DCH_RM, DCH_SSSSS, DCH_TZH, DCH_US, -<span class="Constant">1</span>, DCH_WW, -<span class="Constant">1</span>, DCH_Y_YYY,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, DCH_a_d, DCH_b_c, DCH_cc,<br/></li>
<li>&nbsp; &nbsp; DCH_day, -<span class="Constant">1</span>, DCH_ff1, -<span class="Constant">1</span>, DCH_hh24, DCH_iddd, DCH_j, -<span class="Constant">1</span>, -<span class="Constant">1</span>, DCH_mi,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, DCH_of, DCH_p_m, DCH_q, DCH_rm, DCH_sssss, DCH_tzh, DCH_us, -<span class="Constant">1</span>, DCH_ww,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, DCH_y_yyy, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*---- chars over 126 are skipped ----*/<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * KeyWords index for NUMBER version<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L972">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">int</span> <span class="linkable">NUM_index</span>[<a href="#L107" title="utils/adt/formatting.c:107">KeyWord_INDEX_SIZE</a>] = {<br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">0&nbsp; &nbsp; 1&nbsp; &nbsp; 2&nbsp; &nbsp; 3&nbsp; &nbsp; 4&nbsp; &nbsp; 5&nbsp; &nbsp; 6&nbsp; &nbsp; 7&nbsp; &nbsp; 8&nbsp; &nbsp; 9<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/*---- first 0..31 chars are skipped ----*/<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, NUM_COMMA, -<span class="Constant">1</span>, NUM_DEC, -<span class="Constant">1</span>, NUM_0, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, NUM_9, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, NUM_B, NUM_C, NUM_D, NUM_E,<br/></li>
<li>&nbsp; &nbsp; NUM_FM, NUM_G, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, NUM_L, NUM_MI, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; NUM_PL, -<span class="Constant">1</span>, NUM_RN, NUM_SG, NUM_TH, -<span class="Constant">1</span>, NUM_V, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, NUM_b, NUM_c,<br/></li>
<li>&nbsp; &nbsp; NUM_d, NUM_e, NUM_fm, NUM_g, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, NUM_l, NUM_mi,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, NUM_pl, -<span class="Constant">1</span>, NUM_rn, NUM_sg, NUM_th, -<span class="Constant">1</span>, NUM_v, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*---- chars over 126 are skipped ----*/<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Number processor struct<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L996">&#x200c;</a></span><span class="Type">typedef</span> <span class="Type">struct</span> <span class="linkable">NUMProc</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; is_to_char;<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; *Num;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* number description&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* '-' or '+'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign_wrote,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* was sign write&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num_count,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* number of write digits&nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num_in,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* is inside number&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num_curr,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* current position in number&nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces, <span class="Comment">/* spaces <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> first digit&nbsp; &nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read_dec,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* to_number - was read dec. point&nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read_post,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* to_number - number of dec. digit */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read_pre;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* to_number - number non-dec. digit */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *number,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* string with number&nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *number_p,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* pointer to current number position */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *inout,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* in / out buffer&nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *inout_p,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* pointer to current inout position */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *last_relevant,&nbsp; &nbsp; <span class="Comment">/* last relevant number after decimal point */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *L_negative_sign,&nbsp; &nbsp; <span class="Comment">/* Locale */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *L_positive_sign,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *decimal,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *L_thousands_sep,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *L_currency_symbol;<br/></li>
<li><a id="L1023">&#x200c;</a>} <span class="linkable">NUMProc</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/* Return flags for <a href="#L3412" title="utils/adt/formatting.c:3412">DCH_from_char</a>() */<br/></li>
<li><a id="L1026">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_DATED</span>&nbsp; &nbsp; </span><span class="Constant">0x01<br/></li>
<li><a id="L1027">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_TIMED</span>&nbsp; &nbsp; </span><span class="Constant">0x02<br/></li>
<li><a id="L1028">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DCH_ZONED</span>&nbsp; &nbsp; </span><span class="Constant">0x04<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Functions<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *<a href="#L1099" title="utils/adt/formatting.c:1099">index_seq_search</a>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *kw,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <span class="Type">int</span> *index);<br/></li>
<li><span class="Type">static</span> <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *<a href="#L1123" title="utils/adt/formatting.c:1123">suff_search</a>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *suf, <span class="Type">int</span> type);<br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L1139" title="utils/adt/formatting.c:1139">is_separator_char</a>(<span class="Type">const</span> <span class="Type">char</span> *str);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L1153" title="utils/adt/formatting.c:1153">NUMDesc_prepare</a>(<a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *num, <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L1328" title="utils/adt/formatting.c:1328">parse_format</a>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *kw,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *suf, <span class="Type">const</span> <span class="Type">int</span> *index, uint32 flags, <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *Num);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L2765" title="utils/adt/formatting.c:2765">DCH_to_char</a>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> is_interval,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L482" title="utils/adt/formatting.c:482">TmToChar</a> *in, <span class="Type">char</span> *out, Oid collid);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3412" title="utils/adt/formatting.c:3412">DCH_from_char</a>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type">const</span> <span class="Type">char</span> *in, <a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a> *out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid collid, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std, Node *escontext);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void</span> <a href="#L2290" title="utils/adt/formatting.c:2290">dump_index</a>(<span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *k, <span class="Type">const</span> <span class="Type">int</span> *index);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L1480" title="utils/adt/formatting.c:1480">dump_node</a>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type">int</span> max);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<a href="#L1516" title="utils/adt/formatting.c:1516">get_th</a>(<span class="Type">char</span> *num, <span class="Type">int</span> type);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(<span class="Type">char</span> *dest, <span class="Type">char</span> *num, <span class="Type">int</span> type);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L2354" title="utils/adt/formatting.c:2354">adjust_partial_year_to_2020</a>(<span class="Type">int</span> year);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L2378" title="utils/adt/formatting.c:2378">strspace_len</a>(<span class="Type">const</span> <span class="Type">char</span> *str);<br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L2400" title="utils/adt/formatting.c:2400">from_char_set_mode</a>(<a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a> *tmfc, <span class="Type">const</span> <a href="#L142" title="utils/adt/formatting.c:142">FromCharDateMode</a> mode,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Node *escontext);<br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">int</span> value, <span class="Type">const</span> <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Node *escontext);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">char</span> **src, <span class="Type">const</span> <span class="Type">int</span> len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, Node *escontext);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">char</span> **src, <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Node *escontext);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L2578" title="utils/adt/formatting.c:2578">seq_search_ascii</a>(<span class="Type">const</span> <span class="Type">char</span> *name, <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> *array, <span class="Type">int</span> *len);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L2635" title="utils/adt/formatting.c:2635">seq_search_localized</a>(<span class="Type">const</span> <span class="Type">char</span> *name, <span class="Type">char</span> **array, <span class="Type">int</span> *len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Oid collid);<br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">char</span> **src,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> *array,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">char</span> **localized_array, Oid collid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, Node *escontext);<br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>(text *date_txt, text *fmt, Oid collid, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> pg_tm *tm, fsec_t *fsec, <span class="Type">struct</span> <a href="#L434" title="utils/adt/formatting.c:434">fmt_tz</a> *tz,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> *fprec, uint32 *flags, Node *escontext);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(<span class="Type">char</span> *str, <span class="Type">int</span> c, <span class="Type">int</span> max);<br/></li>
<li><span class="Type">static</span> <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *<a href="#L5180" title="utils/adt/formatting.c:5180">NUM_cache</a>(<span class="Type">int</span> len, <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *Num, text *pars_str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> *shouldFree);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L5238" title="utils/adt/formatting.c:5238">int_to_roman</a>(<span class="Type">int</span> number);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L5287" title="utils/adt/formatting.c:5287">NUM_prepare_locale</a>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a> *Np);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L5369" title="utils/adt/formatting.c:5369">get_last_relevant_decnum</a>(<span class="Type">char</span> *num);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L5405" title="utils/adt/formatting.c:5405">NUM_numpart_from_char</a>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a> *Np, <span class="Type">int</span> id, <span class="Type">int</span> input_len);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L5620" title="utils/adt/formatting.c:5620">NUM_numpart_to_char</a>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a> *Np, <span class="Type">int</span> id);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L5823" title="utils/adt/formatting.c:5823">NUM_processor</a>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *Num, <span class="Type">char</span> *inout,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">char</span> *number, <span class="Type">int</span> input_len, <span class="Type">int</span> to_char_out_pre_spaces,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">int</span> sign, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> is_to_char, Oid collid);<br/></li>
<li><span class="Type">static</span> <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *<a href="#L4073" title="utils/adt/formatting.c:4073">DCH_cache_getnew</a>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std);<br/></li>
<li><span class="Type">static</span> <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *<a href="#L4133" title="utils/adt/formatting.c:4133">DCH_cache_search</a>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std);<br/></li>
<li><span class="Type">static</span> <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *<a href="#L4154" title="utils/adt/formatting.c:4154">DCH_cache_fetch</a>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std);<br/></li>
<li><span class="Type">static</span> <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *<a href="#L5072" title="utils/adt/formatting.c:5072">NUM_cache_getnew</a>(<span class="Type">const</span> <span class="Type">char</span> *str);<br/></li>
<li><span class="Type">static</span> <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *<a href="#L5131" title="utils/adt/formatting.c:5131">NUM_cache_search</a>(<span class="Type">const</span> <span class="Type">char</span> *str);<br/></li>
<li><span class="Type">static</span> <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *<a href="#L5152" title="utils/adt/formatting.c:5152">NUM_cache_fetch</a>(<span class="Type">const</span> <span class="Type">char</span> *str);<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Fast sequential search, use index for data selection which<br/></li>
<li></span><span class="Comment"> * go to seq. cycle (it is very fast for unwanted strings)<br/></li>
<li></span><span class="Comment"> * (can't be used binary search in format parsing)<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *<br/></li>
<li><a id="L1099">&#x200c;</a><span class="linkable">index_seq_search</span>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *kw, <span class="Type">const</span> <span class="Type">int</span> *index)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; poz;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L108" title="utils/adt/formatting.c:108">KeyWord_INDEX_FILTER</a>(*str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((poz = *(index + (*str - <span class="Constant">' '</span>))) &gt; -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *k = kw + poz;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(str, k-&gt;name, k-&gt;len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> k;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; k++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!k-&gt;name)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (*str == *k-&gt;name);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *<br/></li>
<li><a id="L1123">&#x200c;</a><span class="linkable">suff_search</span>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *suf, <span class="Type">int</span> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *s;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (s = suf; s-&gt;name != <span class="Constant">NULL</span>; s++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s-&gt;type != type)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(str, s-&gt;name, s-&gt;len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> s;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L1139">&#x200c;</a></span><span class="linkable">is_separator_char</span>(<span class="Type">const</span> <span class="Type">char</span> *str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* ASCII printable character, but not letter or digit */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> (*str &gt; <span class="Constant">0x20</span> &amp;&amp; *str &lt; <span class="Constant">0x7F</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(*str &gt;= <span class="Constant">'A'</span> &amp;&amp; *str &lt;= <span class="Constant">'Z'</span>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(*str &gt;= <span class="Constant">'a'</span> &amp;&amp; *str &lt;= <span class="Constant">'z'</span>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(*str &gt;= <span class="Constant">'0'</span> &amp;&amp; *str &lt;= <span class="Constant">'9'</span>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Prepare <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> (number description struct) via <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> struct<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1153">&#x200c;</a></span><span class="linkable">NUMDesc_prepare</span>(<a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *num, <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type != <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(num) &amp;&amp; n-&gt;key-&gt;id != NUM_E)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">EEEE</span><span class="Special">\&quot;</span><span class="Constant"> must be the last pattern used&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (n-&gt;key-&gt;id)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_9:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">9</span><span class="Special">\&quot;</span><span class="Constant"> must be ahead of </span><span class="Special">\&quot;</span><span class="Constant">PR</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++num-&gt;multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++num-&gt;post;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++num-&gt;pre;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_0:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">0</span><span class="Special">\&quot;</span><span class="Constant"> must be ahead of </span><span class="Special">\&quot;</span><span class="Constant">PR</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L326" title="utils/adt/formatting.c:326">IS_ZERO</a>(num) &amp;&amp; !<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L303" title="utils/adt/formatting.c:303">NUM_F_ZERO</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;zero_start = num-&gt;pre + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++num-&gt;pre;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++num-&gt;post;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;zero_end = num-&gt;pre + num-&gt;post;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_B:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (num-&gt;pre == <span class="Constant">0</span> &amp;&amp; num-&gt;post == <span class="Constant">0</span> &amp;&amp; (!<a href="#L326" title="utils/adt/formatting.c:326">IS_ZERO</a>(num)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L304" title="utils/adt/formatting.c:304">NUM_F_BLANK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L302" title="utils/adt/formatting.c:302">NUM_F_LDECIMAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;need_locale = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* FALLTHROUGH */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_DEC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;multiple decimal points&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">V</span><span class="Special">\&quot;</span><span class="Constant"> and decimal point together&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L301" title="utils/adt/formatting.c:301">NUM_F_DECIMAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_FM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L305" title="utils/adt/formatting.c:305">NUM_F_FILLMODE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_S:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">S</span><span class="Special">\&quot;</span><span class="Constant"> twice&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L332" title="utils/adt/formatting.c:332">IS_PLUS</a>(num) || <a href="#L330" title="utils/adt/formatting.c:330">IS_MINUS</a>(num) || <a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">S</span><span class="Special">\&quot;</span><span class="Constant"> and </span><span class="Special">\&quot;</span><span class="Constant">PL</span><span class="Special">\&quot;</span><span class="Constant">/</span><span class="Special">\&quot;</span><span class="Constant">MI</span><span class="Special">\&quot;</span><span class="Constant">/</span><span class="Special">\&quot;</span><span class="Constant">SG</span><span class="Special">\&quot;</span><span class="Constant">/</span><span class="Special">\&quot;</span><span class="Constant">PR</span><span class="Special">\&quot;</span><span class="Constant"> together&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;lsign = <a href="#L316" title="utils/adt/formatting.c:316">NUM_LSIGN_PRE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;pre_lsign_num = num-&gt;pre;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;need_locale = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L306" title="utils/adt/formatting.c:306">NUM_F_LSIGN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (num-&gt;lsign == <a href="#L318" title="utils/adt/formatting.c:318">NUM_LSIGN_NONE</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;lsign = <a href="#L317" title="utils/adt/formatting.c:317">NUM_LSIGN_POST</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;need_locale = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L306" title="utils/adt/formatting.c:306">NUM_F_LSIGN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_MI:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">S</span><span class="Special">\&quot;</span><span class="Constant"> and </span><span class="Special">\&quot;</span><span class="Constant">MI</span><span class="Special">\&quot;</span><span class="Constant"> together&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L308" title="utils/adt/formatting.c:308">NUM_F_MINUS</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L313" title="utils/adt/formatting.c:313">NUM_F_MINUS_POST</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_PL:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">S</span><span class="Special">\&quot;</span><span class="Constant"> and </span><span class="Special">\&quot;</span><span class="Constant">PL</span><span class="Special">\&quot;</span><span class="Constant"> together&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L309" title="utils/adt/formatting.c:309">NUM_F_PLUS</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L312" title="utils/adt/formatting.c:312">NUM_F_PLUS_POST</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_SG:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">S</span><span class="Special">\&quot;</span><span class="Constant"> and </span><span class="Special">\&quot;</span><span class="Constant">SG</span><span class="Special">\&quot;</span><span class="Constant"> together&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L308" title="utils/adt/formatting.c:308">NUM_F_MINUS</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L309" title="utils/adt/formatting.c:309">NUM_F_PLUS</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_PR:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(num) || <a href="#L332" title="utils/adt/formatting.c:332">IS_PLUS</a>(num) || <a href="#L330" title="utils/adt/formatting.c:330">IS_MINUS</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">PR</span><span class="Special">\&quot;</span><span class="Constant"> and </span><span class="Special">\&quot;</span><span class="Constant">S</span><span class="Special">\&quot;</span><span class="Constant">/</span><span class="Special">\&quot;</span><span class="Constant">PL</span><span class="Special">\&quot;</span><span class="Constant">/</span><span class="Special">\&quot;</span><span class="Constant">MI</span><span class="Special">\&quot;</span><span class="Constant">/</span><span class="Special">\&quot;</span><span class="Constant">SG</span><span class="Special">\&quot;</span><span class="Constant"> together&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L307" title="utils/adt/formatting.c:307">NUM_F_BRACKET</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_rn:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_RN:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L310" title="utils/adt/formatting.c:310">NUM_F_ROMAN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_L:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_G:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;need_locale = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_V:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">V</span><span class="Special">\&quot;</span><span class="Constant"> and decimal point together&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L311" title="utils/adt/formatting.c:311">NUM_F_MULTI</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_E:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot use </span><span class="Special">\&quot;</span><span class="Constant">EEEE</span><span class="Special">\&quot;</span><span class="Constant"> twice&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L327" title="utils/adt/formatting.c:327">IS_BLANK</a>(num) || <a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(num) || <a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(num) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(num) || <a href="#L330" title="utils/adt/formatting.c:330">IS_MINUS</a>(num) || <a href="#L332" title="utils/adt/formatting.c:332">IS_PLUS</a>(num) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(num) || <a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">EEEE</span><span class="Special">\&quot;</span><span class="Constant"> is incompatible with other formats&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">EEEE</span><span class="Special">\&quot;</span><span class="Constant"> may only be used together with digit and decimal point patterns.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num-&gt;flag |= <a href="#L314" title="utils/adt/formatting.c:314">NUM_F_EEEE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Format parser, search small keywords and keyword's suffixes, and make<br/></li>
<li></span><span class="Comment"> * format-node tree.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * for DATE-TIME &amp; NUMBER version<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1328">&#x200c;</a></span><span class="linkable">parse_format</span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *kw,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *suf, <span class="Type">const</span> <span class="Type">int</span> *index, uint32 flags, <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *Num)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;to_char/number(): run parser&quot;</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; n = node;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*str)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; suffix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <a href="#L128" title="utils/adt/formatting.c:128">KeySuffix</a> *s;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Prefix<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((flags &amp; <a href="#L99" title="utils/adt/formatting.c:99">DCH_FLAG</a>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (s = <a href="#L1123" title="utils/adt/formatting.c:1123">suff_search</a>(str, suf, <a href="#L167" title="utils/adt/formatting.c:167">SUFFTYPE_PREFIX</a>)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; suffix |= s-&gt;id;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s-&gt;len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str += s-&gt;len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Keyword<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*str &amp;&amp; (n-&gt;key = <a href="#L1099" title="utils/adt/formatting.c:1099">index_seq_search</a>(str, kw, index)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;type = <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;suffix = suffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;key-&gt;len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str += n-&gt;key-&gt;len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * NUM version: Prepare global <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> struct<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="#L100" title="utils/adt/formatting.c:100">NUM_FLAG</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1153" title="utils/adt/formatting.c:1153">NUMDesc_prepare</a>(Num, n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Postfix<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((flags &amp; <a href="#L99" title="utils/adt/formatting.c:99">DCH_FLAG</a>) &amp;&amp; *str &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (s = <a href="#L1123" title="utils/adt/formatting.c:1123">suff_search</a>(str, suf, <a href="#L168" title="utils/adt/formatting.c:168">SUFFTYPE_POSTFIX</a>)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;suffix |= s-&gt;id;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s-&gt;len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str += s-&gt;len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*str)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chlen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((flags &amp; <a href="#L101" title="utils/adt/formatting.c:101">STD_FLAG</a>) &amp;&amp; *str != <span class="Constant">'&quot;'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Standard mode, allow only following separators: &quot;-./,':; &quot;.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * However, we support double quotes even in standard mode<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * (see below).&nbsp; This is our extension of standard mode.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strchr(<span class="Constant">&quot;-./,':; &quot;</span>, *str) == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid datetime format separator: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(str, <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str)))));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*str == <span class="Constant">' '</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;type = <a href="#L165" title="utils/adt/formatting.c:165">NODE_TYPE_SPACE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;type = <a href="#L164" title="utils/adt/formatting.c:164">NODE_TYPE_SEPARATOR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;character[<span class="Constant">0</span>] = *str;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;character[<span class="Constant">1</span>] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;key = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;suffix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*str == <span class="Constant">'&quot;'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Process double-quoted literal string, if <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*str)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*str == <span class="Constant">'&quot;'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* backslash quotes the <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> character, if <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*str == <span class="Special">'\\'</span> &amp;&amp; *(str + <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chlen = <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;type = <a href="#L163" title="utils/adt/formatting.c:163">NODE_TYPE_CHAR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(n-&gt;character, str, chlen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;character[chlen] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;key = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;suffix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str += chlen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Outside double-quoted strings, backslash is only special if<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * it immediately precedes a double quote.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*str == <span class="Special">'\\'</span> &amp;&amp; *(str + <span class="Constant">1</span>) == <span class="Constant">'&quot;'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chlen = <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((flags &amp; <a href="#L99" title="utils/adt/formatting.c:99">DCH_FLAG</a>) &amp;&amp; <a href="#L1139" title="utils/adt/formatting.c:1139">is_separator_char</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;type = <a href="#L164" title="utils/adt/formatting.c:164">NODE_TYPE_SEPARATOR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;type = <a href="#L165" title="utils/adt/formatting.c:165">NODE_TYPE_SPACE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;type = <a href="#L163" title="utils/adt/formatting.c:163">NODE_TYPE_CHAR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(n-&gt;character, str, chlen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;character[chlen] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;key = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;suffix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str += chlen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n-&gt;type = <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>;<br/></li>
<li>&nbsp; &nbsp; n-&gt;suffix = <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * DEBUG: Dump the <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> Tree (debug)<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span><br/></li>
<li><a id="L1476">&#x200c;</a><span class="PreProc">#define <span class="linkable">DUMP_THth</span>(_suf) (<a href="#L553" title="utils/adt/formatting.c:553">S_TH</a>(_suf) ? </span><span class="Constant">&quot;TH&quot;</span><span class="PreProc"> : (<a href="#L554" title="utils/adt/formatting.c:554">S_th</a>(_suf) ? </span><span class="Constant">&quot;th&quot;</span><span class="PreProc"> : </span><span class="Constant">&quot; &quot;</span><span class="PreProc">))<br/></li>
<li><a id="L1477">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DUMP_FM</span>(_suf)&nbsp; &nbsp; (<a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(_suf) ? </span><span class="Constant">&quot;FM&quot;</span><span class="PreProc"> : </span><span class="Constant">&quot; &quot;</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1480">&#x200c;</a></span><span class="linkable">dump_node</span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type">int</span> max)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;to_from-char(): DUMP FORMAT&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (a = <span class="Constant">0</span>, n = node; a &lt;= max; n++, a++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type == <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">:</span><span class="Special">\t</span><span class="Constant"> <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a> '</span><span class="Special">%s</span><span class="Constant">'</span><span class="Special">\t</span><span class="Constant">(</span><span class="Special">%s</span><span class="Constant">,</span><span class="Special">%s</span><span class="Constant">)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; a, n-&gt;key-&gt;name, <a href="#L1476" title="utils/adt/formatting.c:1476">DUMP_THth</a>(n-&gt;suffix), <a href="#L1477" title="utils/adt/formatting.c:1477">DUMP_FM</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (n-&gt;type == <a href="#L163" title="utils/adt/formatting.c:163">NODE_TYPE_CHAR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">:</span><span class="Special">\t</span><span class="Constant"> <a href="#L163" title="utils/adt/formatting.c:163">NODE_TYPE_CHAR</a> '</span><span class="Special">%s</span><span class="Constant">'&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; a, n-&gt;character);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (n-&gt;type == <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">:</span><span class="Special">\t</span><span class="Constant"> <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>&quot;</span>, a);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">:</span><span class="Special">\t</span><span class="Constant"> unknown <a href="tsquery_cleanup.c.html#L22" title="utils/adt/tsquery_cleanup.c:22">NODE</a>!&quot;</span>, a);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* DEBUG */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*****************************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Private utils<br/></li>
<li></span><span class="Comment"> *****************************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Return ST/ND/RD/TH for simple (1..9) numbers<br/></li>
<li></span><span class="Comment"> * type --&gt; 0 <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a>, 1 <a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a><br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1516">&#x200c;</a><span class="linkable">get_th</span>(<span class="Type">char</span> *num, <span class="Type">int</span> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = strlen(num),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; last = *(num + (len - <span class="Constant">1</span>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) last))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_TEXT_REPRESENTATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> is not a number&quot;</span>, num)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * All &quot;teens&quot; (&lt;x&gt;1[0-9]) get 'TH/th', while &lt;x&gt;[02-9][123] still get<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * 'ST/st', 'ND/nd', 'RD/rd', respectively<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> ((len &gt; <span class="Constant">1</span>) &amp;&amp; (num[len - <span class="Constant">2</span>] == <span class="Constant">'1'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; last = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (last)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'1'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type == <a href="#L277" title="utils/adt/formatting.c:277">TH_UPPER</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L270" title="utils/adt/formatting.c:270">numTH</a>[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L271" title="utils/adt/formatting.c:271">numth</a>[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'2'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type == <a href="#L277" title="utils/adt/formatting.c:277">TH_UPPER</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L270" title="utils/adt/formatting.c:270">numTH</a>[<span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L271" title="utils/adt/formatting.c:271">numth</a>[<span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'3'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type == <a href="#L277" title="utils/adt/formatting.c:277">TH_UPPER</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L270" title="utils/adt/formatting.c:270">numTH</a>[<span class="Constant">2</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L271" title="utils/adt/formatting.c:271">numth</a>[<span class="Constant">2</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type == <a href="#L277" title="utils/adt/formatting.c:277">TH_UPPER</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L270" title="utils/adt/formatting.c:270">numTH</a>[<span class="Constant">3</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L271" title="utils/adt/formatting.c:271">numth</a>[<span class="Constant">3</span>];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Convert string-number to ordinal string-number<br/></li>
<li></span><span class="Comment"> * type --&gt; 0 <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a>, 1 <a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a><br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1561">&#x200c;</a><span class="linkable">str_numth</span>(<span class="Type">char</span> *dest, <span class="Type">char</span> *num, <span class="Type">int</span> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dest != num)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcpy(dest, num);<br/></li>
<li>&nbsp; &nbsp; strcat(dest, <a href="#L1516" title="utils/adt/formatting.c:1516">get_th</a>(num, type));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dest;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*****************************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a>/<a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a>/<a href="oracle_compat.c.html#L114" title="utils/adt/oracle_compat.c:114">initcap</a> <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a><br/></li>
<li></span><span class="Comment"> *****************************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef USE_ICU<br/></li>
<li></span><br/></li>
<li><a id="L1575">&#x200c;</a><span class="Type">typedef</span> <span class="Type">int32_t</span> (*<span class="linkable">ICU_Convert_Func</span>) (UChar *dest, <span class="Type">int32_t</span> destCapacity,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> UChar *src, <span class="Type">int32_t</span> srcLength,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <span class="Type">char</span> *locale,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; UErrorCode *pErrorCode);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int32_t<br/></li>
<li><a id="L1581">&#x200c;</a></span><span class="linkable">icu_convert_case</span>(<a href="#L1575" title="utils/adt/formatting.c:1575">ICU_Convert_Func</a> func, pg_locale_t mylocale,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; UChar **buff_dest, UChar *buff_source, <span class="Type">int32_t</span> len_source)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; UErrorCode&nbsp; &nbsp; status;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int32_t</span>&nbsp; &nbsp; &nbsp; &nbsp; len_dest;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len_dest = len_source;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* try first with same length */<br/></li>
<li></span>&nbsp; &nbsp; *buff_dest = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(len_dest * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(**buff_dest));<br/></li>
<li>&nbsp; &nbsp; status = U_ZERO_ERROR;<br/></li>
<li>&nbsp; &nbsp; len_dest = func(*buff_dest, len_dest, buff_source, len_source,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mylocale-&gt;info.icu.locale, &amp;status);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (status == U_BUFFER_OVERFLOW_ERROR)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* try again with adjusted length */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(*buff_dest);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *buff_dest = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(len_dest * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(**buff_dest));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; status = U_ZERO_ERROR;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len_dest = func(*buff_dest, len_dest, buff_source, len_source,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mylocale-&gt;info.icu.locale, &amp;status);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (U_FAILURE(status))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;case conversion failed: </span><span class="Special">%s</span><span class="Constant">&quot;</span>, u_errorName(status))));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> len_dest;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int32_t<br/></li>
<li><a id="L1608">&#x200c;</a></span><span class="linkable">u_strToTitle_default_BI</span>(UChar *dest, <span class="Type">int32_t</span> destCapacity,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> UChar *src, <span class="Type">int32_t</span> srcLength,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *locale,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UErrorCode *pErrorCode)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> u_strToTitle(dest, destCapacity, src, srcLength,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>, locale, pErrorCode);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* USE_ICU */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * If the system provides the needed <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> for wide-character manipulation<br/></li>
<li></span><span class="Comment"> * (which are all standardized by C99), then we implement <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a>/<a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a>/<a href="oracle_compat.c.html#L114" title="utils/adt/oracle_compat.c:114">initcap</a><br/></li>
<li></span><span class="Comment"> * using wide-character <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>, if necessary.&nbsp; Otherwise we use the<br/></li>
<li></span><span class="Comment"> * traditional &lt;ctype.h&gt; <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>, which of course will not work as desired<br/></li>
<li></span><span class="Comment"> * in multibyte character sets.&nbsp; Note that in either case we are effectively<br/></li>
<li></span><span class="Comment"> * assuming that the database character encoding matches the encoding implied<br/></li>
<li></span><span class="Comment"> * by LC_CTYPE.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * collation-aware, wide-character-aware <a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a> function<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We pass the number of bytes so we can pass varlena and char*<br/></li>
<li></span><span class="Comment"> * to this function.&nbsp; The result is a <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'d, null-terminated string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L1636">&#x200c;</a><span class="linkable">str_tolower</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, <span class="Type">size_t</span> nbytes, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!buff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(collid))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This typically means that the parser could not resolve a conflict<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * of implicit collations, so report it that way.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INDETERMINATE_COLLATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;could not determine which collation to use for </span><span class="Special">%s</span><span class="Constant"> function&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;<a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a>()&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;Use the COLLATE clause to set the collation explicitly.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* C/POSIX collations use this path regardless of database encoding */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="pg_locale.c.html#L1384" title="utils/adt/pg_locale.c:1384">lc_ctype_is_c</a>(collid))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = <a href="#L2158" title="utils/adt/formatting.c:2158">asc_tolower</a>(buff, nbytes);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pg_locale_t mylocale;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; mylocale = <a href="pg_locale.c.html#L1551" title="utils/adt/pg_locale.c:1551">pg_newlocale_from_collation</a>(collid);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef USE_ICU<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale &amp;&amp; mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_ICU)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int32_t</span>&nbsp; &nbsp; &nbsp; &nbsp; len_uchar;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int32_t</span>&nbsp; &nbsp; &nbsp; &nbsp; len_conv;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UChar&nbsp; &nbsp; &nbsp;&nbsp; *buff_uchar;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UChar&nbsp; &nbsp; &nbsp;&nbsp; *buff_conv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_uchar = <a href="pg_locale.c.html#L2741" title="utils/adt/pg_locale.c:2741">icu_to_uchar</a>(&amp;buff_uchar, buff, nbytes);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_conv = <a href="#L1581" title="utils/adt/formatting.c:1581">icu_convert_case</a>(u_strToLower, mylocale,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;buff_conv, buff_uchar, len_uchar);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L2768" title="utils/adt/pg_locale.c:2768">icu_from_uchar</a>(&amp;result, buff_conv, len_conv);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(buff_uchar);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(buff_conv);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale &amp;&amp; mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_BUILTIN)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *src = buff;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; srclen = nbytes;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; dstsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; needed;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(<a href="../mb/mbutils.c.html#L1261" title="utils/mb/mbutils.c:1261">GetDatabaseEncoding</a>() == PG_UTF8);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* first try buffer of <a href="../../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> size plus terminating NUL */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dstsize = srclen + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(dstsize);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; needed = unicode_strlower(dst, dstsize, src, srclen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (needed + <span class="Constant">1</span> &gt; dstsize)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* grow buffer if needed and retry */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dstsize = needed + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="../mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(dst, dstsize);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; needed = unicode_strlower(dst, dstsize, src, srclen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(needed + <span class="Constant">1</span> == dstsize);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(dst[needed] == <span class="Special">'\0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(!mylocale || mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_LIBC);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../mb/mbutils.c.html#L1546" title="utils/mb/mbutils.c:1546">pg_database_encoding_max_length</a>() &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">wchar_t</span>&nbsp; &nbsp; *workspace;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; curr_char;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; result_size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Overflow paranoia */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((nbytes + <span class="Constant">1</span>) &gt; (<span class="Constant">INT_MAX</span> / <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">wchar_t</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_OUT_OF_MEMORY),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;out of memory&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Output workspace cannot have more codes than input bytes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace = (<span class="Type">wchar_t</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((nbytes + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">wchar_t</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L3121" title="utils/adt/pg_locale.c:3121">char2wchar</a>(workspace, nbytes + <span class="Constant">1</span>, buff, nbytes, mylocale);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (curr_char = <span class="Constant">0</span>; workspace[curr_char] != <span class="Constant">0</span>; curr_char++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towlower_l(workspace[curr_char], mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towlower(workspace[curr_char]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Make result large enough; case change might change number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * of bytes<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result_size = curr_char * <a href="../mb/mbutils.c.html#L1546" title="utils/mb/mbutils.c:1546">pg_database_encoding_max_length</a>() + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(result_size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L3065" title="utils/adt/pg_locale.c:3065">wchar2char</a>(result, workspace, result_size, mylocale);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(workspace);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(buff, nbytes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Note: we assume that tolower_l() will not be so broken as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * to need an isupper_l() guard test.&nbsp; When using the default<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * collation, we apply the traditional Postgres behavior that<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * forces ASCII-style treatment of I/i, but in non-default<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * collations you get exactly what the collation says.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = result; *p; p++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = tolower_l((<span class="Type">unsigned</span> <span class="Type">char</span>) *p, mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = pg_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * collation-aware, wide-character-aware <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a> function<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We pass the number of bytes so we can pass varlena and char*<br/></li>
<li></span><span class="Comment"> * to this function.&nbsp; The result is a <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'d, null-terminated string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L1784">&#x200c;</a><span class="linkable">str_toupper</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, <span class="Type">size_t</span> nbytes, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!buff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(collid))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This typically means that the parser could not resolve a conflict<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * of implicit collations, so report it that way.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INDETERMINATE_COLLATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;could not determine which collation to use for </span><span class="Special">%s</span><span class="Constant"> function&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;<a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a>()&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;Use the COLLATE clause to set the collation explicitly.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* C/POSIX collations use this path regardless of database encoding */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="pg_locale.c.html#L1384" title="utils/adt/pg_locale.c:1384">lc_ctype_is_c</a>(collid))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = <a href="#L2181" title="utils/adt/formatting.c:2181">asc_toupper</a>(buff, nbytes);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pg_locale_t mylocale;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; mylocale = <a href="pg_locale.c.html#L1551" title="utils/adt/pg_locale.c:1551">pg_newlocale_from_collation</a>(collid);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef USE_ICU<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale &amp;&amp; mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_ICU)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int32_t</span>&nbsp; &nbsp; &nbsp; &nbsp; len_uchar,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_conv;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UChar&nbsp; &nbsp; &nbsp;&nbsp; *buff_uchar;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UChar&nbsp; &nbsp; &nbsp;&nbsp; *buff_conv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_uchar = <a href="pg_locale.c.html#L2741" title="utils/adt/pg_locale.c:2741">icu_to_uchar</a>(&amp;buff_uchar, buff, nbytes);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_conv = <a href="#L1581" title="utils/adt/formatting.c:1581">icu_convert_case</a>(u_strToUpper, mylocale,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;buff_conv, buff_uchar, len_uchar);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L2768" title="utils/adt/pg_locale.c:2768">icu_from_uchar</a>(&amp;result, buff_conv, len_conv);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(buff_uchar);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(buff_conv);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale &amp;&amp; mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_BUILTIN)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *src = buff;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; srclen = nbytes;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; dstsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; needed;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(<a href="../mb/mbutils.c.html#L1261" title="utils/mb/mbutils.c:1261">GetDatabaseEncoding</a>() == PG_UTF8);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* first try buffer of <a href="../../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> size plus terminating NUL */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dstsize = srclen + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(dstsize);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; needed = unicode_strupper(dst, dstsize, src, srclen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (needed + <span class="Constant">1</span> &gt; dstsize)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* grow buffer if needed and retry */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dstsize = needed + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="../mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(dst, dstsize);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; needed = unicode_strupper(dst, dstsize, src, srclen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(needed + <span class="Constant">1</span> == dstsize);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(dst[needed] == <span class="Special">'\0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(!mylocale || mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_LIBC);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../mb/mbutils.c.html#L1546" title="utils/mb/mbutils.c:1546">pg_database_encoding_max_length</a>() &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">wchar_t</span>&nbsp; &nbsp; *workspace;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; curr_char;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; result_size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Overflow paranoia */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((nbytes + <span class="Constant">1</span>) &gt; (<span class="Constant">INT_MAX</span> / <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">wchar_t</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_OUT_OF_MEMORY),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;out of memory&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Output workspace cannot have more codes than input bytes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace = (<span class="Type">wchar_t</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((nbytes + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">wchar_t</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L3121" title="utils/adt/pg_locale.c:3121">char2wchar</a>(workspace, nbytes + <span class="Constant">1</span>, buff, nbytes, mylocale);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (curr_char = <span class="Constant">0</span>; workspace[curr_char] != <span class="Constant">0</span>; curr_char++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towupper_l(workspace[curr_char], mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towupper(workspace[curr_char]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Make result large enough; case change might change number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * of bytes<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result_size = curr_char * <a href="../mb/mbutils.c.html#L1546" title="utils/mb/mbutils.c:1546">pg_database_encoding_max_length</a>() + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(result_size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L3065" title="utils/adt/pg_locale.c:3065">wchar2char</a>(result, workspace, result_size, mylocale);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(workspace);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(buff, nbytes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Note: we assume that toupper_l() will not be so broken as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * to need an islower_l() guard test.&nbsp; When using the default<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * collation, we apply the traditional Postgres behavior that<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * forces ASCII-style treatment of I/i, but in non-default<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * collations you get exactly what the collation says.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = result; *p; p++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = toupper_l((<span class="Type">unsigned</span> <span class="Type">char</span>) *p, mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = pg_toupper((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L1925">&#x200c;</a><span class="Type">struct</span> <span class="linkable">WordBoundaryState</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *str;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; offset;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; init;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; prev_alnum;<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Simple <a href="../../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> boundary iterator that draws boundaries each time the result of<br/></li>
<li></span><span class="Comment"> * pg_u_isalnum() changes.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">size_t<br/></li>
<li><a id="L1939">&#x200c;</a></span><span class="linkable">initcap_wbnext</span>(<span class="Type">void</span> *state)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L1925" title="utils/adt/formatting.c:1925">WordBoundaryState</a> *wbstate = (<span class="Type">struct</span> <a href="#L1925" title="utils/adt/formatting.c:1925">WordBoundaryState</a> *) state;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (wbstate-&gt;offset &lt; wbstate-&gt;len &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; wbstate-&gt;str[wbstate-&gt;offset] != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pg_wchar&nbsp; &nbsp; u = utf8_to_unicode((<span class="Type">unsigned</span> <span class="Type">char</span> *) wbstate-&gt;str +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wbstate-&gt;offset);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; curr_alnum = pg_u_isalnum(u, <span class="Constant">true</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!wbstate-&gt;init || curr_alnum != wbstate-&gt;prev_alnum)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; prev_offset = wbstate-&gt;offset;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wbstate-&gt;init = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wbstate-&gt;offset += unicode_utf8len(u);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wbstate-&gt;prev_alnum = curr_alnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> prev_offset;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wbstate-&gt;offset += unicode_utf8len(u);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> wbstate-&gt;len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * collation-aware, wide-character-aware <a href="oracle_compat.c.html#L114" title="utils/adt/oracle_compat.c:114">initcap</a> function<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We pass the number of bytes so we can pass varlena and char*<br/></li>
<li></span><span class="Comment"> * to this function.&nbsp; The result is a <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'d, null-terminated string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L1973">&#x200c;</a><span class="linkable">str_initcap</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, <span class="Type">size_t</span> nbytes, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wasalnum = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!buff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(collid))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This typically means that the parser could not resolve a conflict<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * of implicit collations, so report it that way.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INDETERMINATE_COLLATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;could not determine which collation to use for </span><span class="Special">%s</span><span class="Constant"> function&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;<a href="oracle_compat.c.html#L114" title="utils/adt/oracle_compat.c:114">initcap</a>()&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;Use the COLLATE clause to set the collation explicitly.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* C/POSIX collations use this path regardless of database encoding */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="pg_locale.c.html#L1384" title="utils/adt/pg_locale.c:1384">lc_ctype_is_c</a>(collid))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = <a href="#L2204" title="utils/adt/formatting.c:2204">asc_initcap</a>(buff, nbytes);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pg_locale_t mylocale;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; mylocale = <a href="pg_locale.c.html#L1551" title="utils/adt/pg_locale.c:1551">pg_newlocale_from_collation</a>(collid);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef USE_ICU<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale &amp;&amp; mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_ICU)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int32_t</span>&nbsp; &nbsp; &nbsp; &nbsp; len_uchar,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_conv;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UChar&nbsp; &nbsp; &nbsp;&nbsp; *buff_uchar;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UChar&nbsp; &nbsp; &nbsp;&nbsp; *buff_conv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_uchar = <a href="pg_locale.c.html#L2741" title="utils/adt/pg_locale.c:2741">icu_to_uchar</a>(&amp;buff_uchar, buff, nbytes);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len_conv = <a href="#L1581" title="utils/adt/formatting.c:1581">icu_convert_case</a>(<a href="#L1608" title="utils/adt/formatting.c:1608">u_strToTitle_default_BI</a>, mylocale,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;buff_conv, buff_uchar, len_uchar);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L2768" title="utils/adt/pg_locale.c:2768">icu_from_uchar</a>(&amp;result, buff_conv, len_conv);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(buff_uchar);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(buff_conv);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale &amp;&amp; mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_BUILTIN)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *src = buff;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; srclen = nbytes;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; dstsize;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; needed;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="#L1925" title="utils/adt/formatting.c:1925">WordBoundaryState</a> wbstate = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .str = src,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .len = srclen,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .offset = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .init = <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .prev_alnum = <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(<a href="../mb/mbutils.c.html#L1261" title="utils/mb/mbutils.c:1261">GetDatabaseEncoding</a>() == PG_UTF8);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* first try buffer of <a href="../../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> size plus terminating NUL */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dstsize = srclen + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(dstsize);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; needed = unicode_strtitle(dst, dstsize, src, srclen,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1939" title="utils/adt/formatting.c:1939">initcap_wbnext</a>, &amp;wbstate);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (needed + <span class="Constant">1</span> &gt; dstsize)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* reset iterator */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wbstate.offset = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wbstate.init = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* grow buffer if needed and retry */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dstsize = needed + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="../mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(dst, dstsize);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; needed = unicode_strtitle(dst, dstsize, src, srclen,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1939" title="utils/adt/formatting.c:1939">initcap_wbnext</a>, &amp;wbstate);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(needed + <span class="Constant">1</span> == dstsize);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(!mylocale || mylocale-&gt;<a href="../../jit/jit.c.html#L43" title="jit/jit.c:43">provider</a> == COLLPROVIDER_LIBC);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../mb/mbutils.c.html#L1546" title="utils/mb/mbutils.c:1546">pg_database_encoding_max_length</a>() &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">wchar_t</span>&nbsp; &nbsp; *workspace;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; curr_char;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; result_size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Overflow paranoia */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((nbytes + <span class="Constant">1</span>) &gt; (<span class="Constant">INT_MAX</span> / <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">wchar_t</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_OUT_OF_MEMORY),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;out of memory&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Output workspace cannot have more codes than input bytes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace = (<span class="Type">wchar_t</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((nbytes + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">wchar_t</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L3121" title="utils/adt/pg_locale.c:3121">char2wchar</a>(workspace, nbytes + <span class="Constant">1</span>, buff, nbytes, mylocale);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (curr_char = <span class="Constant">0</span>; workspace[curr_char] != <span class="Constant">0</span>; curr_char++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wasalnum)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towlower_l(workspace[curr_char], mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towupper_l(workspace[curr_char], mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wasalnum = iswalnum_l(workspace[curr_char], mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wasalnum)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towlower(workspace[curr_char]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; workspace[curr_char] = towupper(workspace[curr_char]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wasalnum = iswalnum(workspace[curr_char]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Make result large enough; case change might change number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * of bytes<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result_size = curr_char * <a href="../mb/mbutils.c.html#L1546" title="utils/mb/mbutils.c:1546">pg_database_encoding_max_length</a>() + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(result_size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="pg_locale.c.html#L3065" title="utils/adt/pg_locale.c:3065">wchar2char</a>(result, workspace, result_size, mylocale);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(workspace);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(buff, nbytes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Note: we assume that toupper_l()/tolower_l() will not be so<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * broken as to need guard tests.&nbsp; When using the default<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * collation, we apply the traditional Postgres behavior that<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * forces ASCII-style treatment of I/i, but in non-default<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * collations you get exactly what the collation says.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = result; *p; p++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mylocale)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wasalnum)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = tolower_l((<span class="Type">unsigned</span> <span class="Type">char</span>) *p, mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = toupper_l((<span class="Type">unsigned</span> <span class="Type">char</span>) *p, mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wasalnum = isalnum_l((<span class="Type">unsigned</span> <span class="Type">char</span>) *p, mylocale-&gt;info.lt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wasalnum)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = pg_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = pg_toupper((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wasalnum = isalnum((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * ASCII-only <a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a> function<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We pass the number of bytes so we can pass varlena and char*<br/></li>
<li></span><span class="Comment"> * to this function.&nbsp; The result is a <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'d, null-terminated string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L2158">&#x200c;</a><span class="linkable">asc_tolower</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, <span class="Type">size_t</span> nbytes)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!buff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(buff, nbytes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p = result; *p; p++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p = pg_ascii_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * ASCII-only <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a> function<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We pass the number of bytes so we can pass varlena and char*<br/></li>
<li></span><span class="Comment"> * to this function.&nbsp; The result is a <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'d, null-terminated string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L2181">&#x200c;</a><span class="linkable">asc_toupper</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, <span class="Type">size_t</span> nbytes)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!buff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(buff, nbytes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p = result; *p; p++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p = pg_ascii_toupper((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * ASCII-only <a href="oracle_compat.c.html#L114" title="utils/adt/oracle_compat.c:114">initcap</a> function<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We pass the number of bytes so we can pass varlena and char*<br/></li>
<li></span><span class="Comment"> * to this function.&nbsp; The result is a <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'d, null-terminated string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">char</span> *<br/></li>
<li><a id="L2204">&#x200c;</a><span class="linkable">asc_initcap</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, <span class="Type">size_t</span> nbytes)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wasalnum = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!buff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(buff, nbytes);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p = result; *p; p++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wasalnum)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = c = pg_ascii_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = c = pg_ascii_toupper((<span class="Type">unsigned</span> <span class="Type">char</span>) *p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we don't trust isalnum() here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; wasalnum = ((c &gt;= <span class="Constant">'A'</span> &amp;&amp; c &lt;= <span class="Constant">'Z'</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (c &gt;= <span class="Constant">'a'</span> &amp;&amp; c &lt;= <span class="Constant">'z'</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (c &gt;= <span class="Constant">'0'</span> &amp;&amp; c &lt;= <span class="Constant">'9'</span>));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* convenience routines for when the input is null-terminated */<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L2235">&#x200c;</a><span class="linkable">str_tolower_z</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1636" title="utils/adt/formatting.c:1636">str_tolower</a>(buff, strlen(buff), collid);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L2241">&#x200c;</a><span class="linkable">str_toupper_z</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1784" title="utils/adt/formatting.c:1784">str_toupper</a>(buff, strlen(buff), collid);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L2247">&#x200c;</a><span class="linkable">str_initcap_z</span>(<span class="Type">const</span> <span class="Type">char</span> *buff, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1973" title="utils/adt/formatting.c:1973">str_initcap</a>(buff, strlen(buff), collid);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L2253">&#x200c;</a><span class="linkable">asc_tolower_z</span>(<span class="Type">const</span> <span class="Type">char</span> *buff)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2158" title="utils/adt/formatting.c:2158">asc_tolower</a>(buff, strlen(buff));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L2259">&#x200c;</a><span class="linkable">asc_toupper_z</span>(<span class="Type">const</span> <span class="Type">char</span> *buff)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2181" title="utils/adt/formatting.c:2181">asc_toupper</a>(buff, strlen(buff));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* asc_initcap_z is not currently needed */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Skip TM / th in FROM_CHAR<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If <a href="#L552" title="utils/adt/formatting.c:552">S_THth</a> is on, <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> two chars, assuming there are two available<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L2273">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SKIP_THth</span>(ptr, _suf) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">do</span><span class="PreProc"> { \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(_suf)) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; { \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (*(ptr)) (ptr) += <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(ptr); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (*(ptr)) (ptr) += <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(ptr); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; } \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; } </span><span class="Statement">while</span><span class="PreProc"> (</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span><span class="Comment">/* -----------<br/></li>
<li></span><span class="Comment"> * DEBUG: Call for debug and for index checking; (Show ASCII char<br/></li>
<li></span><span class="Comment"> * and defined keyword for each used position<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L2290">&#x200c;</a></span><span class="linkable">dump_index</span>(<span class="Type">const</span> <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> *k, <span class="Type">const</span> <span class="Type">int</span> *index)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; free_i = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;TO-FROM_CHAR: Dump <a href="#L151" title="utils/adt/formatting.c:151">KeyWord</a> Index:&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L107" title="utils/adt/formatting.c:107">KeyWord_INDEX_SIZE</a>; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (index[i] != -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;</span><span class="Special">\t%c</span><span class="Constant">: </span><span class="Special">%s</span><span class="Constant">, &quot;</span>, i + <span class="Constant">32</span>, k[index[i]].name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; free_i++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">(</span><span class="Special">%d</span><span class="Constant">) </span><span class="Special">%c</span><span class="Constant"> </span><span class="Special">%d</span><span class="Constant">&quot;</span>, i, i + <span class="Constant">32</span>, index[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;</span><span class="Special">\n\t\t</span><span class="Constant">Used positions: </span><span class="Special">%d</span><span class="Constant">,</span><span class="Special">\n\t\t</span><span class="Constant">Free positions: </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; count, free_i);<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* DEBUG */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Return true if <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> format picture is not digit value<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L2321">&#x200c;</a></span><span class="linkable">is_next_separator</span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type == <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type == <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a> &amp;&amp; <a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Next node<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; n++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* end of format string is treated like a non-digit separator */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type == <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type == <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;key-&gt;is_digit)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (n-&gt;character[<span class="Constant">1</span>] == <span class="Special">'\0'</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) n-&gt;character[<span class="Constant">0</span>]))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* some non-digit input (separator) */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2354">&#x200c;</a></span><span class="linkable">adjust_partial_year_to_2020</span>(<span class="Type">int</span> year)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Adjust all dates toward 2020; this is effectively what happens when we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * assume '70' is 1970 and '69' is 2069.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* Force 0-69 into the 2000's */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (year &lt; <span class="Constant">70</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> year + <span class="Constant">2000</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Force 70-99 into the 1900's */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (year &lt; <span class="Constant">100</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> year + <span class="Constant">1900</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Force 100-519 into the 2000's */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (year &lt; <span class="Constant">520</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> year + <span class="Constant">2000</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Force 520-999 into the 1000's */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (year &lt; <span class="Constant">1000</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> year + <span class="Constant">1000</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> year;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2378">&#x200c;</a></span><span class="linkable">strspace_len</span>(<span class="Type">const</span> <span class="Type">char</span> *str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*str &amp;&amp; isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *str))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; str++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Set the date mode of a from-char conversion.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Puke if the date mode has already been set, and the caller attempts to set<br/></li>
<li></span><span class="Comment"> * it to a conflicting mode.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true on success, false on failure (if escontext points to an<br/></li>
<li></span><span class="Comment"> * ErrorSaveContext; otherwise errors are thrown).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L2400">&#x200c;</a></span><span class="linkable">from_char_set_mode</span>(<a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a> *tmfc, <span class="Type">const</span> <a href="#L142" title="utils/adt/formatting.c:142">FromCharDateMode</a> mode,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (mode != FROM_CHAR_DATE_NONE)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc-&gt;mode == FROM_CHAR_DATE_NONE)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmfc-&gt;mode = mode;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (tmfc-&gt;mode != mode)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid combination of date conventions&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;Do not mix Gregorian and ISO week date &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;conventions in a formatting template.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Set the integer pointed to by 'dest' to the given value.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Puke if the destination integer has previously been set to some other<br/></li>
<li></span><span class="Comment"> * non-zero value.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true on success, false on failure (if escontext points to an<br/></li>
<li></span><span class="Comment"> * ErrorSaveContext; otherwise errors are thrown).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L2427">&#x200c;</a></span><span class="linkable">from_char_set_int</span>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">int</span> value, <span class="Type">const</span> <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*dest != <span class="Constant">0</span> &amp;&amp; *dest != value)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;conflicting <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> for </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> field in formatting string&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node-&gt;key-&gt;name),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;This value contradicts a previous setting &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;for the same field type.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; *dest = value;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Read a single integer from the source string, into the int pointed to by<br/></li>
<li></span><span class="Comment"> * 'dest'. If 'dest' is NULL, the result is discarded.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * In fixed-width mode (the node does not have the FM suffix), consume at most<br/></li>
<li></span><span class="Comment"> * 'len' characters.&nbsp; However, <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> leading whitespace isn't counted in 'len'.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We use strtol() to recover the integer value from the source string, in<br/></li>
<li></span><span class="Comment"> * accordance with the given <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If the conversion completes successfully, src will have been advanced to<br/></li>
<li></span><span class="Comment"> * point at the character immediately following the last character used in the<br/></li>
<li></span><span class="Comment"> * conversion.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns the number of characters consumed, or -1 on error (if escontext<br/></li>
<li></span><span class="Comment"> * points to an ErrorSaveContext; otherwise errors are thrown).<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note that <a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>() provides a more convenient wrapper where<br/></li>
<li></span><span class="Comment"> * the length of the field is the same as the length of the format keyword (as<br/></li>
<li></span><span class="Comment"> * with DD and MI).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2463">&#x200c;</a></span><span class="linkable">from_char_parse_int_len</span>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">char</span> **src, <span class="Type">const</span> <span class="Type">int</span> len, <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; copy[<a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a> + <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *init = *src;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; used;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Skip <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> whitespace <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> parsing the integer.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; *src += <a href="#L2378" title="utils/adt/formatting.c:2378">strspace_len</a>(*src);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(len &lt;= <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>);<br/></li>
<li>&nbsp; &nbsp; used = (<span class="Type">int</span>) strlcpy(copy, *src, len + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(node-&gt;suffix) || <a href="#L2321" title="utils/adt/formatting.c:2321">is_next_separator</a>(node))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This node is in Fill <a href="../init/miscinit.c.html#L61" title="utils/init/miscinit.c:61">Mode</a>, or the <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> node is known to be a<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * non-digit value, so we just slurp as many characters as we can get.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *endptr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; errno = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = strtol(init, &amp;endptr, <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *src = endptr;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We need to <a href="../../regex/regc_nfa.c.html#L1713" title="regex/regc_nfa.c:1713">pull</a> exactly the number of characters given in 'len' out<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * of the string, and convert those.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *last;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (used &lt; len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;source string too short for </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> formatting field&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node-&gt;key-&gt;name),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;Field requires </span><span class="Special">%d</span><span class="Constant"> characters, but only </span><span class="Special">%d</span><span class="Constant"> remain.&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len, used),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;If your source string is not fixed-width, &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;try using the </span><span class="Special">\&quot;</span><span class="Constant">FM</span><span class="Special">\&quot;</span><span class="Constant"> modifier.&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; errno = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = strtol(copy, &amp;last, <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; used = last - copy;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (used &gt; <span class="Constant">0</span> &amp;&amp; used &lt; len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> for </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; copy, node-&gt;key-&gt;name),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;Field requires </span><span class="Special">%d</span><span class="Constant"> characters, but only </span><span class="Special">%d</span><span class="Constant"> could be parsed.&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len, used),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;If your source string is not fixed-width, &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;try using the </span><span class="Special">\&quot;</span><span class="Constant">FM</span><span class="Special">\&quot;</span><span class="Constant"> modifier.&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *src += used;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*src == init)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> for </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; copy, node-&gt;key-&gt;name),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;Value must be an integer.&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (errno == <span class="Constant">ERANGE</span> || result &lt; <span class="Constant">INT_MIN</span> || result &gt; <span class="Constant">INT_MAX</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;value for </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> in source string is out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node-&gt;key-&gt;name),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;Value must be in the <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> </span><span class="Special">%d</span><span class="Constant"> to </span><span class="Special">%d</span><span class="Constant">.&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">INT_MIN</span>, <span class="Constant">INT_MAX</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dest != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(dest, (<span class="Type">int</span>) result, node, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> *src - init;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Call <a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(), using the length of the format keyword as<br/></li>
<li></span><span class="Comment"> * the expected length of the field.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Don't call this function if the field differs in length from the format<br/></li>
<li></span><span class="Comment"> * keyword (as with HH24; the keyword length is 4, but the field length is 2).<br/></li>
<li></span><span class="Comment"> * In such cases, call <a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>() instead to specify the<br/></li>
<li></span><span class="Comment"> * required length explicitly.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2560">&#x200c;</a></span><span class="linkable">from_char_parse_int</span>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">char</span> **src, <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(dest, src, node-&gt;key-&gt;len, node, escontext);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Sequentially search null-terminated &quot;array&quot; for a case-insensitive match<br/></li>
<li></span><span class="Comment"> * to the initial character(s) of &quot;name&quot;.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns array index of match, or -1 for no match.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * *len is set to the length of the match, or 0 for no match.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Case-insensitivity is defined per pg_ascii_tolower, so this is only<br/></li>
<li></span><span class="Comment"> * suitable for comparisons to ASCII strings.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2578">&#x200c;</a></span><span class="linkable">seq_search_ascii</span>(<span class="Type">const</span> <span class="Type">char</span> *name, <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> *array, <span class="Type">int</span> *len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> firstc;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> *a;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* empty string can't match anything */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!*name)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* we handle first char specially to gain some speed */<br/></li>
<li></span>&nbsp; &nbsp; firstc = pg_ascii_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) *name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (a = array; *a != <span class="Constant">NULL</span>; a++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../../optimizer/geqo/geqo_pool.c.html#L145" title="optimizer/geqo/geqo_pool.c:145">compare</a> first chars */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pg_ascii_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) **a) != firstc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../../optimizer/geqo/geqo_pool.c.html#L145" title="optimizer/geqo/geqo_pool.c:145">compare</a> rest of string */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = *a + <span class="Constant">1</span>, n = name + <span class="Constant">1</span>;; p++, n++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* return success if we matched whole array entry */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *len = n - name;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> a - array;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* else, must have another character in &quot;name&quot; ... */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*n == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ... and it must match */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pg_ascii_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) *p) !=<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pg_ascii_tolower((<span class="Type">unsigned</span> <span class="Type">char</span>) *n))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Sequentially search an array of possibly non-English words for<br/></li>
<li></span><span class="Comment"> * a case-insensitive match to the initial character(s) of &quot;name&quot;.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This has the same API as <a href="#L2578" title="utils/adt/formatting.c:2578">seq_search_ascii</a>(), but we use a more general<br/></li>
<li></span><span class="Comment"> * case-folding transformation to achieve case-insensitivity.&nbsp; Case folding<br/></li>
<li></span><span class="Comment"> * is done per the rules of the collation identified by &quot;collid&quot;.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The array is treated as const, but we don't declare it that way because<br/></li>
<li></span><span class="Comment"> * the arrays exported by pg_locale.c aren't const.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2635">&#x200c;</a></span><span class="linkable">seq_search_localized</span>(<span class="Type">const</span> <span class="Type">char</span> *name, <span class="Type">char</span> **array, <span class="Type">int</span> *len, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **a;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *upper_name;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *lower_name;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* empty string can't match anything */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!*name)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * The case-folding processing done below is fairly expensive, so <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * doing that, make a quick pass to see if there is an exact match.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (a = array; *a != <span class="Constant">NULL</span>; a++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; element_len = strlen(*a);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(name, *a, element_len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *len = element_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> a - array;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Fold to <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a> case, then to <a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a> case, so that we can match reliably<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * even in languages in which case conversions are not injective.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; upper_name = <a href="#L1784" title="utils/adt/formatting.c:1784">str_toupper</a>(unconstify(<span class="Type">char</span> *, name), strlen(name), collid);<br/></li>
<li>&nbsp; &nbsp; lower_name = <a href="#L1636" title="utils/adt/formatting.c:1636">str_tolower</a>(upper_name, strlen(upper_name), collid);<br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(upper_name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (a = array; *a != <span class="Constant">NULL</span>; a++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *upper_element;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *lower_element;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; element_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Likewise <a href="oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a>/<a href="oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a>-case array <a href="../../regex/regc_locale.c.html#L376" title="regex/regc_locale.c:376">element</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; upper_element = <a href="#L1784" title="utils/adt/formatting.c:1784">str_toupper</a>(*a, strlen(*a), collid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lower_element = <a href="#L1636" title="utils/adt/formatting.c:1636">str_tolower</a>(upper_element, strlen(upper_element),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(upper_element);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; element_len = strlen(lower_element);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Match? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(lower_name, lower_element, element_len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *len = element_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(lower_element);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(lower_name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> a - array;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(lower_element);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(lower_name);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Perform a sequential search in 'array' (or 'localized_array', if that's<br/></li>
<li></span><span class="Comment"> * not NULL) for an entry matching the first character(s) of the 'src'<br/></li>
<li></span><span class="Comment"> * string case-insensitively.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The 'array' is presumed to be English words (all-ASCII), but<br/></li>
<li></span><span class="Comment"> * if 'localized_array' is supplied, that might be non-English<br/></li>
<li></span><span class="Comment"> * so we need a more expensive case-folding transformation<br/></li>
<li></span><span class="Comment"> * (which will follow the rules of the collation 'collid').<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If a match is found, copy the array index of the match into the integer<br/></li>
<li></span><span class="Comment"> * pointed to by 'dest' and advance 'src' to the end of the part of the string<br/></li>
<li></span><span class="Comment"> * which matched.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true on match, false on failure (if escontext points to an<br/></li>
<li></span><span class="Comment"> * ErrorSaveContext; otherwise errors are thrown).<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * 'node' is used only for error reports: node-&gt;key-&gt;name identifies the<br/></li>
<li></span><span class="Comment"> * field type we were searching for.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L2719">&#x200c;</a></span><span class="linkable">from_char_seq_search</span>(<span class="Type">int</span> *dest, <span class="Type">const</span> <span class="Type">char</span> **src, <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> *array,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">char</span> **localized_array, Oid collid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (localized_array == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dest = <a href="#L2578" title="utils/adt/formatting.c:2578">seq_search_ascii</a>(*src, array, &amp;len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *dest = <a href="#L2635" title="utils/adt/formatting.c:2635">seq_search_localized</a>(*src, localized_array, &amp;len, collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &lt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In the error report, truncate the string at the <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> whitespace (if<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a>) to avoid including irrelevant data.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *copy = <a href="../mmgr/mcxt.c.html#L1695" title="utils/mmgr/mcxt.c:1695">pstrdup</a>(*src);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (c = copy; *c; c++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../parser/scansup.c.html#L117" title="parser/scansup.c:117">scanner_isspace</a>(*c))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> for </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; copy, node-&gt;key-&gt;name),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;The given value did not match <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> of &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;the allowed <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> for this field.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; *src += len;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Process a <a href="#L482" title="utils/adt/formatting.c:482">TmToChar</a> struct as denoted by a list of FormatNodes.<br/></li>
<li></span><span class="Comment"> * The formatted data is written to the string pointed to by 'out'.<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L2765">&#x200c;</a></span><span class="linkable">DCH_to_char</span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> is_interval, <a href="#L482" title="utils/adt/formatting.c:482">TmToChar</a> *in, <span class="Type">char</span> *out, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *s;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L469" title="utils/adt/formatting.c:469">fmt_tm</a> *tm = &amp;in-&gt;tm;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* cache localized <a href="datetime.c.html#L84" title="utils/adt/datetime.c:84">days</a> and <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a> */<br/></li>
<li></span>&nbsp; &nbsp; <a href="pg_locale.c.html#L806" title="utils/adt/pg_locale.c:806">cache_locale_time</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; s = out;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (n = node; n-&gt;type != <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>; n++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type != <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, n-&gt;character);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (n-&gt;key-&gt;id)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_A_M:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_P_M:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_hour % HOURS_PER_DAY &gt;= HOURS_PER_DAY / <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? <a href="#L228" title="utils/adt/formatting.c:228">P_M_STR</a> : <a href="#L223" title="utils/adt/formatting.c:223">A_M_STR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_AM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_PM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_hour % HOURS_PER_DAY &gt;= HOURS_PER_DAY / <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? <a href="#L230" title="utils/adt/formatting.c:230">PM_STR</a> : <a href="#L225" title="utils/adt/formatting.c:225">AM_STR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_a_m:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_p_m:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_hour % HOURS_PER_DAY &gt;= HOURS_PER_DAY / <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? <a href="#L229" title="utils/adt/formatting.c:229">p_m_STR</a> : <a href="#L224" title="utils/adt/formatting.c:224">a_m_STR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_am:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_pm:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_hour % HOURS_PER_DAY &gt;= HOURS_PER_DAY / <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? <a href="#L231" title="utils/adt/formatting.c:231">pm_STR</a> : <a href="#L226" title="utils/adt/formatting.c:226">am_STR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH12:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * display time as shown on a 12-hour clock, even for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * intervals<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*lld</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : (tm-&gt;tm_hour &gt;= <span class="Constant">0</span>) ? <span class="Constant">2</span> : <span class="Constant">3</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_hour % (HOURS_PER_DAY / <span class="Constant">2</span>) == <span class="Constant">0</span> ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">long</span> <span class="Type">long</span>) (HOURS_PER_DAY / <span class="Constant">2</span>) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">long</span> <span class="Type">long</span>) (tm-&gt;tm_hour % (HOURS_PER_DAY / <span class="Constant">2</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH24:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*lld</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : (tm-&gt;tm_hour &gt;= <span class="Constant">0</span>) ? <span class="Constant">2</span> : <span class="Constant">3</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">long</span> <span class="Type">long</span>) tm-&gt;tm_hour);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MI:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : (tm-&gt;tm_min &gt;= <span class="Constant">0</span>) ? <span class="Constant">2</span> : <span class="Constant">3</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_min);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_SS:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : (tm-&gt;tm_sec &gt;= <span class="Constant">0</span>) ? <span class="Constant">2</span> : <span class="Constant">3</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_sec);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li><a id="L2848">&#x200c;</a><span class="PreProc">#define <span class="linkable">DCH_to_char_fsec</span>(frac_fmt, frac_val) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, frac_fmt, (</span><span class="Type">int</span><span class="PreProc">) (frac_val)); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix)) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix)); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF1:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* tenth of second */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2848" title="utils/adt/formatting.c:2848">DCH_to_char_fsec</a>(<span class="Constant">&quot;</span><span class="Special">%01d</span><span class="Constant">&quot;</span>, in-&gt;fsec / <span class="Constant">100000</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF2:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* hundredth of second */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2848" title="utils/adt/formatting.c:2848">DCH_to_char_fsec</a>(<span class="Constant">&quot;</span><span class="Special">%02d</span><span class="Constant">&quot;</span>, in-&gt;fsec / <span class="Constant">10000</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF3:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MS:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* millisecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2848" title="utils/adt/formatting.c:2848">DCH_to_char_fsec</a>(<span class="Constant">&quot;</span><span class="Special">%03d</span><span class="Constant">&quot;</span>, in-&gt;fsec / <span class="Constant">1000</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF4:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* tenth of a millisecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2848" title="utils/adt/formatting.c:2848">DCH_to_char_fsec</a>(<span class="Constant">&quot;</span><span class="Special">%04d</span><span class="Constant">&quot;</span>, in-&gt;fsec / <span class="Constant">100</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF5:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* hundredth of a millisecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2848" title="utils/adt/formatting.c:2848">DCH_to_char_fsec</a>(<span class="Constant">&quot;</span><span class="Special">%05d</span><span class="Constant">&quot;</span>, in-&gt;fsec / <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_US:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* microsecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2848" title="utils/adt/formatting.c:2848">DCH_to_char_fsec</a>(<span class="Constant">&quot;</span><span class="Special">%06d</span><span class="Constant">&quot;</span>, in-&gt;fsec);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><a id="L2874">&#x200c;</a><span class="PreProc">#undef <span class="linkable">DCH_to_char_fsec</span><br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_SSSS:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%lld</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">long</span> <span class="Type">long</span>) (tm-&gt;tm_hour * SECS_PER_HOUR +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tm-&gt;tm_min * SECS_PER_MINUTE +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tm-&gt;tm_sec));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_tz:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L490" title="utils/adt/formatting.c:490">tmtcTzn</a>(in))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We assume here that timezone names aren't localized */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p = <a href="#L2253" title="utils/adt/formatting.c:2253">asc_tolower_z</a>(<a href="#L490" title="utils/adt/formatting.c:490">tmtcTzn</a>(in));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZ:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L490" title="utils/adt/formatting.c:490">tmtcTzn</a>(in))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, <a href="#L490" title="utils/adt/formatting.c:490">tmtcTzn</a>(in));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%c%02d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (tm-&gt;tm_gmtoff &gt;= <span class="Constant">0</span>) ? <span class="Constant">'+'</span> : <span class="Constant">'-'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; abs((<span class="Type">int</span>) tm-&gt;tm_gmtoff) / SECS_PER_HOUR);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%02d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (abs((<span class="Type">int</span>) tm-&gt;tm_gmtoff) % SECS_PER_HOUR) / SECS_PER_MINUTE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_OF:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%c%0*d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (tm-&gt;tm_gmtoff &gt;= <span class="Constant">0</span>) ? <span class="Constant">'+'</span> : <span class="Constant">'-'</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : <span class="Constant">2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; abs((<span class="Type">int</span>) tm-&gt;tm_gmtoff) / SECS_PER_HOUR);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (abs((<span class="Type">int</span>) tm-&gt;tm_gmtoff) % SECS_PER_HOUR != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;:</span><span class="Special">%02d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (abs((<span class="Type">int</span>) tm-&gt;tm_gmtoff) % SECS_PER_HOUR) / SECS_PER_MINUTE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_A_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_B_C:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_year &lt;= <span class="Constant">0</span> ? <a href="#L201" title="utils/adt/formatting.c:201">B_C_STR</a> : <a href="#L196" title="utils/adt/formatting.c:196">A_D_STR</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_AD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_BC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_year &lt;= <span class="Constant">0</span> ? <a href="#L203" title="utils/adt/formatting.c:203">BC_STR</a> : <a href="#L198" title="utils/adt/formatting.c:198">AD_STR</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_a_d:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_b_c:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_year &lt;= <span class="Constant">0</span> ? <a href="#L202" title="utils/adt/formatting.c:202">b_c_STR</a> : <a href="#L197" title="utils/adt/formatting.c:197">a_d_STR</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_ad:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_bc:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, (tm-&gt;tm_year &lt;= <span class="Constant">0</span> ? <a href="#L204" title="utils/adt/formatting.c:204">bc_STR</a> : <a href="#L199" title="utils/adt/formatting.c:199">ad_STR</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MONTH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2241" title="utils/adt/formatting.c:2241">str_toupper_z</a>(<a href="pg_locale.c.html#L114" title="utils/adt/pg_locale.c:114">localized_full_months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : -<span class="Constant">9</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2259" title="utils/adt/formatting.c:2259">asc_toupper_z</a>(<a href="#L178" title="utils/adt/formatting.c:178">months_full</a>[tm-&gt;tm_mon - <span class="Constant">1</span>]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Month:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2247" title="utils/adt/formatting.c:2247">str_initcap_z</a>(<a href="pg_locale.c.html#L114" title="utils/adt/pg_locale.c:114">localized_full_months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : -<span class="Constant">9</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L178" title="utils/adt/formatting.c:178">months_full</a>[tm-&gt;tm_mon - <span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_month:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2235" title="utils/adt/formatting.c:2235">str_tolower_z</a>(<a href="pg_locale.c.html#L114" title="utils/adt/pg_locale.c:114">localized_full_months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : -<span class="Constant">9</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2253" title="utils/adt/formatting.c:2253">asc_tolower_z</a>(<a href="#L178" title="utils/adt/formatting.c:178">months_full</a>[tm-&gt;tm_mon - <span class="Constant">1</span>]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MON:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2241" title="utils/adt/formatting.c:2241">str_toupper_z</a>(<a href="pg_locale.c.html#L113" title="utils/adt/pg_locale.c:113">localized_abbrev_months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, <a href="#L2259" title="utils/adt/formatting.c:2259">asc_toupper_z</a>(<a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Mon:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2247" title="utils/adt/formatting.c:2247">str_initcap_z</a>(<a href="pg_locale.c.html#L113" title="utils/adt/pg_locale.c:113">localized_abbrev_months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_mon:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2235" title="utils/adt/formatting.c:2235">str_tolower_z</a>(<a href="pg_locale.c.html#L113" title="utils/adt/pg_locale.c:113">localized_abbrev_months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, <a href="#L2253" title="utils/adt/formatting.c:2253">asc_tolower_z</a>(<a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a>[tm-&gt;tm_mon - <span class="Constant">1</span>]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : (tm-&gt;tm_mon &gt;= <span class="Constant">0</span>) ? <span class="Constant">2</span> : <span class="Constant">3</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mon);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DAY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2241" title="utils/adt/formatting.c:2241">str_toupper_z</a>(<a href="pg_locale.c.html#L112" title="utils/adt/pg_locale.c:112">localized_full_days</a>[tm-&gt;tm_wday], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : -<span class="Constant">9</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2259" title="utils/adt/formatting.c:2259">asc_toupper_z</a>(<a href="datetime.c.html#L84" title="utils/adt/datetime.c:84">days</a>[tm-&gt;tm_wday]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Day:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2247" title="utils/adt/formatting.c:2247">str_initcap_z</a>(<a href="pg_locale.c.html#L112" title="utils/adt/pg_locale.c:112">localized_full_days</a>[tm-&gt;tm_wday], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : -<span class="Constant">9</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L84" title="utils/adt/datetime.c:84">days</a>[tm-&gt;tm_wday]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_day:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2235" title="utils/adt/formatting.c:2235">str_tolower_z</a>(<a href="pg_locale.c.html#L112" title="utils/adt/pg_locale.c:112">localized_full_days</a>[tm-&gt;tm_wday], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : -<span class="Constant">9</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2253" title="utils/adt/formatting.c:2253">asc_tolower_z</a>(<a href="datetime.c.html#L84" title="utils/adt/datetime.c:84">days</a>[tm-&gt;tm_wday]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2241" title="utils/adt/formatting.c:2241">str_toupper_z</a>(<a href="pg_locale.c.html#L111" title="utils/adt/pg_locale.c:111">localized_abbrev_days</a>[tm-&gt;tm_wday], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, <a href="#L2259" title="utils/adt/formatting.c:2259">asc_toupper_z</a>(<a href="#L183" title="utils/adt/formatting.c:183">days_short</a>[tm-&gt;tm_wday]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Dy:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2247" title="utils/adt/formatting.c:2247">str_initcap_z</a>(<a href="pg_locale.c.html#L111" title="utils/adt/pg_locale.c:111">localized_abbrev_days</a>[tm-&gt;tm_wday], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, <a href="#L183" title="utils/adt/formatting.c:183">days_short</a>[tm-&gt;tm_wday]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_dy:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = <a href="#L2235" title="utils/adt/formatting.c:2235">str_tolower_z</a>(<a href="pg_locale.c.html#L111" title="utils/adt/pg_locale.c:111">localized_abbrev_days</a>[tm-&gt;tm_wday], collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strlen(str) &lt;= (n-&gt;key-&gt;len + <a href="#L566" title="utils/adt/formatting.c:566">TM_SUFFIX_LEN</a>) * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;localized string format value too long&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(s, <a href="#L2253" title="utils/adt/formatting.c:2253">asc_tolower_z</a>(<a href="#L183" title="utils/adt/formatting.c:183">days_short</a>[tm-&gt;tm_wday]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DDD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IDDD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : <span class="Constant">3</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (n-&gt;key-&gt;id == DCH_DDD) ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_yday :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="timestamp.c.html#L5267" title="utils/adt/timestamp.c:5267">date2isoyearday</a>(tm-&gt;tm_year, tm-&gt;tm_mon, tm-&gt;tm_mday));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : <span class="Constant">2</span>, tm-&gt;tm_mday);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, tm-&gt;tm_wday + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_ID:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, (tm-&gt;tm_wday == <span class="Constant">0</span>) ? <span class="Constant">7</span> : tm-&gt;tm_wday);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_WW:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : <span class="Constant">2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (tm-&gt;tm_yday - <span class="Constant">1</span>) / <span class="Constant">7</span> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IW:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : <span class="Constant">2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="timestamp.c.html#L5155" title="utils/adt/timestamp.c:5155">date2isoweek</a>(tm-&gt;tm_year, tm-&gt;tm_mon, tm-&gt;tm_mday));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Q:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, (tm-&gt;tm_mon - <span class="Constant">1</span>) / <span class="Constant">3</span> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_CC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (is_interval)&nbsp; &nbsp; <span class="Comment">/* straight calculation */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = tm-&gt;tm_year / <span class="Constant">100</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_year &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Century 20 == 1901 - 2000 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = (tm-&gt;tm_year - <span class="Constant">1</span>) / <span class="Constant">100</span> + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Century 6BC == 600BC - 501BC */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = tm-&gt;tm_year / <span class="Constant">100</span> - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &lt;= <span class="Constant">99</span> &amp;&amp; i &gt;= -<span class="Constant">99</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : (i &gt;= <span class="Constant">0</span>) ? <span class="Constant">2</span> : <span class="Constant">3</span>, i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Y_YYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) / <span class="Constant">1000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">,</span><span class="Special">%03d</span><span class="Constant">&quot;</span>, i,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) - (i * <span class="Constant">1000</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YYYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IYYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) &gt;= <span class="Constant">0</span>) ? <span class="Constant">4</span> : <span class="Constant">5</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (n-&gt;key-&gt;id == DCH_YYYY ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(<a href="timestamp.c.html#L5210" title="utils/adt/timestamp.c:5210">date2isoyear</a>(tm-&gt;tm_year,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mon,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mday),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; is_interval)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) &gt;= <span class="Constant">0</span>) ? <span class="Constant">3</span> : <span class="Constant">4</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (n-&gt;key-&gt;id == DCH_YYY ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(<a href="timestamp.c.html#L5210" title="utils/adt/timestamp.c:5210">date2isoyear</a>(tm-&gt;tm_year,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mon,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mday),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; is_interval)) % <span class="Constant">1000</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%0*d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) &gt;= <span class="Constant">0</span>) ? <span class="Constant">2</span> : <span class="Constant">3</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (n-&gt;key-&gt;id == DCH_YY ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(<a href="timestamp.c.html#L5210" title="utils/adt/timestamp.c:5210">date2isoyear</a>(tm-&gt;tm_year,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mon,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mday),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; is_interval)) % <span class="Constant">100</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Y:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_I:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%1d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (n-&gt;key-&gt;id == DCH_Y ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(tm-&gt;tm_year, is_interval) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L194" title="utils/adt/formatting.c:194">ADJUST_YEAR</a>(<a href="timestamp.c.html#L5210" title="utils/adt/timestamp.c:5210">date2isoyear</a>(tm-&gt;tm_year,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mon,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mday),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; is_interval)) % <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_RM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* FALLTHROUGH */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_rm:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * For intervals, <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> like '12 month' will be reduced to 0<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * month and some years.&nbsp; These should be processed.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_mon &amp;&amp; !tm-&gt;tm_year)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mon = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> *<a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;key-&gt;id == DCH_RM)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a> = <a href="#L252" title="utils/adt/formatting.c:252">rm_months_upper</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a> = <a href="#L255" title="utils/adt/formatting.c:255">rm_months_lower</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Compute the position in the roman-numeral array.&nbsp; Note<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * that the contents of the array are reversed, December<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * being first and January last.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_mon == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This case is special, and tracks the case of full<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * interval years.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mon = tm-&gt;tm_year &gt;= <span class="Constant">0</span> ? <span class="Constant">0</span> : MONTHS_PER_YEAR - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (tm-&gt;tm_mon &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Negative case.&nbsp; In this case, the calculation is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * reversed, where -1 means December, -2 November,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * etc.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mon = -<span class="Constant">1</span> * (tm-&gt;tm_mon + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Common case, with a strictly positive value.&nbsp; The<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * position in the array matches with the value of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * tm_mon.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mon = MONTHS_PER_YEAR - tm-&gt;tm_mon;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, <a href="#L558" title="utils/adt/formatting.c:558">S_FM</a>(n-&gt;suffix) ? <span class="Constant">0</span> : -<span class="Constant">4</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a>[mon]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_W:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, (tm-&gt;tm_mday - <span class="Constant">1</span>) / <span class="Constant">7</span> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_J:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, <a href="datetime.c.html#L286" title="utils/adt/datetime.c:286">date2j</a>(tm-&gt;tm_year, tm-&gt;tm_mon, tm-&gt;tm_mday));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L552" title="utils/adt/formatting.c:552">S_THth</a>(n-&gt;suffix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1561" title="utils/adt/formatting.c:1561">str_numth</a>(s, s, <a href="#L555" title="utils/adt/formatting.c:555">S_TH_TYPE</a>(n-&gt;suffix));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += strlen(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *s = <span class="Special">'\0'</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Process the string 'in' as denoted by the array of FormatNodes 'node[]'.<br/></li>
<li></span><span class="Comment"> * The <a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a> struct pointed to by 'out' is populated with the results.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * 'collid' identifies the collation to use, if needed.<br/></li>
<li></span><span class="Comment"> * 'std' specifies standard parsing mode.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If escontext points to an ErrorSaveContext, data errors will be reported<br/></li>
<li></span><span class="Comment"> * by filling that struct; the caller must test SOFT_ERROR_OCCURRED() to see<br/></li>
<li></span><span class="Comment"> * whether an error occurred.&nbsp; Otherwise, errors are thrown.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note: we currently don't have <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> to_interval() function, so there<br/></li>
<li></span><span class="Comment"> * is no need here for <a href="#L525" title="utils/adt/formatting.c:525">INVALID_FOR_INTERVAL</a> checks.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3412">&#x200c;</a></span><span class="linkable">DCH_from_char</span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <span class="Type">const</span> <span class="Type">char</span> *in, <a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a> *out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid collid, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std, Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *s;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; fx_mode = std;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* number of extra skipped characters (more than given in format string) */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extra_skip = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* cache localized <a href="datetime.c.html#L84" title="utils/adt/datetime.c:84">days</a> and <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a> */<br/></li>
<li></span>&nbsp; &nbsp; <a href="pg_locale.c.html#L806" title="utils/adt/pg_locale.c:806">cache_locale_time</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (n = node, s = in; n-&gt;type != <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a> &amp;&amp; *s != <span class="Special">'\0'</span>; n++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Ignore spaces at the beginning of the string and <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> fields when<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * not in FX (fixed width) mode.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!fx_mode &amp;&amp; (n-&gt;type != <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a> || n-&gt;key-&gt;id != DCH_FX) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (n-&gt;type == <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a> || n == node))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s != <span class="Special">'\0'</span> &amp;&amp; isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extra_skip++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type == <a href="#L165" title="utils/adt/formatting.c:165">NODE_TYPE_SPACE</a> || n-&gt;type == <a href="#L164" title="utils/adt/formatting.c:164">NODE_TYPE_SEPARATOR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (std)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Standard mode requires strict matching between format<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * string separators/spaces and input string.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(n-&gt;character[<span class="Constant">0</span>] &amp;&amp; !n-&gt;character[<span class="Constant">1</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == n-&gt;character[<span class="Constant">0</span>])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext,,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;unmatched format separator </span><span class="Special">\&quot;%c\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;character[<span class="Constant">0</span>])));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!fx_mode)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In non FX (fixed format) mode one format string space or<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * separator match to one space or separator in input string.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Or match nothing if there is no space or separator in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * current position of input string.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extra_skip--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s) || <a href="#L1139" title="utils/adt/formatting.c:1139">is_separator_char</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extra_skip++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In FX mode, on format string space or separator we consume<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * exactly one character from input string.&nbsp; Notice we don't<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * insist that the consumed character match the format's<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * character.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (n-&gt;type != <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Text character, so consume one character from input string.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Notice we don't insist that the consumed character match the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * format's character.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!fx_mode)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In non FX mode we might have skipped some extra characters<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * (more than specified in format string) <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a>.&nbsp; In this<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * case we don't <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> input string character, because it might<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * be part of field.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (extra_skip &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extra_skip--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chlen = <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Standard mode requires strict match of format characters.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (std &amp;&amp; n-&gt;type == <a href="#L163" title="utils/adt/formatting.c:163">NODE_TYPE_CHAR</a> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strncmp(s, n-&gt;character, chlen) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext,,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;unmatched format character </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;character)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += chlen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2400" title="utils/adt/formatting.c:2400">from_char_set_mode</a>(out, n-&gt;key-&gt;date_mode, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (n-&gt;key-&gt;id)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FX:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fx_mode = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_A_M:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_P_M:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_a_m:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_p_m:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="#L244" title="utils/adt/formatting.c:244">ampm_strings_long</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;pm, value % <span class="Constant">2</span>, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;clock = <a href="#L171" title="utils/adt/formatting.c:171">CLOCK_12_HOUR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_AM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_PM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_am:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_pm:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="#L243" title="utils/adt/formatting.c:243">ampm_strings</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;pm, value % <span class="Constant">2</span>, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;clock = <a href="#L171" title="utils/adt/formatting.c:171">CLOCK_12_HOUR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH12:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;hh, &amp;s, <span class="Constant">2</span>, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;clock = <a href="#L171" title="utils/adt/formatting.c:171">CLOCK_12_HOUR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH24:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;hh, &amp;s, <span class="Constant">2</span>, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MI:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;mi, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_SS:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;ss, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MS:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* millisecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;ms, &amp;s, <span class="Constant">3</span>, n, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * 25 is 0.25 and 250 is 0.25 too; 025 is 0.025 and not 0.25<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;ms *= len == <span class="Constant">1</span> ? <span class="Constant">100</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len == <span class="Constant">2</span> ? <span class="Constant">10</span> : <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF1:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF2:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF3:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF4:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF5:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;ff = n-&gt;key-&gt;id - DCH_FF1 + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* FALLTHROUGH */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_US:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* microsecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;us, &amp;s,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n-&gt;key-&gt;id == DCH_US ? <span class="Constant">6</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;ff, n, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;us *= len == <span class="Constant">1</span> ? <span class="Constant">100000</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len == <span class="Constant">2</span> ? <span class="Constant">10000</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len == <span class="Constant">3</span> ? <span class="Constant">1000</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len == <span class="Constant">4</span> ? <span class="Constant">100</span> :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len == <span class="Constant">5</span> ? <span class="Constant">10</span> : <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_SSSS:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;ssss, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_tz:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZ:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tzlen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tzlen = <a href="datetime.c.html#L3262" title="utils/adt/datetime.c:3262">DecodeTimezoneAbbrevPrefix</a>(s,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;out-&gt;gmtoffset,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;out-&gt;tzp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tzlen &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;has_tz = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we only need the zone abbrev for DYNTZ case */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (out-&gt;tzp)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;abbrev = <a href="../mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(s, tzlen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = <span class="Constant">0</span>;&nbsp; &nbsp; <span class="Comment">/* drop <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> earlier TZH/TZM info */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += tzlen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (isalpha((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * It doesn't match <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> abbreviation, but it starts<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * with a letter.&nbsp; OF format certainly won't succeed;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * assume it's a misspelled abbreviation and complain<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * accordingly.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext,,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> for </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s, n-&gt;key-&gt;name),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1205" title="utils/error/elog.c:1205">errdetail</a>(<span class="Constant">&quot;Time zone abbreviation is not recognized.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* otherwise <a href="../../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> it like OF */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* FALLTHROUGH */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_OF:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* OF is equivalent to TZH or TZH:TZM */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* see TZH comments below */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Constant">'+'</span> || *s == <span class="Constant">'-'</span> || *s == <span class="Constant">' '</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = *s == <span class="Constant">'-'</span> ? -<span class="Constant">1</span> : +<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (extra_skip &gt; <span class="Constant">0</span> &amp;&amp; *(s - <span class="Constant">1</span>) == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = +<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;tzh, &amp;s, <span class="Constant">2</span>, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Constant">':'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;tzm, &amp;s, <span class="Constant">2</span>, n,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZH:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Value of TZH might be negative.&nbsp; And the issue is that we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * might swallow minus sign as the separator.&nbsp; So, if we have<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * skipped more characters than specified in the format<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * string, then we consider prepending last skipped minus to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * TZH.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Constant">'+'</span> || *s == <span class="Constant">'-'</span> || *s == <span class="Constant">' '</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = *s == <span class="Constant">'-'</span> ? -<span class="Constant">1</span> : +<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (extra_skip &gt; <span class="Constant">0</span> &amp;&amp; *(s - <span class="Constant">1</span>) == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = +<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;tzh, &amp;s, <span class="Constant">2</span>, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* assign positive timezone sign if TZH was not seen <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!out-&gt;tzsign)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;tzsign = +<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;tzm, &amp;s, <span class="Constant">2</span>, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_A_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_B_C:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_a_d:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_b_c:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="#L217" title="utils/adt/formatting.c:217">adbc_strings_long</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;bc, value % <span class="Constant">2</span>, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_AD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_BC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_ad:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_bc:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="#L216" title="utils/adt/formatting.c:216">adbc_strings</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;bc, value % <span class="Constant">2</span>, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MONTH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Month:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_month:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="#L178" title="utils/adt/formatting.c:178">months_full</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix) ? <a href="pg_locale.c.html#L114" title="utils/adt/pg_locale.c:114">localized_full_months</a> : <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;mm, value + <span class="Constant">1</span>, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MON:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Mon:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_mon:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="datetime.c.html#L81" title="utils/adt/datetime.c:81">months</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix) ? <a href="pg_locale.c.html#L113" title="utils/adt/pg_locale.c:113">localized_abbrev_months</a> : <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;mm, value + <span class="Constant">1</span>, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;mm, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DAY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Day:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_day:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="datetime.c.html#L84" title="utils/adt/datetime.c:84">days</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix) ? <a href="pg_locale.c.html#L112" title="utils/adt/pg_locale.c:112">localized_full_days</a> : <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;d, value, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;d++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Dy:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_dy:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="#L183" title="utils/adt/formatting.c:183">days_short</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L560" title="utils/adt/formatting.c:560">S_TM</a>(n-&gt;suffix) ? <a href="pg_locale.c.html#L111" title="utils/adt/pg_locale.c:111">localized_abbrev_days</a> : <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;d, value, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;d++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DDD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;ddd, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IDDD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;ddd, &amp;s, <span class="Constant">3</span>, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;dd, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;d, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_ID:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2463" title="utils/adt/formatting.c:2463">from_char_parse_int_len</a>(&amp;out-&gt;d, &amp;s, <span class="Constant">1</span>, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Shift numbering to match Gregorian where Sunday = 1 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (++out-&gt;d &gt; <span class="Constant">7</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;d = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_WW:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IW:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;ww, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Q:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We ignore 'Q' when converting to date because it is unclear<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * which date in the quarter to use, and some people specify<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * both quarter and month, so if it was honored it might<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * conflict with the supplied month. That is also why we don't<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * throw an error.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We still <a href="../../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> the source string for an integer, but it<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * isn't stored anywhere in 'out'.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>((<span class="Type">int</span> *) <span class="Constant">NULL</span>, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_CC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;cc, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Y_YYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; matched,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; years,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; millennia,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; matched = sscanf(s, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">,</span><span class="Special">%03d%n</span><span class="Constant">&quot;</span>, &amp;millennia, &amp;years, &amp;nch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (matched &lt; <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext,,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid input string for </span><span class="Special">\&quot;</span><span class="Constant">Y,YYY</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; years += (millennia * <span class="Constant">1000</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;year, years, n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;yysz = <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += nch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YYYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IYYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;year, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;yysz = <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;year, &amp;s, n, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;year = <a href="#L2354" title="utils/adt/formatting.c:2354">adjust_partial_year_to_2020</a>(out-&gt;year);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;yysz = <span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;year, &amp;s, n, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;year = <a href="#L2354" title="utils/adt/formatting.c:2354">adjust_partial_year_to_2020</a>(out-&gt;year);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;yysz = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Y:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_I:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;year, &amp;s, n, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;year = <a href="#L2354" title="utils/adt/formatting.c:2354">adjust_partial_year_to_2020</a>(out-&gt;year);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;yysz = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_RM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_rm:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2719" title="utils/adt/formatting.c:2719">from_char_seq_search</a>(&amp;value, &amp;s, <a href="#L255" title="utils/adt/formatting.c:255">rm_months_lower</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L2427" title="utils/adt/formatting.c:2427">from_char_set_int</a>(&amp;out-&gt;mm, MONTHS_PER_YEAR - value, n,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_W:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;w, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_J:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2560" title="utils/adt/formatting.c:2560">from_char_parse_int</a>(&amp;out-&gt;j, &amp;s, n, escontext) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2273" title="utils/adt/formatting.c:2273">SKIP_THth</a>(s, n-&gt;suffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Ignore all spaces after fields */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!fx_mode)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extra_skip = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s != <span class="Special">'\0'</span> &amp;&amp; isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extra_skip++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Standard parsing mode doesn't allow unmatched format patterns or<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * trailing characters in the input string.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (std)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type != <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext,,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;input string is too short for datetime format&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s != <span class="Special">'\0'</span> &amp;&amp; isspace((<span class="Type">unsigned</span> <span class="Type">char</span>) *s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext,,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;trailing characters remain in input string after datetime format&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * The invariant for DCH cache entry management is that <a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a> is <a href="../../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a><br/></li>
<li></span><span class="Comment"> * to the maximum age value among the existing entries, and we increment it<br/></li>
<li></span><span class="Comment"> * whenever an access occurs.&nbsp; If we approach overflow, deal with that by<br/></li>
<li></span><span class="Comment"> * halving all the age <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>, so that we retain a fairly accurate idea of<br/></li>
<li></span><span class="Comment"> * which entries are oldest.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">inline</span> <span class="Type">void<br/></li>
<li><a id="L3962">&#x200c;</a></span><span class="linkable">DCH_prevent_counter_overflow</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a> &gt;= (<span class="Constant">INT_MAX</span> - <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; <a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L387" title="utils/adt/formatting.c:387">DCHCache</a>[i]-&gt;age &gt;&gt;= <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a> &gt;&gt;= <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Get mask of date/time/zone components present in format nodes.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L3976">&#x200c;</a></span><span class="linkable">DCH_datetime_type</span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flags = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (n = node; n-&gt;type != <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>; n++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type != <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (n-&gt;key-&gt;id)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FX:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_A_M:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_P_M:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_a_m:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_p_m:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_AM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_PM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_am:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_pm:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH12:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_HH24:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MI:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_SS:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MS:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* millisecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_US:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* microsecond */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF1:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF2:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF3:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF4:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF5:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_FF6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_SSSS:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flags |= <a href="#L1027" title="utils/adt/formatting.c:1027">DCH_TIMED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_tz:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZ:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_OF:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_TZM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flags |= <a href="#L1028" title="utils/adt/formatting.c:1028">DCH_ZONED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_A_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_B_C:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_a_d:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_b_c:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_AD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_BC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_ad:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_bc:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MONTH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Month:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_month:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MON:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Mon:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_mon:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_MM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DAY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Day:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_day:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Dy:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_dy:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DDD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IDDD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_DD:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_ID:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_WW:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Q:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_CC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Y_YYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YYYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IYYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IYY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_YY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_IY:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_Y:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_I:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_RM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_rm:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_W:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> DCH_J:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flags |= <a href="#L1026" title="utils/adt/formatting.c:1026">DCH_DATED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> flags;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="../../port/win32/socket.c.html#L36" title="port/win32/socket.c:36">select</a> a <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> to hold the given format picture */<br/></li>
<li></span><span class="Type">static</span> <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *<br/></li>
<li><a id="L4073">&#x200c;</a><span class="linkable">DCH_cache_getnew</span>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *ent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Ensure we can advance <a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a> below */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L3962" title="utils/adt/formatting.c:3962">DCH_prevent_counter_overflow</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If cache is full, remove oldest entry (or recycle first not-valid one)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a> &gt;= <a href="#L365" title="utils/adt/formatting.c:365">DCH_CACHE_ENTRIES</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *old = <a href="#L387" title="utils/adt/formatting.c:387">DCHCache</a>[<span class="Constant">0</span>];<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;cache is full (</span><span class="Special">%d</span><span class="Constant">)&quot;</span>, <a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (old-&gt;valid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">1</span>; i &lt; <a href="#L365" title="utils/adt/formatting.c:365">DCH_CACHE_ENTRIES</a>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ent = <a href="#L387" title="utils/adt/formatting.c:387">DCHCache</a>[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!ent-&gt;valid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old = ent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ent-&gt;age &lt; old-&gt;age)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old = ent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;OLD: '</span><span class="Special">%s</span><span class="Constant">' AGE: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, old-&gt;str, old-&gt;age);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; old-&gt;valid = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strlcpy(old-&gt;str, str, <a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; old-&gt;age = (++<a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* caller is expected to fill format, then set valid */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> old;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;NEW (</span><span class="Special">%d</span><span class="Constant">)&quot;</span>, <a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Assert(<a href="#L387" title="utils/adt/formatting.c:387">DCHCache</a>[<a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a>] == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L387" title="utils/adt/formatting.c:387">DCHCache</a>[<a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a>] = ent = (<a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1214" title="utils/mmgr/mcxt.c:1214">MemoryContextAllocZero</a>(<a href="../mmgr/mcxt.c.html#L149" title="utils/mmgr/mcxt.c:149">TopMemoryContext</a>, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;valid = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strlcpy(ent-&gt;str, str, <a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;std = std;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;age = (++<a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* caller is expected to fill format, then set valid */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ++<a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ent;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* look for an existing <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> matching the given format picture */<br/></li>
<li></span><span class="Type">static</span> <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *<br/></li>
<li><a id="L4133">&#x200c;</a><span class="linkable">DCH_cache_search</span>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Ensure we can advance <a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a> below */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L3962" title="utils/adt/formatting.c:3962">DCH_prevent_counter_overflow</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; <a href="#L388" title="utils/adt/formatting.c:388">n_DCHCache</a>; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *ent = <a href="#L387" title="utils/adt/formatting.c:387">DCHCache</a>[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ent-&gt;valid &amp;&amp; strcmp(ent-&gt;str, str) == <span class="Constant">0</span> &amp;&amp; ent-&gt;std == std)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;age = (++<a href="#L389" title="utils/adt/formatting.c:389">DCHCounter</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Find or create a <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> for the given format picture */<br/></li>
<li></span><span class="Type">static</span> <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *<br/></li>
<li><a id="L4154">&#x200c;</a><span class="linkable">DCH_cache_fetch</span>(<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *ent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((ent = <a href="#L4133" title="utils/adt/formatting.c:4133">DCH_cache_search</a>(str, std)) == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Not in the cache, must run parser and save a new format-picture to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the cache.&nbsp; Do not mark the cache entry valid until parsing<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * succeeds.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ent = <a href="#L4073" title="utils/adt/formatting.c:4073">DCH_cache_getnew</a>(str, std);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1328" title="utils/adt/formatting.c:1328">parse_format</a>(ent-&gt;format, str, <a href="#L775" title="utils/adt/formatting.c:775">DCH_keywords</a>, <a href="#L568" title="utils/adt/formatting.c:568">DCH_suff</a>, <a href="#L948" title="utils/adt/formatting.c:948">DCH_index</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L99" title="utils/adt/formatting.c:99">DCH_FLAG</a> | (std ? <a href="#L101" title="utils/adt/formatting.c:101">STD_FLAG</a> : <span class="Constant">0</span>), <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;valid = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> ent;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Format a date/time or interval into a string according to fmt.<br/></li>
<li></span><span class="Comment"> * We <a href="../../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> fmt into a list of FormatNodes.&nbsp; This is then passed to <a href="#L2765" title="utils/adt/formatting.c:2765">DCH_to_char</a><br/></li>
<li></span><span class="Comment"> * for formatting.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> text *<br/></li>
<li><a id="L4181">&#x200c;</a><span class="linkable">datetime_to_char_body</span>(<a href="#L482" title="utils/adt/formatting.c:482">TmToChar</a> *tmtc, text *fmt, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> is_interval, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *fmt_str,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; incache;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt_len;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *res;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Convert fmt to C string<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; fmt_str = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(fmt);<br/></li>
<li>&nbsp; &nbsp; fmt_len = strlen(fmt_str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Allocate workspace for result as C string<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((fmt_len * <a href="#L114" title="utils/adt/formatting.c:114">DCH_MAX_ITEM_SIZ</a>) + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; *result = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fmt_len &gt; <a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Allocate new memory if format picture is bigger than static cache<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * and do not use cache (call parser always)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; incache = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; format = (<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((fmt_len + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1328" title="utils/adt/formatting.c:1328">parse_format</a>(format, fmt_str, <a href="#L775" title="utils/adt/formatting.c:775">DCH_keywords</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L568" title="utils/adt/formatting.c:568">DCH_suff</a>, <a href="#L948" title="utils/adt/formatting.c:948">DCH_index</a>, <a href="#L99" title="utils/adt/formatting.c:99">DCH_FLAG</a>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Use cache buffers<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *ent = <a href="#L4154" title="utils/adt/formatting.c:4154">DCH_cache_fetch</a>(fmt_str, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; incache = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; format = ent-&gt;format;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* The real work is here */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L2765" title="utils/adt/formatting.c:2765">DCH_to_char</a>(format, is_interval, tmtc, result, collid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!incache)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(format);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(fmt_str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* convert C-string result to TEXT format */<br/></li>
<li></span>&nbsp; &nbsp; res = <a href="varlena.c.html#L184" title="utils/adt/varlena.c:184">cstring_to_text</a>(result);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(result);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/****************************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public routines<br/></li>
<li></span><span class="Comment"> ***************************************************************************/<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* -------------------<br/></li>
<li></span><span class="Comment"> * TIMESTAMP to_char()<br/></li>
<li></span><span class="Comment"> * -------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L4250">&#x200c;</a><span class="linkable">timestamp_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Timestamp&nbsp; &nbsp; dt = PG_GETARG_TIMESTAMP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *res;<br/></li>
<li>&nbsp; &nbsp; <a href="#L482" title="utils/adt/formatting.c:482">TmToChar</a>&nbsp; &nbsp; tmtc;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> pg_tm tt;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L469" title="utils/adt/formatting.c:469">fmt_tm</a> *tm;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; thisdate;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (VARSIZE_ANY_EXHDR(fmt) &lt;= <span class="Constant">0</span> || TIMESTAMP_NOT_FINITE(dt))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_NULL();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L514" title="utils/adt/formatting.c:514">ZERO_tmtc</a>(&amp;tmtc);<br/></li>
<li>&nbsp; &nbsp; tm = <a href="#L489" title="utils/adt/formatting.c:489">tmtcTm</a>(&amp;tmtc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="timestamp.c.html#L1901" title="utils/adt/timestamp.c:1901">timestamp2tm</a>(dt, <span class="Constant">NULL</span>, &amp;tt, &amp;<a href="#L491" title="utils/adt/formatting.c:491">tmtcFsec</a>(&amp;tmtc), <span class="Constant">NULL</span>, <span class="Constant">NULL</span>) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;timestamp out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* calculate wday and yday, because <a href="timestamp.c.html#L1901" title="utils/adt/timestamp.c:1901">timestamp2tm</a> doesn't */<br/></li>
<li></span>&nbsp; &nbsp; thisdate = <a href="datetime.c.html#L286" title="utils/adt/datetime.c:286">date2j</a>(tt.tm_year, tt.tm_mon, tt.tm_mday);<br/></li>
<li>&nbsp; &nbsp; tt.tm_wday = (thisdate + <span class="Constant">1</span>) % <span class="Constant">7</span>;<br/></li>
<li>&nbsp; &nbsp; tt.tm_yday = thisdate - <a href="datetime.c.html#L286" title="utils/adt/datetime.c:286">date2j</a>(tt.tm_year, <span class="Constant">1</span>, <span class="Constant">1</span>) + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L494" title="utils/adt/formatting.c:494">COPY_tm</a>(tm, &amp;tt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!(res = <a href="#L4181" title="utils/adt/formatting.c:4181">datetime_to_char_body</a>(&amp;tmtc, fmt, <span class="Constant">false</span>, PG_GET_COLLATION())))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_NULL();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(res);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L4285">&#x200c;</a><span class="linkable">timestamptz_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; TimestampTz dt = PG_GETARG_TIMESTAMP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *res;<br/></li>
<li>&nbsp; &nbsp; <a href="#L482" title="utils/adt/formatting.c:482">TmToChar</a>&nbsp; &nbsp; tmtc;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tz;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> pg_tm tt;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L469" title="utils/adt/formatting.c:469">fmt_tm</a> *tm;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; thisdate;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (VARSIZE_ANY_EXHDR(fmt) &lt;= <span class="Constant">0</span> || TIMESTAMP_NOT_FINITE(dt))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_NULL();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L514" title="utils/adt/formatting.c:514">ZERO_tmtc</a>(&amp;tmtc);<br/></li>
<li>&nbsp; &nbsp; tm = <a href="#L489" title="utils/adt/formatting.c:489">tmtcTm</a>(&amp;tmtc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="timestamp.c.html#L1901" title="utils/adt/timestamp.c:1901">timestamp2tm</a>(dt, &amp;tz, &amp;tt, &amp;<a href="#L491" title="utils/adt/formatting.c:491">tmtcFsec</a>(&amp;tmtc), &amp;<a href="#L490" title="utils/adt/formatting.c:490">tmtcTzn</a>(&amp;tmtc), <span class="Constant">NULL</span>) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;timestamp out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* calculate wday and yday, because <a href="timestamp.c.html#L1901" title="utils/adt/timestamp.c:1901">timestamp2tm</a> doesn't */<br/></li>
<li></span>&nbsp; &nbsp; thisdate = <a href="datetime.c.html#L286" title="utils/adt/datetime.c:286">date2j</a>(tt.tm_year, tt.tm_mon, tt.tm_mday);<br/></li>
<li>&nbsp; &nbsp; tt.tm_wday = (thisdate + <span class="Constant">1</span>) % <span class="Constant">7</span>;<br/></li>
<li>&nbsp; &nbsp; tt.tm_yday = thisdate - <a href="datetime.c.html#L286" title="utils/adt/datetime.c:286">date2j</a>(tt.tm_year, <span class="Constant">1</span>, <span class="Constant">1</span>) + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L494" title="utils/adt/formatting.c:494">COPY_tm</a>(tm, &amp;tt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!(res = <a href="#L4181" title="utils/adt/formatting.c:4181">datetime_to_char_body</a>(&amp;tmtc, fmt, <span class="Constant">false</span>, PG_GET_COLLATION())))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_NULL();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(res);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* -------------------<br/></li>
<li></span><span class="Comment"> * INTERVAL to_char()<br/></li>
<li></span><span class="Comment"> * -------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L4326">&#x200c;</a><span class="linkable">interval_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Interval&nbsp;&nbsp; *it = PG_GETARG_INTERVAL_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *res;<br/></li>
<li>&nbsp; &nbsp; <a href="#L482" title="utils/adt/formatting.c:482">TmToChar</a>&nbsp; &nbsp; tmtc;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L469" title="utils/adt/formatting.c:469">fmt_tm</a> *tm;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> pg_itm tt,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *itm = &amp;tt;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (VARSIZE_ANY_EXHDR(fmt) &lt;= <span class="Constant">0</span> || INTERVAL_NOT_FINITE(it))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_NULL();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L514" title="utils/adt/formatting.c:514">ZERO_tmtc</a>(&amp;tmtc);<br/></li>
<li>&nbsp; &nbsp; tm = <a href="#L489" title="utils/adt/formatting.c:489">tmtcTm</a>(&amp;tmtc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="timestamp.c.html#L2047" title="utils/adt/timestamp.c:2047">interval2itm</a>(*it, itm);<br/></li>
<li>&nbsp; &nbsp; tmtc.fsec = itm-&gt;tm_usec;<br/></li>
<li>&nbsp; &nbsp; tm-&gt;tm_sec = itm-&gt;tm_sec;<br/></li>
<li>&nbsp; &nbsp; tm-&gt;tm_min = itm-&gt;tm_min;<br/></li>
<li>&nbsp; &nbsp; tm-&gt;tm_hour = itm-&gt;tm_hour;<br/></li>
<li>&nbsp; &nbsp; tm-&gt;tm_mday = itm-&gt;tm_mday;<br/></li>
<li>&nbsp; &nbsp; tm-&gt;tm_mon = itm-&gt;tm_mon;<br/></li>
<li>&nbsp; &nbsp; tm-&gt;tm_year = itm-&gt;tm_year;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* wday is meaningless, yday approximates the total span in <a href="datetime.c.html#L84" title="utils/adt/datetime.c:84">days</a> */<br/></li>
<li></span>&nbsp; &nbsp; tm-&gt;tm_yday = (tm-&gt;tm_year * MONTHS_PER_YEAR + tm-&gt;tm_mon) * DAYS_PER_MONTH + tm-&gt;tm_mday;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!(res = <a href="#L4181" title="utils/adt/formatting.c:4181">datetime_to_char_body</a>(&amp;tmtc, fmt, <span class="Constant">true</span>, PG_GET_COLLATION())))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_NULL();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(res);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ---------------------<br/></li>
<li></span><span class="Comment"> * TO_TIMESTAMP()<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Make Timestamp from date_str which is formatted at argument 'fmt'<br/></li>
<li></span><span class="Comment"> * ( <a href="#L4368" title="utils/adt/formatting.c:4368">to_timestamp</a> is reverse to_char() )<br/></li>
<li></span><span class="Comment"> * ---------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L4368">&#x200c;</a><span class="linkable">to_timestamp</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *date_txt = PG_GETARG_TEXT_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collid = PG_GET_COLLATION();<br/></li>
<li>&nbsp; &nbsp; Timestamp&nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tz;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> pg_tm tm;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L434" title="utils/adt/formatting.c:434">fmt_tz</a> ftz;<br/></li>
<li>&nbsp; &nbsp; fsec_t&nbsp; &nbsp; &nbsp; &nbsp; fsec;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprec;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>(date_txt, fmt, collid, <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;tm, &amp;fsec, &amp;ftz, &amp;fprec, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Use the specified time zone, if <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a>. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (ftz.has_tz)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tz = ftz.gmtoffset;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; tz = <a href="datetime.c.html#L1585" title="utils/adt/datetime.c:1585">DetermineTimeZoneOffset</a>(&amp;tm, session_timezone);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="timestamp.c.html#L1997" title="utils/adt/timestamp.c:1997">tm2timestamp</a>(&amp;tm, fsec, &amp;tz, &amp;result) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;timestamp out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Use the specified fractional precision, if <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a>. */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (fprec)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="timestamp.c.html#L366" title="utils/adt/timestamp.c:366">AdjustTimestampForTypmod</a>(&amp;result, fprec, <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TIMESTAMP(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * TO_DATE<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Make Date from date_str which is formatted at argument 'fmt'<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L4407">&#x200c;</a><span class="linkable">to_date</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *date_txt = PG_GETARG_TEXT_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collid = PG_GET_COLLATION();<br/></li>
<li>&nbsp; &nbsp; DateADT&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> pg_tm tm;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L434" title="utils/adt/formatting.c:434">fmt_tz</a> ftz;<br/></li>
<li>&nbsp; &nbsp; fsec_t&nbsp; &nbsp; &nbsp; &nbsp; fsec;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>(date_txt, fmt, collid, <span class="Constant">false</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;tm, &amp;fsec, &amp;ftz, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Prevent overflow in Julian-day routines */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!IS_VALID_JULIAN(tm.tm_year, tm.tm_mon, tm.tm_mday))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;date out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(date_txt))));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = <a href="datetime.c.html#L286" title="utils/adt/datetime.c:286">date2j</a>(tm.tm_year, tm.tm_mon, tm.tm_mday) - POSTGRES_EPOCH_JDATE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Now check for just-out-of-<a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> dates */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!IS_VALID_DATE(result))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;date out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(date_txt))));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATEADT(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Convert the 'date_txt' input to a datetime type using argument 'fmt'<br/></li>
<li></span><span class="Comment"> * as a format string.&nbsp; The collation 'collid' may be used for case-folding<br/></li>
<li></span><span class="Comment"> * rules in some cases.&nbsp; 'strict' specifies standard parsing mode.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The actual data type (returned in 'typid', 'typmod') is determined by<br/></li>
<li></span><span class="Comment"> * the presence of date/time/zone components in the format string.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * When a timezone component is present, the corresponding offset is<br/></li>
<li></span><span class="Comment"> * returned in '*tz'.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If escontext points to an ErrorSaveContext, data errors will be reported<br/></li>
<li></span><span class="Comment"> * by filling that struct; the caller must test SOFT_ERROR_OCCURRED() to see<br/></li>
<li></span><span class="Comment"> * whether an error occurred.&nbsp; Otherwise, errors are thrown.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L4455">&#x200c;</a><span class="linkable">parse_datetime</span>(text *date_txt, text *fmt, Oid collid, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> strict,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Oid *typid, int32 *typmod, <span class="Type">int</span> *tz,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> pg_tm tm;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L434" title="utils/adt/formatting.c:434">fmt_tz</a> ftz;<br/></li>
<li>&nbsp; &nbsp; fsec_t&nbsp; &nbsp; &nbsp; &nbsp; fsec;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprec;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; flags;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>(date_txt, fmt, collid, strict,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;tm, &amp;fsec, &amp;ftz, &amp;fprec, &amp;flags, escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (Datum) <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *typmod = fprec ? fprec : -<span class="Constant">1</span>;&nbsp; &nbsp; <span class="Comment">/* fractional part precision */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="#L1026" title="utils/adt/formatting.c:1026">DCH_DATED</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="#L1027" title="utils/adt/formatting.c:1027">DCH_TIMED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="#L1028" title="utils/adt/formatting.c:1028">DCH_ZONED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TimestampTz result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ftz.has_tz)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *tz = ftz.gmtoffset;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Time zone is present in format string, but not in input<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * string.&nbsp; Assuming <a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>() triggers no error<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * this should be possible only in non-strict case.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(!strict);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;missing time zone in input string for type timestamptz&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="timestamp.c.html#L1997" title="utils/adt/timestamp.c:1997">tm2timestamp</a>(&amp;tm, fsec, tz, &amp;result) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;timestamptz out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="timestamp.c.html#L366" title="utils/adt/timestamp.c:366">AdjustTimestampForTypmod</a>(&amp;result, *typmod, escontext);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typid = TIMESTAMPTZOID;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TimestampTzGetDatum(result);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Timestamp&nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="timestamp.c.html#L1997" title="utils/adt/timestamp.c:1997">tm2timestamp</a>(&amp;tm, fsec, <span class="Constant">NULL</span>, &amp;result) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;timestamp out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="timestamp.c.html#L366" title="utils/adt/timestamp.c:366">AdjustTimestampForTypmod</a>(&amp;result, *typmod, escontext);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typid = TIMESTAMPOID;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TimestampGetDatum(result);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="#L1028" title="utils/adt/formatting.c:1028">DCH_ZONED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;datetime format is zoned but not timed&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DateADT&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Prevent overflow in Julian-day routines */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!IS_VALID_JULIAN(tm.tm_year, tm.tm_mon, tm.tm_mday))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;date out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(date_txt))));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = <a href="datetime.c.html#L286" title="utils/adt/datetime.c:286">date2j</a>(tm.tm_year, tm.tm_mon, tm.tm_mday) -<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; POSTGRES_EPOCH_JDATE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Now check for just-out-of-<a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> dates */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!IS_VALID_DATE(result))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;date out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(date_txt))));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typid = DATEOID;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> DateADTGetDatum(result);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (flags &amp; <a href="#L1027" title="utils/adt/formatting.c:1027">DCH_TIMED</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="#L1028" title="utils/adt/formatting.c:1028">DCH_ZONED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TimeTzADT&nbsp; *result = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(TimeTzADT));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ftz.has_tz)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *tz = ftz.gmtoffset;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Time zone is present in format string, but not in input<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * string.&nbsp; Assuming <a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>() triggers no error this<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * should be possible only in non-strict case.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(!strict);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;missing time zone in input string for type timetz&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="date.c.html#L2263" title="utils/adt/date.c:2263">tm2timetz</a>(&amp;tm, fsec, *tz, result) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;timetz out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="date.c.html#L1645" title="utils/adt/date.c:1645">AdjustTimeForTypmod</a>(&amp;result-&gt;time, *typmod);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typid = TIMETZOID;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TimeTzADTPGetDatum(result);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TimeADT&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="date.c.html#L1416" title="utils/adt/date.c:1416">tm2time</a>(&amp;tm, fsec, &amp;result) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_DATETIME_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;time out of <a href="../../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="date.c.html#L1645" title="utils/adt/date.c:1645">AdjustTimeForTypmod</a>(&amp;result, *typmod);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typid = TIMEOID;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> TimeADTGetDatum(result);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;datetime format is not dated and not timed&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Parses the datetime format string in 'fmt_str' and returns true if it<br/></li>
<li></span><span class="Comment"> * contains a timezone specifier, false if not.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L4618">&#x200c;</a></span><span class="linkable">datetime_format_has_tz</span>(<span class="Type">const</span> <span class="Type">char</span> *fmt_str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; incache;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt_len = strlen(fmt_str);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fmt_len &gt; <a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Allocate new memory if format picture is bigger than static cache<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * and do not use cache (call parser always)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; incache = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; format = (<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((fmt_len + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1328" title="utils/adt/formatting.c:1328">parse_format</a>(format, fmt_str, <a href="#L775" title="utils/adt/formatting.c:775">DCH_keywords</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L568" title="utils/adt/formatting.c:568">DCH_suff</a>, <a href="#L948" title="utils/adt/formatting.c:948">DCH_index</a>, <a href="#L99" title="utils/adt/formatting.c:99">DCH_FLAG</a>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Use cache buffers<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *ent = <a href="#L4154" title="utils/adt/formatting.c:4154">DCH_cache_fetch</a>(fmt_str, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; incache = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; format = ent-&gt;format;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = <a href="#L3976" title="utils/adt/formatting.c:3976">DCH_datetime_type</a>(format);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!incache)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(format);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result &amp; <a href="#L1028" title="utils/adt/formatting.c:1028">DCH_ZONED</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L4681" title="utils/adt/formatting.c:4681">do_to_timestamp</a>: shared code for <a href="#L4368" title="utils/adt/formatting.c:4368">to_timestamp</a> and <a href="#L4407" title="utils/adt/formatting.c:4407">to_date</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Parse the 'date_txt' according to 'fmt', return results as a struct pg_tm,<br/></li>
<li></span><span class="Comment"> * fractional seconds, struct <a href="#L434" title="utils/adt/formatting.c:434">fmt_tz</a>, and fractional precision.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * 'collid' identifies the collation to use, if needed.<br/></li>
<li></span><span class="Comment"> * 'std' specifies standard parsing mode.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Bit mask of date/time/zone components found in 'fmt' is returned in 'flags',<br/></li>
<li></span><span class="Comment"> * if that is not NULL.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true on success, false on failure (if escontext points to an<br/></li>
<li></span><span class="Comment"> * ErrorSaveContext; otherwise errors are thrown).&nbsp; Note that currently,<br/></li>
<li></span><span class="Comment"> * soft-error behavior is provided for bad data but not bad format.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We <a href="../../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> 'fmt' into a list of FormatNodes, which is then passed to<br/></li>
<li></span><span class="Comment"> * <a href="#L3412" title="utils/adt/formatting.c:3412">DCH_from_char</a> to populate a <a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a> with the parsed contents of<br/></li>
<li></span><span class="Comment"> * 'date_txt'.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The <a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a> is then analysed and converted into the final results in<br/></li>
<li></span><span class="Comment"> * struct 'tm', 'fsec', struct 'tz', and 'fprec'.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L4681">&#x200c;</a></span><span class="linkable">do_to_timestamp</span>(text *date_txt, text *fmt, Oid collid, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> std,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> pg_tm *tm, fsec_t *fsec, <span class="Type">struct</span> <a href="#L434" title="utils/adt/formatting.c:434">fmt_tz</a> *tz,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> *fprec, uint32 *flags, Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L430" title="utils/adt/formatting.c:430">TmFromChar</a>&nbsp; &nbsp; tmfc;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt_len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *date_str;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmask;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; incache = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(tm != <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; Assert(fsec != <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; date_str = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(date_txt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L432" title="utils/adt/formatting.c:432">ZERO_tmfc</a>(&amp;tmfc);<br/></li>
<li>&nbsp; &nbsp; <a href="#L508" title="utils/adt/formatting.c:508">ZERO_tm</a>(tm);<br/></li>
<li>&nbsp; &nbsp; *fsec = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; tz-&gt;has_tz = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fprec)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *fprec = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flags)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *flags = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; fmask = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> mask for <a href="datetime.c.html#L2497" title="utils/adt/datetime.c:2497">ValidateDate</a>() */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; fmt_len = VARSIZE_ANY_EXHDR(fmt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fmt_len)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *fmt_str;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fmt_str = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(fmt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fmt_len &gt; <a href="#L360" title="utils/adt/formatting.c:360">DCH_CACHE_SIZE</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Allocate new memory if format picture is bigger than static<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * cache and do not use cache (call parser always)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; format = (<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((fmt_len + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1328" title="utils/adt/formatting.c:1328">parse_format</a>(format, fmt_str, <a href="#L775" title="utils/adt/formatting.c:775">DCH_keywords</a>, <a href="#L568" title="utils/adt/formatting.c:568">DCH_suff</a>, <a href="#L948" title="utils/adt/formatting.c:948">DCH_index</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L99" title="utils/adt/formatting.c:99">DCH_FLAG</a> | (std ? <a href="#L101" title="utils/adt/formatting.c:101">STD_FLAG</a> : <span class="Constant">0</span>), <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Use cache buffers<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L375" title="utils/adt/formatting.c:375">DCHCacheEntry</a> *ent = <a href="#L4154" title="utils/adt/formatting.c:4154">DCH_cache_fetch</a>(fmt_str, std);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; incache = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; format = ent-&gt;format;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L1480" title="utils/adt/formatting.c:1480">dump_node</a>(format, fmt_len); */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L2290" title="utils/adt/formatting.c:2290">dump_index</a>(<a href="#L775" title="utils/adt/formatting.c:775">DCH_keywords</a>, <a href="#L948" title="utils/adt/formatting.c:948">DCH_index</a>); */<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3412" title="utils/adt/formatting.c:3412">DCH_from_char</a>(format, date_str, &amp;tmfc, collid, std, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(fmt_str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (SOFT_ERROR_OCCURRED(escontext))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> fail;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *flags = <a href="#L3976" title="utils/adt/formatting.c:3976">DCH_datetime_type</a>(format);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!incache)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(format);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; format = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L445" title="utils/adt/formatting.c:445">DEBUG_TMFC</a>(&amp;tmfc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Convert <a href="#L4407" title="utils/adt/formatting.c:4407">to_date</a>/<a href="#L4368" title="utils/adt/formatting.c:4368">to_timestamp</a> input fields to standard 'tm'<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.ssss)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = tmfc.ssss;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_hour = x / SECS_PER_HOUR;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x %= SECS_PER_HOUR;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_min = x / SECS_PER_MINUTE;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x %= SECS_PER_MINUTE;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_sec = x;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.ss)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_sec = tmfc.ss;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.mi)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_min = tmfc.mi;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.hh)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_hour = tmfc.hh;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.clock == <a href="#L171" title="utils/adt/formatting.c:171">CLOCK_12_HOUR</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_hour &lt; <span class="Constant">1</span> || tm-&gt;tm_hour &gt; HOURS_PER_DAY / <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errsave(escontext,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;hour </span><span class="Special">\&quot;%d\&quot;</span><span class="Constant"> is invalid for the 12-hour clock&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_hour),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;Use the 24-hour clock, or give an hour between 1 and 12.&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> fail;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.pm &amp;&amp; tm-&gt;tm_hour &lt; HOURS_PER_DAY / <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_hour += HOURS_PER_DAY / <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!tmfc.pm &amp;&amp; tm-&gt;tm_hour == HOURS_PER_DAY / <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_hour = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.year)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If CC and YY (or Y) are provided, use YY as 2 low-order digits for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the year in the given century.&nbsp; Keep in mind that the 21st century<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * AD runs from 2001-2100, not 2000-2099; 6th century BC runs from<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * 600BC to 501BC.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.cc &amp;&amp; tmfc.yysz &lt;= <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.bc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmfc.cc = -tmfc.cc;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year = tmfc.year % <span class="Constant">100</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_year)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.cc &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year += (tmfc.cc - <span class="Constant">1</span>) * <span class="Constant">100</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year = (tmfc.cc + <span class="Constant">1</span>) * <span class="Constant">100</span> - tm-&gt;tm_year + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> century year for dates ending in &quot;00&quot; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year = tmfc.cc * <span class="Constant">100</span> + ((tmfc.cc &gt;= <span class="Constant">0</span>) ? <span class="Constant">0</span> : <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If a 4-digit year is provided, we use that and ignore CC. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year = tmfc.year;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.bc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year = -tm-&gt;tm_year;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* correct for our representation of BC years */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_year &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_M(YEAR);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (tmfc.cc)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* use first year of century */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.bc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmfc.cc = -tmfc.cc;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.cc &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* +1 because 21st century started in 2001 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year = (tmfc.cc - <span class="Constant">1</span>) * <span class="Constant">100</span> + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* +1 because year == 599 is 600 BC */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_year = tmfc.cc * <span class="Constant">100</span> + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_M(YEAR);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.j)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L311" title="utils/adt/datetime.c:311">j2date</a>(tmfc.j, &amp;tm-&gt;tm_year, &amp;tm-&gt;tm_mon, &amp;tm-&gt;tm_mday);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_DATE_M;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.ww)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.mode == FROM_CHAR_DATE_ISOWEEK)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If tmfc.d is not set, then the date is left at the beginning of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the ISO week (Monday).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.d)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="timestamp.c.html#L5137" title="utils/adt/timestamp.c:5137">isoweekdate2date</a>(tmfc.ww, tmfc.d, &amp;tm-&gt;tm_year, &amp;tm-&gt;tm_mon, &amp;tm-&gt;tm_mday);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="timestamp.c.html#L5124" title="utils/adt/timestamp.c:5124">isoweek2date</a>(tmfc.ww, &amp;tm-&gt;tm_year, &amp;tm-&gt;tm_mon, &amp;tm-&gt;tm_mday);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_DATE_M;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmfc.ddd = (tmfc.ww - <span class="Constant">1</span>) * <span class="Constant">7</span> + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.w)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tmfc.dd = (tmfc.w - <span class="Constant">1</span>) * <span class="Constant">7</span> + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.dd)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mday = tmfc.dd;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_M(DAY);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.mm)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mon = tmfc.mm;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_M(MONTH);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.ddd &amp;&amp; (tm-&gt;tm_mon &lt;= <span class="Constant">1</span> || tm-&gt;tm_mday &lt;= <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * The month and day field have not been set, so we use the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * day-of-year field to populate them.&nbsp; Depending on the date mode,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * this field may be interpreted as a Gregorian day-of-year, or an ISO<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * week date day-of-year.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!tm-&gt;tm_year &amp;&amp; !tmfc.bc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errsave(escontext,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_DATETIME_FORMAT),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;cannot calculate day of year without year information&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> fail;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.mode == FROM_CHAR_DATE_ISOWEEK)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j0;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* zeroth day of the ISO year, in Julian */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j0 = <a href="timestamp.c.html#L5104" title="utils/adt/timestamp.c:5104">isoweek2j</a>(tm-&gt;tm_year, <span class="Constant">1</span>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L311" title="utils/adt/datetime.c:311">j2date</a>(j0 + tmfc.ddd, &amp;tm-&gt;tm_year, &amp;tm-&gt;tm_mon, &amp;tm-&gt;tm_mday);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_DATE_M;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">int</span>&nbsp; *y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">int</span> ysum[<span class="Constant">2</span>][<span class="Constant">13</span>] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<span class="Constant">0</span>, <span class="Constant">31</span>, <span class="Constant">59</span>, <span class="Constant">90</span>, <span class="Constant">120</span>, <span class="Constant">151</span>, <span class="Constant">181</span>, <span class="Constant">212</span>, <span class="Constant">243</span>, <span class="Constant">273</span>, <span class="Constant">304</span>, <span class="Constant">334</span>, <span class="Constant">365</span>},<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<span class="Constant">0</span>, <span class="Constant">31</span>, <span class="Constant">60</span>, <span class="Constant">91</span>, <span class="Constant">121</span>, <span class="Constant">152</span>, <span class="Constant">182</span>, <span class="Constant">213</span>, <span class="Constant">244</span>, <span class="Constant">274</span>, <span class="Constant">305</span>, <span class="Constant">335</span>, <span class="Constant">366</span>}};<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y = ysum[isleap(tm-&gt;tm_year)];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt;= MONTHS_PER_YEAR; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.ddd &lt;= y[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_mon &lt;= <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mon = i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_mday &lt;= <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_mday = tmfc.ddd - y[i - <span class="Constant">1</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmask |= DTK_M(MONTH) | DTK_M(DAY);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.ms)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *fsec += tmfc.ms * <span class="Constant">1000</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.us)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *fsec += tmfc.us;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fprec)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *fprec = tmfc.ff;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fractional precision, if specified */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="geo_spgist.c.html#L107" title="utils/adt/geo_spgist.c:107">Range</a>-check date fields according to <a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> mask computed above */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (fmask != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We already dealt with AD/BC, so pass isjulian = true */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dterr = <a href="datetime.c.html#L2497" title="utils/adt/datetime.c:2497">ValidateDate</a>(fmask, <span class="Constant">true</span>, <span class="Constant">false</span>, <span class="Constant">false</span>, tm);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dterr != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Force the error to be DTERR_FIELD_OVERFLOW even if <a href="datetime.c.html#L2497" title="utils/adt/datetime.c:2497">ValidateDate</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * said DTERR_MD_FIELD_OVERFLOW, because we don't want to <a href="../../nodes/print.c.html#L36" title="nodes/print.c:36">print</a> an<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * irrelevant hint about datestyle.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L4081" title="utils/adt/datetime.c:4081">DateTimeParseError</a>(DTERR_FIELD_OVERFLOW, <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; date_str, <span class="Constant">&quot;timestamp&quot;</span>, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> fail;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="geo_spgist.c.html#L107" title="utils/adt/geo_spgist.c:107">Range</a>-check time fields too */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (tm-&gt;tm_hour &lt; <span class="Constant">0</span> || tm-&gt;tm_hour &gt;= HOURS_PER_DAY ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_min &lt; <span class="Constant">0</span> || tm-&gt;tm_min &gt;= MINS_PER_HOUR ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tm-&gt;tm_sec &lt; <span class="Constant">0</span> || tm-&gt;tm_sec &gt;= SECS_PER_MINUTE ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *fsec &lt; INT64CONST(<span class="Constant">0</span>) || *fsec &gt;= USECS_PER_SEC)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L4081" title="utils/adt/datetime.c:4081">DateTimeParseError</a>(DTERR_FIELD_OVERFLOW, <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; date_str, <span class="Constant">&quot;timestamp&quot;</span>, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> fail;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If timezone info was present, reduce it to a GMT offset.&nbsp; (We cannot do<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * this until we've filled all of the tm struct, since the zone's offset<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * might be time-varying.)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (tmfc.tzsign)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* TZH and/or TZM fields */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.tzh &lt; <span class="Constant">0</span> || tmfc.tzh &gt; MAX_TZDISP_HOUR ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmfc.tzm &lt; <span class="Constant">0</span> || tmfc.tzm &gt;= MINS_PER_HOUR)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="datetime.c.html#L4081" title="utils/adt/datetime.c:4081">DateTimeParseError</a>(DTERR_TZDISP_OVERFLOW, <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; date_str, <span class="Constant">&quot;timestamp&quot;</span>, escontext);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> fail;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tz-&gt;has_tz = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tz-&gt;gmtoffset = (tmfc.tzh * MINS_PER_HOUR + tmfc.tzm) * SECS_PER_MINUTE;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* note we are flipping the sign convention here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.tzsign &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tz-&gt;gmtoffset = -tz-&gt;gmtoffset;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (tmfc.has_tz)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* TZ field */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; tz-&gt;has_tz = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmfc.tzp == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fixed-offset abbreviation; flip the sign convention */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tz-&gt;gmtoffset = -tmfc.gmtoffset;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* dynamic-offset abbreviation, resolve using specified time */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tz-&gt;gmtoffset = <a href="datetime.c.html#L1746" title="utils/adt/datetime.c:1746">DetermineTimeZoneAbbrevOffset</a>(tm, tmfc.abbrev,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmfc.tzp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L451" title="utils/adt/formatting.c:451">DEBUG_TM</a>(tm);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (format &amp;&amp; !incache)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(format);<br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(date_str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">fail</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (format &amp;&amp; !incache)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(format);<br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(date_str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/**********************************************************************<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; the NUMBER version part<br/></li>
<li></span><span class="Comment"> *********************************************************************/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L5038">&#x200c;</a><span class="linkable">fill_str</span>(<span class="Type">char</span> *str, <span class="Type">int</span> c, <span class="Type">int</span> max)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; memset(str, c, max);<br/></li>
<li>&nbsp; &nbsp; *(str + max) = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> str;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L5045">&#x200c;</a><span class="PreProc">#define <span class="linkable">zeroize_NUM</span>(_n) \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> { \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;flag&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;lsign&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;pre&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;post&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;pre_lsign_num = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;need_locale&nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;multi&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;zero_start&nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (_n)-&gt;zero_end&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="Constant">0</span><span class="PreProc">;&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc">(</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* This works the same as <a href="#L3962" title="utils/adt/formatting.c:3962">DCH_prevent_counter_overflow</a> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">inline</span> <span class="Type">void<br/></li>
<li><a id="L5060">&#x200c;</a></span><span class="linkable">NUM_prevent_counter_overflow</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L394" title="utils/adt/formatting.c:394">NUMCounter</a> &gt;= (<span class="Constant">INT_MAX</span> - <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; <a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L392" title="utils/adt/formatting.c:392">NUMCache</a>[i]-&gt;age &gt;&gt;= <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L394" title="utils/adt/formatting.c:394">NUMCounter</a> &gt;&gt;= <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="../../port/win32/socket.c.html#L36" title="port/win32/socket.c:36">select</a> a <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> to hold the given format picture */<br/></li>
<li></span><span class="Type">static</span> <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *<br/></li>
<li><a id="L5072">&#x200c;</a><span class="linkable">NUM_cache_getnew</span>(<span class="Type">const</span> <span class="Type">char</span> *str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *ent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Ensure we can advance <a href="#L394" title="utils/adt/formatting.c:394">NUMCounter</a> below */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L5060" title="utils/adt/formatting.c:5060">NUM_prevent_counter_overflow</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If cache is full, remove oldest entry (or recycle first not-valid one)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a> &gt;= <a href="#L366" title="utils/adt/formatting.c:366">NUM_CACHE_ENTRIES</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *old = <a href="#L392" title="utils/adt/formatting.c:392">NUMCache</a>[<span class="Constant">0</span>];<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Cache is full (</span><span class="Special">%d</span><span class="Constant">)&quot;</span>, <a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (old-&gt;valid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">1</span>; i &lt; <a href="#L366" title="utils/adt/formatting.c:366">NUM_CACHE_ENTRIES</a>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ent = <a href="#L392" title="utils/adt/formatting.c:392">NUMCache</a>[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!ent-&gt;valid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old = ent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ent-&gt;age &lt; old-&gt;age)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old = ent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;OLD: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> AGE: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, old-&gt;str, old-&gt;age);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; old-&gt;valid = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strlcpy(old-&gt;str, str, <a href="#L362" title="utils/adt/formatting.c:362">NUM_CACHE_SIZE</a> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; old-&gt;age = (++<a href="#L394" title="utils/adt/formatting.c:394">NUMCounter</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* caller is expected to fill format and Num, then set valid */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> old;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;NEW (</span><span class="Special">%d</span><span class="Constant">)&quot;</span>, <a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Assert(<a href="#L392" title="utils/adt/formatting.c:392">NUMCache</a>[<a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a>] == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L392" title="utils/adt/formatting.c:392">NUMCache</a>[<a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a>] = ent = (<a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1214" title="utils/mmgr/mcxt.c:1214">MemoryContextAllocZero</a>(<a href="../mmgr/mcxt.c.html#L149" title="utils/mmgr/mcxt.c:149">TopMemoryContext</a>, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;valid = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strlcpy(ent-&gt;str, str, <a href="#L362" title="utils/adt/formatting.c:362">NUM_CACHE_SIZE</a> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;age = (++<a href="#L394" title="utils/adt/formatting.c:394">NUMCounter</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* caller is expected to fill format and Num, then set valid */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ++<a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ent;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* look for an existing <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> matching the given format picture */<br/></li>
<li></span><span class="Type">static</span> <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *<br/></li>
<li><a id="L5131">&#x200c;</a><span class="linkable">NUM_cache_search</span>(<span class="Type">const</span> <span class="Type">char</span> *str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Ensure we can advance <a href="#L394" title="utils/adt/formatting.c:394">NUMCounter</a> below */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L5060" title="utils/adt/formatting.c:5060">NUM_prevent_counter_overflow</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; <a href="#L393" title="utils/adt/formatting.c:393">n_NUMCache</a>; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *ent = <a href="#L392" title="utils/adt/formatting.c:392">NUMCache</a>[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ent-&gt;valid &amp;&amp; strcmp(ent-&gt;str, str) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;age = (++<a href="#L394" title="utils/adt/formatting.c:394">NUMCounter</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ent;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Find or create a <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> for the given format picture */<br/></li>
<li></span><span class="Type">static</span> <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *<br/></li>
<li><a id="L5152">&#x200c;</a><span class="linkable">NUM_cache_fetch</span>(<span class="Type">const</span> <span class="Type">char</span> *str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *ent;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((ent = <a href="#L5131" title="utils/adt/formatting.c:5131">NUM_cache_search</a>(str)) == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Not in the cache, must run parser and save a new format-picture to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the cache.&nbsp; Do not mark the cache entry valid until parsing<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * succeeds.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ent = <a href="#L5072" title="utils/adt/formatting.c:5072">NUM_cache_getnew</a>(str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5045" title="utils/adt/formatting.c:5045">zeroize_NUM</a>(&amp;ent-&gt;Num);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1328" title="utils/adt/formatting.c:1328">parse_format</a>(ent-&gt;format, str, <a href="#L900" title="utils/adt/formatting.c:900">NUM_keywords</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">NULL</span>, <a href="#L972" title="utils/adt/formatting.c:972">NUM_index</a>, <a href="#L100" title="utils/adt/formatting.c:100">NUM_FLAG</a>, &amp;ent-&gt;Num);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ent-&gt;valid = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> ent;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Cache routine for NUM to_char version<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *<br/></li>
<li><a id="L5180">&#x200c;</a><span class="linkable">NUM_cache</span>(<span class="Type">int</span> len, <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *Num, text *pars_str, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> *shouldFree)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; str = <a href="varlena.c.html#L217" title="utils/adt/varlena.c:217">text_to_cstring</a>(pars_str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &gt; <a href="#L362" title="utils/adt/formatting.c:362">NUM_CACHE_SIZE</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Allocate new memory if format picture is bigger than static cache<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * and do not use cache (call parser always)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; format = (<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((len + <span class="Constant">1</span>) * <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *shouldFree = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5045" title="utils/adt/formatting.c:5045">zeroize_NUM</a>(Num);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1328" title="utils/adt/formatting.c:1328">parse_format</a>(format, str, <a href="#L900" title="utils/adt/formatting.c:900">NUM_keywords</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">NULL</span>, <a href="#L972" title="utils/adt/formatting.c:972">NUM_index</a>, <a href="#L100" title="utils/adt/formatting.c:100">NUM_FLAG</a>, Num);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Use cache buffers<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L384" title="utils/adt/formatting.c:384">NUMCacheEntry</a> *ent = <a href="#L5152" title="utils/adt/formatting.c:5152">NUM_cache_fetch</a>(str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *shouldFree = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; format = ent-&gt;format;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Copy cache to used struct<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;flag = ent-&gt;Num.flag;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;lsign = ent-&gt;Num.lsign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;pre = ent-&gt;Num.pre;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;post = ent-&gt;Num.post;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;pre_lsign_num = ent-&gt;Num.pre_lsign_num;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;need_locale = ent-&gt;Num.need_locale;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;multi = ent-&gt;Num.multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;zero_start = ent-&gt;Num.zero_start;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Num-&gt;zero_end = ent-&gt;Num.zero_end;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="#L1480" title="utils/adt/formatting.c:1480">dump_node</a>(format, len); */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L2290" title="utils/adt/formatting.c:2290">dump_index</a>(<a href="#L900" title="utils/adt/formatting.c:900">NUM_keywords</a>, <a href="#L972" title="utils/adt/formatting.c:972">NUM_index</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(str);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> format;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L5238">&#x200c;</a><span class="linkable">int_to_roman</span>(<span class="Type">int</span> number)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *result,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr[<span class="Constant">12</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Constant">16</span>);<br/></li>
<li>&nbsp; &nbsp; *result = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (number &gt; <span class="Constant">3999</span> || number &lt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(result, <span class="Constant">'#'</span>, <span class="Constant">15</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; len = snprintf(numstr, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(numstr), <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, number);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p = numstr; *p != <span class="Special">'\0'</span>; p++, --len)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; num = *p - (<span class="Constant">'0'</span> + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (num &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &gt; <span class="Constant">3</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (num-- != -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcat(result, <span class="Constant">&quot;M&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len == <span class="Constant">3</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcat(result, <a href="#L264" title="utils/adt/formatting.c:264">rm100</a>[num]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (len == <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcat(result, <a href="#L263" title="utils/adt/formatting.c:263">rm10</a>[num]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (len == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcat(result, <a href="#L262" title="utils/adt/formatting.c:262">rm1</a>[num]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Locale<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L5287">&#x200c;</a></span><span class="linkable">NUM_prepare_locale</span>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a> *Np)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;Num-&gt;need_locale)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> lconv *lconv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Get locales<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; lconv = <a href="pg_locale.c.html#L524" title="utils/adt/pg_locale.c:524">PGLC_localeconv</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Positive / Negative number sign<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lconv-&gt;negative_sign &amp;&amp; *lconv-&gt;negative_sign)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_negative_sign = lconv-&gt;negative_sign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_negative_sign = <span class="Constant">&quot;-&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lconv-&gt;positive_sign &amp;&amp; *lconv-&gt;positive_sign)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_positive_sign = lconv-&gt;positive_sign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_positive_sign = <span class="Constant">&quot;+&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Number decimal point<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lconv-&gt;decimal_point &amp;&amp; *lconv-&gt;decimal_point)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;decimal = lconv-&gt;decimal_point;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;decimal = <span class="Constant">&quot;.&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L325" title="utils/adt/formatting.c:325">IS_LDECIMAL</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;decimal = <span class="Constant">&quot;.&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Number thousands separator<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Some locales (e.g. broken glibc pt_BR), have a comma for decimal,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * but &quot;&quot; for thousands_sep, so we set the thousands_sep too.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * http://archives.postgresql.org/pgsql-hackers/2007-11/msg00772.php<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lconv-&gt;thousands_sep &amp;&amp; *lconv-&gt;thousands_sep)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_thousands_sep = lconv-&gt;thousands_sep;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Make sure thousands separator doesn't match decimal point symbol. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (strcmp(Np-&gt;decimal, <span class="Constant">&quot;,&quot;</span>) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_thousands_sep = <span class="Constant">&quot;,&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_thousands_sep = <span class="Constant">&quot;.&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Currency symbol<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lconv-&gt;currency_symbol &amp;&amp; *lconv-&gt;currency_symbol)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_currency_symbol = lconv-&gt;currency_symbol;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_currency_symbol = <span class="Constant">&quot; &quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Default <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_negative_sign = <span class="Constant">&quot;-&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_positive_sign = <span class="Constant">&quot;+&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;decimal = <span class="Constant">&quot;.&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_thousands_sep = <span class="Constant">&quot;,&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;L_currency_symbol = <span class="Constant">&quot; &quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Return pointer of last relevant number after decimal point<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 12.0500 --&gt; last relevant is '5'<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 12.0000 --&gt; last relevant is '.'<br/></li>
<li></span><span class="Comment"> * If there is no decimal point, return NULL (which will result in same<br/></li>
<li></span><span class="Comment"> * behavior as if FM hadn't been specified).<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L5369">&#x200c;</a><span class="linkable">get_last_relevant_decnum</span>(<span class="Type">char</span> *num)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p = strchr(num, <span class="Constant">'.'</span>);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;<a href="#L5369" title="utils/adt/formatting.c:5369">get_last_relevant_decnum</a>()&quot;</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!p)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*(++p))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p != <span class="Constant">'0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = p;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * These macros are used in <a href="#L5823" title="utils/adt/formatting.c:5823">NUM_processor</a>() and its subsidiary routines.<br/></li>
<li></span><span class="Comment"> * <a href="#L5397" title="utils/adt/formatting.c:5397">OVERLOAD_TEST</a>: true if we've reached end of input string<br/></li>
<li></span><span class="Comment"> * <a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a>(s): true if at least s bytes remain in string<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L5397">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">OVERLOAD_TEST</span>&nbsp; &nbsp; (Np-&gt;inout_p &gt;= Np-&gt;inout + input_len)<br/></li>
<li><a id="L5398">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">AMOUNT_TEST</span>(s)&nbsp; &nbsp; (Np-&gt;inout_p &lt;= Np-&gt;inout + (input_len - (s)))<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Number extraction for TO_NUMBER()<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L5405">&#x200c;</a></span><span class="linkable">NUM_numpart_from_char</span>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a> *Np, <span class="Type">int</span> id, <span class="Type">int</span> input_len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; isread = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot; --- scan start --- id=</span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (id == NUM_0 || id == NUM_9) ? <span class="Constant">&quot;NUM_0/9&quot;</span> : id == NUM_DEC ? <span class="Constant">&quot;NUM_DEC&quot;</span> : <span class="Constant">&quot;???&quot;</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L5397" title="utils/adt/formatting.c:5397">OVERLOAD_TEST</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">' '</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L5397" title="utils/adt/formatting.c:5397">OVERLOAD_TEST</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * read sign <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;number == <span class="Constant">' '</span> &amp;&amp; (id == NUM_0 || id == NUM_9) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (Np-&gt;read_pre + Np-&gt;read_post) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Try read sign (</span><span class="Special">%c</span><span class="Constant">), locale positive: </span><span class="Special">%s</span><span class="Constant">, negative: </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *Np-&gt;inout_p, Np-&gt;L_positive_sign, Np-&gt;L_negative_sign);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * locale sign<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(Np-&gt;Num) &amp;&amp; Np-&gt;Num-&gt;lsign == <a href="#L316" title="utils/adt/formatting.c:316">NUM_LSIGN_PRE</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Try read locale pre-sign (</span><span class="Special">%c</span><span class="Constant">)&quot;</span>, *Np-&gt;inout_p);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((x = strlen(Np-&gt;L_negative_sign)) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a>(x) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strncmp(Np-&gt;inout_p, Np-&gt;L_negative_sign, x) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> ((x = strlen(Np-&gt;L_positive_sign)) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a>(x) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; strncmp(Np-&gt;inout_p, Np-&gt;L_positive_sign, x) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Try read simple sign (</span><span class="Special">%c</span><span class="Constant">)&quot;</span>, *Np-&gt;inout_p);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * simple + - &lt; &gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">'-'</span> || (<a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(Np-&gt;Num) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p == <span class="Constant">'&lt;'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'-'</span>;&nbsp; &nbsp; <span class="Comment">/* set - */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'+'</span>;&nbsp; &nbsp; <span class="Comment">/* set + */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L5397" title="utils/adt/formatting.c:5397">OVERLOAD_TEST</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Scan for numbers (</span><span class="Special">%c</span><span class="Constant">), current number: '</span><span class="Special">%s</span><span class="Constant">'&quot;</span>, *Np-&gt;inout_p, Np-&gt;number);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * read digit or decimal point<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) *Np-&gt;inout_p))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;read_dec &amp;&amp; Np-&gt;read_post == Np-&gt;Num-&gt;post)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number_p = *Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;number_p++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;read_dec)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;read_post++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;read_pre++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; isread = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Read digit (</span><span class="Special">%c</span><span class="Constant">)&quot;</span>, *Np-&gt;inout_p);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(Np-&gt;Num) &amp;&amp; Np-&gt;read_dec == <span class="Constant">false</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We need not test <a href="#L325" title="utils/adt/formatting.c:325">IS_LDECIMAL</a>(Np-&gt;Num) explicitly here, because<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Np-&gt;decimal is always just &quot;.&quot; if we don't have a D format token.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * So we just unconditionally match to Np-&gt;decimal.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = strlen(Np-&gt;decimal);<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Try read decimal point (</span><span class="Special">%c</span><span class="Constant">)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *Np-&gt;inout_p);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (x &amp;&amp; <a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a>(x) &amp;&amp; strncmp(Np-&gt;inout_p, Np-&gt;decimal, x) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += x - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number_p = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;number_p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;read_dec = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; isread = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L5397" title="utils/adt/formatting.c:5397">OVERLOAD_TEST</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Read sign behind &quot;last&quot; number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We need sign detection because determine exact position of post-sign is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * difficult:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * FM9999.9999999S&nbsp; &nbsp; &nbsp;&nbsp; -&gt; 123.001- 9.9S&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; -&gt; .5- FM9.999999MI -&gt;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * 5.01-<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;number == <span class="Constant">' '</span> &amp;&amp; Np-&gt;read_pre + Np-&gt;read_post &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * locale sign (NUM_S) is always anchored behind a last number, if: -<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * locale sign expected - last read char was NUM_0/9 or NUM_DEC - and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> char is not digit<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(Np-&gt;Num) &amp;&amp; isread &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (Np-&gt;inout_p + <span class="Constant">1</span>) &lt; Np-&gt;inout + input_len &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>) *(Np-&gt;inout_p + <span class="Constant">1</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *tmp = Np-&gt;inout_p++;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Try read locale post-sign (</span><span class="Special">%c</span><span class="Constant">)&quot;</span>, *Np-&gt;inout_p);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((x = strlen(Np-&gt;L_negative_sign)) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a>(x) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strncmp(Np-&gt;inout_p, Np-&gt;L_negative_sign, x) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += x - <span class="Constant">1</span>;&nbsp; &nbsp; <span class="Comment">/* -1 .. <a href="#L5823" title="utils/adt/formatting.c:5823">NUM_processor</a>() do inout_p++ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> ((x = strlen(Np-&gt;L_positive_sign)) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a>(x) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; strncmp(Np-&gt;inout_p, Np-&gt;L_positive_sign, x) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += x - <span class="Constant">1</span>;&nbsp; &nbsp; <span class="Comment">/* -1 .. <a href="#L5823" title="utils/adt/formatting.c:5823">NUM_processor</a>() do inout_p++ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;number == <span class="Constant">' '</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* no sign read */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p = tmp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * try read non-locale sign, it's happen only if format is not exact<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * and we cannot determine sign position of MI/PL/SG, an example:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * FM9.999999MI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; -&gt; 5.01-<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * if (.... &amp;&amp; <a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(Np-&gt;Num)==false) prevents read wrong formats<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * like to_number('1 -', '9S') where sign is not anchored to last<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * number.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (isread == <span class="Constant">false</span> &amp;&amp; <a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(Np-&gt;Num) == <span class="Constant">false</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<a href="#L332" title="utils/adt/formatting.c:332">IS_PLUS</a>(Np-&gt;Num) || <a href="#L330" title="utils/adt/formatting.c:330">IS_MINUS</a>(Np-&gt;Num)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;Try read simple post-sign (</span><span class="Special">%c</span><span class="Constant">)&quot;</span>, *Np-&gt;inout_p);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * simple + -<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">'-'</span> || *Np-&gt;inout_p == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="#L5823" title="utils/adt/formatting.c:5823">NUM_processor</a>() do inout_p++ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = *Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L5609">&#x200c;</a><span class="PreProc">#define <span class="linkable">IS_PREDEC_SPACE</span>(_n) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L326" title="utils/adt/formatting.c:326">IS_ZERO</a>((_n)-&gt;Num)==</span><span class="Constant">false</span><span class="PreProc"> &amp;&amp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (_n)-&gt;number == (_n)-&gt;number_p &amp;&amp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *(_n)-&gt;number == </span><span class="Constant">'0'</span><span class="PreProc"> &amp;&amp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (_n)-&gt;Num-&gt;post != </span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * Add digit or sign to number-string<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L5620">&#x200c;</a></span><span class="linkable">NUM_numpart_to_char</span>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a> *Np, <span class="Type">int</span> id)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Note: in this elog() output not set '\0' in 'inout' */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Np-&gt;num_curr is number of current item in format-picture, it is not<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * current position in inout!<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;SIGN_WROTE: </span><span class="Special">%d</span><span class="Constant">, CURRENT: </span><span class="Special">%d</span><span class="Constant">, NUMBER_P: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">, INOUT: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;sign_wrote,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;num_curr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;number_p,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;inout);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; Np-&gt;num_in = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Write sign if real number will write to output Note: <a href="#L5609" title="utils/adt/formatting.c:5609">IS_PREDEC_SPACE</a>()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * handle &quot;9.9&quot; --&gt; &quot; .1&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign_wrote == <span class="Constant">false</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (Np-&gt;num_curr &gt;= Np-&gt;out_pre_spaces || (<a href="#L326" title="utils/adt/formatting.c:326">IS_ZERO</a>(Np-&gt;Num) &amp;&amp; Np-&gt;Num-&gt;zero_start == Np-&gt;num_curr)) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L5609" title="utils/adt/formatting.c:5609">IS_PREDEC_SPACE</a>(Np) == <span class="Constant">false</span> || (Np-&gt;last_relevant &amp;&amp; *Np-&gt;last_relevant == <span class="Constant">'.'</span>)))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;Num-&gt;lsign == <a href="#L316" title="utils/adt/formatting.c:316">NUM_LSIGN_PRE</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, Np-&gt;L_negative_sign);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, Np-&gt;L_positive_sign);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = Np-&gt;sign == <span class="Constant">'+'</span> ? <span class="Constant">' '</span> : <span class="Constant">'&lt;'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (Np-&gt;sign == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">' '</span>; <span class="Comment">/* Write + */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (Np-&gt;sign == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Write - */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * digits / FM / Zero / Dec. point<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (id == NUM_9 || id == NUM_0 || id == NUM_D || id == NUM_DEC)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;num_curr &lt; Np-&gt;out_pre_spaces &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (Np-&gt;Num-&gt;zero_start &gt; Np-&gt;num_curr || !<a href="#L326" title="utils/adt/formatting.c:326">IS_ZERO</a>(Np-&gt;Num)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Write blank space<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">' '</span>; <span class="Comment">/* Write ' ' */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L326" title="utils/adt/formatting.c:326">IS_ZERO</a>(Np-&gt;Num) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;num_curr &lt; Np-&gt;out_pre_spaces &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;Num-&gt;zero_start &lt;= Np-&gt;num_curr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Write ZERO<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">'0'</span>; <span class="Comment">/* Write '0' */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;num_in = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Write Decimal point<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;number_p == <span class="Constant">'.'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;last_relevant || *Np-&gt;last_relevant != <span class="Constant">'.'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, Np-&gt;decimal);&nbsp; &nbsp; <span class="Comment">/* Write DEC/D */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Ora 'n' -- FM9.9 --&gt; 'n.'<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;last_relevant &amp;&amp; *Np-&gt;last_relevant == <span class="Constant">'.'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, Np-&gt;decimal);&nbsp; &nbsp; <span class="Comment">/* Write DEC/D */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Write Digits<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;last_relevant &amp;&amp; Np-&gt;number_p &gt; Np-&gt;last_relevant &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; id != NUM_0)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * '0.1' -- 9.9 --&gt; '&nbsp; .1'<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L5609" title="utils/adt/formatting.c:5609">IS_PREDEC_SPACE</a>(Np))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * '0' -- FM9.9 --&gt; '0.'<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (Np-&gt;last_relevant &amp;&amp; *Np-&gt;last_relevant == <span class="Constant">'.'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = *Np-&gt;number_p;&nbsp; &nbsp; <span class="Comment">/* Write <a href="../../regex/regcomp.c.html#L331" title="regex/regcomp.c:331">DIGIT</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;num_in = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* do no exceed string length */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;number_p)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;number_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; end = Np-&gt;num_count + (Np-&gt;out_pre_spaces ? <span class="Constant">1</span> : <span class="Constant">0</span>) + (<a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(Np-&gt;Num) ? <span class="Constant">1</span> : <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;last_relevant &amp;&amp; Np-&gt;last_relevant == Np-&gt;number_p)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end = Np-&gt;num_curr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;num_curr + <span class="Constant">1</span> == end)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign_wrote == <span class="Constant">true</span> &amp;&amp; <a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = Np-&gt;sign == <span class="Constant">'+'</span> ? <span class="Constant">' '</span> : <span class="Constant">'&gt;'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;inout_p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(Np-&gt;Num) &amp;&amp; Np-&gt;Num-&gt;lsign == <a href="#L317" title="utils/adt/formatting.c:317">NUM_LSIGN_POST</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, Np-&gt;L_negative_sign);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, Np-&gt;L_positive_sign);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ++Np-&gt;num_curr;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Skip over &quot;n&quot; input characters, but only if they aren't <a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a> data<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L5810">&#x200c;</a></span><span class="linkable">NUM_eat_non_data_chars</span>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a> *Np, <span class="Type">int</span> n, <span class="Type">int</span> input_len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (n-- &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L5397" title="utils/adt/formatting.c:5397">OVERLOAD_TEST</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* end of input */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strchr(<span class="Constant">&quot;0123456789.,+-&quot;</span>, *Np-&gt;inout_p) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* it's a data character */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(Np-&gt;inout_p);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L5823">&#x200c;</a><span class="linkable">NUM_processor</span>(<a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *node, <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a> *Num, <span class="Type">char</span> *inout,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> *number, <span class="Type">int</span> input_len, <span class="Type">int</span> to_char_out_pre_spaces,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> sign, <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> is_to_char, Oid collid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *n;<br/></li>
<li>&nbsp; &nbsp; <a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a>&nbsp; &nbsp; &nbsp; &nbsp; _Np,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *Np = &amp;_Np;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *pattern;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pattern_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; MemSet(Np, <span class="Constant">0</span>, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L996" title="utils/adt/formatting.c:996">NUMProc</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Np-&gt;Num = Num;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;is_to_char = is_to_char;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;number = number;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;inout = inout;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;last_relevant = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;read_post = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;read_pre = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;read_dec = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;Num-&gt;zero_start)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; --Np-&gt;Num-&gt;zero_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">EEEE</span><span class="Special">\&quot;</span><span class="Constant"> not supported for input&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> strcpy(inout, number);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Roman correction<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">RN</span><span class="Special">\&quot;</span><span class="Constant"> not supported for input&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;lsign = Np-&gt;Num-&gt;pre_lsign_num = Np-&gt;Num-&gt;post =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;pre = Np-&gt;out_pre_spaces = Np-&gt;sign = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;flag = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;flag |= <a href="#L305" title="utils/adt/formatting.c:305">NUM_F_FILLMODE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;flag = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;flag |= <a href="#L310" title="utils/adt/formatting.c:310">NUM_F_ROMAN</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Sign<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (is_to_char)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign = sign;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* MI/PL/SG - write sign itself and not in number */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L332" title="utils/adt/formatting.c:332">IS_PLUS</a>(Np-&gt;Num) || <a href="#L330" title="utils/adt/formatting.c:330">IS_MINUS</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L332" title="utils/adt/formatting.c:332">IS_PLUS</a>(Np-&gt;Num) &amp;&amp; <a href="#L330" title="utils/adt/formatting.c:330">IS_MINUS</a>(Np-&gt;Num) == <span class="Constant">false</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">false</span>; <span class="Comment">/* need sign */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">true</span>;&nbsp; &nbsp; <span class="Comment">/* needn't sign */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign != <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;flag &amp;= ~<a href="#L307" title="utils/adt/formatting.c:307">NUM_F_BRACKET</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign == <span class="Constant">'+'</span> &amp;&amp; <a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num) &amp;&amp; <a href="#L331" title="utils/adt/formatting.c:331">IS_LSIGN</a>(Np-&gt;Num) == <span class="Constant">false</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">true</span>;&nbsp; &nbsp; <span class="Comment">/* needn't sign */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign_wrote = <span class="Constant">false</span>; <span class="Comment">/* need sign */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;Num-&gt;lsign == <a href="#L316" title="utils/adt/formatting.c:316">NUM_LSIGN_PRE</a> &amp;&amp; Np-&gt;Num-&gt;pre == Np-&gt;Num-&gt;pre_lsign_num)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;lsign = <a href="#L317" title="utils/adt/formatting.c:317">NUM_LSIGN_POST</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Count<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; Np-&gt;num_count = Np-&gt;Num-&gt;post + Np-&gt;Num-&gt;pre - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (is_to_char)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;out_pre_spaces = to_char_out_pre_spaces;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num) &amp;&amp; <a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;last_relevant = <a href="#L5369" title="utils/adt/formatting.c:5369">get_last_relevant_decnum</a>(Np-&gt;number);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> '0' specifiers are present, make sure we don't strip<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * those digits.&nbsp; But don't advance last_relevant beyond the last<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * character of the Np-&gt;number string, which is a hazard if the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * number got shortened due to precision limitations.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;last_relevant &amp;&amp; Np-&gt;Num-&gt;zero_end &gt; Np-&gt;out_pre_spaces)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last_zero_pos;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *last_zero;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* note that Np-&gt;number cannot be zero-length here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last_zero_pos = strlen(Np-&gt;number) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last_zero_pos = <a href="../../jit/llvm/llvmjit_inline.cpp.html#L46" title="jit/llvm/llvmjit_inline.cpp:46">Min</a>(last_zero_pos,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;zero_end - Np-&gt;out_pre_spaces);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last_zero = Np-&gt;number + last_zero_pos;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;last_relevant &lt; last_zero)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;last_relevant = last_zero;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign_wrote == <span class="Constant">false</span> &amp;&amp; Np-&gt;out_pre_spaces == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++Np-&gt;num_count;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;out_pre_spaces = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">' '</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* sign space */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *(Np-&gt;number + <span class="Constant">1</span>) = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Np-&gt;num_in = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; Np-&gt;num_curr = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">\n\t</span><span class="Constant">SIGN: '</span><span class="Special">%c</span><span class="Constant">'</span><span class="Special">\n\t</span><span class="Constant">NUM: '</span><span class="Special">%s</span><span class="Constant">'</span><span class="Special">\n\t</span><span class="Constant">PRE: </span><span class="Special">%d\n\t</span><span class="Constant">POST: </span><span class="Special">%d\n\t</span><span class="Constant">NUM_COUNT: </span><span class="Special">%d\n\t</span><span class="Constant">NUM_PRE: </span><span class="Special">%d\n\t</span><span class="Constant">SIGN_WROTE: </span><span class="Special">%s\n\t</span><span class="Constant">ZERO: </span><span class="Special">%s\n\t</span><span class="Constant">ZERO_START: </span><span class="Special">%d\n\t</span><span class="Constant">ZERO_END: </span><span class="Special">%d\n\t</span><span class="Constant">LAST_RELEVANT: </span><span class="Special">%s\n\t</span><span class="Constant">BRACKET: </span><span class="Special">%s\n\t</span><span class="Constant">PLUS: </span><span class="Special">%s\n\t</span><span class="Constant">MINUS: </span><span class="Special">%s\n\t</span><span class="Constant">FILLMODE: </span><span class="Special">%s\n\t</span><span class="Constant">ROMAN: </span><span class="Special">%s\n\t</span><span class="Constant">EEEE: </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;sign,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;number,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;Num-&gt;pre,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;Num-&gt;post,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;num_count,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;out_pre_spaces,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;sign_wrote ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L326" title="utils/adt/formatting.c:326">IS_ZERO</a>(Np-&gt;Num) ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;Num-&gt;zero_start,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;Num-&gt;zero_end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Np-&gt;last_relevant ? Np-&gt;last_relevant : <span class="Constant">&quot;&lt;not set&gt;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L329" title="utils/adt/formatting.c:329">IS_BRACKET</a>(Np-&gt;Num) ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L332" title="utils/adt/formatting.c:332">IS_PLUS</a>(Np-&gt;Num) ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L330" title="utils/adt/formatting.c:330">IS_MINUS</a>(Np-&gt;Num) ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num) ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(Np-&gt;Num) ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(Np-&gt;Num) ? <span class="Constant">&quot;Yes&quot;</span> : <span class="Constant">&quot;No&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; );<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Locale<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L5287" title="utils/adt/formatting.c:5287">NUM_prepare_locale</a>(Np);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Processor direct cycle<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;number_p = Np-&gt;number;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;number_p = Np-&gt;number + <span class="Constant">1</span>;&nbsp; &nbsp; <span class="Comment">/* first char is space for sign */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (n = node, Np-&gt;inout_p = Np-&gt;inout; n-&gt;type != <a href="#L161" title="utils/adt/formatting.c:161">NODE_TYPE_END</a>; n++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Check at least one byte remains to be scanned.&nbsp; (In actions<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * below, must use <a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a> if we want to read more bytes than<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * that.)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L5397" title="utils/adt/formatting.c:5397">OVERLOAD_TEST</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Format pictures actions<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n-&gt;type == <a href="#L162" title="utils/adt/formatting.c:162">NODE_TYPE_ACTION</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Create/read digit/zero/blank/sign/special-case<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * 'NUM_S' note: The locale sign is anchored to number and we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * read/write it when we work with first or last number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * (NUM_0/NUM_9).&nbsp; This is why NUM_S is missing in switch().<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Notice the &quot;Np-&gt;inout_p++&quot; at the bottom of the loop.&nbsp; This is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * why most of the actions advance inout_p one less than you might<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * expect.&nbsp; In cases where we don't want that increment to happen,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * a switch case ends with &quot;continue&quot; not &quot;break&quot;.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (n-&gt;key-&gt;id)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_9:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_0:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_DEC:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_D:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5620" title="utils/adt/formatting.c:5620">NUM_numpart_to_char</a>(Np, n-&gt;key-&gt;id);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;&nbsp; &nbsp; <span class="Comment">/* for() */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5405" title="utils/adt/formatting.c:5405">NUM_numpart_from_char</a>(Np, n-&gt;key-&gt;id, input_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; <span class="Comment">/* switch() case: */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_COMMA:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;num_in)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">','</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;num_in)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;inout_p != <span class="Constant">','</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_G:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pattern = Np-&gt;L_thousands_sep;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pattern_len = strlen(pattern);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;num_in)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* just in case there are MB chars */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pattern_len = <a href="../mb/mbutils.c.html#L1037" title="utils/mb/mbutils.c:1037">pg_mbstrlen</a>(pattern);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memset(Np-&gt;inout_p, <span class="Constant">' '</span>, pattern_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += pattern_len - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, pattern);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += pattern_len - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Np-&gt;num_in)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Because L_thousands_sep typically contains data<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * characters (either '.' or ','), we can't use<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="#L5810" title="utils/adt/formatting.c:5810">NUM_eat_non_data_chars</a> here.&nbsp; Instead <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> only if<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the input matches L_thousands_sep.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L5398" title="utils/adt/formatting.c:5398">AMOUNT_TEST</a>(pattern_len) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strncmp(Np-&gt;inout_p, pattern, pattern_len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += pattern_len - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_L:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pattern = Np-&gt;L_currency_symbol;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, pattern);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(pattern) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5810" title="utils/adt/formatting.c:5810">NUM_eat_non_data_chars</a>(Np, <a href="../mb/mbutils.c.html#L1037" title="utils/mb/mbutils.c:1037">pg_mbstrlen</a>(pattern), input_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_RN:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, Np-&gt;number_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(Np-&gt;inout_p, <span class="Constant">&quot;</span><span class="Special">%15s</span><span class="Constant">&quot;</span>, Np-&gt;number_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_rn:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, <a href="#L2253" title="utils/adt/formatting.c:2253">asc_tolower_z</a>(Np-&gt;number_p));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(Np-&gt;inout_p, <span class="Constant">&quot;</span><span class="Special">%15s</span><span class="Constant">&quot;</span>, <a href="#L2253" title="utils/adt/formatting.c:2253">asc_tolower_z</a>(Np-&gt;number_p));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_th:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(Np-&gt;Num) || *Np-&gt;number == <span class="Constant">'#'</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign == <span class="Constant">'-'</span> || <a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, <a href="#L1516" title="utils/adt/formatting.c:1516">get_th</a>(Np-&gt;number, <a href="#L278" title="utils/adt/formatting.c:278">TH_LOWER</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* All variants of 'th' occupy 2 characters */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5810" title="utils/adt/formatting.c:5810">NUM_eat_non_data_chars</a>(Np, <span class="Constant">2</span>, input_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_TH:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(Np-&gt;Num) || *Np-&gt;number == <span class="Constant">'#'</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;sign == <span class="Constant">'-'</span> || <a href="#L324" title="utils/adt/formatting.c:324">IS_DECIMAL</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, <a href="#L1516" title="utils/adt/formatting.c:1516">get_th</a>(Np-&gt;number, <a href="#L277" title="utils/adt/formatting.c:277">TH_UPPER</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* All variants of 'TH' occupy 2 characters */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5810" title="utils/adt/formatting.c:5810">NUM_eat_non_data_chars</a>(Np, <span class="Constant">2</span>, input_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_MI:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5810" title="utils/adt/formatting.c:5810">NUM_eat_non_data_chars</a>(Np, <span class="Constant">1</span>, input_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_PL:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;sign == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L328" title="utils/adt/formatting.c:328">IS_FILLMODE</a>(Np-&gt;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5810" title="utils/adt/formatting.c:5810">NUM_eat_non_data_chars</a>(Np, <span class="Constant">1</span>, input_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> NUM_SG:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = Np-&gt;sign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*Np-&gt;inout_p == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5810" title="utils/adt/formatting.c:5810">NUM_eat_non_data_chars</a>(Np, <span class="Constant">1</span>, input_len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In TO_CHAR, non-pattern characters in the format are copied to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the output.&nbsp; In TO_NUMBER, we <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> one input character for each<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * non-pattern format character, whether or not it matches the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * format character.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(Np-&gt;inout_p, n-&gt;character);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += strlen(Np-&gt;inout_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p += <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(Np-&gt;inout_p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;inout_p++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Np-&gt;is_to_char)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;inout_p = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> Np-&gt;inout;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*(Np-&gt;number_p - <span class="Constant">1</span>) == <span class="Constant">'.'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(Np-&gt;number_p - <span class="Constant">1</span>) = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *Np-&gt;number_p = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Correction - precision of dec. number<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Np-&gt;Num-&gt;post = Np-&gt;read_post;<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef DEBUG_TO_FROM_CHAR<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(<a href="#L62" title="utils/adt/formatting.c:62">DEBUG_elog_output</a>, <span class="Constant">&quot;TO_NUMBER (number): '</span><span class="Special">%s</span><span class="Constant">'&quot;</span>, Np-&gt;number);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> Np-&gt;number;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * MACRO: Start part of NUM - for all NUM's to_char variants<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; (sorry, but I hate copy same code - macro is better..)<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L6307">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_TOCHAR_prepare</span> \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> { \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Type">int</span><span class="PreProc"> len = VARSIZE_ANY_EXHDR(fmt); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (len &lt;= </span><span class="Constant">0</span><span class="PreProc"> || len &gt;= (</span><span class="Constant">INT_MAX</span><span class="PreProc">-VARHDRSZ)/<a href="#L115" title="utils/adt/formatting.c:115">NUM_MAX_ITEM_SIZ</a>)&nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_TEXT_P(<a href="varlena.c.html#L184" title="utils/adt/varlena.c:184">cstring_to_text</a>(</span><span class="Constant">&quot;&quot;</span><span class="PreProc">)); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; result&nbsp; &nbsp; = (text *) <a href="../mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>((len * <a href="#L115" title="utils/adt/formatting.c:115">NUM_MAX_ITEM_SIZ</a>) + </span><span class="Constant">1</span><span class="PreProc"> + VARHDRSZ);&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; format&nbsp; &nbsp; = <a href="#L5180" title="utils/adt/formatting.c:5180">NUM_cache</a>(len, &amp;Num, fmt, &amp;shouldFree);&nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc"> (</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------<br/></li>
<li></span><span class="Comment"> * MACRO: Finish part of NUM<br/></li>
<li></span><span class="Comment"> * ----------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L6320">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NUM_TOCHAR_finish</span> \<br/></li>
<li></span><span class="Statement">do</span><span class="PreProc"> { \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Type">int</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; len; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; <a href="#L5823" title="utils/adt/formatting.c:5823">NUM_processor</a>(format, &amp;Num, VARDATA(result), numstr, </span><span class="Constant">0</span><span class="PreProc">, out_pre_spaces, sign, </span><span class="Constant">true</span><span class="PreProc">, PG_GET_COLLATION()); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="PreProc"> (shouldFree)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(format);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; </span><span class="Comment">/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Convert null-terminated representation of result to standard text. \<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * The result is usually much bigger than it needs to be, but there \<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * seems little point in realloc'ing it smaller. \<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; len = strlen(VARDATA(result));&nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; SET_VARSIZE(result, len + VARHDRSZ); \<br/></li>
<li></span><span class="PreProc">} </span><span class="Statement">while</span><span class="PreProc"> (</span><span class="Constant">0</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* -------------------<br/></li>
<li></span><span class="Comment"> * NUMERIC to_number() (convert string to <a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a>)<br/></li>
<li></span><span class="Comment"> * -------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L6343">&#x200c;</a><span class="linkable">numeric_to_number</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *value = PG_GETARG_TEXT_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; &nbsp; &nbsp; Num;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *numstr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; shouldFree;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; precision;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = VARSIZE_ANY_EXHDR(fmt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &lt;= <span class="Constant">0</span> || len &gt;= <span class="Constant">INT_MAX</span> / <a href="#L115" title="utils/adt/formatting.c:115">NUM_MAX_ITEM_SIZ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_NULL();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; format = <a href="#L5180" title="utils/adt/formatting.c:5180">NUM_cache</a>(len, &amp;Num, fmt, &amp;shouldFree);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((len * <a href="#L115" title="utils/adt/formatting.c:115">NUM_MAX_ITEM_SIZ</a>) + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L5823" title="utils/adt/formatting.c:5823">NUM_processor</a>(format, &amp;Num, VARDATA_ANY(value), numstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VARSIZE_ANY_EXHDR(value), <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">false</span>, PG_GET_COLLATION());<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; scale = Num.post;<br/></li>
<li>&nbsp; &nbsp; precision = Num.pre + Num.multi + scale;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (shouldFree)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(format);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = DirectFunctionCall3(<a href="numeric.c.html#L628" title="utils/adt/numeric.c:628">numeric_in</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; CStringGetDatum(numstr),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ObjectIdGetDatum(InvalidOid),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Int32GetDatum(((precision &lt;&lt; <span class="Constant">16</span>) | scale) + VARHDRSZ));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; a = <a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(<span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; b = <a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(-Num.multi);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x = DatumGetNumeric(DirectFunctionCall2(<a href="numeric.c.html#L3935" title="utils/adt/numeric.c:3935">numeric_power</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(a),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(b)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = DirectFunctionCall2(<a href="numeric.c.html#L3003" title="utils/adt/numeric.c:3003">numeric_mul</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; result,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; NumericGetDatum(x));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(numstr);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ------------------<br/></li>
<li></span><span class="Comment"> * NUMERIC to_char()<br/></li>
<li></span><span class="Comment"> * ------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L6402">&#x200c;</a><span class="linkable">numeric_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; value = PG_GETARG_NUMERIC(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; &nbsp; &nbsp; Num;<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; shouldFree;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *numstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *orgnum,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; x;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6307" title="utils/adt/formatting.c:6307">NUM_TOCHAR_prepare</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * On DateType depend part (<a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a>)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x = DatumGetNumeric(DirectFunctionCall2(<a href="numeric.c.html#L1534" title="utils/adt/numeric.c:1534">numeric_round</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(value),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Int32GetDatum(<span class="Constant">0</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5238" title="utils/adt/formatting.c:5238">int_to_roman</a>(DatumGetInt32(DirectFunctionCall1(<a href="numeric.c.html#L4447" title="utils/adt/numeric.c:4447">numeric_int4</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; NumericGetDatum(x))));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = <a href="numeric.c.html#L983" title="utils/adt/numeric.c:983">numeric_out_sci</a>(value, Num.post);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="numeric.c.html#L983" title="utils/adt/numeric.c:983">numeric_out_sci</a>() does not emit a sign for positive numbers.&nbsp; We<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * need to add a space in this case so that positive and negative<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * numbers are aligned.&nbsp; Also must check for NaN/infinity cases, which<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * we handle the same way as in <a href="#L6829" title="utils/adt/formatting.c:6829">float8_to_char</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(orgnum, <span class="Constant">&quot;NaN&quot;</span>) == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcmp(orgnum, <span class="Constant">&quot;Infinity&quot;</span>) == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcmp(orgnum, <span class="Constant">&quot;-Infinity&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Allow 6 characters for the leading sign, the decimal point,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * &quot;e&quot;, the exponent's sign and two exponent digits.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">7</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">6</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *numstr = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre + <span class="Constant">1</span>) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*orgnum != <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(strlen(orgnum) + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *numstr = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(numstr + <span class="Constant">1</span>, orgnum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; val = value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; a = <a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(<span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Numeric&nbsp; &nbsp; &nbsp; &nbsp; b = <a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(Num.multi);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = DatumGetNumeric(DirectFunctionCall2(<a href="numeric.c.html#L3935" title="utils/adt/numeric.c:3935">numeric_power</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(a),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(b)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val = DatumGetNumeric(DirectFunctionCall2(<a href="numeric.c.html#L3003" title="utils/adt/numeric.c:3003">numeric_mul</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(value),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(x)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.pre += Num.multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; x = DatumGetNumeric(DirectFunctionCall2(<a href="numeric.c.html#L1534" title="utils/adt/numeric.c:1534">numeric_round</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(val),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Int32GetDatum(Num.post)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = DatumGetCString(DirectFunctionCall1(<a href="numeric.c.html#L807" title="utils/adt/numeric.c:807">numeric_out</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; NumericGetDatum(x)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*orgnum == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((p = strchr(numstr, <span class="Constant">'.'</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = p - numstr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = strlen(numstr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* needs padding? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (numstr_pre_len &lt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = Num.pre - numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* overflowed prefix digit format? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (numstr_pre_len &gt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6320" title="utils/adt/formatting.c:6320">NUM_TOCHAR_finish</a>;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ---------------<br/></li>
<li></span><span class="Comment"> * INT4 to_char()<br/></li>
<li></span><span class="Comment"> * ---------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L6527">&#x200c;</a><span class="linkable">int4_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; value = PG_GETARG_INT32(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; &nbsp; &nbsp; Num;<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; shouldFree;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *numstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *orgnum;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6307" title="utils/adt/formatting.c:6307">NUM_TOCHAR_prepare</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * On DateType depend part (int32)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr = <a href="#L5238" title="utils/adt/formatting.c:5238">int_to_roman</a>(value);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we can do it easily because float8 won't lose <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> precision */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; val = (float8) value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = (<span class="Type">char</span> *) psprintf(<span class="Constant">&quot;</span><span class="Special">%+.*e</span><span class="Constant">&quot;</span>, Num.post, val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Swap a leading positive sign for a space.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*orgnum == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *orgnum = <span class="Constant">' '</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; orgnum = DatumGetCString(DirectFunctionCall1(<a href="int.c.html#L298" title="utils/adt/int.c:298">int4out</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Int32GetDatum(value * ((int32) pow((<span class="Type">double</span>) <span class="Constant">10</span>, (<span class="Type">double</span>) Num.multi)))));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.pre += Num.multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; orgnum = DatumGetCString(DirectFunctionCall1(<a href="int.c.html#L298" title="utils/adt/int.c:298">int4out</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Int32GetDatum(value)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*orgnum == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; orgnum++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'+'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = strlen(orgnum);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* post-decimal digits?&nbsp; Pad out with zeros. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Num.post)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(numstr_pre_len + Num.post + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(numstr, orgnum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + numstr_pre_len) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memset(numstr + numstr_pre_len + <span class="Constant">1</span>, <span class="Constant">'0'</span>, Num.post);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + numstr_pre_len + Num.post + <span class="Constant">1</span>) = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* needs padding? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (numstr_pre_len &lt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = Num.pre - numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* overflowed prefix digit format? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (numstr_pre_len &gt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6320" title="utils/adt/formatting.c:6320">NUM_TOCHAR_finish</a>;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ---------------<br/></li>
<li></span><span class="Comment"> * INT8 to_char()<br/></li>
<li></span><span class="Comment"> * ---------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L6621">&#x200c;</a><span class="linkable">int8_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; value = PG_GETARG_INT64(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; &nbsp; &nbsp; Num;<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; shouldFree;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *numstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *orgnum;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6307" title="utils/adt/formatting.c:6307">NUM_TOCHAR_prepare</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * On DateType depend part (int32)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Currently don't support int8 conversion to roman... */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; numstr = <a href="#L5238" title="utils/adt/formatting.c:5238">int_to_roman</a>(DatumGetInt32(DirectFunctionCall1(<a href="int8.c.html#L1249" title="utils/adt/int8.c:1249">int84</a>, <a href="../fmgr/fmgr.c.html#L1807" title="utils/fmgr/fmgr.c:1807">Int64GetDatum</a>(value))));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* to avoid loss of precision, must go via <a href="numeric.c.html#L1237" title="utils/adt/numeric.c:1237">numeric</a> not float8 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = <a href="numeric.c.html#L983" title="utils/adt/numeric.c:983">numeric_out_sci</a>(<a href="numeric.c.html#L4283" title="utils/adt/numeric.c:4283">int64_to_numeric</a>(value),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Num.post);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="numeric.c.html#L983" title="utils/adt/numeric.c:983">numeric_out_sci</a>() does not emit a sign for positive numbers.&nbsp; We<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * need to add a space in this case so that positive and negative<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * numbers are aligned.&nbsp; We don't have to worry about NaN/inf here.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*orgnum != <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(strlen(orgnum) + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *numstr = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(numstr + <span class="Constant">1</span>, orgnum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; multi = pow((<span class="Type">double</span>) <span class="Constant">10</span>, (<span class="Type">double</span>) Num.multi);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value = DatumGetInt64(DirectFunctionCall2(<a href="int8.c.html#L490" title="utils/adt/int8.c:490">int8mul</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../fmgr/fmgr.c.html#L1807" title="utils/fmgr/fmgr.c:1807">Int64GetDatum</a>(value),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DirectFunctionCall1(<a href="int8.c.html#L1297" title="utils/adt/int8.c:1297">dtoi8</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../fmgr/fmgr.c.html#L1816" title="utils/fmgr/fmgr.c:1816">Float8GetDatum</a>(multi))));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.pre += Num.multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = DatumGetCString(DirectFunctionCall1(<a href="int8.c.html#L61" title="utils/adt/int8.c:61">int8out</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../fmgr/fmgr.c.html#L1807" title="utils/fmgr/fmgr.c:1807">Int64GetDatum</a>(value)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*orgnum == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; orgnum++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'+'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = strlen(orgnum);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* post-decimal digits?&nbsp; Pad out with zeros. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Num.post)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(numstr_pre_len + Num.post + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcpy(numstr, orgnum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + numstr_pre_len) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memset(numstr + numstr_pre_len + <span class="Constant">1</span>, <span class="Constant">'0'</span>, Num.post);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + numstr_pre_len + Num.post + <span class="Constant">1</span>) = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* needs padding? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (numstr_pre_len &lt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = Num.pre - numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* overflowed prefix digit format? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (numstr_pre_len &gt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6320" title="utils/adt/formatting.c:6320">NUM_TOCHAR_finish</a>;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* -----------------<br/></li>
<li></span><span class="Comment"> * FLOAT4 to_char()<br/></li>
<li></span><span class="Comment"> * -----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L6727">&#x200c;</a><span class="linkable">float4_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; float4&nbsp; &nbsp; &nbsp; &nbsp; value = PG_GETARG_FLOAT4(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; &nbsp; &nbsp; Num;<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; shouldFree;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *numstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6307" title="utils/adt/formatting.c:6307">NUM_TOCHAR_prepare</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr = <a href="#L5238" title="utils/adt/formatting.c:5238">int_to_roman</a>((<span class="Type">int</span>) rint(value));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (isnan(value) || isinf(value))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Allow 6 characters for the leading sign, the decimal point,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * &quot;e&quot;, the exponent's sign and two exponent digits.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">7</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">6</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *numstr = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre + <span class="Constant">1</span>) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = psprintf(<span class="Constant">&quot;</span><span class="Special">%+.*e</span><span class="Constant">&quot;</span>, Num.post, value);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Swap a leading positive sign for a space.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*numstr == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *numstr = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; float4&nbsp; &nbsp; &nbsp; &nbsp; val = value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *orgnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">float</span>&nbsp; &nbsp; &nbsp; &nbsp; multi = pow((<span class="Type">double</span>) <span class="Constant">10</span>, (<span class="Type">double</span>) Num.multi);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val = value * multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.pre += Num.multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = psprintf(<span class="Constant">&quot;</span><span class="Special">%.0f</span><span class="Constant">&quot;</span>, fabs(val));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = strlen(orgnum);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* adjust post digits to fit max float digits */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (numstr_pre_len &gt;= <span class="Constant">FLT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.post = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (numstr_pre_len + Num.post &gt; <span class="Constant">FLT_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.post = <span class="Constant">FLT_DIG</span> - numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = psprintf(<span class="Constant">&quot;</span><span class="Special">%.*f</span><span class="Constant">&quot;</span>, Num.post, val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*orgnum == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &lt; 0 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((p = strchr(numstr, <span class="Constant">'.'</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = p - numstr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = strlen(numstr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* needs padding? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (numstr_pre_len &lt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = Num.pre - numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* overflowed prefix digit format? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (numstr_pre_len &gt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6320" title="utils/adt/formatting.c:6320">NUM_TOCHAR_finish</a>;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* -----------------<br/></li>
<li></span><span class="Comment"> * FLOAT8 to_char()<br/></li>
<li></span><span class="Comment"> * -----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L6829">&#x200c;</a><span class="linkable">float8_to_char</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; value = PG_GETARG_FLOAT8(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *fmt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L295" title="utils/adt/formatting.c:295">NUMDesc</a>&nbsp; &nbsp; &nbsp; &nbsp; Num;<br/></li>
<li>&nbsp; &nbsp; <a href="#L159" title="utils/adt/formatting.c:159">FormatNode</a> *format;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; shouldFree;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *numstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6307" title="utils/adt/formatting.c:6307">NUM_TOCHAR_prepare</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="utils/adt/formatting.c:333">IS_ROMAN</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr = <a href="#L5238" title="utils/adt/formatting.c:5238">int_to_roman</a>((<span class="Type">int</span>) rint(value));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L335" title="utils/adt/formatting.c:335">IS_EEEE</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (isnan(value) || isinf(value))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Allow 6 characters for the leading sign, the decimal point,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * &quot;e&quot;, the exponent's sign and two exponent digits.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">7</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">6</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *numstr = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre + <span class="Constant">1</span>) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = psprintf(<span class="Constant">&quot;</span><span class="Special">%+.*e</span><span class="Constant">&quot;</span>, Num.post, value);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Swap a leading positive sign for a space.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*numstr == <span class="Constant">'+'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *numstr = <span class="Constant">' '</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; float8&nbsp; &nbsp; &nbsp; &nbsp; val = value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *orgnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L334" title="utils/adt/formatting.c:334">IS_MULTI</a>(&amp;Num))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; multi = pow((<span class="Type">double</span>) <span class="Constant">10</span>, (<span class="Type">double</span>) Num.multi);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val = value * multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.pre += Num.multi;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = psprintf(<span class="Constant">&quot;</span><span class="Special">%.0f</span><span class="Constant">&quot;</span>, fabs(val));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = strlen(orgnum);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* adjust post digits to fit max double digits */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (numstr_pre_len &gt;= <span class="Constant">DBL_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.post = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (numstr_pre_len + Num.post &gt; <span class="Constant">DBL_DIG</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Num.post = <span class="Constant">DBL_DIG</span> - numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; orgnum = psprintf(<span class="Constant">&quot;</span><span class="Special">%.*f</span><span class="Constant">&quot;</span>, Num.post, val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*orgnum == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &lt; 0 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">'+'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = orgnum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((p = strchr(numstr, <span class="Constant">'.'</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = p - numstr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr_pre_len = strlen(numstr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* needs padding? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (numstr_pre_len &lt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out_pre_spaces = Num.pre - numstr_pre_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* overflowed prefix digit format? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (numstr_pre_len &gt; Num.pre)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numstr = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Num.pre + Num.post + <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L5038" title="utils/adt/formatting.c:5038">fill_str</a>(numstr, <span class="Constant">'#'</span>, Num.pre + Num.post + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(numstr + Num.pre) = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L6320" title="utils/adt/formatting.c:6320">NUM_TOCHAR_finish</a>;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(result);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
