<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/mac.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/mac.c - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L43">macaddr_sortsupport_state</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L267">hashmacaddr</a></li>
<li><a href="#L275">hashmacaddrextended</a></li>
<li><a href="#L415">macaddr_abbrev_abort</a></li>
<li><a href="#L483">macaddr_abbrev_convert</a></li>
<li><a href="#L303">macaddr_and</a></li>
<li><a href="#L197">macaddr_cmp</a></li>
<li><a href="#L182">macaddr_cmp_internal</a></li>
<li><a href="#L228">macaddr_eq</a></li>
<li><a href="#L400">macaddr_fast_cmp</a></li>
<li><a href="#L237">macaddr_ge</a></li>
<li><a href="#L246">macaddr_gt</a></li>
<li><a href="#L55">macaddr_in</a></li>
<li><a href="#L219">macaddr_le</a></li>
<li><a href="#L210">macaddr_lt</a></li>
<li><a href="#L255">macaddr_ne</a></li>
<li><a href="#L287">macaddr_not</a></li>
<li><a href="#L320">macaddr_or</a></li>
<li><a href="#L121">macaddr_out</a></li>
<li><a href="#L140">macaddr_recv</a></li>
<li><a href="#L161">macaddr_send</a></li>
<li><a href="#L363">macaddr_sortsupport</a></li>
<li><a href="#L341">macaddr_trunc</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L30">hibits</a></li>
<li><a href="#L33">lobits</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * mac.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; PostgreSQL type definitions for 6 byte, EUI-48, MAC addresses.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1998-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src/backend/utils/adt/mac.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;common/hashfn.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lib/hyperloglog.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;libpq/pqformat.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;port/pg_bswap.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/fmgrprotos.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/guc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/inet.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/sortsupport.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Utility macros used for sorting and comparing:<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a id="L30">&#x200c;</a><span class="PreProc">#define <span class="linkable">hibits</span>(addr) \<br/></li>
<li></span><span class="PreProc">&nbsp; ((</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">long</span><span class="PreProc">)(((addr)-&gt;a&lt;&lt;</span><span class="Constant">16</span><span class="PreProc">)|((addr)-&gt;b&lt;&lt;</span><span class="Constant">8</span><span class="PreProc">)|((addr)-&gt;c)))<br/></li>
<li></span><br/></li>
<li><a id="L33">&#x200c;</a><span class="PreProc">#define <span class="linkable">lobits</span>(addr) \<br/></li>
<li></span><span class="PreProc">&nbsp; ((</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">long</span><span class="PreProc">)(((addr)-&gt;d&lt;&lt;</span><span class="Constant">16</span><span class="PreProc">)|((addr)-&gt;e&lt;&lt;</span><span class="Constant">8</span><span class="PreProc">)|((addr)-&gt;f)))<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* sortsupport for macaddr */<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; int64&nbsp; &nbsp; &nbsp; &nbsp; input_count;&nbsp; &nbsp; <span class="Comment">/* number of non-null <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> seen */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; estimating;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* true if estimating cardinality */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; hyperLogLogState abbr_card; <span class="Comment">/* cardinality estimator */<br/></li>
<li><a id="L43">&#x200c;</a></span>} <span class="linkable">macaddr_sortsupport_state</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(macaddr *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, macaddr *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; <a href="#L400" title="utils/adt/mac.c:400">macaddr_fast_cmp</a>(Datum x, Datum y, SortSupport ssup);<br/></li>
<li><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L415" title="utils/adt/mac.c:415">macaddr_abbrev_abort</a>(<span class="Type">int</span> memtupcount, SortSupport ssup);<br/></li>
<li><span class="Type">static</span> Datum <a href="#L483" title="utils/adt/mac.c:483">macaddr_abbrev_convert</a>(Datum original, SortSupport ssup);<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; MAC address reader.&nbsp; Accepts several common notations.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>Datum<br/></li>
<li><a id="L55">&#x200c;</a><span class="linkable">macaddr_in</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *str = PG_GETARG_CSTRING(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Node&nbsp; &nbsp; &nbsp;&nbsp; *escontext = fcinfo-&gt;context;<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; junk[<span class="Constant">2</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* %1s matches iff there is trailing non-whitespace garbage */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; count = sscanf(str, <span class="Constant">&quot;</span><span class="Special">%x</span><span class="Constant">:</span><span class="Special">%x</span><span class="Constant">:</span><span class="Special">%x</span><span class="Constant">:</span><span class="Special">%x</span><span class="Constant">:</span><span class="Special">%x</span><span class="Constant">:</span><span class="Special">%x%1s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f, junk);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (count != <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; count = sscanf(str, <span class="Constant">&quot;</span><span class="Special">%x</span><span class="Constant">-</span><span class="Special">%x</span><span class="Constant">-</span><span class="Special">%x</span><span class="Constant">-</span><span class="Special">%x</span><span class="Constant">-</span><span class="Special">%x</span><span class="Constant">-</span><span class="Special">%x%1s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f, junk);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (count != <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; count = sscanf(str, <span class="Constant">&quot;</span><span class="Special">%2x%2x%2x</span><span class="Constant">:</span><span class="Special">%2x%2x%2x%1s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f, junk);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (count != <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; count = sscanf(str, <span class="Constant">&quot;</span><span class="Special">%2x%2x%2x</span><span class="Constant">-</span><span class="Special">%2x%2x%2x%1s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f, junk);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (count != <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; count = sscanf(str, <span class="Constant">&quot;</span><span class="Special">%2x%2x</span><span class="Constant">.</span><span class="Special">%2x%2x</span><span class="Constant">.</span><span class="Special">%2x%2x%1s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f, junk);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (count != <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; count = sscanf(str, <span class="Constant">&quot;</span><span class="Special">%2x%2x</span><span class="Constant">-</span><span class="Special">%2x%2x</span><span class="Constant">-</span><span class="Special">%2x%2x%1s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f, junk);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (count != <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; count = sscanf(str, <span class="Constant">&quot;</span><span class="Special">%2x%2x%2x%2x%2x%2x%1s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f, junk);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (count != <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_TEXT_REPRESENTATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid input syntax for type </span><span class="Special">%s</span><span class="Constant">: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, <span class="Constant">&quot;macaddr&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((a &lt; <span class="Constant">0</span>) || (a &gt; <span class="Constant">255</span>) || (b &lt; <span class="Constant">0</span>) || (b &gt; <span class="Constant">255</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (c &lt; <span class="Constant">0</span>) || (c &gt; <span class="Constant">255</span>) || (d &lt; <span class="Constant">0</span>) || (d &gt; <span class="Constant">255</span>) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (e &lt; <span class="Constant">0</span>) || (e &gt; <span class="Constant">255</span>) || (f &lt; <span class="Constant">0</span>) || (f &gt; <span class="Constant">255</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, (Datum) <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid octet value in </span><span class="Special">\&quot;</span><span class="Constant">macaddr</span><span class="Special">\&quot;</span><span class="Constant"> value: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, str)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (macaddr *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result-&gt;a = a;<br/></li>
<li>&nbsp; &nbsp; result-&gt;b = b;<br/></li>
<li>&nbsp; &nbsp; result-&gt;c = c;<br/></li>
<li>&nbsp; &nbsp; result-&gt;d = d;<br/></li>
<li>&nbsp; &nbsp; result-&gt;e = e;<br/></li>
<li>&nbsp; &nbsp; result-&gt;f = f;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_MACADDR_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; MAC address output function.&nbsp; Fixed format.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>Datum<br/></li>
<li><a id="L121">&#x200c;</a><span class="linkable">macaddr_out</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (<span class="Type">char</span> *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Constant">32</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; snprintf(result, <span class="Constant">32</span>, <span class="Constant">&quot;</span><span class="Special">%02x</span><span class="Constant">:</span><span class="Special">%02x</span><span class="Constant">:</span><span class="Special">%02x</span><span class="Constant">:</span><span class="Special">%02x</span><span class="Constant">:</span><span class="Special">%02x</span><span class="Constant">:</span><span class="Special">%02x</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; addr-&gt;a, addr-&gt;b, addr-&gt;c, addr-&gt;d, addr-&gt;e, addr-&gt;f);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_CSTRING(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L140" title="utils/adt/mac.c:140">macaddr_recv</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - converts external binary format to macaddr<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The external representation is just the six bytes, MSB first.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L140">&#x200c;</a><span class="linkable">macaddr_recv</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; StringInfo&nbsp; &nbsp; buf = (StringInfo) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; addr = (macaddr *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; addr-&gt;a = <a href="../../libpq/pqformat.c.html#L399" title="libpq/pqformat.c:399">pq_getmsgbyte</a>(buf);<br/></li>
<li>&nbsp; &nbsp; addr-&gt;b = <a href="../../libpq/pqformat.c.html#L399" title="libpq/pqformat.c:399">pq_getmsgbyte</a>(buf);<br/></li>
<li>&nbsp; &nbsp; addr-&gt;c = <a href="../../libpq/pqformat.c.html#L399" title="libpq/pqformat.c:399">pq_getmsgbyte</a>(buf);<br/></li>
<li>&nbsp; &nbsp; addr-&gt;d = <a href="../../libpq/pqformat.c.html#L399" title="libpq/pqformat.c:399">pq_getmsgbyte</a>(buf);<br/></li>
<li>&nbsp; &nbsp; addr-&gt;e = <a href="../../libpq/pqformat.c.html#L399" title="libpq/pqformat.c:399">pq_getmsgbyte</a>(buf);<br/></li>
<li>&nbsp; &nbsp; addr-&gt;f = <a href="../../libpq/pqformat.c.html#L399" title="libpq/pqformat.c:399">pq_getmsgbyte</a>(buf);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_MACADDR_P(addr);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L161" title="utils/adt/mac.c:161">macaddr_send</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - converts macaddr to binary format<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L161">&#x200c;</a><span class="linkable">macaddr_send</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; StringInfoData buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../libpq/pqformat.c.html#L326" title="libpq/pqformat.c:326">pq_begintypsend</a>(&amp;buf);<br/></li>
<li>&nbsp; &nbsp; pq_sendbyte(&amp;buf, addr-&gt;a);<br/></li>
<li>&nbsp; &nbsp; pq_sendbyte(&amp;buf, addr-&gt;b);<br/></li>
<li>&nbsp; &nbsp; pq_sendbyte(&amp;buf, addr-&gt;c);<br/></li>
<li>&nbsp; &nbsp; pq_sendbyte(&amp;buf, addr-&gt;d);<br/></li>
<li>&nbsp; &nbsp; pq_sendbyte(&amp;buf, addr-&gt;e);<br/></li>
<li>&nbsp; &nbsp; pq_sendbyte(&amp;buf, addr-&gt;f);<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BYTEA_P(<a href="../../libpq/pqformat.c.html#L346" title="libpq/pqformat.c:346">pq_endtypsend</a>(&amp;buf));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Comparison function for sorting:<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L182">&#x200c;</a></span><span class="linkable">macaddr_cmp_internal</span>(macaddr *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, macaddr *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L30" title="utils/adt/mac.c:30">hibits</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>) &lt; <a href="#L30" title="utils/adt/mac.c:30">hibits</a>(<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L30" title="utils/adt/mac.c:30">hibits</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>) &gt; <a href="#L30" title="utils/adt/mac.c:30">hibits</a>(<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L33" title="utils/adt/mac.c:33">lobits</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>) &lt; <a href="#L33" title="utils/adt/mac.c:33">lobits</a>(<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L33" title="utils/adt/mac.c:33">lobits</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>) &gt; <a href="#L33" title="utils/adt/mac.c:33">lobits</a>(<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L197">&#x200c;</a><span class="linkable">macaddr_cmp</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_INT32(<a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Boolean comparisons.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>Datum<br/></li>
<li><a id="L210">&#x200c;</a><span class="linkable">macaddr_lt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(<a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>) &lt; <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L219">&#x200c;</a><span class="linkable">macaddr_le</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(<a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>) &lt;= <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L228">&#x200c;</a><span class="linkable">macaddr_eq</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(<a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>) == <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L237">&#x200c;</a><span class="linkable">macaddr_ge</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(<a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>) &gt;= <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L246">&#x200c;</a><span class="linkable">macaddr_gt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(<a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>) &gt; <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L255">&#x200c;</a><span class="linkable">macaddr_ne</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *<a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BOOL(<a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(<a href="../../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <a href="../../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>) != <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Support function for <a href="../../regex/rege_dfa.c.html#L715" title="regex/rege_dfa.c:715">hash</a> indexes on macaddr.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L267">&#x200c;</a><span class="linkable">hashmacaddr</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *key = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> hash_any((<span class="Type">unsigned</span> <span class="Type">char</span> *) key, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L275">&#x200c;</a><span class="linkable">hashmacaddrextended</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *key = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> hash_any_extended((<span class="Type">unsigned</span> <span class="Type">char</span> *) key, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PG_GETARG_INT64(<span class="Constant">1</span>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Arithmetic <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>: bitwise NOT, AND, OR.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L287">&#x200c;</a><span class="linkable">macaddr_not</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (macaddr *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li>&nbsp; &nbsp; result-&gt;a = ~addr-&gt;a;<br/></li>
<li>&nbsp; &nbsp; result-&gt;b = ~addr-&gt;b;<br/></li>
<li>&nbsp; &nbsp; result-&gt;c = ~addr-&gt;c;<br/></li>
<li>&nbsp; &nbsp; result-&gt;d = ~addr-&gt;d;<br/></li>
<li>&nbsp; &nbsp; result-&gt;e = ~addr-&gt;e;<br/></li>
<li>&nbsp; &nbsp; result-&gt;f = ~addr-&gt;f;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_MACADDR_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L303">&#x200c;</a><span class="linkable">macaddr_and</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr1 = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr2 = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (macaddr *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li>&nbsp; &nbsp; result-&gt;a = addr1-&gt;a &amp; addr2-&gt;a;<br/></li>
<li>&nbsp; &nbsp; result-&gt;b = addr1-&gt;b &amp; addr2-&gt;b;<br/></li>
<li>&nbsp; &nbsp; result-&gt;c = addr1-&gt;c &amp; addr2-&gt;c;<br/></li>
<li>&nbsp; &nbsp; result-&gt;d = addr1-&gt;d &amp; addr2-&gt;d;<br/></li>
<li>&nbsp; &nbsp; result-&gt;e = addr1-&gt;e &amp; addr2-&gt;e;<br/></li>
<li>&nbsp; &nbsp; result-&gt;f = addr1-&gt;f &amp; addr2-&gt;f;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_MACADDR_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L320">&#x200c;</a><span class="linkable">macaddr_or</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr1 = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr2 = PG_GETARG_MACADDR_P(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (macaddr *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li>&nbsp; &nbsp; result-&gt;a = addr1-&gt;a | addr2-&gt;a;<br/></li>
<li>&nbsp; &nbsp; result-&gt;b = addr1-&gt;b | addr2-&gt;b;<br/></li>
<li>&nbsp; &nbsp; result-&gt;c = addr1-&gt;c | addr2-&gt;c;<br/></li>
<li>&nbsp; &nbsp; result-&gt;d = addr1-&gt;d | addr2-&gt;d;<br/></li>
<li>&nbsp; &nbsp; result-&gt;e = addr1-&gt;e | addr2-&gt;e;<br/></li>
<li>&nbsp; &nbsp; result-&gt;f = addr1-&gt;f | addr2-&gt;f;<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_MACADDR_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; Truncation function to allow comparing mac manufacturers.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; From suggestion by Alex Pilosov &lt;alex@pilosoft.com&gt;<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L341">&#x200c;</a><span class="linkable">macaddr_trunc</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *addr = PG_GETARG_MACADDR_P(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (macaddr *) <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result-&gt;a = addr-&gt;a;<br/></li>
<li>&nbsp; &nbsp; result-&gt;b = addr-&gt;b;<br/></li>
<li>&nbsp; &nbsp; result-&gt;c = addr-&gt;c;<br/></li>
<li>&nbsp; &nbsp; result-&gt;d = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; result-&gt;e = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; result-&gt;f = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_MACADDR_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SortSupport strategy function. Populates a SortSupport struct with the<br/></li>
<li></span><span class="Comment"> * information necessary to use comparison by abbreviated keys.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Datum<br/></li>
<li><a id="L363">&#x200c;</a><span class="linkable">macaddr_sortsupport</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; SortSupport ssup = (SortSupport) PG_GETARG_POINTER(<span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ssup-&gt;comparator = <a href="#L400" title="utils/adt/mac.c:400">macaddr_fast_cmp</a>;<br/></li>
<li>&nbsp; &nbsp; ssup-&gt;ssup_extra = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ssup-&gt;abbreviate)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L43" title="utils/adt/mac.c:43">macaddr_sortsupport_state</a> *uss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; MemoryContext oldcontext;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; oldcontext = MemoryContextSwitchTo(ssup-&gt;ssup_cxt);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; uss = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L43" title="utils/adt/mac.c:43">macaddr_sortsupport_state</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; uss-&gt;input_count = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; uss-&gt;estimating = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../lib/hyperloglog.c.html#L66" title="lib/hyperloglog.c:66">initHyperLogLog</a>(&amp;uss-&gt;abbr_card, <span class="Constant">10</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ssup-&gt;ssup_extra = uss;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ssup-&gt;comparator = <a href="../sort/tuplesort.c.html#L3177" title="utils/sort/tuplesort.c:3177">ssup_datum_unsigned_cmp</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ssup-&gt;abbrev_converter = <a href="#L483" title="utils/adt/mac.c:483">macaddr_abbrev_convert</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ssup-&gt;abbrev_abort = <a href="#L415" title="utils/adt/mac.c:415">macaddr_abbrev_abort</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ssup-&gt;abbrev_full_comparator = <a href="#L400" title="utils/adt/mac.c:400">macaddr_fast_cmp</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; MemoryContextSwitchTo(oldcontext);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_VOID();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SortSupport &quot;traditional&quot; comparison function. Pulls two MAC addresses from<br/></li>
<li></span><span class="Comment"> * the heap and runs a standard comparison on them.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L400">&#x200c;</a></span><span class="linkable">macaddr_fast_cmp</span>(Datum x, Datum y, SortSupport ssup)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *arg1 = DatumGetMacaddrP(x);<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *arg2 = DatumGetMacaddrP(y);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L182" title="utils/adt/mac.c:182">macaddr_cmp_internal</a>(arg1, arg2);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Callback for estimating effectiveness of abbreviated key optimization.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We pay no attention to the cardinality of the non-abbreviated data, because<br/></li>
<li></span><span class="Comment"> * there is no equality fast-path within authoritative macaddr comparator.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L415">&#x200c;</a></span><span class="linkable">macaddr_abbrev_abort</span>(<span class="Type">int</span> memtupcount, SortSupport ssup)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L43" title="utils/adt/mac.c:43">macaddr_sortsupport_state</a> *uss = ssup-&gt;ssup_extra;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; abbr_card;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (memtupcount &lt; <span class="Constant">10000</span> || uss-&gt;input_count &lt; <span class="Constant">10000</span> || !uss-&gt;estimating)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; abbr_card = <a href="../../lib/hyperloglog.c.html#L186" title="lib/hyperloglog.c:186">estimateHyperLogLog</a>(&amp;uss-&gt;abbr_card);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If we have &gt;100k distinct <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>, then even if we were sorting many<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * billion rows we'd likely still break even, and the penalty of undoing<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * that many rows of abbrevs would probably not be worth it. At this point<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * we stop counting because we know that we're <a href="timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> fully committed.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (abbr_card &gt; <span class="Constant">100000.0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#ifdef TRACE_SORT<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../sort/tuplesort.c.html#L124" title="utils/sort/tuplesort.c:124">trace_sort</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(LOG,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;macaddr_abbrev: estimation ends at cardinality </span><span class="Special">%f</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot; after &quot;</span> INT64_FORMAT <span class="Constant">&quot; <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> (</span><span class="Special">%d</span><span class="Constant"> rows)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; abbr_card, uss-&gt;input_count, memtupcount);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; uss-&gt;estimating = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Target minimum cardinality is 1 per ~2k of non-null inputs. 0.5 row<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * fudge factor allows us to abort earlier on genuinely pathological data<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * where we've had exactly one abbreviated value in the first 2k<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * (non-null) rows.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (abbr_card &lt; uss-&gt;input_count / <span class="Constant">2000.0</span> + <span class="Constant">0.5</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#ifdef TRACE_SORT<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../sort/tuplesort.c.html#L124" title="utils/sort/tuplesort.c:124">trace_sort</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(LOG,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;macaddr_abbrev: aborting abbreviation at cardinality </span><span class="Special">%f</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot; below threshold </span><span class="Special">%f</span><span class="Constant"> after &quot;</span> INT64_FORMAT <span class="Constant">&quot; <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> (</span><span class="Special">%d</span><span class="Constant"> rows)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; abbr_card, uss-&gt;input_count / <span class="Constant">2000.0</span> + <span class="Constant">0.5</span>, uss-&gt;input_count,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; memtupcount);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef TRACE_SORT<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../sort/tuplesort.c.html#L124" title="utils/sort/tuplesort.c:124">trace_sort</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(LOG,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;macaddr_abbrev: cardinality </span><span class="Special">%f</span><span class="Constant"> after &quot;</span> INT64_FORMAT<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot; <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> (</span><span class="Special">%d</span><span class="Constant"> rows)&quot;</span>, abbr_card, uss-&gt;input_count, memtupcount);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SortSupport conversion routine. Converts original macaddr representation<br/></li>
<li></span><span class="Comment"> * to abbreviated key representation.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Packs the bytes of a 6-byte MAC address into a Datum and treats it as an<br/></li>
<li></span><span class="Comment"> * unsigned integer for purposes of comparison. On a 64-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> machine, there<br/></li>
<li></span><span class="Comment"> * will be two zeroed bytes of padding. The integer is converted to native<br/></li>
<li></span><span class="Comment"> * endianness to facilitate easy comparison.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> Datum<br/></li>
<li><a id="L483">&#x200c;</a><span class="linkable">macaddr_abbrev_convert</span>(Datum original, SortSupport ssup)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L43" title="utils/adt/mac.c:43">macaddr_sortsupport_state</a> *uss = ssup-&gt;ssup_extra;<br/></li>
<li>&nbsp; &nbsp; macaddr&nbsp; &nbsp; *authoritative = DatumGetMacaddrP(original);<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; res;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * On a 64-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> machine, zero out the 8-byte datum and copy the 6 bytes of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the MAC address in. There will be two bytes of zero padding on the end<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * of the least significant bits.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#if SIZEOF_DATUM == </span><span class="Constant">8<br/></li>
<li></span>&nbsp; &nbsp; memset(&amp;res, <span class="Constant">0</span>, SIZEOF_DATUM);<br/></li>
<li>&nbsp; &nbsp; memcpy(&amp;res, authoritative, <span class="Statement"><a href="../../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(macaddr));<br/></li>
<li><span class="PreProc">#else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* SIZEOF_DATUM != 8 */<br/></li>
<li></span>&nbsp; &nbsp; memcpy(&amp;res, authoritative, SIZEOF_DATUM);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; uss-&gt;input_count += <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Cardinality estimation. The estimate uses uint32, so on a 64-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * architecture, XOR the two 32-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> halves together to produce slightly<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * more entropy. The two zeroed bytes won't have <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> practical impact on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * this operation.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (uss-&gt;estimating)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; tmp;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if SIZEOF_DATUM == </span><span class="Constant">8<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; tmp = (uint32) res ^ (uint32) ((uint64) res &gt;&gt; <span class="Constant">32</span>);<br/></li>
<li><span class="PreProc">#else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* SIZEOF_DATUM != 8 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; tmp = (uint32) res;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../lib/hyperloglog.c.html#L167" title="lib/hyperloglog.c:167">addHyperLogLog</a>(&amp;uss-&gt;abbr_card, DatumGetUInt32(hash_uint32(tmp)));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Byteswap on little-endian machines.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This is needed so that <a href="../sort/tuplesort.c.html#L3177" title="utils/sort/tuplesort.c:3177">ssup_datum_unsigned_cmp</a>() (an unsigned integer<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * 3-way comparator) works correctly on all platforms. Without this, the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * comparator would have to call memcmp() with a pair of pointers to the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * first byte of each abbreviated key, which is slower.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; res = DatumBigEndianToNative(res);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
