<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/encode.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/encode.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L252">_base64</a></li>
<li><a href="#L255">b64lookup</a></li>
<li><a href="#L573">enclist</a></li>
<li><a href="#L150">hexlookup</a></li>
<li><a href="#L148">hextbl</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L33">pg_encoding</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L96">binary_decode</a></li>
<li><a href="#L48">binary_encode</a></li>
<li><a href="#L523">esc_dec_len</a></li>
<li><a href="#L454">esc_decode</a></li>
<li><a href="#L502">esc_enc_len</a></li>
<li><a href="#L415">esc_encode</a></li>
<li><a href="#L176">get_hex</a></li>
<li><a href="#L243">hex_dec_len</a></li>
<li><a href="#L190">hex_decode</a></li>
<li><a href="#L196">hex_decode_safe</a></li>
<li><a href="#L237">hex_enc_len</a></li>
<li><a href="#L162">hex_encode</a></li>
<li><a href="#L392">pg_base64_dec_len</a></li>
<li><a href="#L314">pg_base64_decode</a></li>
<li><a href="#L385">pg_base64_enc_len</a></li>
<li><a href="#L267">pg_base64_encode</a></li>
<li><a href="#L603">pg_find_encoding</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L412">DIG</a></li>
<li><a href="#L411">VAL</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * encode.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Various data encoding/decoding things.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2001-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/utils/adt/encode.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ctype.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;mb/pg_wchar.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/memutils.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;varatt.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Encoding conversion API.<br/></li>
<li></span><span class="Comment"> * encode_len() and decode_len() compute the amount of space needed, while<br/></li>
<li></span><span class="Comment"> * encode() and decode() perform the actual conversions.&nbsp; It is okay for<br/></li>
<li></span><span class="Comment"> * the _len <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> to return an overestimate, but not an underestimate.<br/></li>
<li></span><span class="Comment"> * (Having said that, large overestimates could cause unnecessary errors,<br/></li>
<li></span><span class="Comment"> * so it's better to get it right.)&nbsp; The conversion routines write to the<br/></li>
<li></span><span class="Comment"> * buffer at *res and return the true length of their output.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L33">&#x200c;</a></span><span class="Type">struct</span> <span class="linkable">pg_encoding</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; (*encode_len) (<span class="Type">const</span> <span class="Type">char</span> *data, <span class="Type">size_t</span> dlen);<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; (*decode_len) (<span class="Type">const</span> <span class="Type">char</span> *data, <span class="Type">size_t</span> dlen);<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; (*encode) (<span class="Type">const</span> <span class="Type">char</span> *data, <span class="Type">size_t</span> dlen, <span class="Type">char</span> *res);<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; (*decode) (<span class="Type">const</span> <span class="Type">char</span> *data, <span class="Type">size_t</span> dlen, <span class="Type">char</span> *res);<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">const</span> <span class="Type">struct</span> <a href="#L33" title="utils/adt/encode.c:33">pg_encoding</a> *<a href="#L603" title="utils/adt/encode.c:603">pg_find_encoding</a>(<span class="Type">const</span> <span class="Type">char</span> *name);<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * SQL <a href="../../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>Datum<br/></li>
<li><a id="L48">&#x200c;</a><span class="linkable">binary_encode</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; bytea&nbsp; &nbsp; &nbsp;&nbsp; *data = PG_GETARG_BYTEA_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; name = PG_GETARG_DATUM(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *namebuf;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *dataptr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; datalen;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; resultlen;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; res;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">struct</span> <a href="#L33" title="utils/adt/encode.c:33">pg_encoding</a> *enc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; namebuf = TextDatumGetCString(name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; enc = <a href="#L603" title="utils/adt/encode.c:603">pg_find_encoding</a>(namebuf);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (enc == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;unrecognized encoding: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, namebuf)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dataptr = VARDATA_ANY(data);<br/></li>
<li>&nbsp; &nbsp; datalen = VARSIZE_ANY_EXHDR(data);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; resultlen = enc-&gt;encode_len(dataptr, datalen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * resultlen possibly overflows uint32, therefore on 32-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> machines it's<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * unsafe to rely on <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'s <a href="pseudotypes.c.html#L373" title="utils/adt/pseudotypes.c:373">internal</a> check.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (resultlen &gt; MaxAllocSize - VARHDRSZ)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_PROGRAM_LIMIT_EXCEEDED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;result of encoding conversion is too large&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(VARHDRSZ + resultlen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; res = enc-&gt;encode(dataptr, datalen, VARDATA(result));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Make this FATAL 'cause we've trodden on memory ... */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (res &gt; resultlen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(FATAL, <span class="Constant">&quot;overflow - encode estimate too small&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; SET_VARSIZE(result, VARHDRSZ + res);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L96">&#x200c;</a><span class="linkable">binary_decode</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *data = PG_GETARG_TEXT_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; name = PG_GETARG_DATUM(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; bytea&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *namebuf;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *dataptr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; datalen;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; resultlen;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; res;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">struct</span> <a href="#L33" title="utils/adt/encode.c:33">pg_encoding</a> *enc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; namebuf = TextDatumGetCString(name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; enc = <a href="#L603" title="utils/adt/encode.c:603">pg_find_encoding</a>(namebuf);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (enc == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;unrecognized encoding: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, namebuf)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dataptr = VARDATA_ANY(data);<br/></li>
<li>&nbsp; &nbsp; datalen = VARSIZE_ANY_EXHDR(data);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; resultlen = enc-&gt;decode_len(dataptr, datalen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * resultlen possibly overflows uint32, therefore on 32-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> machines it's<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * unsafe to rely on <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>'s <a href="pseudotypes.c.html#L373" title="utils/adt/pseudotypes.c:373">internal</a> check.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (resultlen &gt; MaxAllocSize - VARHDRSZ)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_PROGRAM_LIMIT_EXCEEDED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;result of decoding conversion is too large&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = <a href="../mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(VARHDRSZ + resultlen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; res = enc-&gt;decode(dataptr, datalen, VARDATA(result));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Make this FATAL 'cause we've trodden on memory ... */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (res &gt; resultlen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(FATAL, <span class="Constant">&quot;overflow - decode estimate too small&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; SET_VARSIZE(result, VARHDRSZ + res);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_BYTEA_P(result);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * HEX<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a id="L148">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> <span class="linkable">hextbl</span>[] = <span class="Constant">&quot;0123456789abcdef&quot;</span>;<br/></li>
<li><br/></li>
<li><a id="L150">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> int8 <span class="linkable">hexlookup</span>[<span class="Constant">128</span>] = {<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">0</span>, <span class="Constant">1</span>, <span class="Constant">2</span>, <span class="Constant">3</span>, <span class="Constant">4</span>, <span class="Constant">5</span>, <span class="Constant">6</span>, <span class="Constant">7</span>, <span class="Constant">8</span>, <span class="Constant">9</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, <span class="Constant">10</span>, <span class="Constant">11</span>, <span class="Constant">12</span>, <span class="Constant">13</span>, <span class="Constant">14</span>, <span class="Constant">15</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, <span class="Constant">10</span>, <span class="Constant">11</span>, <span class="Constant">12</span>, <span class="Constant">13</span>, <span class="Constant">14</span>, <span class="Constant">15</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>};<br/></li>
<li><br/></li>
<li>uint64<br/></li>
<li><a id="L162">&#x200c;</a><span class="linkable">hex_encode</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> len, <span class="Type">char</span> *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *end = src + len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (src &lt; end)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <a href="#L148" title="utils/adt/encode.c:148">hextbl</a>[(*src &gt;&gt; <span class="Constant">4</span>) &amp; <span class="Constant">0xF</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <a href="#L148" title="utils/adt/encode.c:148">hextbl</a>[*src &amp; <span class="Constant">0xF</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (uint64) len * <span class="Constant">2</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">inline</span> <span class="Type"><a href="../fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L176">&#x200c;</a></span><span class="linkable">get_hex</span>(<span class="Type">const</span> <span class="Type">char</span> *cp, <span class="Type">char</span> *out)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> c = (<span class="Type">unsigned</span> <span class="Type">char</span>) *cp;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res = -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c &lt; <span class="Constant">127</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; res = <a href="#L150" title="utils/adt/encode.c:150">hexlookup</a>[c];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *out = (<span class="Type">char</span>) res;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (res &gt;= <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>uint64<br/></li>
<li><a id="L190">&#x200c;</a><span class="linkable">hex_decode</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> len, <span class="Type">char</span> *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L196" title="utils/adt/encode.c:196">hex_decode_safe</a>(src, len, dst, <span class="Constant">NULL</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>uint64<br/></li>
<li><a id="L196">&#x200c;</a><span class="linkable">hex_decode_safe</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> len, <span class="Type">char</span> *dst, Node *escontext)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *s,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *srcend;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; v1,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v2,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; srcend = src + len;<br/></li>
<li>&nbsp; &nbsp; s = src;<br/></li>
<li>&nbsp; &nbsp; p = dst;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (s &lt; srcend)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Constant">' '</span> || *s == <span class="Special">'\n'</span> || *s == <span class="Special">'\t'</span> || *s == <span class="Special">'\r'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L176" title="utils/adt/encode.c:176">get_hex</a>(s, &amp;v1))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid hexadecimal digit: </span><span class="Special">\&quot;%.*s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s), s)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s &gt;= srcend)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid hexadecimal data: odd number of digits&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L176" title="utils/adt/encode.c:176">get_hex</a>(s, &amp;v2))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid hexadecimal digit: </span><span class="Special">\&quot;%.*s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s), s)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p++ = (v1 &lt;&lt; <span class="Constant">4</span>) | v2;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> p - dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L237">&#x200c;</a><span class="linkable">hex_enc_len</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (uint64) srclen &lt;&lt; <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L243">&#x200c;</a><span class="linkable">hex_dec_len</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (uint64) srclen &gt;&gt; <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * BASE64<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a id="L252">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> <span class="linkable">_base64</span>[] =<br/></li>
<li><span class="Constant">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br/></li>
<li><br/></li>
<li><a id="L255">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> int8 <span class="linkable">b64lookup</span>[<span class="Constant">128</span>] = {<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, <span class="Constant">62</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, <span class="Constant">63</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">52</span>, <span class="Constant">53</span>, <span class="Constant">54</span>, <span class="Constant">55</span>, <span class="Constant">56</span>, <span class="Constant">57</span>, <span class="Constant">58</span>, <span class="Constant">59</span>, <span class="Constant">60</span>, <span class="Constant">61</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, <span class="Constant">0</span>, <span class="Constant">1</span>, <span class="Constant">2</span>, <span class="Constant">3</span>, <span class="Constant">4</span>, <span class="Constant">5</span>, <span class="Constant">6</span>, <span class="Constant">7</span>, <span class="Constant">8</span>, <span class="Constant">9</span>, <span class="Constant">10</span>, <span class="Constant">11</span>, <span class="Constant">12</span>, <span class="Constant">13</span>, <span class="Constant">14</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">15</span>, <span class="Constant">16</span>, <span class="Constant">17</span>, <span class="Constant">18</span>, <span class="Constant">19</span>, <span class="Constant">20</span>, <span class="Constant">21</span>, <span class="Constant">22</span>, <span class="Constant">23</span>, <span class="Constant">24</span>, <span class="Constant">25</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; -<span class="Constant">1</span>, <span class="Constant">26</span>, <span class="Constant">27</span>, <span class="Constant">28</span>, <span class="Constant">29</span>, <span class="Constant">30</span>, <span class="Constant">31</span>, <span class="Constant">32</span>, <span class="Constant">33</span>, <span class="Constant">34</span>, <span class="Constant">35</span>, <span class="Constant">36</span>, <span class="Constant">37</span>, <span class="Constant">38</span>, <span class="Constant">39</span>, <span class="Constant">40</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">41</span>, <span class="Constant">42</span>, <span class="Constant">43</span>, <span class="Constant">44</span>, <span class="Constant">45</span>, <span class="Constant">46</span>, <span class="Constant">47</span>, <span class="Constant">48</span>, <span class="Constant">49</span>, <span class="Constant">50</span>, <span class="Constant">51</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>, -<span class="Constant">1</span>,<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L267">&#x200c;</a><span class="linkable">pg_base64_encode</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> len, <span class="Type">char</span> *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *lend = dst + <span class="Constant">76</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *s,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *end = src + len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; buf = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; s = src;<br/></li>
<li>&nbsp; &nbsp; p = dst;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (s &lt; end)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; buf |= (<span class="Type">unsigned</span> <span class="Type">char</span>) *s &lt;&lt; (pos &lt;&lt; <span class="Constant">3</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pos--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* write it out */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pos &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = <a href="#L252" title="utils/adt/encode.c:252">_base64</a>[(buf &gt;&gt; <span class="Constant">18</span>) &amp; <span class="Constant">0x3f</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = <a href="#L252" title="utils/adt/encode.c:252">_base64</a>[(buf &gt;&gt; <span class="Constant">12</span>) &amp; <span class="Constant">0x3f</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = <a href="#L252" title="utils/adt/encode.c:252">_base64</a>[(buf &gt;&gt; <span class="Constant">6</span>) &amp; <span class="Constant">0x3f</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = <a href="#L252" title="utils/adt/encode.c:252">_base64</a>[buf &amp; <span class="Constant">0x3f</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p &gt;= lend)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = <span class="Special">'\n'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lend = p + <span class="Constant">76</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (pos != <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p++ = <a href="#L252" title="utils/adt/encode.c:252">_base64</a>[(buf &gt;&gt; <span class="Constant">18</span>) &amp; <span class="Constant">0x3f</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p++ = <a href="#L252" title="utils/adt/encode.c:252">_base64</a>[(buf &gt;&gt; <span class="Constant">12</span>) &amp; <span class="Constant">0x3f</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p++ = (pos == <span class="Constant">0</span>) ? <a href="#L252" title="utils/adt/encode.c:252">_base64</a>[(buf &gt;&gt; <span class="Constant">6</span>) &amp; <span class="Constant">0x3f</span>] : <span class="Constant">'='</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p++ = <span class="Constant">'='</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> p - dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L314">&#x200c;</a><span class="linkable">pg_base64_decode</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> len, <span class="Type">char</span> *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *srcend = src + len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *s = src;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *p = dst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; c;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; buf = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (s &lt; srcend)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = *s++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">' '</span> || c == <span class="Special">'\t'</span> || c == <span class="Special">'\n'</span> || c == <span class="Special">'\r'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">'='</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* end sequence */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!end)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pos == <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (pos == <span class="Constant">3</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;unexpected </span><span class="Special">\&quot;</span><span class="Constant">=</span><span class="Special">\&quot;</span><span class="Constant"> while decoding base64 sequence&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt; <span class="Constant">0</span> &amp;&amp; c &lt; <span class="Constant">127</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = <a href="#L255" title="utils/adt/encode.c:255">b64lookup</a>[(<span class="Type">unsigned</span> <span class="Type">char</span>) c];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (b &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid symbol </span><span class="Special">\&quot;%.*s\&quot;</span><span class="Constant"> found while decoding base64 sequence&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s - <span class="Constant">1</span>), s - <span class="Constant">1</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* add it to buffer */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; buf = (buf &lt;&lt; <span class="Constant">6</span>) + b;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pos++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pos == <span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = (buf &gt;&gt; <span class="Constant">16</span>) &amp; <span class="Constant">255</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end == <span class="Constant">0</span> || end &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = (buf &gt;&gt; <span class="Constant">8</span>) &amp; <span class="Constant">255</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end == <span class="Constant">0</span> || end &gt; <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p++ = buf &amp; <span class="Constant">255</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (pos != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid base64 end sequence&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1319" title="utils/error/elog.c:1319">errhint</a>(<span class="Constant">&quot;Input data is missing padding, is truncated, or is otherwise corrupted.&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> p - dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L385">&#x200c;</a><span class="linkable">pg_base64_enc_len</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* 3 bytes will be converted to 4, linefeed after 76 chars */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> ((uint64) srclen + <span class="Constant">2</span>) / <span class="Constant">3</span> * <span class="Constant">4</span> + (uint64) srclen / (<span class="Constant">76</span> * <span class="Constant">3</span> / <span class="Constant">4</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L392">&#x200c;</a><span class="linkable">pg_base64_dec_len</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> ((uint64) srclen * <span class="Constant">3</span>) &gt;&gt; <span class="Constant">2</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Escape<br/></li>
<li></span><span class="Comment"> * Minimally escape bytea to text.<br/></li>
<li></span><span class="Comment"> * De-escape text to bytea.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We must escape zero bytes and high-<a href="varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a>-set bytes to avoid generating<br/></li>
<li></span><span class="Comment"> * text that might be invalid in the current encoding, or that might<br/></li>
<li></span><span class="Comment"> * change to something else if passed through an encoding conversion<br/></li>
<li></span><span class="Comment"> * (leading to failing to de-escape to the original bytea value).<br/></li>
<li></span><span class="Comment"> * Also of course backslash itself has to be escaped.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * De-escaping processes \\ and <a href="pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> \### octal<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a id="L411">&#x200c;</a><span class="PreProc">#define <span class="linkable">VAL</span>(CH)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((CH) - </span><span class="Constant">'0'</span><span class="PreProc">)<br/></li>
<li><a id="L412">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">DIG</span>(<a href="#L411" title="utils/adt/encode.c:411">VAL</a>)&nbsp; &nbsp; &nbsp; &nbsp; ((<a href="#L411" title="utils/adt/encode.c:411">VAL</a>) + </span><span class="Constant">'0'</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L415">&#x200c;</a><span class="linkable">esc_encode</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen, <span class="Type">char</span> *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *end = src + srclen;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *rp = dst;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (src &lt; end)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">char</span> c = (<span class="Type">unsigned</span> <span class="Type">char</span>) *src;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Special">'\0'</span> || IS_HIGHBIT_SET(c))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp[<span class="Constant">0</span>] = <span class="Special">'\\'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp[<span class="Constant">1</span>] = <a href="#L412" title="utils/adt/encode.c:412">DIG</a>(c &gt;&gt; <span class="Constant">6</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp[<span class="Constant">2</span>] = <a href="#L412" title="utils/adt/encode.c:412">DIG</a>((c &gt;&gt; <span class="Constant">3</span>) &amp; <span class="Constant">7</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp[<span class="Constant">3</span>] = <a href="#L412" title="utils/adt/encode.c:412">DIG</a>(c &amp; <span class="Constant">7</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c == <span class="Special">'\\'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp[<span class="Constant">0</span>] = <span class="Special">'\\'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp[<span class="Constant">1</span>] = <span class="Special">'\\'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rp += <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *rp++ = c;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L454">&#x200c;</a><span class="linkable">esc_decode</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen, <span class="Type">char</span> *dst)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *end = src + srclen;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *rp = dst;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (src &lt; end)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (src[<span class="Constant">0</span>] != <span class="Special">'\\'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *rp++ = *src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (src + <span class="Constant">3</span> &lt; end &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">1</span>] &gt;= <span class="Constant">'0'</span> &amp;&amp; src[<span class="Constant">1</span>] &lt;= <span class="Constant">'3'</span>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">2</span>] &gt;= <span class="Constant">'0'</span> &amp;&amp; src[<span class="Constant">2</span>] &lt;= <span class="Constant">'7'</span>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">3</span>] &gt;= <span class="Constant">'0'</span> &amp;&amp; src[<span class="Constant">3</span>] &lt;= <span class="Constant">'7'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val = <a href="#L411" title="utils/adt/encode.c:411">VAL</a>(src[<span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val &lt;&lt;= <span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val += <a href="#L411" title="utils/adt/encode.c:411">VAL</a>(src[<span class="Constant">2</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val &lt;&lt;= <span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *rp++ = val + <a href="#L411" title="utils/adt/encode.c:411">VAL</a>(src[<span class="Constant">3</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (src + <span class="Constant">1</span> &lt; end &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">1</span>] == <span class="Special">'\\'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *rp++ = <span class="Special">'\\'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src += <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * One backslash, not followed by ### valid octal. Should never<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * get here, since <a href="#L523" title="utils/adt/encode.c:523">esc_dec_len</a> does same check.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_TEXT_REPRESENTATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid input syntax for type </span><span class="Special">%s</span><span class="Constant">&quot;</span>, <span class="Constant">&quot;bytea&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L502">&#x200c;</a><span class="linkable">esc_enc_len</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *end = src + srclen;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (src &lt; end)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*src == <span class="Special">'\0'</span> || IS_HIGHBIT_SET(*src))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*src == <span class="Special">'\\'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> uint64<br/></li>
<li><a id="L523">&#x200c;</a><span class="linkable">esc_dec_len</span>(<span class="Type">const</span> <span class="Type">char</span> *src, <span class="Type">size_t</span> srclen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *end = src + srclen;<br/></li>
<li>&nbsp; &nbsp; uint64&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (src &lt; end)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (src[<span class="Constant">0</span>] != <span class="Special">'\\'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (src + <span class="Constant">3</span> &lt; end &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">1</span>] &gt;= <span class="Constant">'0'</span> &amp;&amp; src[<span class="Constant">1</span>] &lt;= <span class="Constant">'3'</span>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">2</span>] &gt;= <span class="Constant">'0'</span> &amp;&amp; src[<span class="Constant">2</span>] &lt;= <span class="Constant">'7'</span>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">3</span>] &gt;= <span class="Constant">'0'</span> &amp;&amp; src[<span class="Constant">3</span>] &lt;= <span class="Constant">'7'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * backslash + valid octal<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (src + <span class="Constant">1</span> &lt; end &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (src[<span class="Constant">1</span>] == <span class="Special">'\\'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * two backslashes = backslash<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src += <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * one backslash, not followed by ### valid octal<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_TEXT_REPRESENTATION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid input syntax for type </span><span class="Special">%s</span><span class="Constant">&quot;</span>, <span class="Constant">&quot;bytea&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Common<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">const</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *name;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L33" title="utils/adt/encode.c:33">pg_encoding</a> enc;<br/></li>
<li><a id="L573">&#x200c;</a>}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">enclist</span>[] =<br/></li>
<li><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;hex&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L237" title="utils/adt/encode.c:237">hex_enc_len</a>, <a href="#L243" title="utils/adt/encode.c:243">hex_dec_len</a>, <a href="#L162" title="utils/adt/encode.c:162">hex_encode</a>, <a href="#L190" title="utils/adt/encode.c:190">hex_decode</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; },<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;base64&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L385" title="utils/adt/encode.c:385">pg_base64_enc_len</a>, <a href="#L392" title="utils/adt/encode.c:392">pg_base64_dec_len</a>, <a href="#L267" title="utils/adt/encode.c:267">pg_base64_encode</a>, <a href="#L314" title="utils/adt/encode.c:314">pg_base64_decode</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; },<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;escape&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L502" title="utils/adt/encode.c:502">esc_enc_len</a>, <a href="#L523" title="utils/adt/encode.c:523">esc_dec_len</a>, <a href="#L415" title="utils/adt/encode.c:415">esc_encode</a>, <a href="#L454" title="utils/adt/encode.c:454">esc_decode</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; },<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>, <span class="Constant">NULL<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">const</span> <span class="Type">struct</span> <a href="#L33" title="utils/adt/encode.c:33">pg_encoding</a> *<br/></li>
<li><a id="L603">&#x200c;</a><span class="linkable">pg_find_encoding</span>(<span class="Type">const</span> <span class="Type">char</span> *name)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; <a href="#L573" title="utils/adt/encode.c:573">enclist</a>[i].name; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pg_strcasecmp(<a href="#L573" title="utils/adt/encode.c:573">enclist</a>[i].name, name) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> &amp;<a href="#L573" title="utils/adt/encode.c:573">enclist</a>[i].enc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
