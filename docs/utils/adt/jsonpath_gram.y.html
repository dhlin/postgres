<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/adt/jsonpath_gram.y - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>utils/adt/jsonpath_gram.y - pgsql17devel-backend</h1>

  <code><ol><li><span class="Special">%{<br/></li>
<li></span><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * jsonpath_gram.y<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; Grammar definitions for jsonpath datatype<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Transforms tokenized jsonpath into tree of JsonPathParseItem structs.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2019-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; src/backend/utils/adt/jsonpath_gram.y<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_collation.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;fmgr.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;jsonpath_internal.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;miscadmin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;nodes/pg_list.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;regex/regex.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemType(JsonPathItemType type);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemString(JsonPathString *s);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemVariable(JsonPathString *s);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemKey(JsonPathString *s);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemNumeric(JsonPathString *s);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemBool(</span><span class="Type">bool</span><span class="yaccHeader"> val);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemBinary(JsonPathItemType type,<br/></li>
<li></span><span class="yaccHeader">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; JsonPathParseItem *la,<br/></li>
<li></span><span class="yaccHeader">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; JsonPathParseItem *ra);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemUnary(JsonPathItemType type,<br/></li>
<li></span><span class="yaccHeader">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JsonPathParseItem *a);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeItemList(List *list);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeIndexArray(List *list);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> JsonPathParseItem *makeAny(</span><span class="Type">int</span><span class="yaccHeader"> first, </span><span class="Type">int</span><span class="yaccHeader"> last);<br/></li>
<li></span><span class="Type">static</span><span class="yaccHeader"> </span><span class="Type">bool</span><span class="yaccHeader"> makeItemLikeRegex(JsonPathParseItem *expr,<br/></li>
<li></span><span class="yaccHeader">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JsonPathString *pattern,<br/></li>
<li></span><span class="yaccHeader">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JsonPathString *flags,<br/></li>
<li></span><span class="yaccHeader">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JsonPathParseItem ** result,<br/></li>
<li></span><span class="yaccHeader">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Type">struct</span><span class="yaccHeader"> Node *escontext);<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Bison doesn't allocate anything that needs to live across parser calls,<br/></li>
<li></span><span class="Comment"> * so we can easily have it use palloc instead of malloc.&nbsp; This prevents<br/></li>
<li></span><span class="Comment"> * memory leaks if we error out during parsing.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#define YYMALLOC palloc<br/></li>
<li></span><span class="PreProc">#define YYFREE&nbsp;&nbsp; pfree<br/></li>
<li></span><br/></li>
<li><span class="Special">%}<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* BISON Declarations */<br/></li>
<li></span><span class="PreProc">%pure-parser<br/></li>
<li></span><span class="yaccInit">%expect 0<br/></li>
<li></span><span class="yaccInit">%name-prefix=&quot;jsonpath_yy&quot;<br/></li>
<li></span><span class="PreProc">%parse-param</span><span class="yaccInit"> </span><span class="Special">{</span><span class="yaccParseParamStr">JsonPathParseResult **result</span><span class="Special">}<br/></li>
<li></span><span class="PreProc">%parse-param</span><span class="yaccInit"> </span><span class="Special">{</span><span class="Type">struct</span><span class="yaccParseParamStr"> Node *escontext</span><span class="Special">}<br/></li>
<li></span><span class="PreProc">%lex-param</span><span class="yaccInit"> </span><span class="Special">{</span><span class="yaccParseParamStr">JsonPathParseResult **result</span><span class="Special">}<br/></li>
<li></span><span class="PreProc">%lex-param</span><span class="yaccInit"> </span><span class="Special">{</span><span class="Type">struct</span><span class="yaccParseParamStr"> Node *escontext</span><span class="Special">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">%union<br/></li>
<li></span><span class="Special">{<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; JsonPathString&nbsp; &nbsp; &nbsp; &nbsp; str;<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; List&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *elems;&nbsp; &nbsp; </span><span class="Comment">/* list of JsonPathParseItem */<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; List&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *indexs;&nbsp; &nbsp; </span><span class="Comment">/* list of integers */<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; JsonPathParseItem&nbsp; *value;<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; JsonPathParseResult *result;<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; JsonPathItemType&nbsp; &nbsp; optype;<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; </span><span class="Type">bool</span><span class="yaccUnion">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; boolean;<br/></li>
<li></span><span class="yaccUnion">&nbsp; &nbsp; </span><span class="Type">int</span><span class="yaccUnion">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; integer;<br/></li>
<li></span><span class="Special">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; TO_P NULL_P TRUE_P FALSE_P IS_P UNKNOWN_P EXISTS_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; IDENT_P STRING_P NUMERIC_P INT_P VARIABLE_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; OR_P AND_P NOT_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; LESS_P LESSEQUAL_P EQUAL_P NOTEQUAL_P GREATEREQUAL_P GREATER_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; ANY_P STRICT_P LAX_P LAST_P STARTS_P WITH_P LIKE_REGEX_P FLAG_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; ABS_P SIZE_P TYPE_P FLOOR_P DOUBLE_P CEILING_P KEYVALUE_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; DATETIME_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; BIGINT_P BOOLEAN_P DATE_P DECIMAL_P INTEGER_P NUMBER_P<br/></li>
<li></span><span class="Statement">%token</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; STRINGFUNC_P TIME_P TIME_TZ_P TIMESTAMP_P TIMESTAMP_TZ_P<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">result</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; result<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">value</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; scalar_value path_primary expr array_accessor<br/></li>
<li></span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; any_path accessor_op key predicate delimited_predicate<br/></li>
<li></span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index_elem starts_with_initial expr_or_predicate<br/></li>
<li></span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; datetime_template opt_datetime_template csv_elem<br/></li>
<li></span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; datetime_precision opt_datetime_precision<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">elems</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; accessor_expr csv_list opt_csv_list<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">indexs</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; index_list<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">optype</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; comp_op method<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">boolean</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; mode<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">str</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; &nbsp; &nbsp; key_name<br/></li>
<li></span><br/></li>
<li><span class="Statement">%type</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Statement">&lt;</span><span class="Type">integer</span><span class="Statement">&gt;</span><span class="yaccInit">&nbsp; &nbsp; any_level<br/></li>
<li></span><br/></li>
<li><span class="Statement">%left</span><span class="yaccInit">&nbsp; &nbsp; OR_P<br/></li>
<li></span><span class="Statement">%left</span><span class="yaccInit">&nbsp; &nbsp; AND_P<br/></li>
<li></span><span class="Statement">%right</span><span class="yaccInit">&nbsp; &nbsp; NOT_P<br/></li>
<li></span><span class="Statement">%left</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Constant">'+'</span><span class="yaccInit"> </span><span class="Constant">'-'<br/></li>
<li></span><span class="Statement">%left</span><span class="yaccInit">&nbsp; &nbsp; </span><span class="Constant">'*'</span><span class="yaccInit"> </span><span class="Constant">'/'</span><span class="yaccInit"> </span><span class="Constant">'%'<br/></li>
<li></span><span class="Statement">%left</span><span class="yaccInit">&nbsp; &nbsp; UMINUS<br/></li>
<li></span><span class="Statement">%nonassoc</span><span class="yaccInit"> </span><span class="Constant">'('</span><span class="yaccInit"> </span><span class="Constant">')'<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* Grammar follows */<br/></li>
<li></span><span class="Todo">%%<br/></li>
<li></span><br/></li>
<li><span class="Identifier">result</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; mode expr_or_predicate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *result = palloc(</span><span class="Statement">sizeof</span><span class="yaccAction">(JsonPathParseResult));<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*result)-&gt;expr = </span><span class="Special">$2</span><span class="yaccAction">;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*result)-&gt;lax = </span><span class="Special">$1</span><span class="yaccAction">;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Type">void</span><span class="yaccAction">) yynerrs;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Comment">/* EMPTY */</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> *result = </span><span class="Constant">NULL</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">expr_or_predicate</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> predicate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">mode</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; STRICT_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Constant">false</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LAX_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Constant">true</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Comment">/* EMPTY */</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Constant">true</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">scalar_value</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; STRING_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemString(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> NULL_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemString(</span><span class="Constant">NULL</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TRUE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBool(</span><span class="Constant">true</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> FALSE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBool(</span><span class="Constant">false</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> NUMERIC_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemNumeric(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> INT_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemNumeric(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> VARIABLE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemVariable(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">comp_op</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; EQUAL_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiEqual; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> NOTEQUAL_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiNotEqual; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LESS_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiLess; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> GREATER_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiGreater; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LESSEQUAL_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiLessOrEqual; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> GREATEREQUAL_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiGreaterOrEqual; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">delimited_predicate</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Constant">'('</span><span class="Identifier"> predicate </span><span class="Constant">')'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$2</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> EXISTS_P </span><span class="Constant">'('</span><span class="Identifier"> expr </span><span class="Constant">')'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiExists, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">predicate</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; delimited_predicate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr comp_op expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(</span><span class="Special">$2</span><span class="yaccAction">, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> predicate AND_P predicate&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiAnd, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> predicate OR_P predicate&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiOr, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> NOT_P delimited_predicate&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiNot, </span><span class="Special">$2</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'('</span><span class="Identifier"> predicate </span><span class="Constant">')'</span><span class="Identifier"> IS_P UNKNOWN_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiIsUnknown, </span><span class="Special">$2</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr STARTS_P WITH_P starts_with_initial<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiStartsWith, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr LIKE_REGEX_P STRING_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">{<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; JsonPathParseItem *jppitem;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccAction"> (! makeItemLikeRegex(</span><span class="Special">$1</span><span class="yaccAction">, &amp;</span><span class="Special">$3</span><span class="yaccAction">, </span><span class="Constant">NULL</span><span class="yaccAction">, &amp;jppitem, escontext))<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; YYABORT;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">$$</span><span class="yaccAction"> = jppitem;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr LIKE_REGEX_P STRING_P FLAG_P STRING_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">{<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; JsonPathParseItem *jppitem;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccAction"> (! makeItemLikeRegex(</span><span class="Special">$1</span><span class="yaccAction">, &amp;</span><span class="Special">$3</span><span class="yaccAction">, &amp;</span><span class="Special">$5</span><span class="yaccAction">, &amp;jppitem, escontext))<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; YYABORT;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">$$</span><span class="yaccAction"> = jppitem;<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">starts_with_initial</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; STRING_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemString(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> VARIABLE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemVariable(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">path_primary</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; scalar_value&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'$'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemType(jpiRoot); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'@'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemType(jpiCurrent); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LAST_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemType(jpiLast); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">accessor_expr</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; path_primary&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = list_make1(</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'('</span><span class="Identifier"> expr </span><span class="Constant">')'</span><span class="Identifier"> accessor_op&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = list_make2(</span><span class="Special">$2</span><span class="yaccAction">, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'('</span><span class="Identifier"> predicate </span><span class="Constant">')'</span><span class="Identifier"> accessor_op&nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = list_make2(</span><span class="Special">$2</span><span class="yaccAction">, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> accessor_expr accessor_op&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = lappend(</span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$2</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">expr</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; accessor_expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemList(</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'('</span><span class="Identifier"> expr </span><span class="Constant">')'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$2</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'+'</span><span class="Identifier"> expr %prec UMINUS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiPlus, </span><span class="Special">$2</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'-'</span><span class="Identifier"> expr %prec UMINUS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiMinus, </span><span class="Special">$2</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr </span><span class="Constant">'+'</span><span class="Identifier"> expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiAdd, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr </span><span class="Constant">'-'</span><span class="Identifier"> expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiSub, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr </span><span class="Constant">'*'</span><span class="Identifier"> expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiMul, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr </span><span class="Constant">'/'</span><span class="Identifier"> expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiDiv, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr </span><span class="Constant">'%'</span><span class="Identifier"> expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiMod, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">index_elem</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiSubscript, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Constant">NULL</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> expr TO_P expr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiSubscript, </span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">index_list</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; index_elem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = list_make1(</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> index_list </span><span class="Constant">','</span><span class="Identifier"> index_elem&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = lappend(</span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">array_accessor</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Constant">'['</span><span class="Identifier"> </span><span class="Constant">'*'</span><span class="Identifier"> </span><span class="Constant">']'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemType(jpiAnyArray); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'['</span><span class="Identifier"> index_list </span><span class="Constant">']'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeIndexArray(</span><span class="Special">$2</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">any_level</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; INT_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = pg_strtoint32(</span><span class="Special">$1</span><span class="yaccAction">.val); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LAST_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = -</span><span class="Constant">1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">any_path</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; ANY_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeAny(</span><span class="Constant">0</span><span class="yaccAction">, -</span><span class="Constant">1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> ANY_P </span><span class="Constant">'{'</span><span class="Identifier"> any_level </span><span class="Constant">'}'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeAny(</span><span class="Special">$3</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> ANY_P </span><span class="Constant">'{'</span><span class="Identifier"> any_level TO_P any_level </span><span class="Constant">'}'<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeAny(</span><span class="Special">$3</span><span class="yaccAction">, </span><span class="Special">$5</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">accessor_op</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Constant">'.'</span><span class="Identifier"> key&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$2</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> </span><span class="Constant">'*'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemType(jpiAnyKey); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> array_accessor&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> any_path&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$2</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> method </span><span class="Constant">'('</span><span class="Identifier"> </span><span class="Constant">')'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemType(</span><span class="Special">$2</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'?'</span><span class="Identifier"> </span><span class="Constant">'('</span><span class="Identifier"> predicate </span><span class="Constant">')'</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiFilter, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> DECIMAL_P </span><span class="Constant">'('</span><span class="Identifier"> opt_csv_list </span><span class="Constant">')'<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccAction"> (list_length(</span><span class="Special">$4</span><span class="yaccAction">) == </span><span class="Constant">0</span><span class="yaccAction">)<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiDecimal, </span><span class="Constant">NULL</span><span class="yaccAction">, </span><span class="Constant">NULL</span><span class="yaccAction">);<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="yaccAction"> </span><span class="Statement">if</span><span class="yaccAction"> (list_length(</span><span class="Special">$4</span><span class="yaccAction">) == </span><span class="Constant">1</span><span class="yaccAction">)<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiDecimal, linitial(</span><span class="Special">$4</span><span class="yaccAction">), </span><span class="Constant">NULL</span><span class="yaccAction">);<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else</span><span class="yaccAction"> </span><span class="Statement">if</span><span class="yaccAction"> (list_length(</span><span class="Special">$4</span><span class="yaccAction">) == </span><span class="Constant">2</span><span class="yaccAction">)<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">$$</span><span class="yaccAction"> = makeItemBinary(jpiDecimal, linitial(</span><span class="Special">$4</span><span class="yaccAction">), lsecond(</span><span class="Special">$4</span><span class="yaccAction">));<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, </span><span class="Constant">false</span><span class="yaccAction">,<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_SYNTAX_ERROR),<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; errmsg(</span><span class="Constant">&quot;invalid input syntax for type </span><span class="Special">%s</span><span class="Constant">&quot;</span><span class="yaccAction">, </span><span class="Constant">&quot;jsonpath&quot;</span><span class="yaccAction">),<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; errdetail(</span><span class="Constant">&quot;.decimal() can only have an optional precision[,scale].&quot;</span><span class="yaccAction">)));<br/></li>
<li></span><span class="yaccAction">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> DATETIME_P </span><span class="Constant">'('</span><span class="Identifier"> opt_datetime_template </span><span class="Constant">')'<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiDatetime, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> TIME_P </span><span class="Constant">'('</span><span class="Identifier"> opt_datetime_precision </span><span class="Constant">')'<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiTime, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> TIME_TZ_P </span><span class="Constant">'('</span><span class="Identifier"> opt_datetime_precision </span><span class="Constant">')'<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiTimeTz, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> TIMESTAMP_P </span><span class="Constant">'('</span><span class="Identifier"> opt_datetime_precision </span><span class="Constant">')'<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiTimestamp, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'.'</span><span class="Identifier"> TIMESTAMP_TZ_P </span><span class="Constant">'('</span><span class="Identifier"> opt_datetime_precision </span><span class="Constant">')'<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiTimestampTz, </span><span class="Special">$4</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">csv_elem</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; INT_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemNumeric(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'+'</span><span class="Identifier"> INT_P %prec UMINUS<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiPlus, makeItemNumeric(&amp;</span><span class="Special">$2</span><span class="yaccAction">)); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Constant">'-'</span><span class="Identifier"> INT_P %prec UMINUS<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemUnary(jpiMinus, makeItemNumeric(&amp;</span><span class="Special">$2</span><span class="yaccAction">)); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">csv_list</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; csv_elem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = list_make1(</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> csv_list </span><span class="Constant">','</span><span class="Identifier"> csv_elem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = lappend(</span><span class="Special">$1</span><span class="yaccAction">, </span><span class="Special">$3</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">opt_csv_list</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; csv_list&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Comment">/* EMPTY */</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Constant">NULL</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">datetime_precision</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; INT_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemNumeric(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">opt_datetime_precision</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; datetime_precision&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Comment">/* EMPTY */</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Constant">NULL</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">datetime_template</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; STRING_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemString(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">opt_datetime_template</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; datetime_template&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Special">$1</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> </span><span class="Comment">/* EMPTY */</span><span class="Identifier">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = </span><span class="Constant">NULL</span><span class="yaccAction">; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">key</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; key_name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = makeItemKey(&amp;</span><span class="Special">$1</span><span class="yaccAction">); </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">key_name</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; IDENT_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> STRING_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TO_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> NULL_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TRUE_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> FALSE_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> IS_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> UNKNOWN_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> EXISTS_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> STRICT_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LAX_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> ABS_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> SIZE_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TYPE_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> FLOOR_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> DOUBLE_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> CEILING_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> DATETIME_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> KEYVALUE_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LAST_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> STARTS_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> WITH_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> LIKE_REGEX_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> FLAG_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> BIGINT_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> BOOLEAN_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> DATE_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> DECIMAL_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> INTEGER_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> NUMBER_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> STRINGFUNC_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TIME_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TIME_TZ_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TIMESTAMP_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TIMESTAMP_TZ_P<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">method</span><span class="Special">:<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; ABS_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiAbs; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> SIZE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiSize; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> TYPE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiType; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> FLOOR_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiFloor; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> DOUBLE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiDouble; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> CEILING_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiCeiling; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> KEYVALUE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiKeyValue; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> BIGINT_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiBigint; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> BOOLEAN_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiBoolean; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> DATE_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiDate; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> INTEGER_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiInteger; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> NUMBER_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiNumber; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">|</span><span class="Identifier"> STRINGFUNC_P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Special">{</span><span class="yaccAction"> </span><span class="Special">$$</span><span class="yaccAction"> = jpiStringFunc; </span><span class="Special">}<br/></li>
<li></span><span class="Identifier">&nbsp; &nbsp; </span><span class="Special">;<br/></li>
<li></span><span class="Todo">%%<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * The helper functions below allocate and fill JsonPathParseItem's of various<br/></li>
<li></span><span class="Comment"> * types.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemType(JsonPathItemType type)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v = palloc(</span><span class="Statement">sizeof</span><span class="yaccEndCode">(*v));<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; CHECK_FOR_INTERRUPTS();<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;type = type;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;next = </span><span class="Constant">NULL</span><span class="yaccEndCode">;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemString(JsonPathString *s)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (s == </span><span class="Constant">NULL</span><span class="yaccEndCode">)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v = makeItemType(jpiNull);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v = makeItemType(jpiString);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.string.val = s-&gt;val;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.string.len = s-&gt;len;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemVariable(JsonPathString *s)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v = makeItemType(jpiVariable);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.string.val = s-&gt;val;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.string.len = s-&gt;len;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemKey(JsonPathString *s)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v = makeItemString(s);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;type = jpiKey;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemNumeric(JsonPathString *s)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v = makeItemType(jpiNumeric);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.numeric =<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; DatumGetNumeric(DirectFunctionCall3(numeric_in,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CStringGetDatum(s-&gt;val),<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectIdGetDatum(InvalidOid),<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Int32GetDatum(-</span><span class="Constant">1</span><span class="yaccEndCode">)));<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemBool(</span><span class="Type">bool</span><span class="yaccEndCode"> val)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v = makeItemType(jpiBool);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.boolean = val;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemBinary(JsonPathItemType type, JsonPathParseItem *la, JsonPathParseItem *ra)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v = makeItemType(type);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.args.left = la;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.args.right = ra;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemUnary(JsonPathItemType type, JsonPathParseItem *a)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (type == jpiPlus &amp;&amp; a-&gt;type == jpiNumeric &amp;&amp; !a-&gt;next)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> a;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (type == jpiMinus &amp;&amp; a-&gt;type == jpiNumeric &amp;&amp; !a-&gt;next)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v = makeItemType(jpiNumeric);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.numeric =<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DatumGetNumeric(DirectFunctionCall1(numeric_uminus,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumericGetDatum(a-&gt;value.numeric)));<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v = makeItemType(type);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.arg = a;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeItemList(List *list)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *head,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *end;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; ListCell&nbsp;&nbsp; *cell;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; head = end = (JsonPathParseItem *) linitial(list);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (list_length(list) == </span><span class="Constant">1</span><span class="yaccEndCode">)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> head;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Comment">/* append items to the end of already existing list */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">while</span><span class="yaccEndCode"> (end-&gt;next)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; end = end-&gt;next;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; for_each_from(cell, list, </span><span class="Constant">1</span><span class="yaccEndCode">)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; JsonPathParseItem *c = (JsonPathParseItem *) lfirst(cell);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; end-&gt;next = c;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; end = c;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> head;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeIndexArray(List *list)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v = makeItemType(jpiIndexArray);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; ListCell&nbsp;&nbsp; *cell;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Type">int</span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = </span><span class="Constant">0</span><span class="yaccEndCode">;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; Assert(list != NIL);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.array.nelems = list_length(list);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.array.elems = palloc(</span><span class="Statement">sizeof</span><span class="yaccEndCode">(v-&gt;value.array.elems[</span><span class="Constant">0</span><span class="yaccEndCode">]) *<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.array.nelems);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; foreach(cell, list)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; JsonPathParseItem *jpi = lfirst(cell);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; Assert(jpi-&gt;type == jpiSubscript);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.array.elems[i].from = jpi-&gt;value.args.left;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.array.elems[i++].to = jpi-&gt;value.args.right;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> JsonPathParseItem *<br/></li>
<li></span><span class="yaccEndCode">makeAny(</span><span class="Type">int</span><span class="yaccEndCode"> first, </span><span class="Type">int</span><span class="yaccEndCode"> last)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v = makeItemType(jpiAny);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.anybounds.first = (first &gt;= </span><span class="Constant">0</span><span class="yaccEndCode">) ? first : PG_UINT32_MAX;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.anybounds.last = (last &gt;= </span><span class="Constant">0</span><span class="yaccEndCode">) ? last : PG_UINT32_MAX;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> v;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span><span class="yaccEndCode"> </span><span class="Type">bool<br/></li>
<li></span><span class="yaccEndCode">makeItemLikeRegex(JsonPathParseItem *expr, JsonPathString *pattern,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JsonPathString *flags, JsonPathParseItem ** result,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Type">struct</span><span class="yaccEndCode"> Node *escontext)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; JsonPathParseItem *v = makeItemType(jpiLikeRegex);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Type">int</span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Type">int</span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cflags;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.like_regex.expr = expr;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.like_regex.pattern = pattern-&gt;val;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.like_regex.patternlen = pattern-&gt;len;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Comment">/* Parse the flags string, convert to bitmask.&nbsp; Duplicate flags are OK. */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; v-&gt;value.like_regex.flags = </span><span class="Constant">0</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">for</span><span class="yaccEndCode"> (i = </span><span class="Constant">0</span><span class="yaccEndCode">; flags &amp;&amp; i &lt; flags-&gt;len; i++)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">switch</span><span class="yaccEndCode"> (flags-&gt;val[i])<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="yaccEndCode"> </span><span class="Constant">'i'</span><span class="yaccEndCode">:<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.like_regex.flags |= JSP_REGEX_ICASE;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">break</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="yaccEndCode"> </span><span class="Constant">'s'</span><span class="yaccEndCode">:<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.like_regex.flags |= JSP_REGEX_DOTALL;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">break</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="yaccEndCode"> </span><span class="Constant">'m'</span><span class="yaccEndCode">:<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.like_regex.flags |= JSP_REGEX_MLINE;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">break</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="yaccEndCode"> </span><span class="Constant">'x'</span><span class="yaccEndCode">:<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.like_regex.flags |= JSP_REGEX_WSPACE;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">break</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="yaccEndCode"> </span><span class="Constant">'q'</span><span class="yaccEndCode">:<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;value.like_regex.flags |= JSP_REGEX_QUOTE;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">break</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="yaccEndCode">:<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, </span><span class="Constant">false</span><span class="yaccEndCode">,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_SYNTAX_ERROR),<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; errmsg(</span><span class="Constant">&quot;invalid input syntax for type </span><span class="Special">%s</span><span class="Constant">&quot;</span><span class="yaccEndCode">, </span><span class="Constant">&quot;jsonpath&quot;</span><span class="yaccEndCode">),<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; errdetail(</span><span class="Constant">&quot;Unrecognized flag character </span><span class="Special">\&quot;%.*s\&quot;</span><span class="Constant"> in LIKE_REGEX predicate.&quot;</span><span class="yaccEndCode">,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; pg_mblen(flags-&gt;val + i), flags-&gt;val + i)));<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">break</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Comment">/* Convert flags to what pg_regcomp needs */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> ( !jspConvertRegexFlags(v-&gt;value.like_regex.flags, &amp;cflags, escontext))<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> </span><span class="Constant">false</span><span class="yaccEndCode">;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Comment">/* check regex validity */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; regex_t&nbsp; &nbsp;&nbsp; re_tmp;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; pg_wchar&nbsp;&nbsp; *wpattern;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Type">int</span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; wpattern_len;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Type">int</span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; re_result;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; wpattern = (pg_wchar *) palloc((pattern-&gt;len + </span><span class="Constant">1</span><span class="yaccEndCode">) * </span><span class="Statement">sizeof</span><span class="yaccEndCode">(pg_wchar));<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; wpattern_len = pg_mb2wchar_with_len(pattern-&gt;val,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wpattern,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pattern-&gt;len);<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> ((re_result = pg_regcomp(&amp;re_tmp, wpattern, wpattern_len, cflags,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEFAULT_COLLATION_OID)) != REG_OKAY)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Type">char</span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; errMsg[</span><span class="Constant">100</span><span class="yaccEndCode">];<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pg_regerror(re_result, &amp;re_tmp, errMsg, </span><span class="Statement">sizeof</span><span class="yaccEndCode">(errMsg));<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, </span><span class="Constant">false</span><span class="yaccEndCode">,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_INVALID_REGULAR_EXPRESSION),<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; errmsg(</span><span class="Constant">&quot;invalid regular expression: </span><span class="Special">%s</span><span class="Constant">&quot;</span><span class="yaccEndCode">, errMsg)));<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; pg_regfree(&amp;re_tmp);<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; *result = v;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> </span><span class="Constant">true</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Convert from XQuery regex flags to those recognized by our regex library.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">bool<br/></li>
<li></span><span class="yaccEndCode">jspConvertRegexFlags(uint32 xflags, </span><span class="Type">int</span><span class="yaccEndCode"> *result, </span><span class="Type">struct</span><span class="yaccEndCode"> Node *escontext)<br/></li>
<li></span><span class="yaccEndCode">{<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Comment">/* By default, XQuery is very nearly the same as Spencer's AREs */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Type">int</span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cflags = REG_ADVANCED;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Comment">/* Ignore-case means the same thing, too, modulo locale issues */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (xflags &amp; JSP_REGEX_ICASE)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; cflags |= REG_ICASE;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Comment">/* Per XQuery spec, if 'q' is specified then 'm', 's', 'x' are ignored */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (xflags &amp; JSP_REGEX_QUOTE)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; cflags &amp;= ~REG_ADVANCED;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; cflags |= REG_QUOTE;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; {<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* Note that dotall mode is the default in POSIX */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (!(xflags &amp; JSP_REGEX_DOTALL))<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cflags |= REG_NLSTOP;<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (xflags &amp; JSP_REGEX_MLINE)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cflags |= REG_NLANCH;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * XQuery's 'x' mode is related to Spencer's expanded mode, but it's<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * not really enough alike to justify treating JSP_REGEX_WSPACE as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * REG_EXPANDED.&nbsp; For now we treat 'x' as unimplemented; perhaps in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * future we'll modify the regex library to have an option for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * XQuery-style ignore-whitespace mode.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">if</span><span class="yaccEndCode"> (xflags &amp; JSP_REGEX_WSPACE)<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereturn(escontext, </span><span class="Constant">false</span><span class="yaccEndCode">,<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; errmsg(</span><span class="Constant">&quot;XQuery </span><span class="Special">\&quot;</span><span class="Constant">x</span><span class="Special">\&quot;</span><span class="Constant"> flag (expanded regular expressions) is not implemented&quot;</span><span class="yaccEndCode">)));<br/></li>
<li></span><span class="yaccEndCode">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; *result = cflags;<br/></li>
<li></span><br/></li>
<li><span class="yaccEndCode">&nbsp; &nbsp; </span><span class="Statement">return</span><span class="yaccEndCode"> </span><span class="Constant">true</span><span class="yaccEndCode">;<br/></li>
<li></span><span class="yaccEndCode">}<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
