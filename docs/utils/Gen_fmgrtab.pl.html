<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/Gen_fmgrtab.pl - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>utils/Gen_fmgrtab.pl - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L281">usage</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="PreProc">#! /usr/bin/perl<br/></li>
<li></span><span class="Comment">#-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Gen_fmgrtab.pl<br/></li>
<li></span><span class="Comment">#&nbsp; &nbsp; Perl script that generates fmgroids.h, fmgrprotos.h, and fmgrtab.c<br/></li>
<li></span><span class="Comment">#&nbsp; &nbsp; from pg_proc.dat<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"># Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># IDENTIFICATION<br/></li>
<li></span><span class="Comment">#&nbsp; &nbsp; src/backend/utils/Gen_fmgrtab.pl<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment">#-------------------------------------------------------------------------<br/></li>
<li></span><br/></li>
<li><span class="Statement">use </span>Catalog;<br/></li>
<li><br/></li>
<li><span class="Statement">use strict</span>;<br/></li>
<li><span class="Statement">use warnings</span> <span class="Constant">FATAL</span> =&gt; <span class="Constant">'all'</span>;<br/></li>
<li><span class="Statement">use </span>Getopt::Long;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$output_path</span> = <span class="Constant">''</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$include_path</span>;<br/></li>
<li><br/></li>
<li>GetOptions(<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">'output:s'</span> =&gt; \<span class="Identifier">$output_path</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">'include-path:s'</span> =&gt; \<span class="Identifier">$include_path</span>) || <a href="../catalog/genbki.pl.html#L1174" title="catalog/genbki.pl:1174">usage</a>();<br/></li>
<li><br/></li>
<li><span class="Comment"># Make sure output_path ends in a slash.<br/></li>
<li></span><span class="Statement">if</span> (<span class="Identifier">$output_path</span> <span class="Statement">ne</span> <span class="Constant">''</span> &amp;&amp; <span class="Statement">substr</span>(<span class="Identifier">$output_path</span>, -<span class="Constant">1</span>) <span class="Statement">ne</span> <span class="Constant">'/'</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$output_path</span> .= <span class="Constant">'/'</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Sanity check arguments.<br/></li>
<li></span><span class="Statement">die</span> <span class="Constant">&quot;No input files.</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">@ARGV</span>;<br/></li>
<li><span class="Statement">die</span> <span class="Constant">&quot;--include-path must be specified.</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">unless</span> <span class="Identifier">$include_path</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Read all the input files into internal data structures.<br/></li>
<li></span><span class="Comment"># Note: We pass data file names as arguments and then look for matching<br/></li>
<li></span><span class="Comment"># headers to parse the schema from. This is backwards from genbki.pl,<br/></li>
<li></span><span class="Comment"># but the Makefile dependencies look more sensible this way.<br/></li>
<li></span><span class="Comment"># We currently only need pg_proc, but retain the possibility of reading<br/></li>
<li></span><span class="Comment"># more than one data file.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">%catalogs</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%catalog_data</span>;<br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$datfile</span> (<span class="Identifier">@ARGV</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$datfile</span> =~ <span class="Statement">/</span><span class="Special">(.+)\.</span><span class="Constant">dat$</span><span class="Statement">/<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Input files need to be data (.dat) files.</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$header</span> = <span class="Constant">&quot;</span><span class="Identifier">$1</span><span class="Constant">.h&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&quot;There in no header file corresponding to </span><span class="Identifier">$datfile</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> !<span class="Statement">-e</span> <span class="Identifier">$header</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$catalog</span> = Catalog::<a href="../catalog/Catalog.pm.html#L24" title="catalog/Catalog.pm:24">ParseHeader</a>(<span class="Identifier">$header</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$catname</span> = <span class="Identifier">$catalog-&gt;{</span><span class="Constant">catname</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$schema</span> = <span class="Identifier">$catalog-&gt;{</span><span class="Constant">columns</span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalogs{$catname}</span> = <span class="Identifier">$catalog</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$catalog_data{$catname}</span> = Catalog::<a href="../catalog/Catalog.pm.html#L308" title="catalog/Catalog.pm:308">ParseData</a>(<span class="Identifier">$datfile</span>, <span class="Identifier">$schema</span>, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Collect certain fields from pg_proc.dat.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@fmgr</span> = ();<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%proname_counts</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$row</span> (<span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$catalog_data{</span><span class="Constant">pg_proc</span><span class="Identifier">}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">%bki_values</span> = <span class="Identifier">%$row</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@fmgr</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">oid</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">oid</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">name</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">proname</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">lang</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">prolang</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">kind</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">prokind</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">strict</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">proisstrict</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">retset</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">proretset</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">nargs</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">pronargs</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">args</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">proargtypes</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">prosrc</span> =&gt; <span class="Identifier">$bki_values{</span><span class="Constant">prosrc</span><span class="Identifier">}</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Count so that we can detect overloaded pronames.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Identifier">$proname_counts{</span><span class="perlVarMember"> </span><span class="Identifier">$bki_values{</span><span class="Constant">proname</span><span class="Identifier">}</span><span class="perlVarMember"> </span><span class="Identifier">}</span>++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Emit headers for both files<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">$tmpext</span> = <span class="Constant">&quot;.tmp</span><span class="Identifier">$$</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$oidsfile</span> = <span class="Identifier">$output_path</span> . <span class="Constant">'fmgroids.h'</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$protosfile</span> = <span class="Identifier">$output_path</span> . <span class="Constant">'fmgrprotos.h'</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$tabfile</span> = <span class="Identifier">$output_path</span> . <span class="Constant">'fmgrtab.c'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$ofh</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$oidsfile</span> . <span class="Identifier">$tmpext<br/></li>
<li></span>&nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$oidsfile$tmpext</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$pfh</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$protosfile</span> . <span class="Identifier">$tmpext<br/></li>
<li></span>&nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$protosfile$tmpext</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$tfh</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$tabfile</span> . <span class="Identifier">$tmpext<br/></li>
<li></span>&nbsp; <span class="Statement">or</span> <span class="Statement">die</span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$tabfile$tmpext</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$ofh</span> <span class="Constant">&lt;&lt;OFH</span><span class="perlHereDocStart">;<br/></li>
<li></span><span class="Constant">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * fmgroids.h<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; Macros that define the OIDs of built-in functions.<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * These macros can be used to avoid a catalog lookup when a specific<br/></li>
<li></span><span class="Constant"> * fmgr-callable function needs to be referenced.<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * NOTES<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; *** DO NOT EDIT THIS FILE! ***<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; It has been GENERATED by src/backend/utils/Gen_fmgrtab.pl<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> */<br/></li>
<li></span><span class="Constant">#ifndef FMGROIDS_H<br/></li>
<li></span><span class="Constant">#define FMGROIDS_H<br/></li>
<li></span><br/></li>
<li><span class="Constant">/*<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; Constant macros for the OIDs of entries in pg_proc.<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; F_XXX macros are named after the proname field; if that is not unique,<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; we append the proargtypes field, replacing spaces with underscores.<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; For example, we have F_OIDEQ because that proname is unique, but<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; F_POW_FLOAT8_FLOAT8 (among others) because that proname is not.<br/></li>
<li></span><span class="Constant"> */<br/></li>
<li></span><span class="Constant">OFH<br/></li>
<li></span><br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$pfh</span> <span class="Constant">&lt;&lt;PFH</span><span class="perlHereDocStart">;<br/></li>
<li></span><span class="Constant">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * fmgrprotos.h<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; Prototypes for built-in functions.<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * NOTES<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; *** DO NOT EDIT THIS FILE! ***<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; It has been GENERATED by src/backend/utils/Gen_fmgrtab.pl<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> */<br/></li>
<li></span><br/></li>
<li><span class="Constant">#ifndef FMGRPROTOS_H<br/></li>
<li></span><span class="Constant">#define FMGRPROTOS_H<br/></li>
<li></span><br/></li>
<li><span class="Constant">#include &quot;fmgr.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Constant">PFH<br/></li>
<li></span><br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$tfh</span> <span class="Constant">&lt;&lt;TFH</span><span class="perlHereDocStart">;<br/></li>
<li></span><span class="Constant">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * fmgrtab.c<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; The function manager's table of internal functions.<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Constant"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> * NOTES<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; *** DO NOT EDIT THIS FILE! ***<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; ******************************<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *&nbsp; &nbsp; It has been GENERATED by src/backend/utils/Gen_fmgrtab.pl<br/></li>
<li></span><span class="Constant"> *<br/></li>
<li></span><span class="Constant"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Constant"> */<br/></li>
<li></span><br/></li>
<li><span class="Constant">#include &quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Constant">#include &quot;access/transam.h&quot;<br/></li>
<li></span><span class="Constant">#include &quot;utils/fmgrtab.h&quot;<br/></li>
<li></span><span class="Constant">#include &quot;utils/fmgrprotos.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Constant">TFH<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Emit fmgroids.h and fmgrprotos.h entries in OID order.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">%seenit</span>;<br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$s</span> (<span class="Statement">sort</span> <span class="Statement">{</span> <span class="Identifier">$a-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span> &lt;=&gt; <span class="Identifier">$b-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span> <span class="Statement">}</span> <span class="Identifier">@fmgr</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$sqlname</span> = <span class="Identifier">$s-&gt;{</span><span class="Constant">name</span><span class="Identifier">}</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$sqlname</span> .= <span class="Constant">&quot;_&quot;</span> . <span class="Identifier">$s-&gt;{</span><span class="Constant">args</span><span class="Identifier">}</span> <span class="Statement">if</span> (<span class="Identifier">$proname_counts{</span><span class="perlVarMember"> </span><span class="Identifier">$s-&gt;{</span><span class="Constant">name</span><span class="Identifier">}</span><span class="perlVarMember"> </span><span class="Identifier">}</span> &gt; <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$sqlname</span> =~ <span class="Statement">s/</span><span class="Special">\s+</span><span class="Statement">/</span><span class="Constant">_</span><span class="Statement">/g</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$ofh</span> <span class="Constant">&quot;#define F_&quot;</span> . <span class="Statement">uc</span> <span class="Identifier">$sqlname</span> . <span class="Constant">&quot; </span><span class="Identifier">$s-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># We want only one extern per internal-language, non-aggregate function<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (&nbsp;&nbsp; <span class="Identifier">$s-&gt;{</span><span class="Constant">lang</span><span class="Identifier">}</span> <span class="Statement">eq</span> <span class="Constant">'internal'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <span class="Identifier">$s-&gt;{</span><span class="Constant">kind</span><span class="Identifier">}</span> <span class="Statement">ne</span> <span class="Constant">'a'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; !<span class="Identifier">$seenit{</span><span class="perlVarMember"> </span><span class="Identifier">$s-&gt;{</span><span class="Constant">prosrc</span><span class="Identifier">}</span><span class="perlVarMember"> </span><span class="Identifier">}</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$seenit{</span><span class="perlVarMember"> </span><span class="Identifier">$s-&gt;{</span><span class="Constant">prosrc</span><span class="Identifier">}</span><span class="perlVarMember"> </span><span class="Identifier">}</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$pfh</span> <span class="Constant">&quot;extern Datum </span><span class="Identifier">$s-&gt;{</span><span class="Constant">prosrc</span><span class="Identifier">}</span><span class="Constant">(PG_FUNCTION_ARGS);</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Create the fmgr_builtins table, collect data for fmgr_builtin_oid_index<br/></li>
<li></span><span class="Statement">print</span> <span class="Identifier">$tfh</span> <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">const FmgrBuiltin fmgr_builtins[] = {</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%bmap</span>;<br/></li>
<li><span class="Identifier">$bmap{</span><span class="Constant">'t'</span><span class="Identifier">}</span> = <span class="Constant">'true'</span>;<br/></li>
<li><span class="Identifier">$bmap{</span><span class="Constant">'f'</span><span class="Identifier">}</span> = <span class="Constant">'false'</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">@fmgr_builtin_oid_index</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$last_builtin_oid</span> = <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$fmgr_count</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$s</span> (<span class="Statement">sort</span> <span class="Statement">{</span> <span class="Identifier">$a-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span> &lt;=&gt; <span class="Identifier">$b-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span> <span class="Statement">}</span> <span class="Identifier">@fmgr</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$s-&gt;{</span><span class="Constant">lang</span><span class="Identifier">}</span> <span class="Statement">ne</span> <span class="Constant">'internal'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># We do not need entries for aggregate functions<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">next</span> <span class="Statement">if</span> <span class="Identifier">$s-&gt;{</span><span class="Constant">kind</span><span class="Identifier">}</span> <span class="Statement">eq</span> <span class="Constant">'a'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$tfh</span> <span class="Constant">&quot;,</span><span class="Special">\n</span><span class="Constant">&quot;</span> <span class="Statement">if</span> (<span class="Identifier">$fmgr_count</span> &gt; <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$tfh<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; { </span><span class="Identifier">$s-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span><span class="Constant">, </span><span class="Identifier">$s-&gt;{</span><span class="Constant">nargs</span><span class="Identifier">}</span><span class="Constant">, </span><span class="Identifier">$bmap{$s-&gt;{</span><span class="Constant">strict</span><span class="Identifier">}}</span><span class="Constant">, </span><span class="Identifier">$bmap{$s-&gt;{</span><span class="Constant">retset</span><span class="Identifier">}}</span><span class="Constant">, </span><span class="Special">\&quot;</span><span class="Identifier">$s-&gt;{</span><span class="Constant">prosrc</span><span class="Identifier">}</span><span class="Special">\&quot;</span><span class="Constant">, </span><span class="Identifier">$s-&gt;{</span><span class="Constant">prosrc</span><span class="Identifier">}</span><span class="Constant"> }&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$fmgr_builtin_oid_index[</span><span class="perlVarMember"> </span><span class="Identifier">$s-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span><span class="perlVarMember"> </span><span class="Identifier">]</span> = <span class="Identifier">$fmgr_count</span>++;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$last_builtin_oid</span> = <span class="Identifier">$s-&gt;{</span><span class="Constant">oid</span><span class="Identifier">}</span>;<br/></li>
<li>}<br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$tfh</span> <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">};</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$tfh</span> <span class="Constant">qq|<br/></li>
<li></span><span class="Constant">const int fmgr_nbuiltins = (sizeof(fmgr_builtins) / sizeof(FmgrBuiltin));<br/></li>
<li></span><br/></li>
<li><span class="Constant">const Oid fmgr_last_builtin_oid = %u;<br/></li>
<li></span><span class="Constant">|</span>, <span class="Identifier">$last_builtin_oid</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># Create fmgr_builtin_oid_index table.<br/></li>
<li></span><span class="Statement">printf</span> <span class="Identifier">$tfh</span> <span class="Constant">qq|<br/></li>
<li></span><span class="Constant">const uint16 fmgr_builtin_oid_index[%u] = {<br/></li>
<li></span><span class="Constant">|</span>, <span class="Identifier">$last_builtin_oid</span> + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">for</span> (<span class="Statement">my</span> <span class="Identifier">$i</span> = <span class="Constant">0</span>; <span class="Identifier">$i</span> &lt;= <span class="Identifier">$last_builtin_oid</span>; <span class="Identifier">$i</span>++)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$oid</span> = <span class="Identifier">$fmgr_builtin_oid_index[$i]</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># fmgr_builtin_oid_index is sparse, map nonexistent functions to<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment"># InvalidOidBuiltinMapping<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">not</span> <span class="Statement">defined</span> <span class="Identifier">$oid</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$oid</span> = <span class="Constant">'InvalidOidBuiltinMapping'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$i</span> == <span class="Identifier">$last_builtin_oid</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$tfh</span> <span class="Constant">&quot;&nbsp; </span><span class="Identifier">$oid</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">$tfh</span> <span class="Constant">&quot;&nbsp; </span><span class="Identifier">$oid</span><span class="Constant">,</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$tfh</span> <span class="Constant">&quot;};</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment"># And add the file footers.<br/></li>
<li></span><span class="Statement">print</span> <span class="Identifier">$ofh</span> <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">#endif</span><span class="Special">\t\t\t\t\t\t\t</span><span class="Constant">/* FMGROIDS_H */</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">print</span> <span class="Identifier">$pfh</span> <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">#endif</span><span class="Special">\t\t\t\t\t\t\t</span><span class="Constant">/* FMGRPROTOS_H */</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">close</span>(<span class="Identifier">$ofh</span>);<br/></li>
<li><span class="Statement">close</span>(<span class="Identifier">$pfh</span>);<br/></li>
<li><span class="Statement">close</span>(<span class="Identifier">$tfh</span>);<br/></li>
<li><br/></li>
<li><span class="Comment"># Finally, rename the completed files into place.<br/></li>
<li></span>Catalog::<a href="../catalog/Catalog.pm.html#L511" title="catalog/Catalog.pm:511">RenameTempFile</a>(<span class="Identifier">$oidsfile</span>, <span class="Identifier">$tmpext</span>);<br/></li>
<li>Catalog::<a href="../catalog/Catalog.pm.html#L511" title="catalog/Catalog.pm:511">RenameTempFile</a>(<span class="Identifier">$protosfile</span>, <span class="Identifier">$tmpext</span>);<br/></li>
<li>Catalog::<a href="../catalog/Catalog.pm.html#L511" title="catalog/Catalog.pm:511">RenameTempFile</a>(<span class="Identifier">$tabfile</span>, <span class="Identifier">$tmpext</span>);<br/></li>
<li><br/></li>
<li><a id="L281">&#x200c;</a><span class="Statement">sub </span><span class="Identifier"><span class="linkable">usage</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">die</span> <span class="Constant">&lt;&lt;EOM</span><span class="perlHereDocStart">;<br/></li>
<li></span><span class="Constant">Usage: perl -I [directory of Catalog.pm] Gen_fmgrtab.pl [--include-path/-i &lt;path&gt;] [path to pg_proc.dat]<br/></li>
<li></span><br/></li>
<li><span class="Constant">Options:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; --output&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Output directory (default '.')<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; --include-path&nbsp;&nbsp; Include path in source tree<br/></li>
<li></span><br/></li>
<li><span class="Constant">Gen_fmgrtab.pl generates fmgroids.h, fmgrprotos.h, and fmgrtab.c from<br/></li>
<li></span><span class="Constant">pg_proc.dat<br/></li>
<li></span><br/></li>
<li><span class="Constant">Report bugs to &lt;pgsql-bugs</span><span class="Special">\@</span><span class="Constant">lists.postgresql.org&gt;.<br/></li>
<li></span><span class="Constant">EOM<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><span class="Statement">exit</span> <span class="Constant">0</span>;<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
