<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>storage/ipc/ipci.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>storage/ipc/ipci.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L57">shared_memory_type</a></li>
<li><a href="#L59">shmem_startup_hook</a></li>
<li><a href="#L61">total_addin_request</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L178">AttachSharedMemoryStructs</a></li>
<li><a href="#L90">CalculateShmemSize</a></li>
<li><a href="#L281">CreateOrAttachShmemStructs</a></li>
<li><a href="#L199">CreateSharedMemoryAndSemaphores</a></li>
<li><a href="#L369">InitializeShmemGUCs</a></li>
<li><a href="#L75">RequestAddinShmemSpace</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * ipci.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; POSTGRES inter-process communication initialization code.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/storage/ipc/ipci.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;access/clog.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/commit_ts.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/multixact.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/nbtree.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/subtrans.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/syncscan.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/transam.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/twophase.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/<a href="../../access/transam/xlogrecovery.c.html#L191" title="access/transam/xlogrecovery.c:191">xlogprefetcher</a>.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/xlogrecovery.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;commands/async.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;miscadmin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;pgstat.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postmaster/autovacuum.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postmaster/bgworker_internals.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postmaster/bgwriter.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postmaster/postmaster.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postmaster/walsummarizer.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/logicallauncher.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/origin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/slot.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/slotsync.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/walreceiver.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;replication/walsender.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/bufmgr.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/dsm.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/dsm_registry.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/ipc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/pg_shmem.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/pmsignal.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/predicate.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/proc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/procarray.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/procsignal.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/sinvaladt.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/spin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/guc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/injection_point.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* GUCs */<br/></li>
<li><a id="L57">&#x200c;</a></span><span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">shared_memory_type</span> = DEFAULT_SHARED_MEMORY_TYPE;<br/></li>
<li><br/></li>
<li><a id="L59">&#x200c;</a>shmem_startup_hook_type <span class="linkable">shmem_startup_hook</span> = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><a id="L61">&#x200c;</a><span class="Type">static</span> Size <span class="linkable">total_addin_request</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L281" title="storage/ipc/ipci.c:281">CreateOrAttachShmemStructs</a>(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L75" title="storage/ipc/ipci.c:75">RequestAddinShmemSpace</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Request that extra shmem space be allocated for use by<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; a loadable module.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This may only be called via the <a href="../../utils/init/miscinit.c.html#L1781" title="utils/init/miscinit.c:1781">shmem_request_hook</a> of a library that is<br/></li>
<li></span><span class="Comment"> * loaded into the postmaster via shared_preload_libraries.&nbsp; Calls from<br/></li>
<li></span><span class="Comment"> * elsewhere will fail.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L75">&#x200c;</a></span><span class="linkable">RequestAddinShmemSpace</span>(Size size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../../utils/init/miscinit.c.html#L1782" title="utils/init/miscinit.c:1782">process_shmem_requests_in_progress</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(FATAL, <span class="Constant">&quot;cannot request additional shared memory outside <a href="../../utils/init/miscinit.c.html#L1781" title="utils/init/miscinit.c:1781">shmem_request_hook</a>&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L61" title="storage/ipc/ipci.c:61">total_addin_request</a> = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(<a href="#L61" title="storage/ipc/ipci.c:61">total_addin_request</a>, size);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L90" title="storage/ipc/ipci.c:90">CalculateShmemSize</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Calculates the amount of shared memory and number of semaphores needed.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If num_semaphores is not NULL, it will be set to the number of semaphores<br/></li>
<li></span><span class="Comment"> * required.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>Size<br/></li>
<li><a id="L90">&#x200c;</a><span class="linkable">CalculateShmemSize</span>(<span class="Type">int</span> *num_semaphores)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; size;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numSemas;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Compute number of semaphores we'll need */<br/></li>
<li></span>&nbsp; &nbsp; numSemas = <a href="../lmgr/proc.c.html#L122" title="storage/lmgr/proc.c:122">ProcGlobalSemas</a>();<br/></li>
<li>&nbsp; &nbsp; numSemas += <a href="../lmgr/spin.c.html#L64" title="storage/lmgr/spin.c:64">SpinlockSemas</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Return the number of semaphores if requested by the caller */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (num_semaphores)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *num_semaphores = numSemas;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Size of the Postgres shared-memory block is estimated via moderately-<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * accurate estimates for the big hogs, plus 100K for the stuff that's too<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * small to bother with estimating.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We take some care to ensure that the total size request doesn't<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * overflow size_t.&nbsp; If this gets through, we don't need to be so careful<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * during the actual allocation phase.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; size = <span class="Constant">100000</span>;<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../port/posix_sema.c.html#L165" title="port/posix_sema.c:165">PGSemaphoreShmemSize</a>(numSemas));<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../lmgr/spin.c.html#L55" title="storage/lmgr/spin.c:55">SpinlockSemaSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../utils/hash/dynahash.c.html#L783" title="utils/hash/dynahash.c:783">hash_estimate_size</a>(SHMEM_INDEX_SIZE,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement"><a href="../page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(ShmemIndexEnt)));<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="dsm.c.html#L470" title="storage/ipc/dsm.c:470">dsm_estimate_size</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="dsm_registry.c.html#L63" title="storage/ipc/dsm_registry.c:63">DSMRegistryShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../buffer/buf_init.c.html#L160" title="storage/buffer/buf_init.c:160">BufferShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../lmgr/lock.c.html#L3552" title="storage/lmgr/lock.c:3552">LockShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../lmgr/predicate.c.html#L1342" title="storage/lmgr/predicate.c:1342">PredicateLockShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../lmgr/proc.c.html#L100" title="storage/lmgr/proc.c:100">ProcGlobalShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/xlogprefetcher.c.html#L294" title="access/transam/xlogprefetcher.c:294">XLogPrefetchShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/varsup.c.html#L41" title="access/transam/varsup.c:41">VarsupShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/xlog.c.html#L4835" title="access/transam/xlog.c:4835">XLOGShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/xlogrecovery.c.html#L447" title="access/transam/xlogrecovery.c:447">XLogRecoveryShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/clog.c.html#L781" title="access/transam/clog.c:781">CLOGShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/commit_ts.c.html#L519" title="access/transam/commit_ts.c:519">CommitTsShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/subtrans.c.html#L214" title="access/transam/subtrans.c:214">SUBTRANSShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/twophase.c.html#L237" title="access/transam/twophase.c:237">TwoPhaseShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../postmaster/bgworker.c.html#L146" title="postmaster/bgworker.c:146">BackgroundWorkerShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/transam/multixact.c.html#L1898" title="access/transam/multixact.c:1898">MultiXactShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../lmgr/lwlock.c.html#L423" title="storage/lmgr/lwlock.c:423">LWLockShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="procarray.c.html#L376" title="storage/ipc/procarray.c:376">ProcArrayShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../utils/activity/backend_status.c.html#L83" title="utils/activity/backend_status.c:83">BackendStatusShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="sinvaladt.c.html#L218" title="storage/ipc/sinvaladt.c:218">SInvalShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="pmsignal.c.html#L129" title="storage/ipc/pmsignal.c:129">PMSignalShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="procsignal.c.html#L111" title="storage/ipc/procsignal.c:111">ProcSignalShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../postmaster/checkpointer.c.html#L879" title="postmaster/checkpointer.c:879">CheckpointerShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../postmaster/autovacuum.c.html#L3256" title="postmaster/autovacuum.c:3256">AutoVacuumShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../replication/slot.c.html#L171" title="replication/slot.c:171">ReplicationSlotsShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../replication/logical/origin.c.html#L506" title="replication/logical/origin.c:506">ReplicationOriginShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../replication/walsender.c.html#L3609" title="replication/walsender.c:3609">WalSndShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../replication/walreceiverfuncs.c.html#L43" title="replication/walreceiverfuncs.c:43">WalRcvShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../postmaster/walsummarizer.c.html#L170" title="postmaster/walsummarizer.c:170">WalSummarizerShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../postmaster/pgarch.c.html#L157" title="postmaster/pgarch.c:157">PgArchShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../replication/logical/launcher.c.html#L899" title="replication/logical/launcher.c:899">ApplyLauncherShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/nbtree/nbtutils.c.html#L4520" title="access/nbtree/nbtutils.c:4520">BTreeShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../access/common/syncscan.c.html#L126" title="access/common/syncscan.c:126">SyncScanShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../commands/async.c.html#L485" title="commands/async.c:485">AsyncShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../utils/activity/pgstat_shmem.c.html#L127" title="utils/activity/pgstat_shmem.c:127">StatsShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../utils/activity/wait_event.c.html#L104" title="utils/activity/wait_event.c:104">WaitEventExtensionShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../utils/misc/injection_point.c.html#L150" title="utils/misc/injection_point.c:150">InjectionPointShmemSize</a>());<br/></li>
<li>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../replication/logical/slotsync.c.html#L1659" title="replication/logical/slotsync.c:1659">SlotSyncShmemSize</a>());<br/></li>
<li><span class="PreProc">#ifdef EXEC_BACKEND<br/></li>
<li></span>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="../../postmaster/postmaster.c.html#L4548" title="postmaster/postmaster.c:4548">ShmemBackendArraySize</a>());<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* include additional requested shmem from preload libraries */<br/></li>
<li></span>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <a href="#L61" title="storage/ipc/ipci.c:61">total_addin_request</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* might as well round it off to a multiple of a typical page size */<br/></li>
<li></span>&nbsp; &nbsp; size = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size, <span class="Constant">8192</span> - (size % <span class="Constant">8192</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> size;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef EXEC_BACKEND<br/></li>
<li></span><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L178" title="storage/ipc/ipci.c:178">AttachSharedMemoryStructs</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Initialize a postmaster child process's access to shared memory<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; structures.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * In !EXEC_BACKEND mode, we inherit everything through the fork, and this<br/></li>
<li></span><span class="Comment"> * isn't needed.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L178">&#x200c;</a></span><span class="linkable">AttachSharedMemoryStructs</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../lmgr/proc.c.html#L296" title="storage/lmgr/proc.c:296">InitProcess</a> must've been called already */<br/></li>
<li></span>&nbsp; &nbsp; Assert(<a href="../lmgr/proc.c.html#L66" title="storage/lmgr/proc.c:66">MyProc</a> != <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; Assert(<a href="../../utils/init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L281" title="storage/ipc/ipci.c:281">CreateOrAttachShmemStructs</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Now give loadable modules a chance to set up their shmem allocations<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="storage/ipc/ipci.c:59">shmem_startup_hook</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L59" title="storage/ipc/ipci.c:59">shmem_startup_hook</a>();<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L199" title="storage/ipc/ipci.c:199">CreateSharedMemoryAndSemaphores</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Creates and initializes shared memory and semaphores.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L199">&#x200c;</a></span><span class="linkable">CreateSharedMemoryAndSemaphores</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PGShmemHeader *shim;<br/></li>
<li>&nbsp; &nbsp; PGShmemHeader *seghdr;<br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; size;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numSemas;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(!<a href="../../utils/init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Compute the size of the shared-memory block */<br/></li>
<li></span>&nbsp; &nbsp; size = <a href="#L90" title="storage/ipc/ipci.c:90">CalculateShmemSize</a>(&amp;numSemas);<br/></li>
<li>&nbsp; &nbsp; elog(DEBUG3, <span class="Constant">&quot;invoking IpcMemoryCreate(size=</span><span class="Special">%zu</span><span class="Constant">)&quot;</span>, size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Create the shmem segment<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; seghdr = <a href="../../port/win32_shmem.c.html#L207" title="port/win32_shmem.c:207">PGSharedMemoryCreate</a>(size, &amp;shim);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Make sure that huge pages are never reported as &quot;unknown&quot; while the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * server is running.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; Assert(strcmp(<span class="Constant">&quot;unknown&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../utils/misc/guc.c.html#L4308" title="utils/misc/guc.c:4308">GetConfigOption</a>(<span class="Constant">&quot;<a href="../../utils/misc/guc_tables.c.html#L567" title="utils/misc/guc_tables.c:567">huge_pages_status</a>&quot;</span>, <span class="Constant">false</span>, <span class="Constant">false</span>)) != <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="shmem.c.html#L100" title="storage/ipc/shmem.c:100">InitShmemAccess</a>(seghdr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Create semaphores<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../port/posix_sema.c.html#L196" title="port/posix_sema.c:196">PGReserveSemaphores</a>(numSemas);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If spinlocks are disabled, <a href="../../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> emulation layer (which depends on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * semaphores, so the order is important here).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#ifndef HAVE_SPINLOCKS<br/></li>
<li></span>&nbsp; &nbsp; <a href="../lmgr/spin.c.html#L77" title="storage/lmgr/spin.c:77">SpinlockSemaInit</a>();<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up shared memory allocation mechanism<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="shmem.c.html#L115" title="storage/ipc/shmem.c:115">InitShmemAllocation</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Initialize subsystems */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L281" title="storage/ipc/ipci.c:281">CreateOrAttachShmemStructs</a>();<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef EXEC_BACKEND<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Alloc the win32 shared backend array<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../postmaster/postmaster.c.html#L4554" title="postmaster/postmaster.c:4554">ShmemBackendArrayAllocation</a>();<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Initialize dynamic shared memory facilities. */<br/></li>
<li></span>&nbsp; &nbsp; <a href="dsm.c.html#L177" title="storage/ipc/dsm.c:177">dsm_postmaster_startup</a>(shim);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Now give loadable modules a chance to set up their shmem allocations<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="storage/ipc/ipci.c:59">shmem_startup_hook</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L59" title="storage/ipc/ipci.c:59">shmem_startup_hook</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Initialize various subsystems, setting up their data structures in<br/></li>
<li></span><span class="Comment"> * shared memory.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This is called by the postmaster or by a standalone backend.<br/></li>
<li></span><span class="Comment"> * It is also called by a backend forked from the postmaster in the<br/></li>
<li></span><span class="Comment"> * EXEC_BACKEND case.&nbsp; In the latter case, the shared memory segment<br/></li>
<li></span><span class="Comment"> * already exists and has been physically attached to, but we have to<br/></li>
<li></span><span class="Comment"> * <a href="../../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> pointers in local memory that reference the shared structures,<br/></li>
<li></span><span class="Comment"> * because we didn't inherit the correct pointer <a href="../../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> from the postmaster<br/></li>
<li></span><span class="Comment"> * as we do in the fork() scenario.&nbsp; The easiest way to do that is to run<br/></li>
<li></span><span class="Comment"> * through the same code as <a href="../../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a>.&nbsp; (Note that the called routines mostly<br/></li>
<li></span><span class="Comment"> * check <a href="../../utils/init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>, rather than EXEC_BACKEND, to detect this case.<br/></li>
<li></span><span class="Comment"> * This is a <a href="../../utils/adt/varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> code-wasteful and could be cleaned up.)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L281">&#x200c;</a></span><span class="linkable">CreateOrAttachShmemStructs</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Now <a href="../../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> LWLocks, which do shared memory allocation and are<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * needed for <a href="shmem.c.html#L283" title="storage/ipc/shmem.c:283">InitShmemIndex</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../lmgr/lwlock.c.html#L453" title="storage/lmgr/lwlock.c:453">CreateLWLocks</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up shmem.c index hashtable<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="shmem.c.html#L283" title="storage/ipc/shmem.c:283">InitShmemIndex</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="dsm.c.html#L479" title="storage/ipc/dsm.c:479">dsm_shmem_init</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="dsm_registry.c.html#L69" title="storage/ipc/dsm_registry.c:69">DSMRegistryShmemInit</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up xlog, clog, and buffers<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../access/transam/varsup.c.html#L47" title="access/transam/varsup.c:47">VarsupShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/xlog.c.html#L4885" title="access/transam/xlog.c:4885">XLOGShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/xlogprefetcher.c.html#L315" title="access/transam/xlogprefetcher.c:315">XLogPrefetchShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/xlogrecovery.c.html#L458" title="access/transam/xlogrecovery.c:458">XLogRecoveryShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/clog.c.html#L787" title="access/transam/clog.c:787">CLOGShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/commit_ts.c.html#L530" title="access/transam/commit_ts.c:530">CommitTsShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/subtrans.c.html#L220" title="access/transam/subtrans.c:220">SUBTRANSShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/multixact.c.html#L1915" title="access/transam/multixact.c:1915">MultiXactShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../buffer/buf_init.c.html#L68" title="storage/buffer/buf_init.c:68">InitBufferPool</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up lock manager<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../lmgr/lock.c.html#L392" title="storage/lmgr/lock.c:392">InitLocks</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up predicate lock manager<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../lmgr/predicate.c.html#L1140" title="storage/lmgr/predicate.c:1140">InitPredicateLocks</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up process table<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../../utils/init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../lmgr/proc.c.html#L157" title="storage/lmgr/proc.c:157">InitProcGlobal</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="procarray.c.html#L418" title="storage/ipc/procarray.c:418">CreateSharedProcArray</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../utils/activity/backend_status.c.html#L116" title="utils/activity/backend_status.c:116">CreateSharedBackendStatus</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/transam/twophase.c.html#L253" title="access/transam/twophase.c:253">TwoPhaseShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../postmaster/bgworker.c.html#L162" title="postmaster/bgworker.c:162">BackgroundWorkerShmemInit</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up shared-inval messaging<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="sinvaladt.c.html#L234" title="storage/ipc/sinvaladt.c:234">CreateSharedInvalidationState</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up interprocess signaling mechanisms<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="pmsignal.c.html#L144" title="storage/ipc/pmsignal.c:144">PMSignalShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="procsignal.c.html#L125" title="storage/ipc/procsignal.c:125">ProcSignalShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../postmaster/checkpointer.c.html#L898" title="postmaster/checkpointer.c:898">CheckpointerShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../postmaster/autovacuum.c.html#L3275" title="postmaster/autovacuum.c:3275">AutoVacuumShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../replication/slot.c.html#L189" title="replication/slot.c:189">ReplicationSlotsShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../replication/logical/origin.c.html#L526" title="replication/logical/origin.c:526">ReplicationOriginShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../replication/walsender.c.html#L3621" title="replication/walsender.c:3621">WalSndShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../replication/walreceiverfuncs.c.html#L54" title="replication/walreceiverfuncs.c:54">WalRcvShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../postmaster/walsummarizer.c.html#L179" title="postmaster/walsummarizer.c:179">WalSummarizerShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../postmaster/pgarch.c.html#L168" title="postmaster/pgarch.c:168">PgArchShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../replication/logical/launcher.c.html#L954" title="replication/logical/launcher.c:954">ApplyLauncherShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../replication/logical/slotsync.c.html#L1668" title="replication/logical/slotsync.c:1668">SlotSyncShmemInit</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up other modules that need some shared memory space<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../access/nbtree/nbtutils.c.html#L4533" title="access/nbtree/nbtutils.c:4533">BTreeShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../access/common/syncscan.c.html#L135" title="access/common/syncscan.c:135">SyncScanShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../commands/async.c.html#L502" title="commands/async.c:502">AsyncShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../utils/activity/pgstat_shmem.c.html#L141" title="utils/activity/pgstat_shmem.c:141">StatsShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../utils/activity/wait_event.c.html#L120" title="utils/activity/wait_event.c:120">WaitEventExtensionShmemInit</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../../utils/misc/injection_point.c.html#L167" title="utils/misc/injection_point.c:167">InjectionPointShmemInit</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L369" title="storage/ipc/ipci.c:369">InitializeShmemGUCs</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This function initializes runtime-computed GUCs related to the amount of<br/></li>
<li></span><span class="Comment"> * shared memory required for the current configuration.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L369">&#x200c;</a></span><span class="linkable">InitializeShmemGUCs</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; buf[<span class="Constant">64</span>];<br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; size_b;<br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; size_mb;<br/></li>
<li>&nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; hp_size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Calculate the shared memory size and round up to the nearest megabyte.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; size_b = <a href="#L90" title="storage/ipc/ipci.c:90">CalculateShmemSize</a>(<span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; size_mb = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size_b, (<span class="Constant">1024</span> * <span class="Constant">1024</span>) - <span class="Constant">1</span>) / (<span class="Constant">1024</span> * <span class="Constant">1024</span>);<br/></li>
<li>&nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%zu</span><span class="Constant">&quot;</span>, size_mb);<br/></li>
<li>&nbsp; &nbsp; <a href="../../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(<span class="Constant">&quot;shared_memory_size&quot;</span>, buf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PGC_INTERNAL, PGC_S_DYNAMIC_DEFAULT);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Calculate the number of huge pages required.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../port/win32_shmem.c.html#L630" title="port/win32_shmem.c:630">GetHugePageSize</a>(&amp;hp_size, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (hp_size != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; &nbsp; hp_required;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; hp_required = <a href="shmem.c.html#L493" title="storage/ipc/shmem.c:493">add_size</a>(size_b / hp_size, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(buf, <span class="Constant">&quot;</span><span class="Special">%zu</span><span class="Constant">&quot;</span>, hp_required);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(<span class="Constant">&quot;<a href="../../utils/misc/guc_tables.c.html#L601" title="utils/misc/guc_tables.c:601">shared_memory_size_in_huge_pages</a>&quot;</span>, buf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PGC_INTERNAL, PGC_S_DYNAMIC_DEFAULT);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
