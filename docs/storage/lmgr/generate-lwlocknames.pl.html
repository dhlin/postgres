<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>storage/lmgr/generate-lwlocknames.pl - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>storage/lmgr/generate-lwlocknames.pl - pgsql17devel-backend</h1>

  <code><ol><li><span class="PreProc">#!/usr/bin/perl<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># Generate lwlocknames.h from lwlocklist.h<br/></li>
<li></span><span class="Comment"># Copyright (c) 2000-2024, PostgreSQL Global Development Group<br/></li>
<li></span><br/></li>
<li><span class="Statement">use strict</span>;<br/></li>
<li><span class="Statement">use warnings</span> <span class="Constant">FATAL</span> =&gt; <span class="Constant">'all'</span>;<br/></li>
<li><span class="Statement">use </span>Getopt::Long;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$output_path</span> = <span class="Constant">'.'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$lastlockidx</span> = -<span class="Constant">1</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$continue</span> = <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>GetOptions(<span class="Constant">'outdir:s'</span> =&gt; \<span class="Identifier">$output_path</span>);<br/></li>
<li><br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$lwlocklist</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$ARGV[</span><span class="Constant">0</span><span class="Identifier">]</span> <span class="Statement">or</span> <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$wait_event_names</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$ARGV[</span><span class="Constant">1</span><span class="Identifier">]</span> <span class="Statement">or</span> <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Include PID in suffix in case parallel make runs this multiple times.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">$htmp</span> = <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/lwlocknames.h.tmp</span><span class="Identifier">$$</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">open</span> <span class="Statement">my</span> <span class="Identifier">$h</span>, <span class="Constant">'&gt;'</span>, <span class="Identifier">$htmp</span> <span class="Statement">or</span> <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span> <span class="Constant">&quot;Could not open </span><span class="Identifier">$htmp</span><span class="Constant">: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$autogen</span> =<br/></li>
<li>&nbsp; <span class="Constant">&quot;/* autogenerated from src/include/storage/lwlocklist.h, do not edit */</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement"><a href="../../nodes/print.c.html#L36" title="nodes/print.c:36">print</a></span> <span class="Identifier">$h</span> <span class="Identifier">$autogen</span>;<br/></li>
<li><span class="Statement"><a href="../../nodes/print.c.html#L36" title="nodes/print.c:36">print</a></span> <span class="Identifier">$h</span> <span class="Constant">&quot;/* there is deliberately not an #ifndef LWLOCKNAMES_H here */</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">#<br/></li>
<li></span><span class="Comment"># First, record the predefined LWLocks listed in wait_event_names.txt.&nbsp; We'll<br/></li>
<li></span><span class="Comment"># cross-check those with the ones in lwlocklist.h.<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">@wait_event_lwlocks</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$record_lwlocks</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">while</span> (&lt;<span class="Identifier">$wait_event_names</span>&gt;)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">chomp</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Check for end marker.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">last</span> <span class="Statement">if</span> <span class="Statement">/</span><span class="Constant">^# <a href="../../regex/regcomp.c.html#L336" title="regex/regcomp.c:336">END</a> OF PREDEFINED LWLOCKS</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Skip comments and empty lines.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span> <span class="Statement">if</span> <span class="Statement">/</span><span class="Constant">^#</span><span class="Statement">/</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span> <span class="Statement">if</span> <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">$</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Start recording LWLocks when we <a href="../../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> the WaitEventLWLock section.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Statement">/</span><span class="Constant">^Section: ClassName - WaitEventLWLock$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$record_lwlocks</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Go to the <a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> line if we are not yet recording LWLocks.<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span> <span class="Statement">if</span> <span class="Statement">not</span> <span class="Identifier">$record_lwlocks</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Record the LWLock.<br/></li>
<li></span>&nbsp; &nbsp; (<span class="Statement">my</span> <span class="Identifier">$waiteventname</span>, <span class="Statement">my</span> <span class="Identifier">$waitevendocsentence</span>) = <span class="Statement">split</span>(<span class="Statement">/</span><span class="Special">\t</span><span class="Statement">/</span>, <span class="Identifier">$<a href="../../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a></span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_nfa.c.html#L1884" title="regex/regc_nfa.c:1884">push</a></span>(<span class="Identifier">@wait_event_lwlocks</span>, <span class="Identifier">$waiteventname</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$in_comment</span> = <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$i</span> = <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">while</span> (&lt;<span class="Identifier">$lwlocklist</span>&gt;)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">chomp</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Skip single-line C comments and empty lines<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span> <span class="Statement">if</span> <span class="Statement">m{</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">/</span><span class="Special">\*.*\*</span><span class="Constant">/$</span><span class="Statement">}</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span> <span class="Statement">if</span> <span class="Statement">/</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">$</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># <a href="../../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> multiline C comments<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$in_comment</span> == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$in_comment</span> = <span class="Constant">0</span> <span class="Statement">if</span> <span class="Statement">m{</span><span class="Special">\*</span><span class="Constant">/</span><span class="Statement">}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Statement">m{</span><span class="Constant">^</span><span class="Special">\s*</span><span class="Constant">/</span><span class="Special">\*</span><span class="Statement">}</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$in_comment</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement"><a href="../../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a></span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span> <span class="Constant">&quot;unable to <a href="../../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> lwlocklist.h line </span><span class="Special">\&quot;</span><span class="Identifier">$<a href="../../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a></span><span class="Special">\&quot;</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> <span class="Statement">/</span><span class="Constant">^<a href="lwlock.c.html#L130" title="storage/lmgr/lwlock.c:130">PG_LWLOCK</a></span><span class="Special">\((\d+)</span><span class="Constant">,</span><span class="Special">\s+(\w+)\)</span><span class="Constant">$</span><span class="Statement">/</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; (<span class="Statement">my</span> <span class="Identifier">$lockidx</span>, <span class="Statement">my</span> <span class="Identifier">$lockname</span>) = (<span class="Identifier">$1</span>, <span class="Identifier">$2</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span> <span class="Constant">&quot;lwlocklist.h not in order&quot;</span> <span class="Statement">if</span> <span class="Identifier">$lockidx</span> &lt; <span class="Identifier">$lastlockidx</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span> <span class="Constant">&quot;lwlocklist.h has duplicates&quot;</span> <span class="Statement">if</span> <span class="Identifier">$lockidx</span> == <span class="Identifier">$lastlockidx</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span> <span class="Constant">&quot;</span><span class="Identifier">$lockname</span><span class="Constant"> defined in lwlocklist.h but missing from &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;wait_event_names.txt&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> <span class="Identifier">$i</span> &gt;= <span class="Statement">scalar</span> <span class="Identifier">@wait_event_lwlocks</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span> <span class="Constant">&quot;lists of predefined LWLocks do not match (first mismatch at &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;</span><span class="Identifier">$wait_event_lwlocks[$i]</span><span class="Constant"> in wait_event_names.txt and </span><span class="Identifier">$lockname</span><span class="Constant"> in &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; . <span class="Constant">&quot;lwlocklist.h)&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> <span class="Identifier">$wait_event_lwlocks[$i]</span> <span class="Statement">ne</span> <span class="Identifier">$lockname</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$i</span>++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (<span class="Identifier">$lastlockidx</span> &lt; <span class="Identifier">$lockidx</span> - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ++<span class="Identifier">$lastlockidx</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$continue</span> = <span class="Constant">&quot;,</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$lastlockidx</span> = <span class="Identifier">$lockidx</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$continue</span> = <span class="Constant">&quot;,</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement"><a href="../../nodes/print.c.html#L36" title="nodes/print.c:36">print</a></span> <span class="Identifier">$h</span> <span class="Constant">&quot;#define </span><span class="Identifier">${lockname}</span><span class="Constant">Lock (&amp;<a href="lwlock.c.html#L191" title="storage/lmgr/lwlock.c:191">MainLWLockArray</a>[</span><span class="Identifier">$lockidx</span><span class="Constant">].lock)</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a><br/></li>
<li></span>&nbsp; <span class="Constant">&quot;</span><span class="Identifier">$wait_event_lwlocks[$i]</span><span class="Constant"> defined in wait_event_names.txt but missing from &quot;<br/></li>
<li></span>&nbsp; . <span class="Constant">&quot;lwlocklist.h&quot;<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> <span class="Identifier">$i</span> &lt; <span class="Statement">scalar</span> <span class="Identifier">@wait_event_lwlocks</span>;<br/></li>
<li><br/></li>
<li><span class="Statement"><a href="../../nodes/print.c.html#L36" title="nodes/print.c:36">print</a></span> <span class="Identifier">$h</span> <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;<br/></li>
<li><span class="Statement">printf</span> <span class="Identifier">$h</span> <span class="Constant">&quot;#define NUM_INDIVIDUAL_LWLOCKS&nbsp; &nbsp; &nbsp; &nbsp; %s</span><span class="Special">\n</span><span class="Constant">&quot;</span>, <span class="Identifier">$lastlockidx</span> + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$h</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">rename</span>(<span class="Identifier">$htmp</span>, <span class="Constant">&quot;</span><span class="Identifier">$output_path</span><span class="Constant">/lwlocknames.h&quot;</span>)<br/></li>
<li>&nbsp; || <span class="Statement"><a href="../../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a></span> <span class="Constant">&quot;rename: </span><span class="Identifier">$htmp</span><span class="Constant"> to </span><span class="Identifier">$output_path</span><span class="Constant">/lwlocknames.h: </span><span class="Identifier">$!</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$lwlocklist</span>;<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
