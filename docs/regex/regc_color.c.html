<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>regex/regc_color.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>regex/regc_color.c - pgsql17devel-backend</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L984">colorchain</a></li>
<li><a href="#L1064">colorcomplement</a></li>
<li><a href="#L1175">dumpchr</a></li>
<li><a href="#L1111">dumpcolors</a></li>
<li><a href="#L103">freecm</a></li>
<li><a href="#L257">freecolor</a></li>
<li><a href="#L49">initcm</a></li>
<li><a href="#L172">maxcolor</a></li>
<li><a href="#L185">newcolor</a></li>
<li><a href="#L469">newhicolorcols</a></li>
<li><a href="#L420">newhicolorrow</a></li>
<li><a href="#L389">newsub</a></li>
<li><a href="#L916">okcolors</a></li>
<li><a href="#L120">pg_reg_getcolor</a></li>
<li><a href="#L312">pseudocolor</a></li>
<li><a href="#L1031">rainbow</a></li>
<li><a href="#L336">subcolor</a></li>
<li><a href="#L522">subcolorcvec</a></li>
<li><a href="#L366">subcolorhi</a></li>
<li><a href="#L624">subcoloronechr</a></li>
<li><a href="#L747">subcoloronerange</a></li>
<li><a href="#L885">subcoloronerow</a></li>
<li><a href="#L1001">uncolorchain</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L41">CERR</a></li>
<li><a href="#L40">CISERR</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * colorings of characters<br/></li>
<li></span><span class="Comment"> * This file is #included by regcomp.c.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 1998, 1999 Henry Spencer.&nbsp; All rights reserved.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Development of this software was funded, in part, by Cray Research Inc.,<br/></li>
<li></span><span class="Comment"> * UUNET Communications Services Inc., Sun Microsystems Inc., and Scriptics<br/></li>
<li></span><span class="Comment"> * Corporation, <a href="../optimizer/util/predtest.c.html#L1670" title="optimizer/util/predtest.c:1670">none</a> of whom are responsible for the results.&nbsp; The author<br/></li>
<li></span><span class="Comment"> * thanks all of them.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Redistribution and use in source and binary forms -- with or without<br/></li>
<li></span><span class="Comment"> * modification -- are permitted for <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> purpose, provided that<br/></li>
<li></span><span class="Comment"> * redistributions in source form retain this entire copyright notice and<br/></li>
<li></span><span class="Comment"> * indicate the origin and nature of <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> modifications.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * I'd appreciate being given credit for this package in the documentation<br/></li>
<li></span><span class="Comment"> * of software which uses it, but that is not a requirement.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,<br/></li>
<li></span><span class="Comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY<br/></li>
<li></span><span class="Comment"> * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.&nbsp; IN NO EVENT SHALL<br/></li>
<li></span><span class="Comment"> * HENRY SPENCER BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,<br/></li>
<li></span><span class="Comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,<br/></li>
<li></span><span class="Comment"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;<br/></li>
<li></span><span class="Comment"> * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,<br/></li>
<li></span><span class="Comment"> * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR<br/></li>
<li></span><span class="Comment"> * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF<br/></li>
<li></span><span class="Comment"> * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * src/backend/regex/regc_color.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note that there are some incestuous relationships between this code and<br/></li>
<li></span><span class="Comment"> * NFA arc maintenance, which perhaps ought to be cleaned up sometime.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L40">&#x200c;</a><span class="PreProc">#define <span class="linkable">CISERR</span>()&nbsp; &nbsp; <a href="regexec.c.html#L126" title="regex/regexec.c:126">VISERR</a>(cm-&gt;v)<br/></li>
<li><a id="L41">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">CERR</span>(e)&nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L128" title="regex/regexec.c:128">VERR</a>(cm-&gt;v, (e))<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L49" title="regex/regc_color.c:49">initcm</a> - set up new colormap<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L49">&#x200c;</a></span><span class="linkable">initcm</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> colormap *cm)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cm-&gt;magic = CMMAGIC;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;v = v;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cm-&gt;ncds = NINLINECDS;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;cd = cm-&gt;cdspace;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;max = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;free = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cd = cm-&gt;cd;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* cm-&gt;cd[WHITE] */<br/></li>
<li></span>&nbsp; &nbsp; cd-&gt;nschrs = MAX_SIMPLE_CHR - CHR_MIN + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;nuchrs = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;sub = NOSUB;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;arcs = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;firstchr = CHR_MIN;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;flags = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cm-&gt;locolormap = (color *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; MALLOC((MAX_SIMPLE_CHR - CHR_MIN + <span class="Constant">1</span>) * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(color));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;locolormap == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cmranges = <span class="Constant">NULL</span>;&nbsp; &nbsp; <span class="Comment">/* prevent failure during <a href="#L103" title="regex/regc_color.c:103">freecm</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;hicolormap = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* this memset relies on WHITE being zero: */<br/></li>
<li></span>&nbsp; &nbsp; memset(cm-&gt;locolormap, WHITE,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (MAX_SIMPLE_CHR - CHR_MIN + <span class="Constant">1</span>) * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(color));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memset(cm-&gt;classbits, <span class="Constant">0</span>, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(cm-&gt;classbits));<br/></li>
<li>&nbsp; &nbsp; cm-&gt;numcmranges = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;cmranges = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;maxarrayrows = <span class="Constant">4</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* arbitrary initial allocation */<br/></li>
<li></span>&nbsp; &nbsp; cm-&gt;hiarrayrows = <span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* but we have only one row/col initially */<br/></li>
<li></span>&nbsp; &nbsp; cm-&gt;hiarraycols = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;hicolormap = (color *) MALLOC(cm-&gt;maxarrayrows * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(color));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;hicolormap == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> the &quot;all other characters&quot; row to WHITE */<br/></li>
<li></span>&nbsp; &nbsp; cm-&gt;hicolormap[<span class="Constant">0</span>] = WHITE;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L103" title="regex/regc_color.c:103">freecm</a> - free dynamically-allocated things in a colormap<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L103">&#x200c;</a></span><span class="linkable">freecm</span>(<span class="Type">struct</span> colormap *cm)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; cm-&gt;magic = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;cd != cm-&gt;cdspace)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FREE(cm-&gt;cd);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;locolormap != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FREE(cm-&gt;locolormap);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;cmranges != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FREE(cm-&gt;cmranges);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;hicolormap != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FREE(cm-&gt;hicolormap);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L120" title="regex/regc_color.c:120">pg_reg_getcolor</a> - slow case of GETCOLOR()<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span>color<br/></li>
<li><a id="L120">&#x200c;</a><span class="linkable">pg_reg_getcolor</span>(<span class="Type">struct</span> colormap *cm, <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> c)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rownum,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; colnum,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; low,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; high;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Should not be used for chrs in the locolormap */<br/></li>
<li></span>&nbsp; &nbsp; assert(c &gt; MAX_SIMPLE_CHR);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Find which row it's in.&nbsp; The colormapranges are in order, so we can use<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * binary search.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; rownum = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* if no match, use array row zero */<br/></li>
<li></span>&nbsp; &nbsp; low = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; high = cm-&gt;numcmranges;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (low &lt; high)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; middle = low + (high - low) / <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> colormaprange *cmr = &amp;cm-&gt;cmranges[middle];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &lt; cmr-&gt;cmin)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; high = middle;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &gt; cmr-&gt;cmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; low = middle + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rownum = cmr-&gt;rownum;&nbsp; &nbsp; <span class="Comment">/* found a match */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Find which column it's in --- this is all locale-dependent.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;hiarraycols &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; colnum = <a href="regc_locale.c.html#L671" title="regex/regc_locale.c:671">cclass_column_index</a>(cm, c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> cm-&gt;hicolormap[rownum * cm-&gt;hiarraycols + colnum];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fast path if no relevant cclasses */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> cm-&gt;hicolormap[rownum];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L172" title="regex/regc_color.c:172">maxcolor</a> - report largest color number in use<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> color<br/></li>
<li><a id="L172">&#x200c;</a><span class="linkable">maxcolor</span>(<span class="Type">struct</span> colormap *cm)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L40" title="regex/regc_color.c:40">CISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (color) cm-&gt;max;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L185" title="regex/regc_color.c:185">newcolor</a> - <a href="regexec.c.html#L419" title="regex/regexec.c:419">find</a> a new color (must be assigned at once)<br/></li>
<li></span><span class="Comment"> * Beware:&nbsp; &nbsp; may relocate the colordescs.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> color&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* COLORLESS for error */<br/></li>
<li><a id="L185">&#x200c;</a></span><span class="linkable">newcolor</span>(<span class="Type">struct</span> colormap *cm)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L40" title="regex/regc_color.c:40">CISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;free != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(cm-&gt;free &gt; <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert((<span class="Type">size_t</span>) cm-&gt;free &lt; cm-&gt;ncds);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cd = &amp;cm-&gt;cd[cm-&gt;free];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(UNUSEDCOLOR(cd));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(cd-&gt;arcs == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;free = cd-&gt;sub;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (cm-&gt;max &lt; cm-&gt;ncds - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;max++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cd = &amp;cm-&gt;cd[cm-&gt;max];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* oops, must allocate more */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> colordesc *newCd;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;max == MAX_COLOR)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ECOLORS);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;&nbsp; &nbsp; <span class="Comment">/* too many colors */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = cm-&gt;ncds * <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n &gt; MAX_COLOR + <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = MAX_COLOR + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;cd == cm-&gt;cdspace)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newCd = (<span class="Type">struct</span> colordesc *) MALLOC(n * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> colordesc));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (newCd != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(VS(newCd), VS(cm-&gt;cdspace), cm-&gt;ncds *<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> colordesc));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newCd = (<span class="Type">struct</span> colordesc *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REALLOC(cm-&gt;cd, n * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> colordesc));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (newCd == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cd = newCd;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;ncds = n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(cm-&gt;max &lt; cm-&gt;ncds - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;max++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cd = &amp;cm-&gt;cd[cm-&gt;max];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cd-&gt;nschrs = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;nuchrs = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;sub = NOSUB;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;arcs = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;firstchr = CHR_MIN;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* in case never set otherwise */<br/></li>
<li></span>&nbsp; &nbsp; cd-&gt;flags = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (color) (cd - cm-&gt;cd);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L257" title="regex/regc_color.c:257">freecolor</a> - free a color (must have no arcs or <a href="#L336" title="regex/regc_color.c:336">subcolor</a>)<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L257">&#x200c;</a></span><span class="linkable">freecolor</span>(<span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color co)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd = &amp;cm-&gt;cd[co];<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; pco,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nco;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* for freelist scan */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; assert(co &gt;= <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (co == WHITE)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; assert(cd-&gt;arcs == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; assert(cd-&gt;sub == NOSUB);<br/></li>
<li>&nbsp; &nbsp; assert(cd-&gt;nschrs == <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; assert(cd-&gt;nuchrs == <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; cd-&gt;flags = FREECOL;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((<span class="Type">size_t</span>) co == cm-&gt;max)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (cm-&gt;max &gt; WHITE &amp;&amp; UNUSEDCOLOR(&amp;cm-&gt;cd[cm-&gt;max]))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;max--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(cm-&gt;free &gt;= <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> ((<span class="Type">size_t</span>) cm-&gt;free &gt; cm-&gt;max)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;free = cm-&gt;cd[cm-&gt;free].sub;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;free &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(cm-&gt;free &lt; cm-&gt;max);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pco = cm-&gt;free;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nco = cm-&gt;cd[pco].sub;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (nco &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<span class="Type">size_t</span>) nco &gt; cm-&gt;max)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* take this one out of freelist */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nco = cm-&gt;cd[nco].sub;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cd[pco].sub = nco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(nco &lt; cm-&gt;max);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pco = nco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nco = cm-&gt;cd[pco].sub;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cd-&gt;sub = cm-&gt;free;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;free = (color) (cd - cm-&gt;cd);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L312" title="regex/regc_color.c:312">pseudocolor</a> - allocate a false color, to be managed by other means<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> color<br/></li>
<li><a id="L312">&#x200c;</a><span class="linkable">pseudocolor</span>(<span class="Type">struct</span> colormap *cm)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; co = <a href="#L185" title="regex/regc_color.c:185">newcolor</a>(cm);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L40" title="regex/regc_color.c:40">CISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;<br/></li>
<li>&nbsp; &nbsp; cd = &amp;cm-&gt;cd[co];<br/></li>
<li>&nbsp; &nbsp; cd-&gt;nschrs = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;nuchrs = <span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* pretend it is in the <a href="../utils/adt/oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a> map */<br/></li>
<li></span>&nbsp; &nbsp; cd-&gt;sub = NOSUB;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;arcs = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;firstchr = CHR_MIN;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;flags = PSEUDO;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> co;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L336" title="regex/regc_color.c:336">subcolor</a> - allocate a new <a href="#L336" title="regex/regc_color.c:336">subcolor</a> (if necessary) to this <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This works only for chrs that map into the low color map.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> color<br/></li>
<li><a id="L336">&#x200c;</a><span class="linkable">subcolor</span>(<span class="Type">struct</span> colormap *cm, <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> c)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* current color of c */<br/></li>
<li></span>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* new <a href="#L336" title="regex/regc_color.c:336">subcolor</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; assert(c &lt;= MAX_SIMPLE_CHR);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; co = cm-&gt;locolormap[c - CHR_MIN];<br/></li>
<li>&nbsp; &nbsp; sco = <a href="#L389" title="regex/regc_color.c:389">newsub</a>(cm, co);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L40" title="regex/regc_color.c:40">CISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;<br/></li>
<li>&nbsp; &nbsp; assert(sco != COLORLESS);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (co == sco)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* already in an open <a href="#L336" title="regex/regc_color.c:336">subcolor</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> co;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* rest is redundant */<br/></li>
<li></span>&nbsp; &nbsp; cm-&gt;cd[co].nschrs--;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;cd[sco].nschrs == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cd[sco].firstchr = c;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;cd[sco].nschrs++;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;locolormap[c - CHR_MIN] = sco;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> sco;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L366" title="regex/regc_color.c:366">subcolorhi</a> - allocate a new <a href="#L336" title="regex/regc_color.c:336">subcolor</a> (if necessary) to this colormap entry<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This is the same processing as <a href="#L336" title="regex/regc_color.c:336">subcolor</a>(), but for entries in the high<br/></li>
<li></span><span class="Comment"> * colormap, which do not necessarily correspond to exactly one <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> code.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> color<br/></li>
<li><a id="L366">&#x200c;</a><span class="linkable">subcolorhi</span>(<span class="Type">struct</span> colormap *cm, color *pco)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* current color of entry */<br/></li>
<li></span>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* new <a href="#L336" title="regex/regc_color.c:336">subcolor</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; co = *pco;<br/></li>
<li>&nbsp; &nbsp; sco = <a href="#L389" title="regex/regc_color.c:389">newsub</a>(cm, co);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L40" title="regex/regc_color.c:40">CISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;<br/></li>
<li>&nbsp; &nbsp; assert(sco != COLORLESS);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (co == sco)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* already in an open <a href="#L336" title="regex/regc_color.c:336">subcolor</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> co;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* rest is redundant */<br/></li>
<li></span>&nbsp; &nbsp; cm-&gt;cd[co].nuchrs--;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;cd[sco].nuchrs++;<br/></li>
<li>&nbsp; &nbsp; *pco = sco;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> sco;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L389" title="regex/regc_color.c:389">newsub</a> - allocate a new <a href="#L336" title="regex/regc_color.c:336">subcolor</a> (if necessary) for a color<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> color<br/></li>
<li><a id="L389">&#x200c;</a><span class="linkable">newsub</span>(<span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; color co)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* new <a href="#L336" title="regex/regc_color.c:336">subcolor</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; sco = cm-&gt;cd[co].sub;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sco == NOSUB)<br/></li>
<li>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* color has no open <a href="#L336" title="regex/regc_color.c:336">subcolor</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* optimization: singly-referenced color need not be subcolored */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((cm-&gt;cd[co].nschrs + cm-&gt;cd[co].nuchrs) == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> co;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sco = <a href="#L185" title="regex/regc_color.c:185">newcolor</a>(cm);&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* must create <a href="#L336" title="regex/regc_color.c:336">subcolor</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sco == COLORLESS)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(<a href="#L40" title="regex/regc_color.c:40">CISERR</a>());<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> COLORLESS;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cd[co].sub = sco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cd[sco].sub = sco;&nbsp; &nbsp; <span class="Comment">/* open <a href="#L336" title="regex/regc_color.c:336">subcolor</a> points to self */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; assert(sco != NOSUB);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> sco;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a> - get a new row in the hicolormap, cloning it from oldrow<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns array index of new row.&nbsp; Note the array might move.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L420">&#x200c;</a></span><span class="linkable">newhicolorrow</span>(<span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> oldrow)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newrow = cm-&gt;hiarrayrows;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *newrowptr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Assign a fresh array row index, enlarging storage if needed */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (newrow &gt;= cm-&gt;maxarrayrows)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *newarray;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;maxarrayrows &gt;= <span class="Constant">INT_MAX</span> / (cm-&gt;hiarraycols * <span class="Constant">2</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newarray = (color *) REALLOC(cm-&gt;hicolormap,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cm-&gt;maxarrayrows * <span class="Constant">2</span> *<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cm-&gt;hiarraycols * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(color));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (newarray == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;hicolormap = newarray;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;maxarrayrows *= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; cm-&gt;hiarrayrows++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Copy old row data */<br/></li>
<li></span>&nbsp; &nbsp; newrowptr = &amp;cm-&gt;hicolormap[newrow * cm-&gt;hiarraycols];<br/></li>
<li>&nbsp; &nbsp; memcpy(newrowptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;cm-&gt;hicolormap[oldrow * cm-&gt;hiarraycols],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cm-&gt;hiarraycols * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(color));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Increase color reference counts to reflect new colormap entries */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cm-&gt;hiarraycols; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cd[newrowptr[i]].nuchrs++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> newrow;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L469" title="regex/regc_color.c:469">newhicolorcols</a> - create a new set of columns in the high colormap<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Essentially, extends the 2-D array to the right with a copy of itself.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L469">&#x200c;</a></span><span class="linkable">newhicolorcols</span>(<span class="Type">struct</span> colormap *cm)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *newarray;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;hiarraycols &gt;= <span class="Constant">INT_MAX</span> / (cm-&gt;maxarrayrows * <span class="Constant">2</span>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; newarray = (color *) REALLOC(cm-&gt;hicolormap,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cm-&gt;maxarrayrows *<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cm-&gt;hiarraycols * <span class="Constant">2</span> * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(color));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (newarray == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; cm-&gt;hicolormap = newarray;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Duplicate existing columns to the right, and increase ref counts */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* Must work backwards in the array because we realloc'd in place */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (r = cm-&gt;hiarrayrows - <span class="Constant">1</span>; r &gt;= <span class="Constant">0</span>; r--)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *oldrowptr = &amp;newarray[r * cm-&gt;hiarraycols];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *newrowptr = &amp;newarray[r * cm-&gt;hiarraycols * <span class="Constant">2</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *newrowptr2 = newrowptr + cm-&gt;hiarraycols;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (c = <span class="Constant">0</span>; c &lt; cm-&gt;hiarraycols; c++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co = oldrowptr[c];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newrowptr[c] = newrowptr2[c] = co;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;cd[co].nuchrs++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cm-&gt;hiarraycols *= <span class="Constant">2</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L522" title="regex/regc_color.c:522">subcolorcvec</a> - allocate new subcolors to cvec members, fill in arcs<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * For each <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> &quot;c&quot; represented by the cvec, do the equivalent of<br/></li>
<li></span><span class="Comment"> * <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(v-&gt;nfa, <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a>, <a href="#L336" title="regex/regc_color.c:336">subcolor</a>(v-&gt;cm, c), lp, rp);<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note that in typical cases, many of the subcolors are the same.<br/></li>
<li></span><span class="Comment"> * While <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>() would discard duplicate arc requests, we can save<br/></li>
<li></span><span class="Comment"> * some cycles by not calling it repetitively to begin with.&nbsp; This is<br/></li>
<li></span><span class="Comment"> * mechanized with the &quot;lastsubcolor&quot; state variable.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L522">&#x200c;</a></span><span class="linkable">subcolorcvec</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> cvec *cv,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *lp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *rp)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colormap *cm = v-&gt;cm;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; lastsubcolor = COLORLESS;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; to;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* ordinary characters */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (p = cv-&gt;chrs, i = cv-&gt;nchrs; i &gt; <span class="Constant">0</span>; p++, i--)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ch = *p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L624" title="regex/regc_color.c:624">subcoloronechr</a>(v, ch, lp, rp, &amp;lastsubcolor);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* and the ranges */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (p = cv-&gt;ranges, i = cv-&gt;nranges; i &gt; <span class="Constant">0</span>; p += <span class="Constant">2</span>, i--)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; from = *p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; to = *(p + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from &lt;= MAX_SIMPLE_CHR)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* deal with simple chars one at a time */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lim = (to &lt;= MAX_SIMPLE_CHR) ? to : MAX_SIMPLE_CHR;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (from &lt;= lim)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco = <a href="#L336" title="regex/regc_color.c:336">subcolor</a>(cm, from);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sco != lastsubcolor)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(v-&gt;nfa, <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a>, sco, lp, rp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastsubcolor = sco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* deal with <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> part of the <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> that's above MAX_SIMPLE_CHR */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from &lt; to)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L747" title="regex/regc_color.c:747">subcoloronerange</a>(v, from, to, lp, rp, &amp;lastsubcolor);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (from == to)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L624" title="regex/regc_color.c:624">subcoloronechr</a>(v, from, lp, rp, &amp;lastsubcolor);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* and deal with cclass if <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cv-&gt;cclasscode &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; classbit;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *pco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Enlarge array if we don't have a column <a href="../utils/adt/varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> assignment for cclass */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;classbits[cv-&gt;cclasscode] == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cm-&gt;classbits[cv-&gt;cclasscode] = cm-&gt;hiarraycols;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L469" title="regex/regc_color.c:469">newhicolorcols</a>(cm);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Apply <a href="#L366" title="regex/regc_color.c:366">subcolorhi</a>() and make arc for each entry in relevant cols */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; classbit = cm-&gt;classbits[cv-&gt;cclasscode];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pco = cm-&gt;hicolormap;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (r = <span class="Constant">0</span>; r &lt; cm-&gt;hiarrayrows; r++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (c = <span class="Constant">0</span>; c &lt; cm-&gt;hiarraycols; c++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &amp; classbit)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco = <a href="#L366" title="regex/regc_color.c:366">subcolorhi</a>(cm, pco);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* add the arc if needed */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sco != lastsubcolor)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(v-&gt;nfa, <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a>, sco, lp, rp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastsubcolor = sco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pco++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L624" title="regex/regc_color.c:624">subcoloronechr</a> - do <a href="#L522" title="regex/regc_color.c:522">subcolorcvec</a>'s work for a singleton <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We could just let <a href="#L747" title="regex/regc_color.c:747">subcoloronerange</a> do this, but it's a <a href="../utils/adt/varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> more efficient<br/></li>
<li></span><span class="Comment"> * if we exploit the single-<a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> case.&nbsp; Also, callers <a href="regexec.c.html#L419" title="regex/regexec.c:419">find</a> it useful for this<br/></li>
<li></span><span class="Comment"> * to be able to handle both low and high <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> codes.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L624">&#x200c;</a></span><span class="linkable">subcoloronechr</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> ch,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *lp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *rp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; color *lastsubcolor)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colormap *cm = v-&gt;cm;<br/></li>
<li>&nbsp; &nbsp; colormaprange *newranges;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges;<br/></li>
<li>&nbsp; &nbsp; colormaprange *oldrange;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldrangen;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newrow;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Easy case for low <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> codes */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (ch &lt;= MAX_SIMPLE_CHR)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco = <a href="#L336" title="regex/regc_color.c:336">subcolor</a>(cm, ch);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sco != *lastsubcolor)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(v-&gt;nfa, <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a>, sco, lp, rp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *lastsubcolor = sco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Potentially, we could need two more colormapranges than we have <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a>, if<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the given <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> is in the middle of some existing <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; newranges = (colormaprange *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; MALLOC((cm-&gt;numcmranges + <span class="Constant">2</span>) * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(colormaprange));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (newranges == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; numnewranges = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../access/brin/brin_minmax_multi.c.html#L170" title="access/brin/brin_minmax_multi.c:170">Ranges</a> <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> target are unchanged */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (oldrange = cm-&gt;cmranges, oldrangen = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; oldrangen &lt; cm-&gt;numcmranges;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; oldrange++, oldrangen++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (oldrange-&gt;cmax &gt;= ch)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges++] = *oldrange;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Match target <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> against current <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (oldrangen &gt;= cm-&gt;numcmranges || oldrange-&gt;cmin &gt; ch)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> does not belong to <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> existing <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>, make a new one */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* row state should be cloned from the &quot;all others&quot; row */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum = newrow = <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a>(cm, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (oldrange-&gt;cmin == oldrange-&gt;cmax)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we have an existing singleton <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> matching the <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges++] = *oldrange;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newrow = oldrange-&gt;rownum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we've <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> fully processed this old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; oldrange++, oldrangen++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> is a <a href="regexec.c.html#L702" title="regex/regexec.c:702">subset</a> of this existing <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>, must split it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt; oldrange-&gt;cmin)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* emit portion of old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = oldrange-&gt;cmin;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = ch - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum = oldrange-&gt;rownum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* emit <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> as singleton <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>, initially cloning from <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum = newrow =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a>(cm, oldrange-&gt;rownum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &lt; oldrange-&gt;cmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* emit portion of old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> after <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = ch + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = oldrange-&gt;cmax;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* must clone the row if we are making two new ranges from old */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (ch &gt; oldrange-&gt;cmin) ? <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a>(cm, oldrange-&gt;rownum) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldrange-&gt;rownum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we've <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> fully processed this old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; oldrange++, oldrangen++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Update colors in newrow and create arcs as needed */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L885" title="regex/regc_color.c:885">subcoloronerow</a>(v, newrow, lp, rp, lastsubcolor);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../access/brin/brin_minmax_multi.c.html#L170" title="access/brin/brin_minmax_multi.c:170">Ranges</a> after target are unchanged */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (; oldrangen &lt; cm-&gt;numcmranges; oldrange++, oldrangen++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges++] = *oldrange;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Assert our original space estimate was adequate */<br/></li>
<li></span>&nbsp; &nbsp; assert(numnewranges &lt;= (cm-&gt;numcmranges + <span class="Constant">2</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* And finally, store back the updated list of ranges */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;cmranges != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FREE(cm-&gt;cmranges);<br/></li>
<li>&nbsp; &nbsp; cm-&gt;cmranges = newranges;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;numcmranges = numnewranges;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L747" title="regex/regc_color.c:747">subcoloronerange</a> - do <a href="#L522" title="regex/regc_color.c:522">subcolorcvec</a>'s work for a high <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a><br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L747">&#x200c;</a></span><span class="linkable">subcoloronerange</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> from,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> to,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *lp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *rp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; color *lastsubcolor)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colormap *cm = v-&gt;cm;<br/></li>
<li>&nbsp; &nbsp; colormaprange *newranges;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges;<br/></li>
<li>&nbsp; &nbsp; colormaprange *oldrange;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldrangen;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newrow;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Caller should take care of non-high-<a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> cases */<br/></li>
<li></span>&nbsp; &nbsp; assert(from &gt; MAX_SIMPLE_CHR);<br/></li>
<li>&nbsp; &nbsp; assert(from &lt; to);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Potentially, if we have N non-adjacent ranges, we could need as many as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * 2N+1 result ranges (consider case where new <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> spans 'em all).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; newranges = (colormaprange *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; MALLOC((cm-&gt;numcmranges * <span class="Constant">2</span> + <span class="Constant">1</span>) * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(colormaprange));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (newranges == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L41" title="regex/regc_color.c:41">CERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; numnewranges = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../access/brin/brin_minmax_multi.c.html#L170" title="access/brin/brin_minmax_multi.c:170">Ranges</a> <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> target are unchanged */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (oldrange = cm-&gt;cmranges, oldrangen = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; oldrangen &lt; cm-&gt;numcmranges;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; oldrange++, oldrangen++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (oldrange-&gt;cmax &gt;= from)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges++] = *oldrange;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Deal with ranges that (partially) overlap the target.&nbsp; As we process<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * each such <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>, increase &quot;from&quot; to remove the dealt-with characters<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * from the target <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (oldrangen &lt; cm-&gt;numcmranges &amp;&amp; oldrange-&gt;cmin &lt;= to)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from &lt; oldrange-&gt;cmin)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Handle portion of new <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> that corresponds to no old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = from;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = oldrange-&gt;cmin - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* row state should be cloned from the &quot;all others&quot; row */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum = newrow = <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a>(cm, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Update colors in newrow and create arcs as needed */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L885" title="regex/regc_color.c:885">subcoloronerow</a>(v, newrow, lp, rp, lastsubcolor);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We've <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> fully processed the part of new <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> old */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from = oldrange-&gt;cmin;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from &lt;= oldrange-&gt;cmin &amp;&amp; to &gt;= oldrange-&gt;cmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> is fully contained in new, process it in-place */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges++] = *oldrange;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newrow = oldrange-&gt;rownum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from = oldrange-&gt;cmax + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* some part of old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> does not overlap new <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from &gt; oldrange-&gt;cmin)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* emit portion of old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> new <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = oldrange-&gt;cmin;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = from - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum = oldrange-&gt;rownum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* emit common subrange, initially cloning from old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = from;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (to &lt; oldrange-&gt;cmax) ? to : oldrange-&gt;cmax;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum = newrow =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a>(cm, oldrange-&gt;rownum);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (to &lt; oldrange-&gt;cmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* emit portion of old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> after new <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = to + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = oldrange-&gt;cmax;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* must clone the row if we are making two new ranges from old */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (from &gt; oldrange-&gt;cmin) ? <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a>(cm, oldrange-&gt;rownum) :<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldrange-&gt;rownum;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from = oldrange-&gt;cmax + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Update colors in newrow and create arcs as needed */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L885" title="regex/regc_color.c:885">subcoloronerow</a>(v, newrow, lp, rp, lastsubcolor);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we've <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> fully processed this old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; oldrange++, oldrangen++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (from &lt;= to)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Handle portion of new <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> that corresponds to no old <a href="regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmin = from;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].cmax = to;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* row state should be cloned from the &quot;all others&quot; row */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges].rownum = newrow = <a href="#L420" title="regex/regc_color.c:420">newhicolorrow</a>(cm, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numnewranges++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Update colors in newrow and create arcs as needed */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L885" title="regex/regc_color.c:885">subcoloronerow</a>(v, newrow, lp, rp, lastsubcolor);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../access/brin/brin_minmax_multi.c.html#L170" title="access/brin/brin_minmax_multi.c:170">Ranges</a> after target are unchanged */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (; oldrangen &lt; cm-&gt;numcmranges; oldrange++, oldrangen++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newranges[numnewranges++] = *oldrange;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Assert our original space estimate was adequate */<br/></li>
<li></span>&nbsp; &nbsp; assert(numnewranges &lt;= (cm-&gt;numcmranges * <span class="Constant">2</span> + <span class="Constant">1</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* And finally, store back the updated list of ranges */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;cmranges != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FREE(cm-&gt;cmranges);<br/></li>
<li>&nbsp; &nbsp; cm-&gt;cmranges = newranges;<br/></li>
<li>&nbsp; &nbsp; cm-&gt;numcmranges = numnewranges;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L885" title="regex/regc_color.c:885">subcoloronerow</a> - do <a href="#L522" title="regex/regc_color.c:522">subcolorcvec</a>'s work for one new row in the high colormap<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L885">&#x200c;</a></span><span class="linkable">subcoloronerow</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">int</span> rownum,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *lp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> state *rp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; color *lastsubcolor)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colormap *cm = v-&gt;cm;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp;&nbsp; *pco;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Apply <a href="#L366" title="regex/regc_color.c:366">subcolorhi</a>() and make arc for each entry in row */<br/></li>
<li></span>&nbsp; &nbsp; pco = &amp;cm-&gt;hicolormap[rownum * cm-&gt;hiarraycols];<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cm-&gt;hiarraycols; pco++, i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco = <a href="#L366" title="regex/regc_color.c:366">subcolorhi</a>(cm, pco);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* make the arc if needed */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sco != *lastsubcolor)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(v-&gt;nfa, <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a>, sco, lp, rp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L130" title="regex/regexec.c:130">NOERR</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *lastsubcolor = sco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L916" title="regex/regc_color.c:916">okcolors</a> - promote subcolors to full colors<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L916">&#x200c;</a></span><span class="linkable">okcolors</span>(<span class="Type">struct</span> nfa *nfa,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> colormap *cm)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *end = CDEND(cm);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *scd;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> arc *a;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; sco;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (cd = cm-&gt;cd, co = <span class="Constant">0</span>; cd &lt; end; cd++, co++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sco = cd-&gt;sub;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (UNUSEDCOLOR(cd) || sco == NOSUB)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* has no <a href="#L336" title="regex/regc_color.c:336">subcolor</a>, no further action */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (sco == co)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* is <a href="#L336" title="regex/regc_color.c:336">subcolor</a>, let parent deal with it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (cd-&gt;nschrs == <span class="Constant">0</span> &amp;&amp; cd-&gt;nuchrs == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Parent is <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> empty, so just change all its arcs to the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="#L336" title="regex/regc_color.c:336">subcolor</a>, then free the parent.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * It is not obvious that simply relabeling the arcs like this is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * OK; it appears to risk creating duplicate arcs.&nbsp; We are<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * basically relying on the assumption that processing of a<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="regcomp.c.html#L1671" title="regex/regcomp.c:1671">bracket</a> expression can't create arcs of both a color and its<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="#L336" title="regex/regc_color.c:336">subcolor</a> between the <a href="regcomp.c.html#L1671" title="regex/regcomp.c:1671">bracket</a>'s endpoints.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd-&gt;sub = NOSUB;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scd = &amp;cm-&gt;cd[sco];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(scd-&gt;nschrs &gt; <span class="Constant">0</span> || scd-&gt;nuchrs &gt; <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(scd-&gt;sub == sco);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scd-&gt;sub = NOSUB;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> ((a = cd-&gt;arcs) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(a-&gt;co == co);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1001" title="regex/regc_color.c:1001">uncolorchain</a>(cm, a);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a-&gt;co = sco;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L984" title="regex/regc_color.c:984">colorchain</a>(cm, a);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L257" title="regex/regc_color.c:257">freecolor</a>(cm, co);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* parent's arcs must gain parallel <a href="#L336" title="regex/regc_color.c:336">subcolor</a> arcs */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd-&gt;sub = NOSUB;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scd = &amp;cm-&gt;cd[sco];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(scd-&gt;nschrs &gt; <span class="Constant">0</span> || scd-&gt;nuchrs &gt; <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(scd-&gt;sub == sco);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scd-&gt;sub = NOSUB;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (a = cd-&gt;arcs; a != <span class="Constant">NULL</span>; a = a-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(a-&gt;co == co);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(nfa, a-&gt;type, sco, a-&gt;from, a-&gt;to);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L984" title="regex/regc_color.c:984">colorchain</a> - add this arc to the color chain of its color<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L984">&#x200c;</a></span><span class="linkable">colorchain</span>(<span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> arc *a)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd = &amp;cm-&gt;cd[a-&gt;co];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; assert(a-&gt;co &gt;= <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cd-&gt;arcs != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cd-&gt;arcs-&gt;colorchainRev = a;<br/></li>
<li>&nbsp; &nbsp; a-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a> = cd-&gt;arcs;<br/></li>
<li>&nbsp; &nbsp; a-&gt;colorchainRev = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cd-&gt;arcs = a;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L1001" title="regex/regc_color.c:1001">uncolorchain</a> - delete this arc from the color chain of its color<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1001">&#x200c;</a></span><span class="linkable">uncolorchain</span>(<span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> arc *a)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd = &amp;cm-&gt;cd[a-&gt;co];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> arc *aa = a-&gt;colorchainRev;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; assert(a-&gt;co &gt;= <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (aa == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(cd-&gt;arcs == a);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cd-&gt;arcs = a-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(aa-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a> == a);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; aa-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a> = a-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (a-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a> != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; a-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a>-&gt;colorchainRev = aa;<br/></li>
<li>&nbsp; &nbsp; a-&gt;<a href="#L984" title="regex/regc_color.c:984">colorchain</a> = <span class="Constant">NULL</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* paranoia */<br/></li>
<li></span>&nbsp; &nbsp; a-&gt;colorchainRev = <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L1031" title="regex/regc_color.c:1031">rainbow</a> - add arcs of all full colors (but one) between specified states<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If there isn't an exception color, we <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> generate just a single arc<br/></li>
<li></span><span class="Comment"> * labeled RAINBOW, saving lots of arc-munging later on.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1031">&#x200c;</a></span><span class="linkable">rainbow</span>(<span class="Type">struct</span> nfa *nfa,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> type,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; color but,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* COLORLESS if no exceptions */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> state *from,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> state *to)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *end = CDEND(cm);<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (but == COLORLESS)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(nfa, type, RAINBOW, from, to);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Gotta do it the hard way.&nbsp; Skip subcolors, pseudocolors, and &quot;but&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (cd = cm-&gt;cd, co = <span class="Constant">0</span>; cd &lt; end &amp;&amp; !<a href="#L40" title="regex/regc_color.c:40">CISERR</a>(); cd++, co++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!UNUSEDCOLOR(cd) &amp;&amp; cd-&gt;sub != co &amp;&amp; co != but &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(cd-&gt;flags &amp; PSEUDO))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(nfa, type, co, from, to);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L1064" title="regex/regc_color.c:1064">colorcomplement</a> - add arcs of complementary colors<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We add arcs of all colors that are not pseudocolors and do not match<br/></li>
<li></span><span class="Comment"> * <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> of the &quot;of&quot; state's <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a> outarcs.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The calling sequence ought to be reconciled with <a href="regc_nfa.c.html#L1256" title="regex/regc_nfa.c:1256">cloneouts</a>().<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1064">&#x200c;</a></span><span class="linkable">colorcomplement</span>(<span class="Type">struct</span> nfa *nfa,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> type,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> state *of,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> state *from,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> state *to)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *end = CDEND(cm);<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> arc *a;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; assert(of != from);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* A RAINBOW arc matches all colors, making the complement empty */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="regc_nfa.c.html#L592" title="regex/regc_nfa.c:592">findarc</a>(of, <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a>, RAINBOW) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Otherwise, transiently mark the colors that appear in of's out-arcs */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (a = of-&gt;outs; a != <span class="Constant">NULL</span>; a = a-&gt;outchain)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (a-&gt;type == <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(a-&gt;co &gt;= <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd = &amp;cm-&gt;cd[a-&gt;co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(!UNUSEDCOLOR(cd));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd-&gt;flags |= COLMARK;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Scan colors, clear transient marks, add arcs for unmarked colors */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (cd = cm-&gt;cd, co = <span class="Constant">0</span>; cd &lt; end &amp;&amp; !<a href="#L40" title="regex/regc_color.c:40">CISERR</a>(); cd++, co++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cd-&gt;flags &amp; COLMARK)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd-&gt;flags &amp;= ~COLMARK;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!UNUSEDCOLOR(cd) &amp;&amp; !(cd-&gt;flags &amp; PSEUDO))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regc_nfa.c.html#L281" title="regex/regc_nfa.c:281">newarc</a>(nfa, type, co, from, to);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef REG_DEBUG<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L1111" title="regex/regc_color.c:1111">dumpcolors</a> - debugging output<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1111">&#x200c;</a></span><span class="linkable">dumpcolors</span>(<span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">FILE</span> *f)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *cd;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colordesc *end;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;max </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) cm-&gt;max);<br/></li>
<li>&nbsp; &nbsp; end = CDEND(cm);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (cd = cm-&gt;cd + <span class="Constant">1</span>, co = <span class="Constant">1</span>; cd &lt; end; cd++, co++) <span class="Comment">/* <a href="regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> 0 */<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!UNUSEDCOLOR(cd))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(cd-&gt;nschrs &gt; <span class="Constant">0</span> || cd-&gt;nuchrs &gt; <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cd-&gt;flags &amp; PSEUDO)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;#</span><span class="Special">%2ld</span><span class="Constant">(ps): &quot;</span>, (<span class="Type">long</span>) co);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;#</span><span class="Special">%2ld</span><span class="Constant">(</span><span class="Special">%2d</span><span class="Constant">): &quot;</span>, (<span class="Type">long</span>) co, cd-&gt;nschrs + cd-&gt;nuchrs);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Unfortunately, it's hard to do this <a href="regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> <a href="../utils/adt/varbit.c.html#L391" title="utils/adt/varbit.c:391">bit</a> more efficiently.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (c = CHR_MIN; c &lt;= MAX_SIMPLE_CHR; c++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (GETCOLOR(cm, c) == co)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1175" title="regex/regc_color.c:1175">dumpchr</a>(c, f);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L2491" title="regex/regcomp.c:2491">dump</a> the high colormap if it contains anything interesting */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cm-&gt;hiarrayrows &gt; <span class="Constant">1</span> || cm-&gt;hiarraycols &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> color *rowptr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;other:</span><span class="Special">\t</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (c = <span class="Constant">0</span>; c &lt; cm-&gt;hiarraycols; c++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;</span><span class="Special">\t%ld</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) cm-&gt;hicolormap[c]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (r = <span class="Constant">0</span>; r &lt; cm-&gt;numcmranges; r++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1175" title="regex/regc_color.c:1175">dumpchr</a>(cm-&gt;cmranges[r].cmin, f);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;..&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1175" title="regex/regc_color.c:1175">dumpchr</a>(cm-&gt;cmranges[r].cmax, f);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;:&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rowptr = &amp;cm-&gt;hicolormap[cm-&gt;cmranges[r].rownum * cm-&gt;hiarraycols];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (c = <span class="Constant">0</span>; c &lt; cm-&gt;hiarraycols; c++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;</span><span class="Special">\t%ld</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) rowptr[c]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L1175" title="regex/regc_color.c:1175">dumpchr</a> - <a href="../nodes/print.c.html#L36" title="nodes/print.c:36">print</a> a <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Kind of char-centric but works well enough for debug use.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1175">&#x200c;</a></span><span class="linkable">dumpchr</span>(<a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> c,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">FILE</span> *f)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Special">'\\'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;</span><span class="Special">\\\\</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c &gt; <span class="Constant">' '</span> &amp;&amp; c &lt;= <span class="Constant">'~'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; putc((<span class="Type">char</span>) c, f);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; fprintf(f, <span class="Constant">&quot;</span><span class="Special">\\</span><span class="Constant">u</span><span class="Special">%04lx</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) c);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* REG_DEBUG */<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
