<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>regex/rege_dfa.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>regex/rege_dfa.c - pgsql17devel-backend</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L506">dfa_backref</a></li>
<li><a href="#L691">freedfa</a></li>
<li><a href="#L973">getvacant</a></li>
<li><a href="#L715">hash</a></li>
<li><a href="#L731">initialize</a></li>
<li><a href="#L916">lacon</a></li>
<li><a href="#L585">lastcold</a></li>
<li><a href="#L42">longest</a></li>
<li><a href="#L371">matchuntil</a></li>
<li><a href="#L777">miss</a></li>
<li><a href="#L607">newdfa</a></li>
<li><a href="#L1044">pickss</a></li>
<li><a href="#L204">shortest</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * DFA routines<br/></li>
<li></span><span class="Comment"> * This file is #included by regexec.c.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 1998, 1999 Henry Spencer.&nbsp; All rights reserved.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Development of this software was funded, in part, by Cray Research Inc.,<br/></li>
<li></span><span class="Comment"> * UUNET Communications Services Inc., Sun Microsystems Inc., and Scriptics<br/></li>
<li></span><span class="Comment"> * Corporation, <a href="../optimizer/util/predtest.c.html#L1670" title="optimizer/util/predtest.c:1670">none</a> of whom are responsible for the results.&nbsp; The author<br/></li>
<li></span><span class="Comment"> * thanks all of them.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Redistribution and use in source and binary forms -- with or without<br/></li>
<li></span><span class="Comment"> * modification -- are permitted for <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> purpose, provided that<br/></li>
<li></span><span class="Comment"> * redistributions in source form retain this entire copyright notice and<br/></li>
<li></span><span class="Comment"> * indicate the origin and nature of <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> modifications.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * I'd appreciate being given credit for this package in the documentation<br/></li>
<li></span><span class="Comment"> * of software which uses it, but that is not a requirement.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,<br/></li>
<li></span><span class="Comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY<br/></li>
<li></span><span class="Comment"> * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.&nbsp; IN NO EVENT SHALL<br/></li>
<li></span><span class="Comment"> * HENRY SPENCER BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,<br/></li>
<li></span><span class="Comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,<br/></li>
<li></span><span class="Comment"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;<br/></li>
<li></span><span class="Comment"> * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,<br/></li>
<li></span><span class="Comment"> * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR<br/></li>
<li></span><span class="Comment"> * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF<br/></li>
<li></span><span class="Comment"> * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * src/backend/regex/rege_dfa.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L42" title="regex/rege_dfa.c:42">longest</a> - <a href="#L42" title="regex/rege_dfa.c:42">longest</a>-preferred matching engine<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * On success, returns match endpoint address.&nbsp; Returns NULL on no match.<br/></li>
<li></span><span class="Comment"> * Internal errors also return NULL, with v-&gt;err set.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *<br/></li>
<li><a id="L42">&#x200c;</a><span class="linkable">longest</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *start,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* where the match should start */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *stop,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* match must end at or <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> *hitstopp)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* record whether hit v-&gt;stop, if non-NULL */<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *cp;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *realstop = (stop == v-&gt;stop) ? stop : stop + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *css;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *ss;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *post;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colormap *cm = d-&gt;cm;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* prevent &quot;uninitialized variable&quot; warnings */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (hitstopp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *hitstopp = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* if this is a backref to a known string, just match against that */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;backno &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert((<span class="Type">size_t</span>) d-&gt;backno &lt; v-&gt;nmatch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;pmatch[d-&gt;backno].rm_so &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp = <a href="#L506" title="regex/rege_dfa.c:506">dfa_backref</a>(v, d, start, start, stop, <span class="Constant">false</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cp == v-&gt;stop &amp;&amp; stop == v-&gt;stop &amp;&amp; hitstopp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *hitstopp = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* fast path for matchall NFAs */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;cnfa-&gt;flags &amp; MATCHALL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; nchr = stop - start;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; maxmatchall = d-&gt;cnfa-&gt;maxmatchall;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nchr &lt; d-&gt;cnfa-&gt;minmatchall)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (maxmatchall == DUPINF)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stop == v-&gt;stop &amp;&amp; hitstopp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *hitstopp = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stop == v-&gt;stop &amp;&amp; nchr &lt;= maxmatchall + <span class="Constant">1</span> &amp;&amp; hitstopp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *hitstopp = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nchr &gt; maxmatchall)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> start + maxmatchall;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> stop;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="#L731" title="regex/rege_dfa.c:731">initialize</a> */<br/></li>
<li></span>&nbsp; &nbsp; css = <a href="#L731" title="regex/rege_dfa.c:731">initialize</a>(v, d, start);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (css == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cp = start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* startup */<br/></li>
<li></span>&nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;+++ startup +++</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cp == v-&gt;start)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = d-&gt;cnfa-&gt;bos[(v-&gt;eflags &amp; REG_NOTBOL) ? <span class="Constant">0</span> : <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *(cp - <span class="Constant">1</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;char </span><span class="Special">%c</span><span class="Constant">, color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">char</span>) *(cp - <span class="Constant">1</span>), (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; css = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp, start);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (css == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; css-&gt;lastseen = cp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This is the <a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a> text-scanning loop.&nbsp; It seems worth having two copies<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * to avoid the overhead of REG_FTRACE tests here, even in REG_DEBUG<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * builds, when you're not actively tracing.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#ifdef REG_DEBUG<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;eflags &amp; REG_FTRACE)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (cp &lt; realstop)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;+++ at c</span><span class="Special">%d</span><span class="Constant"> +++</span><span class="Special">\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (css - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;char </span><span class="Special">%c</span><span class="Constant">, color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">char</span>) *cp, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp + <span class="Constant">1</span>, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; css = ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (cp &lt; realstop)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp + <span class="Constant">1</span>, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; css = ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="regexec.c.html#L127" title="regex/regexec.c:127">ISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* shutdown */<br/></li>
<li></span>&nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;+++ shutdown at c</span><span class="Special">%d</span><span class="Constant"> +++</span><span class="Special">\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (css - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cp == v-&gt;stop &amp;&amp; stop == v-&gt;stop)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (hitstopp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *hitstopp = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = d-&gt;cnfa-&gt;eos[(v-&gt;eflags &amp; REG_NOTEOL) ? <span class="Constant">0</span> : <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="regexec.c.html#L127" title="regex/regexec.c:127">ISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* special case:&nbsp; match ended at eol? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss != <span class="Constant">NULL</span> &amp;&amp; (ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (ss != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;lastseen = cp;&nbsp; &nbsp; <span class="Comment">/* to be tidy */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="regexec.c.html#L419" title="regex/regexec.c:419">find</a> last match, if <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> */<br/></li>
<li></span>&nbsp; &nbsp; post = d-&gt;lastpost;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (ss = d-&gt;ssets, i = d-&gt;nssused; i &gt; <span class="Constant">0</span>; ss++, i--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>) &amp;&amp; post != ss-&gt;lastseen &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (post == <span class="Constant">NULL</span> || post &lt; ss-&gt;lastseen))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; post = ss-&gt;lastseen;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (post != <span class="Constant">NULL</span>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* found one */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> post - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L204" title="regex/rege_dfa.c:204">shortest</a> - <a href="#L204" title="regex/rege_dfa.c:204">shortest</a>-preferred matching engine<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * On success, returns match endpoint address.&nbsp; Returns NULL on no match.<br/></li>
<li></span><span class="Comment"> * Internal errors also return NULL, with v-&gt;err set.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *<br/></li>
<li><a id="L204">&#x200c;</a><span class="linkable">shortest</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *start,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* where the match should start */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *min,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* match must end at or after here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *max,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* match must end at or <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> **coldp,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* store coldstart pointer here, if non-NULL */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">int</span> *hitstopp)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* record whether hit v-&gt;stop, if non-NULL */<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *cp;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *realmin = (min == v-&gt;stop) ? min : min + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *realmax = (max == v-&gt;stop) ? max : max + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *css;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *ss;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colormap *cm = d-&gt;cm;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* prevent &quot;uninitialized variable&quot; warnings */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (coldp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *coldp = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (hitstopp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *hitstopp = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* if this is a backref to a known string, just match against that */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;backno &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert((<span class="Type">size_t</span>) d-&gt;backno &lt; v-&gt;nmatch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;pmatch[d-&gt;backno].rm_so &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp = <a href="#L506" title="regex/rege_dfa.c:506">dfa_backref</a>(v, d, start, min, max, <span class="Constant">true</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cp != <span class="Constant">NULL</span> &amp;&amp; coldp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *coldp = start;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* there is no case where we should set *hitstopp */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* fast path for matchall NFAs */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;cnfa-&gt;flags &amp; MATCHALL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; nchr = min - start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;cnfa-&gt;maxmatchall != DUPINF &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nchr &gt; d-&gt;cnfa-&gt;maxmatchall)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((max - start) &lt; d-&gt;cnfa-&gt;minmatchall)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nchr &lt; d-&gt;cnfa-&gt;minmatchall)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; min = start + d-&gt;cnfa-&gt;minmatchall;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (coldp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *coldp = start;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* there is no case where we should set *hitstopp */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> min;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="#L731" title="regex/rege_dfa.c:731">initialize</a> */<br/></li>
<li></span>&nbsp; &nbsp; css = <a href="#L731" title="regex/rege_dfa.c:731">initialize</a>(v, d, start);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (css == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cp = start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* startup */<br/></li>
<li></span>&nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;--- startup ---</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cp == v-&gt;start)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = d-&gt;cnfa-&gt;bos[(v-&gt;eflags &amp; REG_NOTBOL) ? <span class="Constant">0</span> : <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *(cp - <span class="Constant">1</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;char </span><span class="Special">%c</span><span class="Constant">, color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">char</span>) *(cp - <span class="Constant">1</span>), (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; css = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp, start);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (css == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; css-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; ss = css;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This is the <a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a> text-scanning loop.&nbsp; It seems worth having two copies<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * to avoid the overhead of REG_FTRACE tests here, even in REG_DEBUG<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * builds, when you're not actively tracing.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#ifdef REG_DEBUG<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;eflags &amp; REG_FTRACE)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (cp &lt; realmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;--- at c</span><span class="Special">%d</span><span class="Constant"> ---</span><span class="Special">\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (css - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;char </span><span class="Special">%c</span><span class="Constant">, color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">char</span>) *cp, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp + <span class="Constant">1</span>, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; css = ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>) &amp;&amp; cp &gt;= realmin)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (cp &lt; realmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp + <span class="Constant">1</span>, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; css = ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>) &amp;&amp; cp &gt;= realmin)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (coldp != <span class="Constant">NULL</span>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* report last no-progress state set, if <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *coldp = <a href="#L585" title="regex/rege_dfa.c:585">lastcold</a>(v, d);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>) &amp;&amp; cp &gt; min)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(cp &gt;= realmin);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cp--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (cp == v-&gt;stop &amp;&amp; max == v-&gt;stop)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = d-&gt;cnfa-&gt;eos[(v-&gt;eflags &amp; REG_NOTEOL) ? <span class="Constant">0</span> : <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* match might have ended at eol */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ss == <span class="Constant">NULL</span> || !(ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>)) &amp;&amp; hitstopp != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *hitstopp = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span> || !(ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> cp;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L371" title="regex/rege_dfa.c:371">matchuntil</a> - incremental matching engine<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This is meant for use with a search-style NFA (that is, the pattern is<br/></li>
<li></span><span class="Comment"> * known to act as though it had a leading .*).&nbsp; We determine whether a<br/></li>
<li></span><span class="Comment"> * match exists starting at v-&gt;start and ending at probe.&nbsp; Multiple calls<br/></li>
<li></span><span class="Comment"> * require only O(N) time not O(N^2) so long as the probe <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> are<br/></li>
<li></span><span class="Comment"> * nondecreasing.&nbsp; *lastcss and *lastcp must be initialized to NULL <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a><br/></li>
<li></span><span class="Comment"> * starting a series of calls.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns 1 if a match exists, 0 if not.<br/></li>
<li></span><span class="Comment"> * Internal errors also return 0, with v-&gt;err set.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L371">&#x200c;</a></span><span class="linkable">matchuntil</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *probe,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we want to know if a match ends here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> **lastcss,&nbsp; &nbsp; <span class="Comment">/* state storage across calls */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> **lastcp)&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* state storage across calls */<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *cp = *lastcp;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *css = *lastcss;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *ss;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> colormap *cm = d-&gt;cm;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* fast path for matchall NFAs */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;cnfa-&gt;flags &amp; MATCHALL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; nchr = probe - v-&gt;start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nchr &lt; d-&gt;cnfa-&gt;minmatchall)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* maxmatchall will always be infinity, cf. <a href="regcomp.c.html#L619" title="regex/regcomp.c:619">makesearch</a>() */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; assert(d-&gt;cnfa-&gt;maxmatchall == DUPINF);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="#L731" title="regex/rege_dfa.c:731">initialize</a> and startup, or restart, if necessary */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cp == <span class="Constant">NULL</span> || cp &gt; probe)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cp = v-&gt;start;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; css = <a href="#L731" title="regex/rege_dfa.c:731">initialize</a>(v, d, cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (css == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;&gt;&gt;&gt; startup &gt;&gt;&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = d-&gt;cnfa-&gt;bos[(v-&gt;eflags &amp; REG_NOTBOL) ? <span class="Constant">0</span> : <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) co));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; css = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp, v-&gt;start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (css == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; css-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (css == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we previously found that no match is possible beyond *lastcp */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; ss = css;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This is the <a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a> text-scanning loop.&nbsp; It seems worth having two copies<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * to avoid the overhead of REG_FTRACE tests here, even in REG_DEBUG<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * builds, when you're not actively tracing.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#ifdef REG_DEBUG<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;eflags &amp; REG_FTRACE)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (cp &lt; probe)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;&gt;&gt;&gt; at c</span><span class="Special">%d</span><span class="Constant"> &gt;&gt;&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (css - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;char </span><span class="Special">%c</span><span class="Constant">, color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">char</span>) *cp, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp + <span class="Constant">1</span>, v-&gt;start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; css = ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (cp &lt; probe)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp + <span class="Constant">1</span>, v-&gt;start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;lastseen = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; css = ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *lastcss = ss;<br/></li>
<li>&nbsp; &nbsp; *lastcp = cp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* impossible match, or <a href="../utils/adt/pseudotypes.c.html#L373" title="utils/adt/pseudotypes.c:373">internal</a> error */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* We need to process one more <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>, or the <a href="regcomp.c.html#L329" title="regex/regcomp.c:329">EOS</a> symbol, to check match */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cp &lt; v-&gt;stop)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;&gt;&gt;&gt; at c</span><span class="Special">%d</span><span class="Constant"> &gt;&gt;&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (css - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = GETCOLOR(cm, *cp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;char </span><span class="Special">%c</span><span class="Constant">, color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">char</span>) *cp, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss = css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp + <span class="Constant">1</span>, v-&gt;start);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(cp == v-&gt;stop);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = d-&gt;cnfa-&gt;eos[(v-&gt;eflags &amp; REG_NOTEOL) ? <span class="Constant">0</span> : <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;color </span><span class="Special">%ld\n</span><span class="Constant">&quot;</span>, (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L777" title="regex/rege_dfa.c:777">miss</a>(v, d, css, co, cp, v-&gt;start);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span> || !(ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L506" title="regex/rege_dfa.c:506">dfa_backref</a> - <a href="regexec.c.html#L419" title="regex/regexec.c:419">find</a> best match length for a known backref string<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * When the backref's referent is already available, we can deliver an exact<br/></li>
<li></span><span class="Comment"> * answer with considerably less work than running the backref node's NFA.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Return match endpoint for <a href="#L42" title="regex/rege_dfa.c:42">longest</a> or <a href="#L204" title="regex/rege_dfa.c:204">shortest</a> valid repeated match,<br/></li>
<li></span><span class="Comment"> * or NULL if there is no valid match.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Should be in sync with <a href="regexec.c.html#L994" title="regex/regexec.c:994">cbrdissect</a>(), although that has the different task<br/></li>
<li></span><span class="Comment"> * of checking a match to a predetermined section of the string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *<br/></li>
<li><a id="L506">&#x200c;</a><span class="linkable">dfa_backref</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *start,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* where the match should start */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *min,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* match must end at or after here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *max,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* match must end at or <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> here */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <a href="#L204" title="regex/rege_dfa.c:204">shortest</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = d-&gt;backno;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; backmin = d-&gt;backmin;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; backmax = d-&gt;backmax;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; numreps;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; minreps;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; maxreps;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; brlen;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *brstring;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* get the backreferenced string (caller should have checked this) */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;pmatch[n].rm_so == -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; brstring = v-&gt;start + v-&gt;pmatch[n].rm_so;<br/></li>
<li>&nbsp; &nbsp; brlen = v-&gt;pmatch[n].rm_eo - v-&gt;pmatch[n].rm_so;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* special-case zero-length backreference to avoid divide by zero */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (brlen == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * matches only a zero-length string, but <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> number of repetitions<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * can be considered to be present<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (min == start &amp;&amp; backmin &lt;= backmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> start;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * convert min and max into numbers of possible repetitions of the backref<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * string, rounding appropriately<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (min &lt;= start)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; minreps = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; minreps = (min - start - <span class="Constant">1</span>) / brlen + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; maxreps = (max - start) / brlen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* apply bounds, then see if there is <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> allowed match length */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (minreps &lt; backmin)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; minreps = backmin;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (backmax != DUPINF &amp;&amp; maxreps &gt; backmax)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; maxreps = backmax;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (maxreps &lt; minreps)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* quick exit if zero-repetitions match is valid and preferred */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L204" title="regex/rege_dfa.c:204">shortest</a> &amp;&amp; minreps == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* okay, <a href="../optimizer/geqo/geqo_pool.c.html#L145" title="optimizer/geqo/geqo_pool.c:145">compare</a> the actual string contents */<br/></li>
<li></span>&nbsp; &nbsp; p = start;<br/></li>
<li>&nbsp; &nbsp; numreps = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (numreps &lt; maxreps)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((*v-&gt;g-&gt;<a href="../optimizer/geqo/geqo_pool.c.html#L145" title="optimizer/geqo/geqo_pool.c:145">compare</a>) (brstring, p, brlen) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p += brlen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; numreps++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L204" title="regex/rege_dfa.c:204">shortest</a> &amp;&amp; numreps &gt;= minreps)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (numreps &gt;= minreps)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> p;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L585" title="regex/rege_dfa.c:585">lastcold</a> - determine last point at which no progress had been made<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* endpoint, or NULL */<br/></li>
<li><a id="L585">&#x200c;</a></span><span class="linkable">lastcold</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *ss;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *nopr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; nopr = d-&gt;lastnopr;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (nopr == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; nopr = v-&gt;start;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (ss = d-&gt;ssets, i = d-&gt;nssused; i &gt; <span class="Constant">0</span>; ss++, i--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;flags &amp; <a href="regexec.c.html#L56" title="regex/regexec.c:56">NOPROGRESS</a>) &amp;&amp; nopr &lt; ss-&gt;lastseen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nopr = ss-&gt;lastseen;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> nopr;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L607" title="regex/rege_dfa.c:607">newdfa</a> - set up a fresh DFA<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns NULL (and sets v-&gt;err) on failure.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *<br/></li>
<li><a id="L607">&#x200c;</a><span class="linkable">newdfa</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> cnfa *cnfa,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> colormap *cm,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L92" title="regex/regexec.c:92">smalldfa</a> *sml)&nbsp; &nbsp; <span class="Comment">/* preallocated space, may be NULL */<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; nss = cnfa-&gt;nstates * <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wordsper = (cnfa-&gt;nstates + UBITS - <span class="Constant">1</span>) / UBITS;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; ismalloced = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; assert(cnfa != <span class="Constant">NULL</span> &amp;&amp; cnfa-&gt;nstates != <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (nss &lt;= <a href="regexec.c.html#L90" title="regex/regexec.c:90">FEWSTATES</a> &amp;&amp; cnfa-&gt;ncolors &lt;= <a href="regexec.c.html#L91" title="regex/regexec.c:91">FEWCOLORS</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(wordsper == <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sml == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sml = (<span class="Type">struct</span> <a href="regexec.c.html#L92" title="regex/regexec.c:92">smalldfa</a> *) MALLOC(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> <a href="regexec.c.html#L92" title="regex/regexec.c:92">smalldfa</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sml == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L129" title="regex/regexec.c:129">ERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ismalloced = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d = &amp;sml-&gt;<a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;ssets = sml-&gt;ssets;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;statesarea = sml-&gt;statesarea;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;work = &amp;d-&gt;statesarea[nss];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;outsarea = sml-&gt;outsarea;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;incarea = sml-&gt;incarea;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;ismalloced = ismalloced;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;arraysmalloced = <span class="Constant">false</span>;&nbsp; &nbsp; <span class="Comment">/* not separately allocated, anyway */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d = (<span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *) MALLOC(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L129" title="regex/regexec.c:129">ERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;ssets = (<span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *) MALLOC(nss * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;statesarea = (<span class="Type">unsigned</span> *) MALLOC((nss + <a href="regexec.c.html#L87" title="regex/regexec.c:87">WORK</a>) * wordsper *<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">unsigned</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;work = &amp;d-&gt;statesarea[nss * wordsper];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;outsarea = (<span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> **) MALLOC(nss * cnfa-&gt;ncolors *<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;incarea = (<span class="Type">struct</span> <a href="regexec.c.html#L39" title="regex/regexec.c:39">arcp</a> *) MALLOC(nss * cnfa-&gt;ncolors *<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> <a href="regexec.c.html#L39" title="regex/regexec.c:39">arcp</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;ismalloced = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;arraysmalloced = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> <a href="#L691" title="regex/rege_dfa.c:691">freedfa</a>() will behave sanely */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;ssets == <span class="Constant">NULL</span> || d-&gt;statesarea == <span class="Constant">NULL</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d-&gt;outsarea == <span class="Constant">NULL</span> || d-&gt;incarea == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L691" title="regex/rege_dfa.c:691">freedfa</a>(d);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L129" title="regex/regexec.c:129">ERR</a>(REG_ESPACE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; d-&gt;nssets = (v-&gt;eflags &amp; REG_SMALL) ? <span class="Constant">7</span> : nss;<br/></li>
<li>&nbsp; &nbsp; d-&gt;nssused = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; d-&gt;nstates = cnfa-&gt;nstates;<br/></li>
<li>&nbsp; &nbsp; d-&gt;ncolors = cnfa-&gt;ncolors;<br/></li>
<li>&nbsp; &nbsp; d-&gt;wordsper = wordsper;<br/></li>
<li>&nbsp; &nbsp; d-&gt;cnfa = cnfa;<br/></li>
<li>&nbsp; &nbsp; d-&gt;cm = cm;<br/></li>
<li>&nbsp; &nbsp; d-&gt;lastpost = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; d-&gt;lastnopr = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; d-&gt;search = d-&gt;ssets;<br/></li>
<li>&nbsp; &nbsp; d-&gt;backno = -<span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* may be set by caller */<br/></li>
<li></span>&nbsp; &nbsp; d-&gt;backmin = d-&gt;backmax = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* initialization of <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> fields is done as needed */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> d;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L691" title="regex/rege_dfa.c:691">freedfa</a> - free a DFA<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L691">&#x200c;</a></span><span class="linkable">freedfa</span>(<span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;arraysmalloced)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;ssets != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FREE(d-&gt;ssets);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;statesarea != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FREE(d-&gt;statesarea);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;outsarea != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FREE(d-&gt;outsarea);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;incarea != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FREE(d-&gt;incarea);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;ismalloced)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FREE(d);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L715" title="regex/rege_dfa.c:715">hash</a> - construct a <a href="#L715" title="regex/rege_dfa.c:715">hash</a> code for a bitvector<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * There are probably better ways, but they're more expensive.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">unsigned<br/></li>
<li><a id="L715">&#x200c;</a></span><span class="linkable">hash</span>(<span class="Type">unsigned</span> *uv,<br/></li>
<li>&nbsp; &nbsp;&nbsp; <span class="Type">int</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span>&nbsp; &nbsp; h;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; h ^= uv[i];<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> h;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L731" title="regex/rege_dfa.c:731">initialize</a> - hand-craft a cache entry for startup, otherwise get ready<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *<br/></li>
<li><a id="L731">&#x200c;</a><span class="linkable">initialize</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *start)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *ss;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* is previous one still there? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;nssused &gt; <span class="Constant">0</span> &amp;&amp; (d-&gt;ssets[<span class="Constant">0</span>].flags &amp; <a href="regexec.c.html#L53" title="regex/regexec.c:53">STARTER</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss = &amp;d-&gt;ssets[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* no, must (re)build it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ss = <a href="#L973" title="regex/rege_dfa.c:973">getvacant</a>(v, d, start, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;wordsper; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;states[i] = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; BSET(ss-&gt;states, d-&gt;cnfa-&gt;pre);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;<a href="#L715" title="regex/rege_dfa.c:715">hash</a> = <a href="regexec.c.html#L49" title="regex/regexec.c:49">HASH</a>(ss-&gt;states, d-&gt;wordsper);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(d-&gt;cnfa-&gt;pre != d-&gt;cnfa-&gt;post);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;flags = <a href="regexec.c.html#L53" title="regex/regexec.c:53">STARTER</a> | <a href="regexec.c.html#L55" title="regex/regexec.c:55">LOCKED</a> | <a href="regexec.c.html#L56" title="regex/regexec.c:56">NOPROGRESS</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* lastseen dealt with below */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;nssused; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;ssets[i].lastseen = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; ss-&gt;lastseen = start;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* maybe untrue, but harmless */<br/></li>
<li></span>&nbsp; &nbsp; d-&gt;lastpost = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; d-&gt;lastnopr = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> ss;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L777" title="regex/rege_dfa.c:777">miss</a> - handle a stateset cache <a href="#L777" title="regex/rege_dfa.c:777">miss</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * css is the current stateset, co is the color of the current input character,<br/></li>
<li></span><span class="Comment"> * cp points to the character after that (which is where we may need to test<br/></li>
<li></span><span class="Comment"> * LACONs).&nbsp; start does not affect matching behavior but is needed for <a href="#L1044" title="regex/rege_dfa.c:1044">pickss</a>'<br/></li>
<li></span><span class="Comment"> * heuristics about which stateset cache entry to replace.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Ordinarily, returns the address of the <a href="regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> stateset (the one that is<br/></li>
<li></span><span class="Comment"> * valid after consuming the input character).&nbsp; Returns NULL if no valid<br/></li>
<li></span><span class="Comment"> * NFA states remain, ie we have a certain match failure.<br/></li>
<li></span><span class="Comment"> * Internal errors also return NULL, with v-&gt;err set.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *<br/></li>
<li><a id="L777">&#x200c;</a><span class="linkable">miss</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *css,<br/></li>
<li>&nbsp; &nbsp;&nbsp; color co,<br/></li>
<li>&nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *cp,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> */<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *start)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* where the attempt got started */<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> cnfa *cnfa = d-&gt;cnfa;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span>&nbsp; &nbsp; h;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> carc *ca;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ispseudocolor;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ispost;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; noprogress;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gotstate;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dolacons;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sawlacons;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* for convenience, we can be called even if it might not be a <a href="#L777" title="regex/rege_dfa.c:777">miss</a> */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (css-&gt;outs[co] != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;hit</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> css-&gt;outs[co];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;<a href="#L777" title="regex/rege_dfa.c:777">miss</a></span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Checking for operation cancel in the inner text search loop seems<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * unduly expensive.&nbsp; As a compromise, check during cache misses.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; INTERRUPT(v-&gt;re);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * What set of states would we end up in after consuming the co character?<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We first consider <a href="regcomp.c.html#L330" title="regex/regcomp.c:330">PLAIN</a> arcs that consume the character, and then look<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * to see what <a href="regcomp.c.html#L340" title="regex/regcomp.c:340">LACON</a> arcs could be traversed after consuming it.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;wordsper; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;work[i] = <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* build new stateset bitmap in d-&gt;work */<br/></li>
<li></span>&nbsp; &nbsp; ispseudocolor = d-&gt;cm-&gt;cd[co].flags &amp; PSEUDO;<br/></li>
<li>&nbsp; &nbsp; ispost = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; noprogress = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; gotstate = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;nstates; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ISBSET(css-&gt;states, i))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (ca = cnfa-&gt;states[i]; ca-&gt;co != COLORLESS; ca++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ca-&gt;co == co ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (ca-&gt;co == RAINBOW &amp;&amp; !ispseudocolor))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BSET(d-&gt;work, ca-&gt;to);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gotstate = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ca-&gt;to == cnfa-&gt;post)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ispost = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(cnfa-&gt;stflags[ca-&gt;to] &amp; CNFA_NOPROGRESS))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; noprogress = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant"> -&gt; </span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, i, ca-&gt;to));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!gotstate)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* character cannot reach <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> new state */<br/></li>
<li></span>&nbsp; &nbsp; dolacons = (cnfa-&gt;flags &amp; HASLACONS);<br/></li>
<li>&nbsp; &nbsp; sawlacons = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* outer loop handles transitive closure of reachable-by-<a href="regcomp.c.html#L340" title="regex/regcomp.c:340">LACON</a> states */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (dolacons)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dolacons = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;nstates; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ISBSET(d-&gt;work, i))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (ca = cnfa-&gt;states[i]; ca-&gt;co != COLORLESS; ca++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ca-&gt;co &lt; cnfa-&gt;ncolors)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;&nbsp; &nbsp; <span class="Comment">/* not a <a href="regcomp.c.html#L340" title="regex/regcomp.c:340">LACON</a> arc */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ISBSET(d-&gt;work, ca-&gt;to))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;&nbsp; &nbsp; <span class="Comment">/* arc would be a no-op anyway */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sawlacons = <span class="Constant">1</span>;&nbsp; &nbsp; <span class="Comment">/* this <a href="regcomp.c.html#L340" title="regex/regcomp.c:340">LACON</a> affects our result */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L916" title="regex/rege_dfa.c:916">lacon</a>(v, cnfa, cp, ca-&gt;co))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="regexec.c.html#L127" title="regex/regexec.c:127">ISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;&nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L340" title="regex/regcomp.c:340">LACON</a> arc cannot be traversed */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="regexec.c.html#L127" title="regex/regexec.c:127">ISERR</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BSET(d-&gt;work, ca-&gt;to);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dolacons = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ca-&gt;to == cnfa-&gt;post)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ispost = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(cnfa-&gt;stflags[ca-&gt;to] &amp; CNFA_NOPROGRESS))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; noprogress = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant"> :&gt; </span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, i, ca-&gt;to));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; h = <a href="regexec.c.html#L49" title="regex/regexec.c:49">HASH</a>(d-&gt;work, d-&gt;wordsper);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Is this stateset already in the cache? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (p = d-&gt;ssets, i = d-&gt;nssused; i &gt; <span class="Constant">0</span>; p++, i--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="regexec.c.html#L50" title="regex/regexec.c:50">HIT</a>(h, d-&gt;work, p, d-&gt;wordsper))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;cached c</span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (p - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> BREAK OUT */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (i == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* nope, need a new cache entry */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L973" title="regex/rege_dfa.c:973">getvacant</a>(v, d, cp, start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(p != css);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;wordsper; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p-&gt;states[i] = d-&gt;work[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p-&gt;<a href="#L715" title="regex/rege_dfa.c:715">hash</a> = h;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p-&gt;flags = (ispost) ? <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a> : <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (noprogress)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p-&gt;flags |= <a href="regexec.c.html#L56" title="regex/regexec.c:56">NOPROGRESS</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* lastseen to be dealt with by caller */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Link new stateset to old, unless a <a href="regcomp.c.html#L340" title="regex/regcomp.c:340">LACON</a> affected the result, in which<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * case we don't create the link.&nbsp; That forces future transitions across<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * this same arc (same prior stateset and character color) to come through<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="#L777" title="regex/rege_dfa.c:777">miss</a>() again, so that we can recheck the <a href="regcomp.c.html#L340" title="regex/regcomp.c:340">LACON</a>(s), which might or might<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * not pass since context will be different.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!sawlacons)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;c</span><span class="Special">%d</span><span class="Constant">[</span><span class="Special">%d</span><span class="Constant">]-&gt;c</span><span class="Special">%d\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">int</span>) (css - d-&gt;ssets), co, (<span class="Type">int</span>) (p - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; css-&gt;outs[co] = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; css-&gt;inchain[co] = p-&gt;ins;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p-&gt;ins.ss = css;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p-&gt;ins.co = co;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> p;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L916" title="regex/rege_dfa.c:916">lacon</a> - lookaround-constraint checker for <a href="#L777" title="regex/rege_dfa.c:777">miss</a>()<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* predicate:&nbsp; constraint satisfied? */<br/></li>
<li><a id="L916">&#x200c;</a></span><span class="linkable">lacon</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type">struct</span> cnfa *pcnfa,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* parent cnfa */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *cp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; color co)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot;color&quot; of the lookaround constraint */<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regcomp.c.html#L2093" title="regex/regcomp.c:2093">subre</a> *sub;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *end;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; satisfied;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Since this is recursive, it could be driven to stack overflow */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (STACK_TOO_DEEP(v-&gt;re))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="regexec.c.html#L129" title="regex/regexec.c:129">ERR</a>(REG_ETOOBIG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = co - pcnfa-&gt;ncolors;<br/></li>
<li>&nbsp; &nbsp; assert(n &gt; <span class="Constant">0</span> &amp;&amp; n &lt; v-&gt;g-&gt;nlacons &amp;&amp; v-&gt;g-&gt;lacons != <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;=== testing <a href="#L916" title="regex/rege_dfa.c:916">lacon</a> </span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, n));<br/></li>
<li>&nbsp; &nbsp; sub = &amp;v-&gt;g-&gt;lacons[n];<br/></li>
<li>&nbsp; &nbsp; d = <a href="regexec.c.html#L400" title="regex/regexec.c:400">getladfa</a>(v, n);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (d == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (LATYPE_IS_AHEAD(sub-&gt;latype))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* used to use <a href="#L42" title="regex/rege_dfa.c:42">longest</a>() here, but <a href="#L204" title="regex/rege_dfa.c:204">shortest</a>() could be much cheaper */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; end = <a href="#L204" title="regex/rege_dfa.c:204">shortest</a>(v, d, cp, cp, v-&gt;stop,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> **) <span class="Constant">NULL</span>, (<span class="Type">int</span> *) <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; satisfied = LATYPE_IS_POS(sub-&gt;latype) ? (end != <span class="Constant">NULL</span>) : (end == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * To avoid doing O(N^2) work when repeatedly testing a lookbehind<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * constraint in an N-character string, we use <a href="#L371" title="regex/rege_dfa.c:371">matchuntil</a>() which can<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * cache the DFA state across calls.&nbsp; We only need to restart if the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * probe point decreases, which is not common.&nbsp; The NFA we're using is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * a search NFA, so it doesn't mind scanning over stuff <a href="regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * nominal match.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; satisfied = <a href="#L371" title="regex/rege_dfa.c:371">matchuntil</a>(v, d, cp, &amp;v-&gt;lblastcss[n], &amp;v-&gt;lblastcp[n]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!LATYPE_IS_POS(sub-&gt;latype))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; satisfied = !satisfied;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;=== <a href="#L916" title="regex/rege_dfa.c:916">lacon</a> </span><span class="Special">%d</span><span class="Constant"> satisfied </span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, n, satisfied));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> satisfied;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L973" title="regex/rege_dfa.c:973">getvacant</a> - get a vacant state set<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This routine clears out the inarcs and outarcs, but does not otherwise<br/></li>
<li></span><span class="Comment"> * clear the innards of the state set -- that's up to the caller.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *<br/></li>
<li><a id="L973">&#x200c;</a><span class="linkable">getvacant</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *cp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *start)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *ss;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L39" title="regex/regexec.c:39">arcp</a> ap;<br/></li>
<li>&nbsp; &nbsp; color&nbsp; &nbsp; &nbsp; &nbsp; co;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ss = <a href="#L1044" title="regex/rege_dfa.c:1044">pickss</a>(v, d, cp, start);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ss == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; assert(!(ss-&gt;flags &amp; <a href="regexec.c.html#L55" title="regex/regexec.c:55">LOCKED</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* clear out its inarcs, including self-referential ones */<br/></li>
<li></span>&nbsp; &nbsp; ap = ss-&gt;ins;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((p = ap.ss) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; co = ap.co;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;zapping c</span><span class="Special">%d</span><span class="Constant">'s </span><span class="Special">%ld</span><span class="Constant"> outarc</span><span class="Special">\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (p - d-&gt;ssets), (<span class="Type">long</span>) co));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p-&gt;outs[co] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ap = p-&gt;inchain[co];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p-&gt;inchain[co].ss = <span class="Constant">NULL</span>;&nbsp; &nbsp; <span class="Comment">/* paranoia */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; ss-&gt;ins.ss = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* take it off the inarc chains of the ssets reached by its outarcs */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;ncolors; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = ss-&gt;outs[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; assert(p != ss);&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not self-referential */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="regcomp.c.html#L324" title="regex/regcomp.c:324">NOTE</a> CONTINUE */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;del outarc </span><span class="Special">%d</span><span class="Constant"> from c</span><span class="Special">%d</span><span class="Constant">'s in chn</span><span class="Special">\n</span><span class="Constant">&quot;</span>, i, (<span class="Type">int</span>) (p - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p-&gt;ins.ss == ss &amp;&amp; p-&gt;ins.co == i)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p-&gt;ins = ss-&gt;inchain[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L39" title="regex/regexec.c:39">arcp</a> lastap = {<span class="Constant">NULL</span>, <span class="Constant">0</span>};<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(p-&gt;ins.ss != <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (ap = p-&gt;ins; ap.ss != <span class="Constant">NULL</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; !(ap.ss == ss &amp;&amp; ap.co == i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ap = ap.ss-&gt;inchain[ap.co])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastap = ap;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; assert(ap.ss != <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastap.ss-&gt;inchain[lastap.co] = ss-&gt;inchain[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;outs[i] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;inchain[i].ss = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* if ss was a success state, may need to remember location */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;flags &amp; <a href="regexec.c.html#L54" title="regex/regexec.c:54">POSTSTATE</a>) &amp;&amp; ss-&gt;lastseen != d-&gt;lastpost &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (d-&gt;lastpost == <span class="Constant">NULL</span> || d-&gt;lastpost &lt; ss-&gt;lastseen))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;lastpost = ss-&gt;lastseen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* likewise for a no-progress state */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;flags &amp; <a href="regexec.c.html#L56" title="regex/regexec.c:56">NOPROGRESS</a>) &amp;&amp; ss-&gt;lastseen != d-&gt;lastnopr &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (d-&gt;lastnopr == <span class="Constant">NULL</span> || d-&gt;lastnopr &lt; ss-&gt;lastseen))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;lastnopr = ss-&gt;lastseen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> ss;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L1044" title="regex/rege_dfa.c:1044">pickss</a> - pick the <a href="regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> stateset to be used<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *<br/></li>
<li><a id="L1044">&#x200c;</a><span class="linkable">pickss</span>(<span class="Type">struct</span> <a href="regexec.c.html#L106" title="regex/regexec.c:106">vars</a> *v,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L63" title="regex/regexec.c:63">dfa</a> *d,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *cp,<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a> *start)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *ss;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="regexec.c.html#L45" title="regex/regexec.c:45">sset</a> *end;<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/oracle_compat.c.html#L1006" title="utils/adt/oracle_compat.c:1006">chr</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *ancient;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* shortcut for cases where cache isn't full */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (d-&gt;nssused &lt; d-&gt;nssets)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = d-&gt;nssused;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; d-&gt;nssused++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss = &amp;d-&gt;ssets[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;new c</span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, i));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* set up innards */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;states = &amp;d-&gt;statesarea[i * d-&gt;wordsper];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;flags = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;ins.ss = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;ins.co = WHITE;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* give it some value */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;outs = &amp;d-&gt;outsarea[i * d-&gt;ncolors];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;inchain = &amp;d-&gt;incarea[i * d-&gt;ncolors];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; d-&gt;ncolors; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;outs[i] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ss-&gt;inchain[i].ss = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ss;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* look for oldest, or old enough anyway */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cp - start &gt; d-&gt;nssets * <span class="Constant">2</span> / <span class="Constant">3</span>) <span class="Comment">/* oldest 33% are expendable */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ancient = cp - d-&gt;nssets * <span class="Constant">2</span> / <span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; ancient = start;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (ss = d-&gt;search, end = &amp;d-&gt;ssets[d-&gt;nssets]; ss &lt; end; ss++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;lastseen == <span class="Constant">NULL</span> || ss-&gt;lastseen &lt; ancient) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(ss-&gt;flags &amp; <a href="regexec.c.html#L55" title="regex/regexec.c:55">LOCKED</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d-&gt;search = ss + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;replacing c</span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (ss - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (ss = d-&gt;ssets, end = d-&gt;search; ss &lt; end; ss++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ss-&gt;lastseen == <span class="Constant">NULL</span> || ss-&gt;lastseen &lt; ancient) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(ss-&gt;flags &amp; <a href="regexec.c.html#L55" title="regex/regexec.c:55">LOCKED</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d-&gt;search = ss + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;replacing c</span><span class="Special">%d\n</span><span class="Constant">&quot;</span>, (<span class="Type">int</span>) (ss - d-&gt;ssets)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ss;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* nobody's old enough?!? -- something's really wrong */<br/></li>
<li></span>&nbsp; &nbsp; FDEBUG((<span class="Constant">&quot;cannot <a href="regexec.c.html#L419" title="regex/regexec.c:419">find</a> victim to replace!</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; <a href="regexec.c.html#L129" title="regex/regexec.c:129">ERR</a>(REG_ASSERT);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
