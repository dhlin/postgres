<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>parser/check_keywords.pl - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>parser/check_keywords.pl - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L26">check_alphabetical_order</a></li>
<li><a href="#L17">error</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="PreProc">#!/usr/bin/perl<br/></li>
<li></span><br/></li>
<li><span class="Comment"># Check that the keyword lists in gram.y and kwlist.h are sane.<br/></li>
<li></span><span class="Comment"># Usage: check_keywords.pl gram.y kwlist.h<br/></li>
<li></span><br/></li>
<li><span class="Comment"># src/backend/parser/check_keywords.pl<br/></li>
<li></span><span class="Comment"># Copyright (c) 2009-2024, PostgreSQL Global Development Group<br/></li>
<li></span><br/></li>
<li><span class="Statement">use strict</span>;<br/></li>
<li><span class="Statement">use warnings</span> <span class="Constant">FATAL</span> =&gt; <span class="Constant">'all'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$gram_filename</span> = <span class="Identifier">$ARGV[</span><span class="Constant">0</span><span class="Identifier">]</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$kwlist_filename</span> = <span class="Identifier">$ARGV[</span><span class="Constant">1</span><span class="Identifier">]</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$errors</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><a id="L17">&#x200c;</a><span class="Statement">sub </span><span class="Identifier"><span class="linkable">error</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">print</span> <span class="Identifier">STDERR</span> <span class="Identifier">@_</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$errors</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment"># Check alphabetical order of a set of keyword symbols<br/></li>
<li></span><span class="Comment"># (note these are NOT the actual keyword strings)<br/></li>
<li><a id="L26">&#x200c;</a></span><span class="Statement">sub </span><span class="Identifier"><span class="linkable">check_alphabetical_order</span><br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$listname</span>, <span class="Identifier">$list</span>) = <span class="Identifier">@_</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$prevkword</span> = <span class="Constant">''</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$kword</span> (<span class="Identifier">@$list</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Some symbols have a _P suffix. Remove it for the comparison.<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$bare_kword</span> = <span class="Identifier">$kword</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$bare_kword</span> =~ <span class="Statement">s/</span><span class="Constant">_P$</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$bare_kword</span> <span class="Statement">le</span> <span class="Identifier">$prevkword</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;'</span><span class="Identifier">$bare_kword</span><span class="Constant">' after '</span><span class="Identifier">$prevkword</span><span class="Constant">' in </span><span class="Identifier">$listname</span><span class="Constant"> list is misplaced&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$prevkword</span> = <span class="Identifier">$bare_kword</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Identifier">$,</span> = <span class="Constant">' '</span>;&nbsp; &nbsp;&nbsp; <span class="Comment"># set output field separator<br/></li>
<li></span><span class="Identifier">$\</span> = <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;&nbsp; &nbsp; <span class="Comment"># set output record separator<br/></li>
<li></span><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%keyword_categories</span>;<br/></li>
<li><span class="Identifier">$keyword_categories{</span><span class="Constant">'unreserved_keyword'</span><span class="Identifier">}</span> = <span class="Constant">'UNRESERVED_KEYWORD'</span>;<br/></li>
<li><span class="Identifier">$keyword_categories{</span><span class="Constant">'col_name_keyword'</span><span class="Identifier">}</span> = <span class="Constant">'COL_NAME_KEYWORD'</span>;<br/></li>
<li><span class="Identifier">$keyword_categories{</span><span class="Constant">'type_func_name_keyword'</span><span class="Identifier">}</span> = <span class="Constant">'TYPE_FUNC_NAME_KEYWORD'</span>;<br/></li>
<li><span class="Identifier">$keyword_categories{</span><span class="Constant">'reserved_keyword'</span><span class="Identifier">}</span> = <span class="Constant">'RESERVED_KEYWORD'</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">open</span>(<span class="Statement">my</span> <span class="Identifier">$gram</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$gram_filename</span>) || <span class="Statement">die</span>(<span class="Constant">&quot;Could not open : </span><span class="Identifier">$gram_filename</span><span class="Constant">&quot;</span>);<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$kcat</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$in_bare_labels</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$comment</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">@arr</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%keywords</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">@bare_label_keywords</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">line:</span> <span class="Statement">while</span> (<span class="Statement">my</span> <span class="Identifier">$S</span> = &lt;<span class="Identifier">$gram</span>&gt;)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">chomp</span> <span class="Identifier">$S</span>;&nbsp; &nbsp; <span class="Comment"># strip record separator<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$s</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Make sure any braces are split<br/></li>
<li></span>&nbsp; &nbsp; <span class="Identifier">$s</span> = <span class="Constant">'{'</span>, <span class="Identifier">$S</span> =~ <span class="Statement">s/</span><span class="Identifier">$s</span><span class="Statement">/</span><span class="Constant"> { </span><span class="Statement">/g</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$s</span> = <span class="Constant">'}'</span>, <span class="Identifier">$S</span> =~ <span class="Statement">s/</span><span class="Identifier">$s</span><span class="Statement">/</span><span class="Constant"> } </span><span class="Statement">/g</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Any comments are split<br/></li>
<li></span>&nbsp; &nbsp; <span class="Identifier">$s</span> = <span class="Constant">'[/][*]'</span>, <span class="Identifier">$S</span> =~ <span class="Statement">s#</span><span class="Identifier">$s</span><span class="Statement">#</span><span class="Constant"> /* </span><span class="Statement">#g</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$s</span> = <span class="Constant">'[*][/]'</span>, <span class="Identifier">$S</span> =~ <span class="Statement">s#</span><span class="Identifier">$s</span><span class="Statement">#</span><span class="Constant"> */ </span><span class="Statement">#g</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!(<span class="Identifier">$kcat</span>) &amp;&amp; !(<span class="Identifier">$in_bare_labels</span>))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Is this the beginning of a keyword list?<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$k</span> (<span class="Statement">keys</span> <span class="Identifier">%keyword_categories</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$S</span> =~ <span class="Statement">m/</span><span class="Constant">^</span><span class="Special">(</span><span class="Identifier">$k</span><span class="Special">)</span><span class="Constant">:</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$kcat</span> = <span class="Identifier">$k</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> line;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Is this the beginning of the bare_label_keyword list?<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$in_bare_labels</span> = <span class="Constant">1</span> <span class="Statement">if</span> (<span class="Identifier">$S</span> =~ <span class="Statement">m/</span><span class="Constant">^bare_label_keyword:</span><span class="Statement">/</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> line;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Now split the line into individual fields<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$n</span> = (<span class="Identifier">@arr</span> = <span class="Statement">split</span>(<span class="Constant">' '</span>, <span class="Identifier">$S</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment"># Ok, we're in a keyword list. Go through each field in turn<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Statement">my</span> <span class="Identifier">$fieldIndexer</span> = <span class="Constant">0</span>; <span class="Identifier">$fieldIndexer</span> &lt; <span class="Identifier">$n</span>; <span class="Identifier">$fieldIndexer</span>++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$arr[$fieldIndexer]</span> <span class="Statement">eq</span> <span class="Constant">'*/'</span> &amp;&amp; <span class="Identifier">$comment</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$comment</span> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$comment</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$arr[$fieldIndexer]</span> <span class="Statement">eq</span> <span class="Constant">'/*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># start of a multiline comment<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$comment</span> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$arr[$fieldIndexer]</span> <span class="Statement">eq</span> <span class="Constant">'//'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span> line;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$arr[$fieldIndexer]</span> <span class="Statement">eq</span> <span class="Constant">';'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># end of keyword list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">undef</span> <span class="Identifier">$kcat</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">undef</span> <span class="Identifier">$in_bare_labels</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$arr[$fieldIndexer]</span> <span class="Statement">eq</span> <span class="Constant">'|'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">next</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Put this keyword into the right list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$in_bare_labels</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@bare_label_keywords</span>, <span class="Identifier">$arr[$fieldIndexer]</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">push</span> <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$keywords{$kcat}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>, <span class="Identifier">$arr[$fieldIndexer]</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$gram</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Check that each keyword list is in alphabetical order (just for neatnik-ism)<br/></li>
<li></span><a href="#L26" title="parser/check_keywords.pl:26">check_alphabetical_order</a>(<span class="Identifier">$_</span>, <span class="Identifier">$keywords{$_}</span>) <span class="Statement">for</span> (<span class="Statement">keys</span> <span class="Identifier">%keyword_categories</span>);<br/></li>
<li><a href="#L26" title="parser/check_keywords.pl:26">check_alphabetical_order</a>(<span class="Constant">'bare_label_keyword'</span>, \<span class="Identifier">@bare_label_keywords</span>);<br/></li>
<li><br/></li>
<li><span class="Comment"># Transform the keyword lists into hashes.<br/></li>
<li></span><span class="Comment"># kwhashes is a hash of hashes, keyed by keyword category id,<br/></li>
<li></span><span class="Comment"># e.g. UNRESERVED_KEYWORD.<br/></li>
<li></span><span class="Comment"># Each inner hash is keyed by keyword id, e.g. ABORT_P, with a dummy value.<br/></li>
<li></span><span class="Statement">my</span> <span class="Identifier">%kwhashes</span>;<br/></li>
<li><span class="Statement">while</span> (<span class="Statement">my</span> (<span class="Identifier">$kcat</span>, <span class="Identifier">$kcat_id</span>) = <span class="Statement">each</span>(<span class="Identifier">%keyword_categories</span>))<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">@arr</span> = <span class="Identifier">@{</span><span class="perlVarBlock"> </span><span class="Identifier">$keywords{$kcat}</span><span class="perlVarBlock"> </span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> <span class="Identifier">$hash</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$item</span> (<span class="Identifier">@arr</span>) { <span class="Identifier">$hash-&gt;{$item}</span> = <span class="Constant">1</span>; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">$kwhashes{$kcat_id}</span> = <span class="Identifier">$hash</span>;<br/></li>
<li>}<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%bare_label_keywords</span> = <span class="Statement">map</span> <span class="Statement">{</span> <span class="Identifier">$_</span> =&gt; <span class="Constant">1</span> <span class="Statement">}</span> <span class="Identifier">@bare_label_keywords</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Now read in kwlist.h<br/></li>
<li></span><br/></li>
<li><span class="Statement">open</span>(<span class="Statement">my</span> <span class="Identifier">$kwlist</span>, <span class="Constant">'&lt;'</span>, <span class="Identifier">$kwlist_filename</span>)<br/></li>
<li>&nbsp; || <span class="Statement">die</span>(<span class="Constant">&quot;Could not open : </span><span class="Identifier">$kwlist_filename</span><span class="Constant">&quot;</span>);<br/></li>
<li><br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$prevkwstring</span> = <span class="Constant">''</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">$bare_kwname</span>;<br/></li>
<li><span class="Statement">my</span> <span class="Identifier">%kwhash</span>;<br/></li>
<li><span class="Statement">kwlist_line:</span> <span class="Statement">while</span> (&lt;<span class="Identifier">$kwlist</span>&gt;)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$line</span>) = <span class="Identifier">$_</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$line</span> =~ <span class="Statement">/</span><span class="Constant">^PG_KEYWORD</span><span class="Special">\(\&quot;(.*)\&quot;</span><span class="Constant">, </span><span class="Special">(.*)</span><span class="Constant">, </span><span class="Special">(.*)</span><span class="Constant">, </span><span class="Special">(.*)\)</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$kwstring</span>) = <span class="Identifier">$1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$kwname</span>) = <span class="Identifier">$2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$kwcat_id</span>) = <span class="Identifier">$3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">my</span> (<span class="Identifier">$collabel</span>) = <span class="Identifier">$4</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Check that the list is in alphabetical order (critical!)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$kwstring</span> <span class="Statement">le</span> <span class="Identifier">$prevkwstring</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;'</span><span class="Identifier">$kwstring</span><span class="Constant">' after '</span><span class="Identifier">$prevkwstring</span><span class="Constant">' in kwlist.h is misplaced&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$prevkwstring</span> = <span class="Identifier">$kwstring</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Check that the keyword string is valid: all lower-case ASCII chars<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$kwstring</span> !~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">[a-z_]+</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;'</span><span class="Identifier">$kwstring</span><span class="Constant">' is not a valid keyword string, must be all lower-case ASCII chars&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Check that the keyword name is valid: all upper-case ASCII chars<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$kwname</span> !~ <span class="Statement">/</span><span class="Constant">^</span><span class="Special">[A-Z_]+</span><span class="Constant">$</span><span class="Statement">/</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;'</span><span class="Identifier">$kwname</span><span class="Constant">' is not a valid keyword name, must be all upper-case ASCII chars&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Check that the keyword string matches keyword name<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$bare_kwname</span> = <span class="Identifier">$kwname</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">$bare_kwname</span> =~ <span class="Statement">s/</span><span class="Constant">_P$</span><span class="Statement">//</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$bare_kwname</span> <span class="Statement">ne</span> <span class="Statement">uc</span>(<span class="Identifier">$kwstring</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;keyword name '</span><span class="Identifier">$kwname</span><span class="Constant">' doesn't match keyword string '</span><span class="Identifier">$kwstring</span><span class="Constant">'&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Check that the keyword is present in the right category list<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Identifier">%kwhash</span> = <span class="Identifier">%{</span><span class="perlVarBlock2"> </span><span class="Identifier">$kwhashes{$kwcat_id}</span><span class="perlVarBlock2"> </span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(<span class="Identifier">%kwhash</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a> <span class="Constant">&quot;Unknown keyword category: </span><span class="Identifier">$kwcat_id</span><span class="Constant">&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(<span class="Identifier">$kwhash{$kwname}</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a> <span class="Constant">&quot;'</span><span class="Identifier">$kwname</span><span class="Constant">' not present in </span><span class="Identifier">$kwcat_id</span><span class="Constant"> section of gram.y&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Remove it from the hash, so that we can<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># complain at the end if there's keywords left<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># that were not found in kwlist.h<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">delete</span> <span class="Identifier">$kwhashes{$kwcat_id}-&gt;{$kwname}</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment"># Check that the keyword's collabel property matches gram.y<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$collabel</span> <span class="Statement">eq</span> <span class="Constant">'BARE_LABEL'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">unless</span> (<span class="Identifier">$bare_label_keywords{$kwname}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;'</span><span class="Identifier">$kwname</span><span class="Constant">' is marked as BARE_LABEL in kwlist.h, but it is missing from gram.y's bare_label_keyword rule&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">elsif</span> (<span class="Identifier">$collabel</span> <span class="Statement">eq</span> <span class="Constant">'AS_LABEL'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<span class="Identifier">$bare_label_keywords{$kwname}</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;'</span><span class="Identifier">$kwname</span><span class="Constant">' is marked as AS_LABEL in kwlist.h, but it is listed in gram.y's bare_label_keyword rule&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;'</span><span class="Identifier">$collabel</span><span class="Constant">' not recognized in kwlist.h.&nbsp; Expected either 'BARE_LABEL' or 'AS_LABEL'&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><span class="Statement">close</span> <span class="Identifier">$kwlist</span>;<br/></li>
<li><br/></li>
<li><span class="Comment"># Check that we've paired up all keywords from gram.y with lines in kwlist.h<br/></li>
<li></span><span class="Statement">while</span> (<span class="Statement">my</span> (<span class="Identifier">$kwcat</span>, <span class="Identifier">$kwcat_id</span>) = <span class="Statement">each</span>(<span class="Identifier">%keyword_categories</span>))<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Identifier">%kwhash</span> = <span class="Identifier">%{</span><span class="perlVarBlock2"> </span><span class="Identifier">$kwhashes{$kwcat_id}</span><span class="perlVarBlock2"> </span><span class="Identifier">}</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> <span class="Statement">my</span> <span class="Identifier">$kw</span> (<span class="Statement">keys</span> <span class="Identifier">%kwhash</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L17" title="parser/check_keywords.pl:17">error</a> <span class="Constant">&quot;'</span><span class="Identifier">$kw</span><span class="Constant">' found in gram.y </span><span class="Identifier">$kwcat</span><span class="Constant"> category, but not in kwlist.h&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Statement">exit</span> <span class="Identifier">$errors</span>;<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
