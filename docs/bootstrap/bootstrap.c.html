<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>bootstrap/bootstrap.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>bootstrap/bootstrap.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L150">Ap</a></li>
<li><a href="#L171">ILHead</a></li>
<li><a href="#L153">Nulls</a></li>
<li><a href="#L149">Typ</a></li>
<li><a href="#L88">TypInfo</a></li>
<li><a href="#L61">attrtypes</a></li>
<li><a href="#L59">boot_reldesc</a></li>
<li><a href="#L44">bootstrap_data_checksum_version</a></li>
<li><a href="#L141">n_types</a></li>
<li><a href="#L155">nogc</a></li>
<li><a href="#L62">numattr</a></li>
<li><a href="#L152">values</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L169">IndexList</a></li>
<li><a href="#L163">_IndexList</a></li>
<li><a href="#L74">typinfo</a></li>
<li><a href="#L143">typmap</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L883">AllocateAttribute</a></li>
<li><a href="#L199">BootstrapModeMain</a></li>
<li><a href="#L181">CheckerModeMain</a></li>
<li><a href="#L490">DefineAttr</a></li>
<li><a href="#L664">InsertOneNull</a></li>
<li><a href="#L598">InsertOneTuple</a></li>
<li><a href="#L626">InsertOneValue</a></li>
<li><a href="#L806">boot_get_type_io_data</a></li>
<li><a href="#L408">boot_openrel</a></li>
<li><a href="#L381">bootstrap_signals</a></li>
<li><a href="#L951">build_indices</a></li>
<li><a href="#L682">cleanup</a></li>
<li><a href="#L453">closerel</a></li>
<li><a href="#L735">gettype</a></li>
<li><a href="#L901">index_register</a></li>
<li><a href="#L695">populate_typ_list</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * bootstrap.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; routines to support running postgres in 'bootstrap' mode<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; bootstrap mode is used to create the initial template database<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/bootstrap/bootstrap.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;unistd.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;signal.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;access/genam.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/heapam.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/htup_details.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/tableam.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/toast_compression.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;access/xact.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;bootstrap/bootstrap.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/index.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_collation.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_type.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;common/link-canary.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;miscadmin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;nodes/makefuncs.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;pg_getopt.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/bufpage.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/ipc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;storage/proc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/builtins.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/fmgroids.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/guc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/memutils.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/rel.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/relmapper.h&quot;<br/></li>
<li></span><br/></li>
<li><a id="L44">&#x200c;</a>uint32&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">bootstrap_data_checksum_version</span> = <span class="Constant">0</span>;&nbsp; &nbsp; <span class="Comment">/* No checksum */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L181" title="bootstrap/bootstrap.c:181">CheckerModeMain</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L381" title="bootstrap/bootstrap.c:381">bootstrap_signals</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">static</span> Form_pg_attribute <a href="#L883" title="bootstrap/bootstrap.c:883">AllocateAttribute</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L695" title="bootstrap/bootstrap.c:695">populate_typ_list</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">static</span> Oid&nbsp; &nbsp; <a href="#L735" title="bootstrap/bootstrap.c:735">gettype</a>(<span class="Type">char</span> *type);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="../regex/regc_nfa.c.html#L2929" title="regex/regc_nfa.c:2929">cleanup</a>(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; global variables<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a id="L59">&#x200c;</a>Relation&nbsp; &nbsp; <span class="linkable">boot_reldesc</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* current relation descriptor */<br/></li>
<li></span><br/></li>
<li><a id="L61">&#x200c;</a>Form_pg_attribute <span class="linkable">attrtypes</span>[MAXATTR];&nbsp; &nbsp; <span class="Comment">/* points to attribute info */<br/></li>
<li><a id="L62">&#x200c;</a></span><span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">numattr</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* number of attributes for cur. rel */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Basic information associated with each type.&nbsp; This is used <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a><br/></li>
<li></span><span class="Comment"> * pg_type is filled, so it has to cover the datatypes used as column types<br/></li>
<li></span><span class="Comment"> * in the core &quot;bootstrapped&quot; catalogs.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Todo">XXX</span><span class="Comment"> several of these input/output <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> do catalog scans<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (e.g., F_REGPROCIN scans pg_proc).&nbsp; this obviously creates some<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; order dependencies in the catalog creation process.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L74">&#x200c;</a></span><span class="Type">struct</span> <span class="linkable">typinfo</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; name[NAMEDATALEN];<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oid;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elem;<br/></li>
<li>&nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; byval;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; align;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; storage;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collation;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inproc;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; outproc;<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><a id="L88">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">struct</span> <a href="#L74" title="bootstrap/bootstrap.c:74">typinfo</a> <span class="linkable">TypInfo</span>[] = {<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;<a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a>&quot;</span>, BOOLOID, <span class="Constant">0</span>, <span class="Constant">1</span>, <span class="Constant">true</span>, TYPALIGN_CHAR, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_BOOLIN, F_BOOLOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;bytea&quot;</span>, BYTEAOID, <span class="Constant">0</span>, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_BYTEAIN, F_BYTEAOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;char&quot;</span>, CHAROID, <span class="Constant">0</span>, <span class="Constant">1</span>, <span class="Constant">true</span>, TYPALIGN_CHAR, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_CHARIN, F_CHAROUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;int2&quot;</span>, INT2OID, <span class="Constant">0</span>, <span class="Constant">2</span>, <span class="Constant">true</span>, TYPALIGN_SHORT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_INT2IN, F_INT2OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;int4&quot;</span>, INT4OID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_INT4IN, F_INT4OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;float4&quot;</span>, FLOAT4OID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_FLOAT4IN, F_FLOAT4OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;name&quot;</span>, NAMEOID, CHAROID, NAMEDATALEN, <span class="Constant">false</span>, TYPALIGN_CHAR, TYPSTORAGE_PLAIN, C_COLLATION_OID,<br/></li>
<li>&nbsp; &nbsp; F_NAMEIN, F_NAMEOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;regclass&quot;</span>, REGCLASSOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_REGCLASSIN, F_REGCLASSOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;regproc&quot;</span>, REGPROCOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_REGPROCIN, F_REGPROCOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;regtype&quot;</span>, REGTYPEOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_REGTYPEIN, F_REGTYPEOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;regrole&quot;</span>, REGROLEOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_REGROLEIN, F_REGROLEOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;regnamespace&quot;</span>, REGNAMESPACEOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_REGNAMESPACEIN, F_REGNAMESPACEOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;text&quot;</span>, TEXTOID, <span class="Constant">0</span>, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, DEFAULT_COLLATION_OID,<br/></li>
<li>&nbsp; &nbsp; F_TEXTIN, F_TEXTOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;oid&quot;</span>, OIDOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_OIDIN, F_OIDOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;tid&quot;</span>, TIDOID, <span class="Constant">0</span>, <span class="Constant">6</span>, <span class="Constant">false</span>, TYPALIGN_SHORT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_TIDIN, F_TIDOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;xid&quot;</span>, XIDOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_XIDIN, F_XIDOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;cid&quot;</span>, CIDOID, <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">true</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_CIDIN, F_CIDOUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;<a href="../utils/adt/pseudotypes.c.html#L334" title="utils/adt/pseudotypes.c:334">pg_node_tree</a>&quot;</span>, PG_NODE_TREEOID, <span class="Constant">0</span>, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, DEFAULT_COLLATION_OID,<br/></li>
<li>&nbsp; &nbsp; F_PG_NODE_TREE_IN, F_PG_NODE_TREE_OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;int2vector&quot;</span>, INT2VECTOROID, INT2OID, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_INT2VECTORIN, F_INT2VECTOROUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;oidvector&quot;</span>, OIDVECTOROID, OIDOID, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_PLAIN, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_OIDVECTORIN, F_OIDVECTOROUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;_int4&quot;</span>, INT4ARRAYOID, INT4OID, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_ARRAY_IN, F_ARRAY_OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;_text&quot;</span>, <span class="Constant">1009</span>, TEXTOID, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, DEFAULT_COLLATION_OID,<br/></li>
<li>&nbsp; &nbsp; F_ARRAY_IN, F_ARRAY_OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;_oid&quot;</span>, <span class="Constant">1028</span>, OIDOID, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_ARRAY_IN, F_ARRAY_OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;_char&quot;</span>, <span class="Constant">1002</span>, CHAROID, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_ARRAY_IN, F_ARRAY_OUT},<br/></li>
<li>&nbsp; &nbsp; {<span class="Constant">&quot;_aclitem&quot;</span>, <span class="Constant">1034</span>, ACLITEMOID, -<span class="Constant">1</span>, <span class="Constant">false</span>, TYPALIGN_INT, TYPSTORAGE_EXTENDED, InvalidOid,<br/></li>
<li>&nbsp; &nbsp; F_ARRAY_IN, F_ARRAY_OUT}<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><a id="L141">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">int</span> <span class="linkable">n_types</span> = <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>) / <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> <a href="#L74" title="bootstrap/bootstrap.c:74">typinfo</a>);<br/></li>
<li><br/></li>
<li><a id="L143">&#x200c;</a><span class="Type">struct</span> <span class="linkable">typmap</span><br/></li>
<li>{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* a hack */<br/></li>
<li></span>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; am_oid;<br/></li>
<li>&nbsp; &nbsp; FormData_pg_type am_typ;<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><a id="L149">&#x200c;</a><span class="Type">static</span> List *<span class="linkable">Typ</span> = NIL;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* List of struct <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a>* */<br/></li>
<li><a id="L150">&#x200c;</a></span><span class="Type">static</span> <span class="Type">struct</span> <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a> *<span class="linkable">Ap</span> = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><a id="L152">&#x200c;</a><span class="Type">static</span> Datum <span class="linkable">values</span>[MAXATTR];&nbsp; &nbsp; <span class="Comment">/* current row's attribute <span class="linkable">values</span> */<br/></li>
<li><a id="L153">&#x200c;</a></span><span class="Type">static</span> <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <span class="linkable">Nulls</span>[MAXATTR];<br/></li>
<li><br/></li>
<li><a id="L155">&#x200c;</a><span class="Type">static</span> MemoryContext <span class="linkable">nogc</span> = <span class="Constant">NULL</span>;&nbsp; &nbsp; <span class="Comment">/* special no-gc mem context */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; At bootstrap time, we first declare all the indices to be built, and<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; then build them.&nbsp; The <a href="#L169" title="bootstrap/bootstrap.c:169">IndexList</a> structure stores enough information<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; to allow us to build the indices after they've been declared.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a id="L163">&#x200c;</a><span class="Type">typedef</span> <span class="Type">struct</span> <span class="linkable">_IndexList</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; il_heap;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; il_ind;<br/></li>
<li>&nbsp; &nbsp; IndexInfo&nbsp; *il_info;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L163" title="bootstrap/bootstrap.c:163">_IndexList</a> *il_next;<br/></li>
<li><a id="L169">&#x200c;</a>} <span class="linkable">IndexList</span>;<br/></li>
<li><br/></li>
<li><a id="L171">&#x200c;</a><span class="Type">static</span> <a href="#L169" title="bootstrap/bootstrap.c:169">IndexList</a> *<span class="linkable">ILHead</span> = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * In shared memory checker mode, all we really want to do is create shared<br/></li>
<li></span><span class="Comment"> * memory and semaphores (just to prove we can do it with the current GUC<br/></li>
<li></span><span class="Comment"> * settings).&nbsp; Since, in fact, that was already done by<br/></li>
<li></span><span class="Comment"> * <a href="../storage/ipc/ipci.c.html#L199" title="storage/ipc/ipci.c:199">CreateSharedMemoryAndSemaphores</a>(), we have nothing more to do here.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L181">&#x200c;</a></span><span class="linkable">CheckerModeMain</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../storage/ipc/ipc.c.html#L104" title="storage/ipc/ipc.c:104">proc_exit</a>(<span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; The <a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a> entry point for running the backend in bootstrap mode<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; The bootstrap mode is used to <a href="../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> the template database.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; The bootstrap backend doesn't speak SQL, but instead expects<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; commands in a special bootstrap language.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; When check_only is true, startup is done only far enough to verify that<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; the current configuration, particularly the passed in options pertaining<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; to shared memory sizing, options work (or at least do not cause an error<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; up to shared memory creation).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L199">&#x200c;</a></span><span class="linkable">BootstrapModeMain</span>(<span class="Type">int</span> argc, <span class="Type">char</span> *argv[], <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> check_only)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *<a href="../main/main.c.html#L44" title="main/main.c:44">progname</a> = argv[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *<a href="../tcop/postgres.c.html#L161" title="tcop/postgres.c:161">userDoption</a> = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(!<a href="../utils/init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/init/miscinit.c.html#L181" title="utils/init/miscinit.c:181">InitStandaloneProcess</a>(argv[<span class="Constant">0</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Set defaults, to be overridden by explicit options below */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L1532" title="utils/misc/guc.c:1532">InitializeGUCOptions</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* an initial --boot or --check should be present */<br/></li>
<li></span>&nbsp; &nbsp; Assert(argc &gt; <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;&amp; (strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--boot&quot;</span>) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; || strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--check&quot;</span>) == <span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; argv++;<br/></li>
<li>&nbsp; &nbsp; argc--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((flag = getopt(argc, argv, <span class="Constant">&quot;B:c:d:D:Fkr:X:-:&quot;</span>)) != -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (flag)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'B'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(<span class="Constant">&quot;shared_buffers&quot;</span>, optarg, PGC_POSTMASTER, PGC_S_ARGV);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'c'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'-'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *name,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L6321" title="utils/misc/guc.c:6321">ParseLongOption</a>(optarg, &amp;name, &amp;value);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!value)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flag == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;--</span><span class="Special">%s</span><span class="Constant"> requires a value&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; optarg)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_SYNTAX_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;-c </span><span class="Special">%s</span><span class="Constant"> requires a value&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; optarg)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(name, value, PGC_POSTMASTER, PGC_S_ARGV);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(value);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'D'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../tcop/postgres.c.html#L161" title="tcop/postgres.c:161">userDoption</a> = <a href="../utils/mmgr/mcxt.c.html#L1695" title="utils/mmgr/mcxt.c:1695">pstrdup</a>(optarg);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'d'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Turn on debugging for the bootstrap process. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *debugstr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; debugstr = psprintf(<span class="Constant">&quot;debug</span><span class="Special">%s</span><span class="Constant">&quot;</span>, optarg);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(<span class="Constant">&quot;<a href="../utils/misc/guc_tables.c.html#L524" title="utils/misc/guc_tables.c:524">log_min_messages</a>&quot;</span>, debugstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PGC_POSTMASTER, PGC_S_ARGV);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(<span class="Constant">&quot;<a href="../utils/misc/guc_tables.c.html#L525" title="utils/misc/guc_tables.c:525">client_min_messages</a>&quot;</span>, debugstr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PGC_POSTMASTER, PGC_S_ARGV);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(debugstr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'F'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(<span class="Constant">&quot;fsync&quot;</span>, <span class="Constant">&quot;false&quot;</span>, PGC_POSTMASTER, PGC_S_ARGV);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'k'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L44" title="bootstrap/bootstrap.c:44">bootstrap_data_checksum_version</a> = PG_DATA_CHECKSUM_VERSION;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'r'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strlcpy(<a href="../utils/init/globals.c.html#L76" title="utils/init/globals.c:76">OutputFileName</a>, optarg, MAXPGPATH);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'X'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/guc.c.html#L4285" title="utils/misc/guc.c:4285">SetConfigOption</a>(<span class="Constant">&quot;<a href="../access/transam/xlog.c.html#L143" title="access/transam/xlog.c:143">wal_segment_size</a>&quot;</span>, optarg, PGC_INTERNAL, PGC_S_DYNAMIC_DEFAULT);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;Try </span><span class="Special">\&quot;%s</span><span class="Constant"> --<a href="../main/main.c.html#L320" title="main/main.c:320">help</a></span><span class="Special">\&quot;</span><span class="Constant"> for more information.</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../main/main.c.html#L44" title="main/main.c:44">progname</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../storage/ipc/ipc.c.html#L104" title="storage/ipc/ipc.c:104">proc_exit</a>(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (argc != optind)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">: invalid command-line arguments</span><span class="Special">\n</span><span class="Constant">&quot;</span>, <a href="../main/main.c.html#L44" title="main/main.c:44">progname</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../storage/ipc/ipc.c.html#L104" title="storage/ipc/ipc.c:104">proc_exit</a>(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Acquire configuration parameters */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../utils/misc/guc.c.html#L1786" title="utils/misc/guc.c:1786">SelectConfigFiles</a>(<a href="../tcop/postgres.c.html#L161" title="tcop/postgres.c:161">userDoption</a>, <a href="../main/main.c.html#L44" title="main/main.c:44">progname</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../storage/ipc/ipc.c.html#L104" title="storage/ipc/ipc.c:104">proc_exit</a>(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Validate we have been given a reasonable-looking <a href="../utils/init/globals.c.html#L68" title="utils/init/globals.c:68">DataDir</a> and change<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * into it<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../utils/init/miscinit.c.html#L341" title="utils/init/miscinit.c:341">checkDataDir</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/init/miscinit.c.html#L454" title="utils/init/miscinit.c:454">ChangeToDataDir</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/init/miscinit.c.html#L1455" title="utils/init/miscinit.c:1455">CreateDataDirLockFile</a>(<span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; SetProcessingMode(BootstrapProcessing);<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/init/miscinit.c.html#L80" title="utils/init/miscinit.c:80">IgnoreSystemIndexes</a> = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/init/postinit.c.html#L575" title="utils/init/postinit.c:575">InitializeMaxBackends</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../storage/ipc/ipci.c.html#L199" title="storage/ipc/ipci.c:199">CreateSharedMemoryAndSemaphores</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * </span><span class="Todo">XXX</span><span class="Comment">: It might make sense to move this into its own function at some<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * point. Right <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> it seems like it'd cause more code duplication than<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * it's worth.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (check_only)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; SetProcessingMode(NormalProcessing);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L181" title="bootstrap/bootstrap.c:181">CheckerModeMain</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; abort();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Do backend-like initialization for bootstrap mode<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../storage/lmgr/proc.c.html#L296" title="storage/lmgr/proc.c:296">InitProcess</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/init/postinit.c.html#L645" title="utils/init/postinit.c:645">BaseInit</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L381" title="bootstrap/bootstrap.c:381">bootstrap_signals</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../access/transam/xlog.c.html#L5000" title="access/transam/xlog.c:5000">BootStrapXLOG</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * To ensure that src/common/link-canary.c is linked into the backend, we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * must call it from somewhere.&nbsp; Here is as good as anywhere.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (pg_link_canary_is_frontend())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;backend is incorrectly linked to frontend <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a>&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/init/postinit.c.html#L736" title="utils/init/postinit.c:736">InitPostgres</a>(<span class="Constant">NULL</span>, InvalidOid, <span class="Constant">NULL</span>, InvalidOid, <span class="Constant">0</span>, <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Initialize stuff for bootstrap-file processing */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; MAXATTR; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[i] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L153" title="bootstrap/bootstrap.c:153">Nulls</a>[i] = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Process bootstrap input.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../access/transam/xact.c.html#L2995" title="access/transam/xact.c:2995">StartTransactionCommand</a>();<br/></li>
<li>&nbsp; &nbsp; boot_yyparse();<br/></li>
<li>&nbsp; &nbsp; <a href="../access/transam/xact.c.html#L3093" title="access/transam/xact.c:3093">CommitTransactionCommand</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We should <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> know about all mapped relations, so it's okay to write<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * out the initial relation mapping files.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../utils/cache/relmapper.c.html#L625" title="utils/cache/relmapper.c:625">RelationMapFinishBootstrap</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Clean up and exit */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../regex/regc_nfa.c.html#L2929" title="regex/regc_nfa.c:2929">cleanup</a>();<br/></li>
<li>&nbsp; &nbsp; <a href="../storage/ipc/ipc.c.html#L104" title="storage/ipc/ipc.c:104">proc_exit</a>(<span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; misc <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a><br/></li>
<li></span><span class="Comment"> * ----------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Set up signal handling for a bootstrap process<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L381">&#x200c;</a></span><span class="linkable">bootstrap_signals</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Assert(!<a href="../utils/init/globals.c.html#L117" title="utils/init/globals.c:117">IsUnderPostmaster</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We don't actually need <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> non-default signal handling in bootstrap<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * mode; &quot;curl up and <a href="../tcop/postgres.c.html#L2972" title="tcop/postgres.c:2972">die</a>&quot; is a sufficient response for all these cases.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Let's set that handling explicitly, as documentation if nothing else.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; pqsignal(<span class="Constant">SIGHUP</span>, <span class="Constant">SIG_DFL</span>);<br/></li>
<li>&nbsp; &nbsp; pqsignal(<span class="Constant">SIGINT</span>, <span class="Constant">SIG_DFL</span>);<br/></li>
<li>&nbsp; &nbsp; pqsignal(<span class="Constant">SIGTERM</span>, <span class="Constant">SIG_DFL</span>);<br/></li>
<li>&nbsp; &nbsp; pqsignal(<span class="Constant">SIGQUIT</span>, <span class="Constant">SIG_DFL</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MANUAL BACKEND INTERACTIVE INTERFACE COMMANDS<br/></li>
<li></span><span class="Comment"> * ----------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L408" title="bootstrap/bootstrap.c:408">boot_openrel</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Execute BKI OPEN command.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L408">&#x200c;</a></span><span class="linkable">boot_openrel</span>(<span class="Type">char</span> *relname)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (strlen(relname) &gt;= NAMEDATALEN)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; relname[NAMEDATALEN - <span class="Constant">1</span>] = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * pg_type must be filled <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> OPEN command is executed, hence we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * can <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> populate <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> if we haven't yet.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> == NIL)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L695" title="bootstrap/bootstrap.c:695">populate_typ_list</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a> != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L453" title="bootstrap/bootstrap.c:453">closerel</a>(<span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;open relation </span><span class="Special">%s</span><span class="Constant">, attrsize </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; relname, (<span class="Type">int</span>) ATTRIBUTE_FIXED_PART_SIZE);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a> = <a href="../access/table/table.c.html#L83" title="access/table/table.c:83">table_openrv</a>(<a href="../nodes/makefuncs.c.html#L424" title="nodes/makefuncs.c:424">makeRangeVar</a>(<span class="Constant">NULL</span>, relname, -<span class="Constant">1</span>), NoLock);<br/></li>
<li>&nbsp; &nbsp; <a href="#L62" title="bootstrap/bootstrap.c:62">numattr</a> = RelationGetNumberOfAttributes(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L62" title="bootstrap/bootstrap.c:62">numattr</a>; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[i] == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[i] = <a href="#L883" title="bootstrap/bootstrap.c:883">AllocateAttribute</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memmove((<span class="Type">char</span> *) <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[i],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">char</span> *) TupleDescAttr(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>-&gt;rd_att, i),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ATTRIBUTE_FIXED_PART_SIZE);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Form_pg_attribute at = <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;create attribute </span><span class="Special">%d</span><span class="Constant"> name </span><span class="Special">%s</span><span class="Constant"> len </span><span class="Special">%d</span><span class="Constant"> num </span><span class="Special">%d</span><span class="Constant"> type </span><span class="Special">%u</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i, NameStr(at-&gt;attname), at-&gt;attlen, at-&gt;attnum,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; at-&gt;atttypid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L453" title="bootstrap/bootstrap.c:453">closerel</a><br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L453">&#x200c;</a></span><span class="linkable">closerel</span>(<span class="Type">char</span> *relname)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (relname)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(RelationGetRelationName(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>), relname) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;close of </span><span class="Special">%s</span><span class="Constant"> when </span><span class="Special">%s</span><span class="Constant"> was expected&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; relname, RelationGetRelationName(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;close of </span><span class="Special">%s</span><span class="Constant"> <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> relation was opened&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; relname);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a> == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;no open relation to close&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;close relation </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; RelationGetRelationName(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../access/table/table.c.html#L126" title="access/table/table.c:126">table_close</a>(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>, NoLock);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a> = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> * DEFINEATTR()<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * define a &lt;field,type&gt; pair<br/></li>
<li></span><span class="Comment"> * if there are n fields in a relation to be created, this routine<br/></li>
<li></span><span class="Comment"> * will be called n times<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L490">&#x200c;</a></span><span class="linkable">DefineAttr</span>(<span class="Type">char</span> *name, <span class="Type">char</span> *type, <span class="Type">int</span> attnum, <span class="Type">int</span> nullness)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typeoid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a> != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(WARNING, <span class="Constant">&quot;no open relations allowed with CREATE command&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L453" title="bootstrap/bootstrap.c:453">closerel</a>(<span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum] == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum] = <a href="#L883" title="bootstrap/bootstrap.c:883">AllocateAttribute</a>();<br/></li>
<li>&nbsp; &nbsp; MemSet(<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum], <span class="Constant">0</span>, ATTRIBUTE_FIXED_PART_SIZE);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/adt/name.c.html#L233" title="utils/adt/name.c:233">namestrcpy</a>(&amp;<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attname, name);<br/></li>
<li>&nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;column </span><span class="Special">%s</span><span class="Constant"> </span><span class="Special">%s</span><span class="Constant">&quot;</span>, NameStr(<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attname), type);<br/></li>
<li>&nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attnum = attnum + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; typeoid = <a href="#L735" title="bootstrap/bootstrap.c:735">gettype</a>(type);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> != NIL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;atttypid = <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_oid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attlen = <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_typ.typlen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attbyval = <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_typ.typbyval;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attalign = <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_typ.typalign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attstorage = <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_typ.typstorage;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attcompression = InvalidCompressionMethod;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attcollation = <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_typ.typcollation;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* if an array type, assume 1-dimensional attribute */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_typ.typelem != InvalidOid &amp;&amp; <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a>-&gt;am_typ.typlen &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attndims = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attndims = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;atttypid = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeoid].oid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attlen = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeoid].len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attbyval = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeoid].byval;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attalign = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeoid].align;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attstorage = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeoid].storage;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attcompression = InvalidCompressionMethod;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attcollation = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeoid].collation;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* if an array type, assume 1-dimensional attribute */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeoid].elem != InvalidOid &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attlen &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attndims = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attndims = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If a system catalog column is collation-aware, force it to use C<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * collation, so that its behavior is independent of the database's<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * collation.&nbsp; This is essential to allow template0 to be cloned with a<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * different database collation.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (OidIsValid(<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attcollation))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attcollation = C_COLLATION_OID;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attcacheoff = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;atttypmod = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attislocal = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (nullness == BOOTCOL_NULL_FORCE_NOT_NULL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attnotnull = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (nullness == BOOTCOL_NULL_FORCE_NULL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attnotnull = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Assert(nullness == BOOTCOL_NULL_AUTO);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Mark as &quot;not null&quot; if type is fixed-width and prior columns are<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * likewise fixed-width and not-null.&nbsp; This corresponds to case where<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * column can be accessed directly via C struct declaration.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attlen &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* check earlier attributes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; attnum; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[i]-&gt;attlen &lt;= <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !<a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[i]-&gt;attnotnull)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i == attnum)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>[attnum]-&gt;attnotnull = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L598" title="bootstrap/bootstrap.c:598">InsertOneTuple</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If objectid is not zero, it is a specific OID to assign to the tuple.<br/></li>
<li></span><span class="Comment"> * Otherwise, an OID will be assigned (if necessary) by <a href="../access/heap/heapam.c.html#L1990" title="access/heap/heapam.c:1990">heap_insert</a>.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L598">&#x200c;</a></span><span class="linkable">InsertOneTuple</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; HeapTuple&nbsp; &nbsp; tuple;<br/></li>
<li>&nbsp; &nbsp; TupleDesc&nbsp; &nbsp; tupDesc;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;inserting row with </span><span class="Special">%d</span><span class="Constant"> columns&quot;</span>, <a href="#L62" title="bootstrap/bootstrap.c:62">numattr</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; tupDesc = <a href="../access/common/tupdesc.c.html#L112" title="access/common/tupdesc.c:112">CreateTupleDesc</a>(<a href="#L62" title="bootstrap/bootstrap.c:62">numattr</a>, <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a>);<br/></li>
<li>&nbsp; &nbsp; tuple = <a href="../access/common/heaptuple.c.html#L1116" title="access/common/heaptuple.c:1116">heap_form_tuple</a>(tupDesc, <a href="#L152" title="bootstrap/bootstrap.c:152">values</a>, <a href="#L153" title="bootstrap/bootstrap.c:153">Nulls</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(tupDesc);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* just free's tupDesc, not the <a href="#L61" title="bootstrap/bootstrap.c:61">attrtypes</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../access/heap/heapam.c.html#L2621" title="access/heap/heapam.c:2621">simple_heap_insert</a>(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>, tuple);<br/></li>
<li>&nbsp; &nbsp; <a href="../access/common/heaptuple.c.html#L1434" title="access/common/heaptuple.c:1434">heap_freetuple</a>(tuple);<br/></li>
<li>&nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;row inserted&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Reset null markers for <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> tuple<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L62" title="bootstrap/bootstrap.c:62">numattr</a>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L153" title="bootstrap/bootstrap.c:153">Nulls</a>[i] = <span class="Constant">false</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L626" title="bootstrap/bootstrap.c:626">InsertOneValue</a><br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L626">&#x200c;</a></span><span class="linkable">InsertOneValue</span>(<span class="Type">char</span> *value, <span class="Type">int</span> i)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typoid;<br/></li>
<li>&nbsp; &nbsp; int16&nbsp; &nbsp; &nbsp; &nbsp; typlen;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; typbyval;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; typalign;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; typdelim;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typioparam;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typinput;<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typoutput;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(i &gt;= <span class="Constant">0</span> &amp;&amp; i &lt; MAXATTR);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;inserting column </span><span class="Special">%d</span><span class="Constant"> value </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, i, value);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; typoid = TupleDescAttr(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>-&gt;rd_att, i)-&gt;atttypid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L806" title="bootstrap/bootstrap.c:806">boot_get_type_io_data</a>(typoid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;typlen, &amp;typbyval, &amp;typalign,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;typdelim, &amp;typioparam,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;typinput, &amp;typoutput);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L152" title="bootstrap/bootstrap.c:152">values</a>[i] = <a href="../utils/fmgr/fmgr.c.html#L1754" title="utils/fmgr/fmgr.c:1754">OidInputFunctionCall</a>(typinput, value, typioparam, -<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We use ereport not elog here so that parameters aren't evaluated unless<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the message is going to be printed, which generally it isn't<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; ereport(DEBUG4,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L1159" title="utils/error/elog.c:1159">errmsg_internal</a>(<span class="Constant">&quot;inserted -&gt; </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/fmgr/fmgr.c.html#L1763" title="utils/fmgr/fmgr.c:1763">OidOutputFunctionCall</a>(typoutput, <a href="#L152" title="bootstrap/bootstrap.c:152">values</a>[i]))));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L664" title="bootstrap/bootstrap.c:664">InsertOneNull</a><br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L664">&#x200c;</a></span><span class="linkable">InsertOneNull</span>(<span class="Type">int</span> i)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;inserting column </span><span class="Special">%d</span><span class="Constant"> NULL&quot;</span>, i);<br/></li>
<li>&nbsp; &nbsp; Assert(i &gt;= <span class="Constant">0</span> &amp;&amp; i &lt; MAXATTR);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (TupleDescAttr(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>-&gt;rd_att, i)-&gt;attnotnull)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;NULL value specified for not-null column </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> of relation </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; NameStr(TupleDescAttr(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>-&gt;rd_att, i)-&gt;attname),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; RelationGetRelationName(<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a>));<br/></li>
<li>&nbsp; &nbsp; <a href="#L152" title="bootstrap/bootstrap.c:152">values</a>[i] = PointerGetDatum(<span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L153" title="bootstrap/bootstrap.c:153">Nulls</a>[i] = <span class="Constant">true</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_nfa.c.html#L2929" title="regex/regc_nfa.c:2929">cleanup</a><br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L682">&#x200c;</a></span><span class="linkable">cleanup</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="bootstrap/bootstrap.c:59">boot_reldesc</a> != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L453" title="bootstrap/bootstrap.c:453">closerel</a>(<span class="Constant">NULL</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L695" title="bootstrap/bootstrap.c:695">populate_typ_list</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Load the <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> list by reading pg_type.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L695">&#x200c;</a></span><span class="linkable">populate_typ_list</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Relation&nbsp; &nbsp; rel;<br/></li>
<li>&nbsp; &nbsp; TableScanDesc scan;<br/></li>
<li>&nbsp; &nbsp; HeapTuple&nbsp; &nbsp; tup;<br/></li>
<li>&nbsp; &nbsp; MemoryContext old;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(<a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> == NIL);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rel = <a href="../access/table/table.c.html#L40" title="access/table/table.c:40">table_open</a>(TypeRelationId, NoLock);<br/></li>
<li>&nbsp; &nbsp; scan = <a href="../access/table/tableam.c.html#L112" title="access/table/tableam.c:112">table_beginscan_catalog</a>(rel, <span class="Constant">0</span>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; old = MemoryContextSwitchTo(<a href="../utils/mmgr/mcxt.c.html#L149" title="utils/mmgr/mcxt.c:149">TopMemoryContext</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((tup = <a href="../access/heap/heapam.c.html#L1248" title="access/heap/heapam.c:1248">heap_getnext</a>(scan, ForwardScanDirection)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Form_pg_type typForm = (Form_pg_type) GETSTRUCT(tup);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a> *newtyp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newtyp = (<span class="Type">struct</span> <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">struct</span> <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> = <a href="../nodes/list.c.html#L339" title="nodes/list.c:339">lappend</a>(<a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a>, newtyp);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; newtyp-&gt;am_oid = typForm-&gt;oid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(&amp;newtyp-&gt;am_typ, typForm, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(newtyp-&gt;am_typ));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(old);<br/></li>
<li>&nbsp; &nbsp; table_endscan(scan);<br/></li>
<li>&nbsp; &nbsp; <a href="../access/table/table.c.html#L126" title="access/table/table.c:126">table_close</a>(rel, NoLock);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L735" title="bootstrap/bootstrap.c:735">gettype</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * NB: this is really ugly; it will return an integer index into <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[],<br/></li>
<li></span><span class="Comment"> * and not an OID at all, until the first reference to a type not known in<br/></li>
<li></span><span class="Comment"> * <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[].&nbsp; At that point it will read and cache pg_type in <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a>,<br/></li>
<li></span><span class="Comment"> * and subsequently return a real OID (and set the global pointer <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a> to<br/></li>
<li></span><span class="Comment"> * point at the found row in <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a>).&nbsp; So caller must check whether <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> is<br/></li>
<li></span><span class="Comment"> * still NIL to determine what the return value is!<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> Oid<br/></li>
<li><a id="L735">&#x200c;</a><span class="linkable">gettype</span>(<span class="Type">char</span> *type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> != NIL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ListCell&nbsp;&nbsp; *lc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; foreach(lc, <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a> *app = lfirst(lc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(NameStr(app-&gt;am_typ.typname), type, NAMEDATALEN) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a> = app;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> app-&gt;am_oid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * The type wasn't known; reload the pg_type contents and check again<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * to handle composite types, added since last populating the list.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../nodes/list.c.html#L1560" title="nodes/list.c:1560">list_free_deep</a>(<a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> = NIL;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L695" title="bootstrap/bootstrap.c:695">populate_typ_list</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Calling <a href="#L735" title="bootstrap/bootstrap.c:735">gettype</a> would result in infinite recursion for types<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * missing in pg_type, so just <a href="../regex/regcomp.c.html#L1584" title="regex/regcomp.c:1584">repeat</a> the lookup.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; foreach(lc, <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a> *app = lfirst(lc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(NameStr(app-&gt;am_typ.typname), type, NAMEDATALEN) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L150" title="bootstrap/bootstrap.c:150">Ap</a> = app;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> app-&gt;am_oid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L141" title="bootstrap/bootstrap.c:141">n_types</a>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strncmp(type, <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[i].name, NAMEDATALEN) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Not in <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>, so we'd better be able to read pg_type <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; elog(DEBUG4, <span class="Constant">&quot;external type: </span><span class="Special">%s</span><span class="Constant">&quot;</span>, type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L695" title="bootstrap/bootstrap.c:695">populate_typ_list</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L735" title="bootstrap/bootstrap.c:735">gettype</a>(type);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized type </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, type);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* not reached, here to make compiler happy */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L806" title="bootstrap/bootstrap.c:806">boot_get_type_io_data</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Obtain type I/O information at bootstrap time.&nbsp; This intentionally has<br/></li>
<li></span><span class="Comment"> * almost the same API as lsyscache.c's <a href="../utils/cache/lsyscache.c.html#L2325" title="utils/cache/lsyscache.c:2325">get_type_io_data</a>, except that<br/></li>
<li></span><span class="Comment"> * we only support obtaining the typinput and typoutput routines, not<br/></li>
<li></span><span class="Comment"> * the binary I/O routines.&nbsp; It is exported so that <a href="../utils/adt/arrayfuncs.c.html#L179" title="utils/adt/arrayfuncs.c:179">array_in</a> and <a href="../utils/adt/arrayfuncs.c.html#L1016" title="utils/adt/arrayfuncs.c:1016">array_out</a><br/></li>
<li></span><span class="Comment"> * can be made to work during early bootstrap.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L806">&#x200c;</a></span><span class="linkable">boot_get_type_io_data</span>(Oid typid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int16 *typlen,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> *typbyval,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> *typalign,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> *typdelim,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid *typioparam,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid *typinput,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid *typoutput)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> != NIL)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We have the boot-time contents of pg_type, so use it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="#L143" title="bootstrap/bootstrap.c:143">typmap</a> *ap = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ListCell&nbsp;&nbsp; *lc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; foreach(lc, <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ap = lfirst(lc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ap-&gt;am_oid == typid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!ap || ap-&gt;am_oid != typid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;type OID </span><span class="Special">%u</span><span class="Constant"> not found in <a href="#L149" title="bootstrap/bootstrap.c:149">Typ</a> list&quot;</span>, typid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typlen = ap-&gt;am_typ.typlen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typbyval = ap-&gt;am_typ.typbyval;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typalign = ap-&gt;am_typ.typalign;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typdelim = ap-&gt;am_typ.typdelim;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* </span><span class="Todo">XXX</span><span class="Comment"> this logic must match <a href="../utils/cache/lsyscache.c.html#L2303" title="utils/cache/lsyscache.c:2303">getTypeIOParam</a>() */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (OidIsValid(ap-&gt;am_typ.typelem))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typioparam = ap-&gt;am_typ.typelem;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typioparam = typid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typinput = ap-&gt;am_typ.typinput;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typoutput = ap-&gt;am_typ.typoutput;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We don't have pg_type yet, so use the hard-wired <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a> array */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; typeindex;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (typeindex = <span class="Constant">0</span>; typeindex &lt; <a href="#L141" title="bootstrap/bootstrap.c:141">n_types</a>; typeindex++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].oid == typid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (typeindex &gt;= <a href="#L141" title="bootstrap/bootstrap.c:141">n_types</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;type OID </span><span class="Special">%u</span><span class="Constant"> not found in <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>&quot;</span>, typid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typlen = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typbyval = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].byval;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typalign = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].align;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* We assume typdelim is ',' for all boot-time types */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *typdelim = <span class="Constant">','</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* </span><span class="Todo">XXX</span><span class="Comment"> this logic must match <a href="../utils/cache/lsyscache.c.html#L2303" title="utils/cache/lsyscache.c:2303">getTypeIOParam</a>() */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (OidIsValid(<a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].elem))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typioparam = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].elem;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *typioparam = typid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typinput = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].inproc;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *typoutput = <a href="#L88" title="bootstrap/bootstrap.c:88">TypInfo</a>[typeindex].outproc;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* ----------------<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L883" title="bootstrap/bootstrap.c:883">AllocateAttribute</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note: bootstrap never sets <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> per-column ACLs, so we only need<br/></li>
<li></span><span class="Comment"> * ATTRIBUTE_FIXED_PART_SIZE space per attribute.<br/></li>
<li></span><span class="Comment"> * ----------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> Form_pg_attribute<br/></li>
<li><a id="L883">&#x200c;</a><span class="linkable">AllocateAttribute</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (Form_pg_attribute)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1214" title="utils/mmgr/mcxt.c:1214">MemoryContextAllocZero</a>(<a href="../utils/mmgr/mcxt.c.html#L149" title="utils/mmgr/mcxt.c:149">TopMemoryContext</a>, ATTRIBUTE_FIXED_PART_SIZE);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; <a href="#L901" title="bootstrap/bootstrap.c:901">index_register</a>() -- record an index that has been set up for building<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; later.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; At bootstrap time, we define a bunch of indexes on system catalogs.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; We postpone actually building the indexes until just <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> we're<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; finished with initialization, however.&nbsp; This is because the indexes<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; themselves have catalog entries, and those have to be included in the<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; indexes on those catalogs.&nbsp; Doing it in two phases is the simplest<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; way of making sure the indexes have the right contents at the end.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L901">&#x200c;</a></span><span class="linkable">index_register</span>(Oid heap,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Oid ind,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> IndexInfo *indexInfo)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L169" title="bootstrap/bootstrap.c:169">IndexList</a>&nbsp; *newind;<br/></li>
<li>&nbsp; &nbsp; MemoryContext oldcxt;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * </span><span class="Todo">XXX</span><span class="Comment"> mao 10/31/92 -- don't gc index reldescs, associated info at<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * bootstrap time.&nbsp; we'll declare the indexes <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a>, but want to create them<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * later.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L155" title="bootstrap/bootstrap.c:155">nogc</a> == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L155" title="bootstrap/bootstrap.c:155">nogc</a> = AllocSetContextCreate(<span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;BootstrapNoGC&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ALLOCSET_DEFAULT_SIZES);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; oldcxt = MemoryContextSwitchTo(<a href="#L155" title="bootstrap/bootstrap.c:155">nogc</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; newind = (<a href="#L169" title="bootstrap/bootstrap.c:169">IndexList</a> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L169" title="bootstrap/bootstrap.c:169">IndexList</a>));<br/></li>
<li>&nbsp; &nbsp; newind-&gt;il_heap = heap;<br/></li>
<li>&nbsp; &nbsp; newind-&gt;il_ind = ind;<br/></li>
<li>&nbsp; &nbsp; newind-&gt;il_info = (IndexInfo *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(IndexInfo));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memcpy(newind-&gt;il_info, indexInfo, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(IndexInfo));<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* expressions will likely be null, but may as well copy it */<br/></li>
<li></span>&nbsp; &nbsp; newind-&gt;il_info-&gt;ii_Expressions =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; copyObject(indexInfo-&gt;ii_Expressions);<br/></li>
<li>&nbsp; &nbsp; newind-&gt;il_info-&gt;ii_ExpressionsState = NIL;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* predicate will likely be null, but may as well copy it */<br/></li>
<li></span>&nbsp; &nbsp; newind-&gt;il_info-&gt;ii_Predicate =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; copyObject(indexInfo-&gt;ii_Predicate);<br/></li>
<li>&nbsp; &nbsp; newind-&gt;il_info-&gt;ii_PredicateState = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* no exclusion constraints at bootstrap time, so no need to copy */<br/></li>
<li></span>&nbsp; &nbsp; Assert(indexInfo-&gt;ii_ExclusionOps == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; Assert(indexInfo-&gt;ii_ExclusionProcs == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; Assert(indexInfo-&gt;ii_ExclusionStrats == <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; newind-&gt;il_next = <a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a> = newind;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(oldcxt);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L951" title="bootstrap/bootstrap.c:951">build_indices</a> -- fill in all the indexes registered earlier<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L951">&#x200c;</a></span><span class="linkable">build_indices</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (; <a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a> != <span class="Constant">NULL</span>; <a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a> = <a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a>-&gt;il_next)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Relation&nbsp; &nbsp; heap;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Relation&nbsp; &nbsp; ind;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* need not bother with locks during bootstrap */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; heap = <a href="../access/table/table.c.html#L40" title="access/table/table.c:40">table_open</a>(<a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a>-&gt;il_heap, NoLock);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ind = <a href="../access/index/indexam.c.html#L133" title="access/index/indexam.c:133">index_open</a>(<a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a>-&gt;il_ind, NoLock);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../catalog/index.c.html#L2945" title="catalog/index.c:2945">index_build</a>(heap, ind, <a href="#L171" title="bootstrap/bootstrap.c:171">ILHead</a>-&gt;il_info, <span class="Constant">false</span>, <span class="Constant">false</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../access/index/indexam.c.html#L177" title="access/index/indexam.c:177">index_close</a>(ind, NoLock);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../access/table/table.c.html#L126" title="access/table/table.c:126">table_close</a>(heap, NoLock);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
