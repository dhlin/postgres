<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>main/main.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>main/main.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L44">progname</a></li>
<li><a href="#L45">reached_main</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L436">__ubsan_default_options</a></li>
<li><a href="#L379">check_root</a></li>
<li><a href="#L320">help</a></li>
<li><a href="#L301">init_locale</a></li>
<li><a href="#L58">main</a></li>
<li><a href="#L216">startup_hacks</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * <a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a>.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Stub <a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a>() routine for the postgres executable.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This does some essential startup tasks for <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> incarnation of postgres<br/></li>
<li></span><span class="Comment"> * (postmaster, standalone backend, standalone bootstrap process, or a<br/></li>
<li></span><span class="Comment"> * separately exec'd child of a postmaster) and then dispatches to the<br/></li>
<li></span><span class="Comment"> * proper FooMain() routine for the incarnation.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1994, Regents of the University of California<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/<a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a>/<a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a>.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;unistd.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(WIN32)<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;crtdbg.h&gt;<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if defined(__NetBSD__)<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;sys/param.h&gt;<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;bootstrap/bootstrap.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;common/username.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;port/atomics.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postmaster/postmaster.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;tcop/tcopprot.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/help_config.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/memutils.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/pg_locale.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/ps_status.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L44">&#x200c;</a><span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">progname</span>;<br/></li>
<li><a id="L45">&#x200c;</a><span class="Type">static</span> <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> <span class="linkable">reached_main</span> = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L216" title="main/main.c:216">startup_hacks</a>(<span class="Type">const</span> <span class="Type">char</span> *<a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L301" title="main/main.c:301">init_locale</a>(<span class="Type">const</span> <span class="Type">char</span> *categoryname, <span class="Type">int</span> category, <span class="Type">const</span> <span class="Type">char</span> *locale);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L320" title="main/main.c:320">help</a>(<span class="Type">const</span> <span class="Type">char</span> *<a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L379" title="main/main.c:379">check_root</a>(<span class="Type">const</span> <span class="Type">char</span> *<a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Any Postgres server process begins execution here.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">int<br/></li>
<li><a id="L58">&#x200c;</a></span><span class="linkable">main</span>(<span class="Type">int</span> argc, <span class="Type">char</span> *argv[])<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; do_check_root = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L45" title="main/main.c:45">reached_main</a> = <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If supported on the current platform, set up a handler to be called if<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the backend/postmaster crashes with a fatal signal or exception.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#if defined(WIN32)<br/></li>
<li></span>&nbsp; &nbsp; <a href="../port/win32/crashdump.c.html#L178" title="port/win32/crashdump.c:178">pgwin32_install_crashdump_handler</a>();<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="#L44" title="main/main.c:44">progname</a> = get_progname(argv[<span class="Constant">0</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Platform-specific startup hacks<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L216" title="main/main.c:216">startup_hacks</a>(<a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Remember the physical location of the initially given argv[] array for<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * possible use by ps display.&nbsp; On some platforms, the argv[] storage must<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * be overwritten in order to set the process title for ps. In such cases<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="../utils/misc/ps_status.c.html#L117" title="utils/misc/ps_status.c:117">save_ps_display_args</a> makes and returns a new copy of the argv[] array.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="../utils/misc/ps_status.c.html#L117" title="utils/misc/ps_status.c:117">save_ps_display_args</a> may also move the environment strings to make<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * extra room. Therefore this should be done as early as possible during<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * startup, to avoid entanglements with code that might save a getenv()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * result pointer.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; argv = <a href="../utils/misc/ps_status.c.html#L117" title="utils/misc/ps_status.c:117">save_ps_display_args</a>(argc, argv);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Fire up essential subsystems: error and memory management<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Code after this point is allowed to use elog/ereport, though<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * localization of messages may not work right away, and messages won't go<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * anywhere but stderr until GUC settings get loaded.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L339" title="utils/mmgr/mcxt.c:339">MemoryContextInit</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Set up locale information<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; set_pglocale_pgservice(argv[<span class="Constant">0</span>], PG_TEXTDOMAIN(<span class="Constant">&quot;postgres&quot;</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * In the postmaster, absorb the environment <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> for LC_COLLATE and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * LC_CTYPE.&nbsp; Individual backends will change these later to settings<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * taken from pg_database, but the postmaster cannot do that.&nbsp; If we leave<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * these set to &quot;C&quot; then message localization might not work well in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * postmaster.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L301" title="main/main.c:301">init_locale</a>(<span class="Constant">&quot;LC_COLLATE&quot;</span>, <span class="Constant">LC_COLLATE</span>, <span class="Constant">&quot;&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L301" title="main/main.c:301">init_locale</a>(<span class="Constant">&quot;LC_CTYPE&quot;</span>, <span class="Constant">LC_CTYPE</span>, <span class="Constant">&quot;&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * LC_MESSAGES will get set later during GUC option processing, but we set<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * it here to allow startup error messages to be localized.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#ifdef LC_MESSAGES<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L301" title="main/main.c:301">init_locale</a>(<span class="Constant">&quot;LC_MESSAGES&quot;</span>, LC_MESSAGES, <span class="Constant">&quot;&quot;</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * We keep these set to &quot;C&quot; always, except transiently in pg_locale.c; see<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * that file for explanations.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L301" title="main/main.c:301">init_locale</a>(<span class="Constant">&quot;LC_MONETARY&quot;</span>, <span class="Constant">LC_MONETARY</span>, <span class="Constant">&quot;C&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L301" title="main/main.c:301">init_locale</a>(<span class="Constant">&quot;LC_NUMERIC&quot;</span>, <span class="Constant">LC_NUMERIC</span>, <span class="Constant">&quot;C&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L301" title="main/main.c:301">init_locale</a>(<span class="Constant">&quot;LC_TIME&quot;</span>, <span class="Constant">LC_TIME</span>, <span class="Constant">&quot;C&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Now that we have absorbed as much as we wish to from the locale<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * environment, remove <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> LC_ALL setting, so that the environment<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * variables installed by <a href="../utils/adt/pg_locale.c.html#L212" title="utils/adt/pg_locale.c:212">pg_perm_setlocale</a> have force.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; unsetenv(<span class="Constant">&quot;LC_ALL&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Catch standard options <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> doing much else, in particular <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * insist on not being root.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (argc &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--<a href="#L320" title="main/main.c:320">help</a>&quot;</span>) == <span class="Constant">0</span> || strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;-?&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L320" title="main/main.c:320">help</a>(<a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--version&quot;</span>) == <span class="Constant">0</span> || strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;-V&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fputs(PG_BACKEND_VERSIONSTR, <span class="Constant">stdout</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In addition to the above, we allow &quot;--describe-config&quot; and &quot;-C var&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * to be called by root.&nbsp; This is reasonably safe since these are<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * read-only activities.&nbsp; The -C case is important because pg_ctl may<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * try to invoke it while still holding administrator privileges on<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Windows.&nbsp; Note that while -C can normally be in <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> argv position,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * if you want to bypass the root check you must put it first.&nbsp; This<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * reduces the risk that we might misinterpret some other mode's -C<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * switch as being the postmaster/postgres one.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--describe-config&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; do_check_root = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (argc &gt; <span class="Constant">2</span> &amp;&amp; strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;-C&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; do_check_root = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Make sure we are not running as root, unless it's safe for the selected<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * option.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (do_check_root)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L379" title="main/main.c:379">check_root</a>(<a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Dispatch to one of various subprograms depending on first argument.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (argc &gt; <span class="Constant">1</span> &amp;&amp; strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--check&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../bootstrap/bootstrap.c.html#L199" title="bootstrap/bootstrap.c:199">BootstrapModeMain</a>(argc, argv, <span class="Constant">true</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (argc &gt; <span class="Constant">1</span> &amp;&amp; strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--boot&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../bootstrap/bootstrap.c.html#L199" title="bootstrap/bootstrap.c:199">BootstrapModeMain</a>(argc, argv, <span class="Constant">false</span>);<br/></li>
<li><span class="PreProc">#ifdef EXEC_BACKEND<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (argc &gt; <span class="Constant">1</span> &amp;&amp; strncmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--fork&quot;</span>, <span class="Constant">6</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../postmaster/launch_backend.c.html#L569" title="postmaster/launch_backend.c:569">SubPostmasterMain</a>(argc, argv);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (argc &gt; <span class="Constant">1</span> &amp;&amp; strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--describe-config&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/misc/help_config.c.html#L46" title="utils/misc/help_config.c:46">GucInfoMain</a>();<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (argc &gt; <span class="Constant">1</span> &amp;&amp; strcmp(argv[<span class="Constant">1</span>], <span class="Constant">&quot;--single&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tcop/postgres.c.html#L4042" title="tcop/postgres.c:4042">PostgresSingleUserMain</a>(argc, argv,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; strdup(get_user_name_or_exit(<a href="#L44" title="main/main.c:44">progname</a>)));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../postmaster/postmaster.c.html#L489" title="postmaster/postmaster.c:489">PostmasterMain</a>(argc, argv);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* the <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> above should not return */<br/></li>
<li></span>&nbsp; &nbsp; abort();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Place platform-specific startup hacks here.&nbsp; This is the right<br/></li>
<li></span><span class="Comment"> * place to put code that must be executed early in the launch of <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> new<br/></li>
<li></span><span class="Comment"> * server process.&nbsp; Note that this code will NOT be executed when a backend<br/></li>
<li></span><span class="Comment"> * or sub-bootstrap process is forked, unless we are in a fork/exec<br/></li>
<li></span><span class="Comment"> * environment (ie EXEC_BACKEND is defined).<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * </span><span class="Todo">XXX</span><span class="Comment"> The need for code here is proof that the platform in question<br/></li>
<li></span><span class="Comment"> * is too brain-dead to provide a standard C execution environment<br/></li>
<li></span><span class="Comment"> * without <a href="#L320" title="main/main.c:320">help</a>.&nbsp; Avoid adding more here, if you can.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L216">&#x200c;</a></span><span class="linkable">startup_hacks</span>(<span class="Type">const</span> <span class="Type">char</span> *<a href="#L44" title="main/main.c:44">progname</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Windows-specific execution environment hacking.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#ifdef WIN32<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; WSADATA&nbsp; &nbsp; &nbsp; &nbsp; wsaData;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Make output streams unbuffered by default */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; setvbuf(<span class="Constant">stdout</span>, <span class="Constant">NULL</span>, <span class="Constant">_IONBF</span>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; setvbuf(<span class="Constant">stderr</span>, <span class="Constant">NULL</span>, <span class="Constant">_IONBF</span>, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Prepare Winsock */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; err = WSAStartup(MAKEWORD(<span class="Constant">2</span>, <span class="Constant">2</span>), &amp;wsaData);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (err != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">: WSAStartup failed: </span><span class="Special">%d\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L44" title="main/main.c:44">progname</a>, err);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * By default abort() only generates a crash-<a href="../regex/regcomp.c.html#L2491" title="regex/regcomp.c:2491">dump</a> in *non* debug<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * builds. As our Assert() / <a href="../utils/error/assert.c.html#L30" title="utils/error/assert.c:30">ExceptionalCondition</a>() uses abort(),<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * leaving the default in place would make debugging harder.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * MINGW's own C runtime doesn't have _set_abort_behavior(). When<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * targeting Microsoft's UCRT with mingw, it never links to the debug<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * version of the library and thus doesn't need the call to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * _set_abort_behavior() either.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><span class="PreProc">#if !defined(__MINGW32__) &amp;&amp; !defined(__MINGW64__)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; _set_abort_behavior(_CALL_REPORTFAULT | _WRITE_ABORT_MSG,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _CALL_REPORTFAULT | _WRITE_ABORT_MSG);<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* !defined(__MINGW32__) &amp;&amp;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * !defined(__MINGW64__) */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * SEM_FAILCRITICALERRORS causes more errors to be reported to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * callers.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * We used to also specify SEM_NOGPFAULTERRORBOX, but that prevents<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * windows crash reporting from working. Which includes registered<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * just-in-time debuggers, making it unnecessarily hard to debug<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * problems on windows. Now we try to disable sources of popups<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * separately below (note that SEM_NOGPFAULTERRORBOX did not actually<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * prevent all sources of such popups).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; SetErrorMode(SEM_FAILCRITICALERRORS);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Show errors on stderr instead of popup box (note this doesn't<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * affect errors originating in the C runtime, see below).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; _set_error_mode(_OUT_TO_STDERR);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In DEBUG builds, errors, including assertions, C runtime errors are<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * reported via _CrtDbgReport. By default such errors are displayed<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * with a popup (even with NOGPFAULTERRORBOX), preventing forward<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * progress. Instead report such errors stderr (and the debugger).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This is C runtime specific and thus the above incantations aren't<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * sufficient to suppress these popups.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; _CrtSetReportMode(_CRT_ERROR, _CRTDBG_MODE_FILE | _CRTDBG_MODE_DEBUG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; _CrtSetReportFile(_CRT_ERROR, _CRTDBG_FILE_STDERR);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; _CrtSetReportMode(_CRT_ASSERT, _CRTDBG_MODE_FILE | _CRTDBG_MODE_DEBUG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; _CrtSetReportFile(_CRT_ASSERT, _CRTDBG_FILE_STDERR);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; _CrtSetReportMode(_CRT_WARN, _CRTDBG_MODE_FILE | _CRTDBG_MODE_DEBUG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; _CrtSetReportFile(_CRT_WARN, _CRTDBG_FILE_STDERR);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* WIN32 */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Make the initial permanent setting for a locale category.&nbsp; If that fails,<br/></li>
<li></span><span class="Comment"> * perhaps due to LC_foo=invalid in the environment, use locale C.&nbsp; If even<br/></li>
<li></span><span class="Comment"> * that fails, perhaps due to out-of-memory, the entire startup fails with it.<br/></li>
<li></span><span class="Comment"> * When this returns, we are guaranteed to have a setting for the given<br/></li>
<li></span><span class="Comment"> * category's environment variable.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L301">&#x200c;</a></span><span class="linkable">init_locale</span>(<span class="Type">const</span> <span class="Type">char</span> *categoryname, <span class="Type">int</span> category, <span class="Type">const</span> <span class="Type">char</span> *locale)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../utils/adt/pg_locale.c.html#L212" title="utils/adt/pg_locale.c:212">pg_perm_setlocale</a>(category, locale) == <span class="Constant">NULL</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/adt/pg_locale.c.html#L212" title="utils/adt/pg_locale.c:212">pg_perm_setlocale</a>(category, <span class="Constant">&quot;C&quot;</span>) == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(FATAL, <span class="Constant">&quot;could not adopt </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> locale nor C locale for </span><span class="Special">%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; locale, categoryname);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Help display should match the options accepted by <a href="../postmaster/postmaster.c.html#L489" title="postmaster/postmaster.c:489">PostmasterMain</a>()<br/></li>
<li></span><span class="Comment"> * and <a href="../tcop/postgres.c.html#L4152" title="tcop/postgres.c:4152">PostgresMain</a>().<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * </span><span class="Todo">XXX</span><span class="Comment"> On Windows, non-ASCII localizations of these messages only display<br/></li>
<li></span><span class="Comment"> * correctly if the console output code page covers the necessary characters.<br/></li>
<li></span><span class="Comment"> * Messages emitted in <a href="../utils/error/elog.c.html#L2545" title="utils/error/elog.c:2545">write_console</a>() do not exhibit this problem.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L320">&#x200c;</a></span><span class="linkable">help</span>(<span class="Type">const</span> <span class="Type">char</span> *<a href="#L44" title="main/main.c:44">progname</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> is the PostgreSQL server.</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>), <a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;Usage:</span><span class="Special">\n</span><span class="Constant">&nbsp; </span><span class="Special">%s</span><span class="Constant"> [OPTION]...</span><span class="Special">\n\n</span><span class="Constant">&quot;</span>), <a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;Options:</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -B NBUFFERS&nbsp; &nbsp; &nbsp; &nbsp; number of shared buffers</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -c NAME=VALUE&nbsp; &nbsp; &nbsp; set run-time parameter</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -C NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../nodes/print.c.html#L36" title="nodes/print.c:36">print</a> value of run-time parameter, then exit</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -d 1-5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; debugging level</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -D DATADIR&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; database directory</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -e&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; use European date input format (DMY)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -F&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; turn fsync off</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -h HOSTNAME&nbsp; &nbsp; &nbsp; &nbsp; host name or IP address to <a href="../port/win32/socket.c.html#L33" title="port/win32/socket.c:33">listen</a> on</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -i&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; enable TCP/IP connections (deprecated)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -k DIRECTORY&nbsp; &nbsp; &nbsp;&nbsp; Unix-domain <a href="../port/win32/socket.c.html#L31" title="port/win32/socket.c:31">socket</a> location</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li><span class="PreProc">#ifdef USE_SSL<br/></li>
<li></span>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -l&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; enable SSL connections</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -N MAX-CONNECT&nbsp; &nbsp;&nbsp; maximum number of allowed connections</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -p PORT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port number to <a href="../port/win32/socket.c.html#L33" title="port/win32/socket.c:33">listen</a> on</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; show statistics after each query</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -S <a href="../regex/regexec.c.html#L87" title="regex/regexec.c:87">WORK</a>-MEM&nbsp; &nbsp; &nbsp; &nbsp; set amount of memory for sorts (in kB)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -V, --version&nbsp; &nbsp; &nbsp; output version information, then exit</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; --NAME=VALUE&nbsp; &nbsp; &nbsp;&nbsp; set run-time parameter</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; --describe-config&nbsp; describe configuration parameters, then exit</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -?, --<a href="#L320" title="main/main.c:320">help</a>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; show this <a href="#L320" title="main/main.c:320">help</a>, then exit</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">Developer options:</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -f s|i|o|b|t|n|m|h forbid use of some plan types</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; allow system table structure changes</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; disable system indexes</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -t pa|pl|ex&nbsp; &nbsp; &nbsp; &nbsp; show timings after each query</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -T&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../port/win32/socket.c.html#L38" title="port/win32/socket.c:38">send</a> SIGABRT to all backend processes if one dies</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -W NUM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; wait NUM seconds to allow attach from a debugger</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">Options for single-user mode:</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; --single&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; selects single-user mode (must be first argument)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; DBNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; database name (defaults to user name)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -d 0-5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; override debugging level</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -E&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo statement <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> execution</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -j&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; do not use <a href="../regex/regc_lex.c.html#L1010" title="regex/regc_lex.c:1010">newline</a> as interactive query delimiter</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -r FILENAME&nbsp; &nbsp; &nbsp; &nbsp; <a href="../port/win32/socket.c.html#L38" title="port/win32/socket.c:38">send</a> stdout and stderr to given file</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">Options for bootstrapping mode:</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; --boot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; selects bootstrapping mode (must be first argument)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; --check&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; selects check mode (must be first argument)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; DBNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; database name (mandatory argument in bootstrapping mode)</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;&nbsp; -r FILENAME&nbsp; &nbsp; &nbsp; &nbsp; <a href="../port/win32/socket.c.html#L38" title="port/win32/socket.c:38">send</a> stdout and stderr to given file</span><span class="Special">\n</span><span class="Constant">&quot;</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">Please read the documentation for the complete list of run-time</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;configuration settings and how to set them on the command line or in</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;the configuration file.</span><span class="Special">\n\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;Report bugs to &lt;</span><span class="Special">%s</span><span class="Constant">&gt;.</span><span class="Special">\n</span><span class="Constant">&quot;</span>), PACKAGE_BUGREPORT);<br/></li>
<li>&nbsp; &nbsp; printf(<a href="../utils/error/elog.c.html#L89" title="utils/error/elog.c:89">_</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> home page: &lt;</span><span class="Special">%s</span><span class="Constant">&gt;</span><span class="Special">\n</span><span class="Constant">&quot;</span>), PACKAGE_NAME, PACKAGE_URL);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L379">&#x200c;</a></span><span class="linkable">check_root</span>(<span class="Type">const</span> <span class="Type">char</span> *<a href="#L44" title="main/main.c:44">progname</a>)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#ifndef WIN32<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (geteuid() == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">root</span><span class="Special">\&quot;</span><span class="Constant"> execution of the PostgreSQL server is not permitted.</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;The server must be started under an unprivileged user ID to prevent</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;possible system security compromise.&nbsp; See the documentation for</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;more information on how to properly start the server.</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Also make sure that real and effective uids are the same. Executing as<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * a setuid program from a root shell is a security hole, since on many<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * platforms a nefarious subroutine could setuid back to root if real uid<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * is root.&nbsp; (Since nobody actually uses postgres as a setuid program,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * trying to actively fix this situation seems more trouble than it's<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * worth; we'll just expend the effort to check for it.)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (getuid() != geteuid())<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">: real and effective user IDs must match</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L44" title="main/main.c:44">progname</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* WIN32 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (pgwin32_is_admin())<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/error/elog.c.html#L3707" title="utils/error/elog.c:3707">write_stderr</a>(<span class="Constant">&quot;Execution of PostgreSQL by a user with administrative permissions is not</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;permitted.</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;The server must be started under an unprivileged user ID to prevent</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;possible system security compromises.&nbsp; See the documentation for</span><span class="Special">\n</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;more information on how to properly start the server.</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* WIN32 */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * At least on linux, set_ps_display() breaks /proc/$pid/environ. The<br/></li>
<li></span><span class="Comment"> * sanitizer library uses /proc/$pid/environ to implement getenv() as it wants<br/></li>
<li></span><span class="Comment"> * to work independent of libc. When just using undefined and alignment<br/></li>
<li></span><span class="Comment"> * sanitizers, the sanitizer library is only initialized when the first error<br/></li>
<li></span><span class="Comment"> * occurs, by which time we've often already called set_ps_display(),<br/></li>
<li></span><span class="Comment"> * preventing the sanitizer libraries from seeing the options.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We can work around that by defining <a href="#L436" title="main/main.c:436">__ubsan_default_options</a>, a weak symbol<br/></li>
<li></span><span class="Comment"> * libsanitizer uses to get defaults from the application, and return<br/></li>
<li></span><span class="Comment"> * getenv(&quot;UBSAN_OPTIONS&quot;). But only if <a href="../storage/lmgr/s_lock.c.html#L257" title="storage/lmgr/s_lock.c:257">main</a> already was reached, so that we<br/></li>
<li></span><span class="Comment"> * don't end up relying on a not-yet-working getenv().<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * As this function won't get called when not running a sanitizer, it doesn't<br/></li>
<li></span><span class="Comment"> * seem necessary to only compile it conditionally.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">const</span> <span class="Type">char</span> *<a href="#L436" title="main/main.c:436">__ubsan_default_options</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">const</span> <span class="Type">char</span> *<br/></li>
<li><a id="L436">&#x200c;</a><span class="linkable">__ubsan_default_options</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* don't call libc <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> it's guaranteed to be initialized */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L45" title="main/main.c:45">reached_main</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> getenv(<span class="Constant">&quot;UBSAN_OPTIONS&quot;</span>);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
