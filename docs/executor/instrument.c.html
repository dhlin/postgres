<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>executor/instrument.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>executor/instrument.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L20">pgBufferUsage</a></li>
<li><a href="#L22">pgWalUsage</a></li>
<li><a href="#L21">save_pgBufferUsage</a></li>
<li><a href="#L23">save_pgWalUsage</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L248">BufferUsageAccumDiff</a></li>
<li><a href="#L226">BufferUsageAdd</a></li>
<li><a href="#L218">InstrAccumParallelQuery</a></li>
<li><a href="#L169">InstrAggNode</a></li>
<li><a href="#L31">InstrAlloc</a></li>
<li><a href="#L140">InstrEndLoop</a></li>
<li><a href="#L208">InstrEndParallelQuery</a></li>
<li><a href="#L58">InstrInit</a></li>
<li><a href="#L68">InstrStartNode</a></li>
<li><a href="#L200">InstrStartParallelQuery</a></li>
<li><a href="#L84">InstrStopNode</a></li>
<li><a href="#L132">InstrUpdateTupleCount</a></li>
<li><a href="#L286">WalUsageAccumDiff</a></li>
<li><a href="#L278">WalUsageAdd</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * instrument.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> for instrumentation of plan execution<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Copyright (c) 2001-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/executor/instrument.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;unistd.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;executor/instrument.h&quot;<br/></li>
<li></span><br/></li>
<li><a id="L20">&#x200c;</a>BufferUsage <span class="linkable">pgBufferUsage</span>;<br/></li>
<li><a id="L21">&#x200c;</a><span class="Type">static</span> BufferUsage <span class="linkable">save_pgBufferUsage</span>;<br/></li>
<li><a id="L22">&#x200c;</a>WalUsage&nbsp; &nbsp; <span class="linkable">pgWalUsage</span>;<br/></li>
<li><a id="L23">&#x200c;</a><span class="Type">static</span> WalUsage <span class="linkable">save_pgWalUsage</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L226" title="executor/instrument.c:226">BufferUsageAdd</a>(BufferUsage *dst, <span class="Type">const</span> BufferUsage *add);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L278" title="executor/instrument.c:278">WalUsageAdd</a>(WalUsage *dst, WalUsage *add);<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* Allocate new instrumentation structure(s) */<br/></li>
<li></span>Instrumentation *<br/></li>
<li><a id="L31">&#x200c;</a><span class="linkable">InstrAlloc</span>(<span class="Type">int</span> n, <span class="Type">int</span> instrument_options, <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> async_mode)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Instrumentation *instr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../regex/rege_dfa.c.html#L731" title="regex/rege_dfa.c:731">initialize</a> all fields to zeroes, then modify as needed */<br/></li>
<li></span>&nbsp; &nbsp; instr = <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(n * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Instrumentation));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (instrument_options &amp; (INSTRUMENT_BUFFERS | INSTRUMENT_TIMER | INSTRUMENT_WAL))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; need_buffers = (instrument_options &amp; INSTRUMENT_BUFFERS) != <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; need_wal = (instrument_options &amp; INSTRUMENT_WAL) != <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; need_timer = (instrument_options &amp; INSTRUMENT_TIMER) != <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instr[i].need_bufusage = need_buffers;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instr[i].need_walusage = need_wal;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instr[i].need_timer = need_timer;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instr[i].async_mode = async_mode;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> instr;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Initialize a pre-allocated instrumentation structure. */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L58">&#x200c;</a></span><span class="linkable">InstrInit</span>(Instrumentation *instr, <span class="Type">int</span> instrument_options)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; memset(instr, <span class="Constant">0</span>, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(Instrumentation));<br/></li>
<li>&nbsp; &nbsp; instr-&gt;need_bufusage = (instrument_options &amp; INSTRUMENT_BUFFERS) != <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; instr-&gt;need_walusage = (instrument_options &amp; INSTRUMENT_WAL) != <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; instr-&gt;need_timer = (instrument_options &amp; INSTRUMENT_TIMER) != <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Entry to a plan node */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L68">&#x200c;</a></span><span class="linkable">InstrStartNode</span>(Instrumentation *instr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (instr-&gt;need_timer &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; !INSTR_TIME_SET_CURRENT_LAZY(instr-&gt;starttime))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;<a href="#L68" title="executor/instrument.c:68">InstrStartNode</a> called twice in a row&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* save buffer usage totals at node entry, if needed */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (instr-&gt;need_bufusage)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; instr-&gt;bufusage_start = <a href="#L20" title="executor/instrument.c:20">pgBufferUsage</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (instr-&gt;need_walusage)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; instr-&gt;walusage_start = <a href="#L22" title="executor/instrument.c:22">pgWalUsage</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Exit from a plan node */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L84">&#x200c;</a></span><span class="linkable">InstrStopNode</span>(Instrumentation *instr, <span class="Type">double</span> nTuples)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; save_tuplecount = instr-&gt;tuplecount;<br/></li>
<li>&nbsp; &nbsp; instr_time&nbsp; &nbsp; endtime;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* count the returned tuples */<br/></li>
<li></span>&nbsp; &nbsp; instr-&gt;tuplecount += nTuples;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* let's update the time only if the timer was requested */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (instr-&gt;need_timer)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (INSTR_TIME_IS_ZERO(instr-&gt;starttime))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;<a href="#L84" title="executor/instrument.c:84">InstrStopNode</a> called without start&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; INSTR_TIME_SET_CURRENT(endtime);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; INSTR_TIME_ACCUM_DIFF(instr-&gt;counter, endtime, instr-&gt;starttime);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; INSTR_TIME_SET_ZERO(instr-&gt;starttime);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Add delta of buffer usage since entry to node's totals */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (instr-&gt;need_bufusage)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L248" title="executor/instrument.c:248">BufferUsageAccumDiff</a>(&amp;instr-&gt;bufusage,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;<a href="#L20" title="executor/instrument.c:20">pgBufferUsage</a>, &amp;instr-&gt;bufusage_start);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (instr-&gt;need_walusage)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L286" title="executor/instrument.c:286">WalUsageAccumDiff</a>(&amp;instr-&gt;walusage,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;<a href="#L22" title="executor/instrument.c:22">pgWalUsage</a>, &amp;instr-&gt;walusage_start);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Is this the first tuple of this cycle? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!instr-&gt;running)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; instr-&gt;running = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; instr-&gt;firsttuple = INSTR_TIME_GET_DOUBLE(instr-&gt;counter);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * In async mode, if the plan node hadn't emitted <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> tuples <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a>,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * this might be the first tuple<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (instr-&gt;async_mode &amp;&amp; save_tuplecount &lt; <span class="Constant">1.0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instr-&gt;firsttuple = INSTR_TIME_GET_DOUBLE(instr-&gt;counter);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Update tuple count */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L132">&#x200c;</a></span><span class="linkable">InstrUpdateTupleCount</span>(Instrumentation *instr, <span class="Type">double</span> nTuples)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* count the returned tuples */<br/></li>
<li></span>&nbsp; &nbsp; instr-&gt;tuplecount += nTuples;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Finish a run cycle for a plan node */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L140">&#x200c;</a></span><span class="linkable">InstrEndLoop</span>(Instrumentation *instr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; totaltime;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Skip if nothing has happened, or already shut down */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (!instr-&gt;running)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!INSTR_TIME_IS_ZERO(instr-&gt;starttime))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;<a href="#L140" title="executor/instrument.c:140">InstrEndLoop</a> called on running node&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Accumulate per-cycle statistics into totals */<br/></li>
<li></span>&nbsp; &nbsp; totaltime = INSTR_TIME_GET_DOUBLE(instr-&gt;counter);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; instr-&gt;startup += instr-&gt;firsttuple;<br/></li>
<li>&nbsp; &nbsp; instr-&gt;total += totaltime;<br/></li>
<li>&nbsp; &nbsp; instr-&gt;ntuples += instr-&gt;tuplecount;<br/></li>
<li>&nbsp; &nbsp; instr-&gt;nloops += <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Reset for <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> cycle (if <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a>) */<br/></li>
<li></span>&nbsp; &nbsp; instr-&gt;running = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_SET_ZERO(instr-&gt;starttime);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_SET_ZERO(instr-&gt;counter);<br/></li>
<li>&nbsp; &nbsp; instr-&gt;firsttuple = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; instr-&gt;tuplecount = <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* aggregate instrumentation information */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L169">&#x200c;</a></span><span class="linkable">InstrAggNode</span>(Instrumentation *dst, Instrumentation *add)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!dst-&gt;running &amp;&amp; add-&gt;running)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst-&gt;running = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst-&gt;firsttuple = add-&gt;firsttuple;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (dst-&gt;running &amp;&amp; add-&gt;running &amp;&amp; dst-&gt;firsttuple &gt; add-&gt;firsttuple)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst-&gt;firsttuple = add-&gt;firsttuple;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ADD(dst-&gt;counter, add-&gt;counter);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dst-&gt;tuplecount += add-&gt;tuplecount;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;startup += add-&gt;startup;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;total += add-&gt;total;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;ntuples += add-&gt;ntuples;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;ntuples2 += add-&gt;ntuples2;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;nloops += add-&gt;nloops;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;nfiltered1 += add-&gt;nfiltered1;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;nfiltered2 += add-&gt;nfiltered2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Add delta of buffer usage since entry to node's totals */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (dst-&gt;need_bufusage)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L226" title="executor/instrument.c:226">BufferUsageAdd</a>(&amp;dst-&gt;bufusage, &amp;add-&gt;bufusage);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dst-&gt;need_walusage)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L278" title="executor/instrument.c:278">WalUsageAdd</a>(&amp;dst-&gt;walusage, &amp;add-&gt;walusage);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* note current <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> during parallel executor startup */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L200">&#x200c;</a></span><span class="linkable">InstrStartParallelQuery</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L21" title="executor/instrument.c:21">save_pgBufferUsage</a> = <a href="#L20" title="executor/instrument.c:20">pgBufferUsage</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L23" title="executor/instrument.c:23">save_pgWalUsage</a> = <a href="#L22" title="executor/instrument.c:22">pgWalUsage</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* report usage after parallel executor shutdown */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L208">&#x200c;</a></span><span class="linkable">InstrEndParallelQuery</span>(BufferUsage *bufusage, WalUsage *walusage)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; memset(bufusage, <span class="Constant">0</span>, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(BufferUsage));<br/></li>
<li>&nbsp; &nbsp; <a href="#L248" title="executor/instrument.c:248">BufferUsageAccumDiff</a>(bufusage, &amp;<a href="#L20" title="executor/instrument.c:20">pgBufferUsage</a>, &amp;<a href="#L21" title="executor/instrument.c:21">save_pgBufferUsage</a>);<br/></li>
<li>&nbsp; &nbsp; memset(walusage, <span class="Constant">0</span>, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(WalUsage));<br/></li>
<li>&nbsp; &nbsp; <a href="#L286" title="executor/instrument.c:286">WalUsageAccumDiff</a>(walusage, &amp;<a href="#L22" title="executor/instrument.c:22">pgWalUsage</a>, &amp;<a href="#L23" title="executor/instrument.c:23">save_pgWalUsage</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* accumulate work done by workers in leader's stats */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L218">&#x200c;</a></span><span class="linkable">InstrAccumParallelQuery</span>(BufferUsage *bufusage, WalUsage *walusage)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L226" title="executor/instrument.c:226">BufferUsageAdd</a>(&amp;<a href="#L20" title="executor/instrument.c:20">pgBufferUsage</a>, bufusage);<br/></li>
<li>&nbsp; &nbsp; <a href="#L278" title="executor/instrument.c:278">WalUsageAdd</a>(&amp;<a href="#L22" title="executor/instrument.c:22">pgWalUsage</a>, walusage);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* dst += add */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L226">&#x200c;</a></span><span class="linkable">BufferUsageAdd</span>(BufferUsage *dst, <span class="Type">const</span> BufferUsage *add)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_hit += add-&gt;shared_blks_hit;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_read += add-&gt;shared_blks_read;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_dirtied += add-&gt;shared_blks_dirtied;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_written += add-&gt;shared_blks_written;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_hit += add-&gt;local_blks_hit;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_read += add-&gt;local_blks_read;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_dirtied += add-&gt;local_blks_dirtied;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_written += add-&gt;local_blks_written;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;temp_blks_read += add-&gt;temp_blks_read;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;temp_blks_written += add-&gt;temp_blks_written;<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ADD(dst-&gt;shared_blk_read_time, add-&gt;shared_blk_read_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ADD(dst-&gt;shared_blk_write_time, add-&gt;shared_blk_write_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ADD(dst-&gt;local_blk_read_time, add-&gt;local_blk_read_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ADD(dst-&gt;local_blk_write_time, add-&gt;local_blk_write_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ADD(dst-&gt;temp_blk_read_time, add-&gt;temp_blk_read_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ADD(dst-&gt;temp_blk_write_time, add-&gt;temp_blk_write_time);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* dst += add - sub */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L248">&#x200c;</a></span><span class="linkable">BufferUsageAccumDiff</span>(BufferUsage *dst,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> BufferUsage *add,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> BufferUsage *sub)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_hit += add-&gt;shared_blks_hit - sub-&gt;shared_blks_hit;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_read += add-&gt;shared_blks_read - sub-&gt;shared_blks_read;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_dirtied += add-&gt;shared_blks_dirtied - sub-&gt;shared_blks_dirtied;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;shared_blks_written += add-&gt;shared_blks_written - sub-&gt;shared_blks_written;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_hit += add-&gt;local_blks_hit - sub-&gt;local_blks_hit;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_read += add-&gt;local_blks_read - sub-&gt;local_blks_read;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_dirtied += add-&gt;local_blks_dirtied - sub-&gt;local_blks_dirtied;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;local_blks_written += add-&gt;local_blks_written - sub-&gt;local_blks_written;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;temp_blks_read += add-&gt;temp_blks_read - sub-&gt;temp_blks_read;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;temp_blks_written += add-&gt;temp_blks_written - sub-&gt;temp_blks_written;<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ACCUM_DIFF(dst-&gt;shared_blk_read_time,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add-&gt;shared_blk_read_time, sub-&gt;shared_blk_read_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ACCUM_DIFF(dst-&gt;shared_blk_write_time,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add-&gt;shared_blk_write_time, sub-&gt;shared_blk_write_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ACCUM_DIFF(dst-&gt;local_blk_read_time,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add-&gt;local_blk_read_time, sub-&gt;local_blk_read_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ACCUM_DIFF(dst-&gt;local_blk_write_time,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add-&gt;local_blk_write_time, sub-&gt;local_blk_write_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ACCUM_DIFF(dst-&gt;temp_blk_read_time,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add-&gt;temp_blk_read_time, sub-&gt;temp_blk_read_time);<br/></li>
<li>&nbsp; &nbsp; INSTR_TIME_ACCUM_DIFF(dst-&gt;temp_blk_write_time,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add-&gt;temp_blk_write_time, sub-&gt;temp_blk_write_time);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* helper <a href="../regex/regcomp.c.html#L356" title="regex/regcomp.c:356">functions</a> for WAL usage accumulation */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L278">&#x200c;</a></span><span class="linkable">WalUsageAdd</span>(WalUsage *dst, WalUsage *add)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; dst-&gt;wal_bytes += add-&gt;wal_bytes;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;wal_records += add-&gt;wal_records;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;wal_fpi += add-&gt;wal_fpi;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L286">&#x200c;</a></span><span class="linkable">WalUsageAccumDiff</span>(WalUsage *dst, <span class="Type">const</span> WalUsage *add, <span class="Type">const</span> WalUsage *sub)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; dst-&gt;wal_bytes += add-&gt;wal_bytes - sub-&gt;wal_bytes;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;wal_records += add-&gt;wal_records - sub-&gt;wal_records;<br/></li>
<li>&nbsp; &nbsp; dst-&gt;wal_fpi += add-&gt;wal_fpi - sub-&gt;wal_fpi;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
