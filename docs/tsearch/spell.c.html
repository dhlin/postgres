<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>tsearch/spell.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>tsearch/spell.c - pgsql17devel-backend</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L194">VoidString</a></li>
</ul>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L2281">SplitVar</a></li>
<li><a href="#L2287">SplitVar</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L2357">AddStem</a></li>
<li><a href="#L2067">CheckAffix</a></li>
<li><a href="#L2290">CheckCompoundAffixes</a></li>
<li><a href="#L2332">CopyVar</a></li>
<li><a href="#L2024">FindAffixes</a></li>
<li><a href="#L602">FindWord</a></li>
<li><a href="#L454">IsAffixFlagInUse</a></li>
<li><a href="#L1572">MergeAffix</a></li>
<li><a href="#L677">NIAddAffix</a></li>
<li><a href="#L486">NIAddSpell</a></li>
<li><a href="#L103">NIFinishBuild</a></li>
<li><a href="#L1425">NIImportAffixes</a></li>
<li><a href="#L517">NIImportDictionary</a></li>
<li><a href="#L1196">NIImportOOAffixes</a></li>
<li><a href="#L2536">NINormalizeWord</a></li>
<li><a href="#L1972">NISortAffixes</a></li>
<li><a href="#L1718">NISortDictionary</a></li>
<li><a href="#L88">NIStartBuild</a></li>
<li><a href="#L2172">NormalizeSubWord</a></li>
<li><a href="#L2370">SplitToVariants</a></li>
<li><a href="#L1066">addCompoundAffixFlagValue</a></li>
<li><a href="#L2520">addNorm</a></li>
<li><a href="#L2157">addToResult</a></li>
<li><a href="#L311">cmpaffix</a></li>
<li><a href="#L210">cmpcmdflag</a></li>
<li><a href="#L197">cmpspell</a></li>
<li><a href="#L203">cmpspellaffix</a></li>
<li><a href="#L130">compact_palloc0</a></li>
<li><a href="#L162">cpstrdup</a></li>
<li><a href="#L229">findchar</a></li>
<li><a href="#L242">findchar2</a></li>
<li><a href="#L1159">getAffixFlagSet</a></li>
<li><a href="#L1123">getCompoundAffixFlagValue</a></li>
<li><a href="#L349">getNextFlagFromString</a></li>
<li><a href="#L791">get_nextfield</a></li>
<li><a href="#L1957">isAffixInUse</a></li>
<li><a href="#L175">lowerstr_ctx</a></li>
<li><a href="#L1619">makeCompoundFlags</a></li>
<li><a href="#L1826">mkANode</a></li>
<li><a href="#L1636">mkSPNode</a></li>
<li><a href="#L1903">mkVoidAffix</a></li>
<li><a href="#L913">parse_affentry</a></li>
<li><a href="#L857">parse_ooaffentry</a></li>
<li><a href="#L1031">setCompoundAffixFlagValue</a></li>
<li><a href="#L257">strbcmp</a></li>
<li><a href="#L280">strbncmp</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L126">COMPACT_ALLOC_CHUNK</a></li>
<li><a href="#L127">COMPACT_MAX_REQ</a></li>
<li><a href="#L192">GETCHAR</a></li>
<li><a href="#L191">GETWCHAR</a></li>
<li><a href="#L188">MAXNORMLEN</a></li>
<li><a href="#L187">MAX_NORM</a></li>
<li><a href="#L774">PAE_INFIND</a></li>
<li><a href="#L772">PAE_INMASK</a></li>
<li><a href="#L776">PAE_INREPL</a></li>
<li><a href="#L773">PAE_WAIT_FIND</a></li>
<li><a href="#L778">PAE_WAIT_FLAG</a></li>
<li><a href="#L771">PAE_WAIT_MASK</a></li>
<li><a href="#L775">PAE_WAIT_REPL</a></li>
<li><a href="#L777">PAE_WAIT_TYPE</a></li>
<li><a href="#L190">STRNCMP</a></li>
<li><a href="#L158">cpalloc</a></li>
<li><a href="#L159">cpalloc0</a></li>
<li><a href="#L79">tmpalloc</a></li>
<li><a href="#L80">tmpalloc0</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * spell.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Normalizing <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> with ISpell<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Ispell dictionary<br/></li>
<li></span><span class="Comment"> * -----------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Rules of dictionaries are defined in two files with .affix and .dict<br/></li>
<li></span><span class="Comment"> * extensions. They are used by spell checker programs Ispell and Hunspell.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * An .affix file declares morphological rules to get a basic form of words.<br/></li>
<li></span><span class="Comment"> * The format of an .affix file has different structure for Ispell and Hunspell<br/></li>
<li></span><span class="Comment"> * dictionaries. The Hunspell format is more complicated. But when an .affix<br/></li>
<li></span><span class="Comment"> * file is imported and compiled, it is stored in the same structure AffixNode.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * A .dict file stores a list of basic forms of words with references to<br/></li>
<li></span><span class="Comment"> * affix rules. The format of a .dict file has the same structure for Ispell<br/></li>
<li></span><span class="Comment"> * and Hunspell dictionaries.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Compilation of a dictionary<br/></li>
<li></span><span class="Comment"> * ---------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * A compiled dictionary is stored in the IspellDict structure. Compilation of<br/></li>
<li></span><span class="Comment"> * a dictionary is divided into the several steps:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - <a href="#L517" title="tsearch/spell.c:517">NIImportDictionary</a>() - stores each <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> of a .dict file in the<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; temporary Spell field.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - <a href="#L1425" title="tsearch/spell.c:1425">NIImportAffixes</a>() - stores affix rules of an .affix file in the<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Affix field (not temporary) if an .affix file has the Ispell format.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; -&gt; <a href="#L1196" title="tsearch/spell.c:1196">NIImportOOAffixes</a>() - stores affix rules if an .affix file has the<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Hunspell format. The AffixData field is initialized if AF parameter<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; is defined.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - <a href="#L1718" title="tsearch/spell.c:1718">NISortDictionary</a>() - builds a prefix tree (Trie) from the words list<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; and stores it in the Dictionary field. The words list is got from the<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; Spell field. The AffixData field is initialized if AF parameter is not<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; defined.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; - <a href="#L1972" title="tsearch/spell.c:1972">NISortAffixes</a>():<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; - builds a list of compound affixes from the affix list and stores it<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; in the CompoundAffix.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; - builds prefix trees (Trie) from the affix list for <a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a> and suffixes<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; and stores them in Suffix and Prefix fields.<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; The affix list is got from the Affix field.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Memory management<br/></li>
<li></span><span class="Comment"> * -----------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The IspellDict structure has the Spell field which is used only in compile<br/></li>
<li></span><span class="Comment"> * time. The Spell field stores a words list. It can take a lot of memory.<br/></li>
<li></span><span class="Comment"> * Therefore when a dictionary is compiled this field is cleared by<br/></li>
<li></span><span class="Comment"> * <a href="#L103" title="tsearch/spell.c:103">NIFinishBuild</a>().<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * All resources which should cleared by <a href="#L103" title="tsearch/spell.c:103">NIFinishBuild</a>() is initialized using<br/></li>
<li></span><span class="Comment"> * <a href="#L79" title="tsearch/spell.c:79">tmpalloc</a>() and <a href="#L80" title="tsearch/spell.c:80">tmpalloc0</a>().<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/tsearch/spell.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;catalog/pg_collation.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;miscadmin.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;tsearch/dicts/spell.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;tsearch/ts_locale.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/memutils.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Initialization requires a lot of memory that's not needed<br/></li>
<li></span><span class="Comment"> * after the initialization is done.&nbsp; During initialization,<br/></li>
<li></span><span class="Comment"> * <a href="../utils/mmgr/mcxt.c.html#L143" title="utils/mmgr/mcxt.c:143">CurrentMemoryContext</a> is the long-lived memory context associated<br/></li>
<li></span><span class="Comment"> * with the dictionary cache entry.&nbsp; We keep the short-lived stuff<br/></li>
<li></span><span class="Comment"> * in the Conf-&gt;buildCxt context.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L79">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">tmpalloc</span>(sz)&nbsp; <a href="../utils/mmgr/mcxt.c.html#L1180" title="utils/mmgr/mcxt.c:1180">MemoryContextAlloc</a>(Conf-&gt;buildCxt, (sz))<br/></li>
<li><a id="L80">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">tmpalloc0</span>(sz)&nbsp; <a href="../utils/mmgr/mcxt.c.html#L1214" title="utils/mmgr/mcxt.c:1214">MemoryContextAllocZero</a>(Conf-&gt;buildCxt, (sz))<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Prepare for constructing an ISpell dictionary.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The IspellDict struct is assumed to be zeroed when allocated.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L88">&#x200c;</a></span><span class="linkable">NIStartBuild</span>(IspellDict *Conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * The temp context is a child of <a href="../utils/mmgr/mcxt.c.html#L155" title="utils/mmgr/mcxt.c:155">CurTransactionContext</a>, so that it will<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * go away automatically on error.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; Conf-&gt;buildCxt = AllocSetContextCreate(<a href="../utils/mmgr/mcxt.c.html#L155" title="utils/mmgr/mcxt.c:155">CurTransactionContext</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;Ispell dictionary init context&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ALLOCSET_DEFAULT_SIZES);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Clean up when dictionary construction is complete.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L103">&#x200c;</a></span><span class="linkable">NIFinishBuild</span>(IspellDict *Conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Release no-longer-needed temp memory */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L454" title="utils/mmgr/mcxt.c:454">MemoryContextDelete</a>(Conf-&gt;buildCxt);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Just for cleanliness, zero the <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a>-dangling pointers */<br/></li>
<li></span>&nbsp; &nbsp; Conf-&gt;buildCxt = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;Spell = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;firstfree = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;CompoundAffixFlags = <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * &quot;Compact&quot; <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>: allocate without extra <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a> overhead.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Since we have no need to free the ispell data items individually, there's<br/></li>
<li></span><span class="Comment"> * not much value in the per-chunk overhead normally consumed by <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>.<br/></li>
<li></span><span class="Comment"> * Getting rid of it is helpful since ispell can allocate a lot of small nodes.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We currently pre-zero all data allocated this way, even though some of it<br/></li>
<li></span><span class="Comment"> * doesn't need that.&nbsp; The <a href="#L158" title="tsearch/spell.c:158">cpalloc</a> and <a href="#L159" title="tsearch/spell.c:159">cpalloc0</a> macros are just documentation<br/></li>
<li></span><span class="Comment"> * to indicate which allocations actually require zeroing.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L126">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">COMPACT_ALLOC_CHUNK</span> </span><span class="Constant">8192</span><span class="PreProc">&nbsp; &nbsp; </span><span class="Comment">/* amount to get from <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a> at once */<br/></li>
<li><a id="L127">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">COMPACT_MAX_REQ</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">1024</span><span class="PreProc">&nbsp; &nbsp; </span><span class="Comment">/* must be &lt; <a href="#L126" title="tsearch/spell.c:126">COMPACT_ALLOC_CHUNK</a> */<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<br/></li>
<li><a id="L130">&#x200c;</a><span class="linkable">compact_palloc0</span>(IspellDict *Conf, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp;&nbsp; *result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Should only be called during init */<br/></li>
<li></span>&nbsp; &nbsp; Assert(Conf-&gt;buildCxt != <span class="Constant">NULL</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* No point in this for large chunks */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (size &gt; <a href="#L127" title="tsearch/spell.c:127">COMPACT_MAX_REQ</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Keep everything maxaligned */<br/></li>
<li></span>&nbsp; &nbsp; size = MAXALIGN(size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Need more space? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (size &gt; Conf-&gt;avail)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;firstfree = <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(<a href="#L126" title="tsearch/spell.c:126">COMPACT_ALLOC_CHUNK</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;avail = <a href="#L126" title="tsearch/spell.c:126">COMPACT_ALLOC_CHUNK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; result = (<span class="Type">void</span> *) Conf-&gt;firstfree;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;firstfree += size;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;avail -= size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L158">&#x200c;</a><span class="PreProc">#define <span class="linkable">cpalloc</span>(size) <a href="#L130" title="tsearch/spell.c:130">compact_palloc0</a>(Conf, size)<br/></li>
<li><a id="L159">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">cpalloc0</span>(size) <a href="#L130" title="tsearch/spell.c:130">compact_palloc0</a>(Conf, size)<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L162">&#x200c;</a><span class="linkable">cpstrdup</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *res = <a href="#L158" title="tsearch/spell.c:158">cpalloc</a>(strlen(str) + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; strcpy(res, str);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Apply <a href="ts_locale.c.html#L253" title="tsearch/ts_locale.c:253">lowerstr</a>(), producing a temporary result (in the buildCxt).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L175">&#x200c;</a><span class="linkable">lowerstr_ctx</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *src)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; MemoryContext saveCtx;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *dst;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; saveCtx = MemoryContextSwitchTo(Conf-&gt;buildCxt);<br/></li>
<li>&nbsp; &nbsp; dst = <a href="ts_locale.c.html#L253" title="tsearch/ts_locale.c:253">lowerstr</a>(src);<br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(saveCtx);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L187">&#x200c;</a><span class="PreProc">#define <span class="linkable">MAX_NORM</span> </span><span class="Constant">1024<br/></li>
<li><a id="L188">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">MAXNORMLEN</span> </span><span class="Constant">256<br/></li>
<li></span><br/></li>
<li><a id="L190">&#x200c;</a><span class="PreProc">#define <span class="linkable">STRNCMP</span>(s,p)&nbsp; &nbsp; strncmp( (s), (p), strlen(p) )<br/></li>
<li><a id="L191">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">GETWCHAR</span>(W,L,N,T) ( ((</span><span class="Type">const</span><span class="PreProc"> uint8*)(W))[ ((T)==FF_PREFIX) ? (N) : ( (L) - </span><span class="Constant">1</span><span class="PreProc"> - (N) ) ] )<br/></li>
<li><a id="L192">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">GETCHAR</span>(A,N,T)&nbsp; &nbsp; &nbsp; <a href="#L191" title="tsearch/spell.c:191">GETWCHAR</a>( (A)-&gt;repl, (A)-&gt;replen, N, T )<br/></li>
<li></span><br/></li>
<li><a id="L194">&#x200c;</a><span class="Type">static</span> <span class="Type">char</span> *<span class="linkable">VoidString</span> = <span class="Constant">&quot;&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L197">&#x200c;</a></span><span class="linkable">cmpspell</span>(<span class="Type">const</span> <span class="Type">void</span> *s1, <span class="Type">const</span> <span class="Type">void</span> *s2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> strcmp((*(SPELL *<span class="Type">const</span> *) s1)-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, (*(SPELL *<span class="Type">const</span> *) s2)-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L203">&#x200c;</a></span><span class="linkable">cmpspellaffix</span>(<span class="Type">const</span> <span class="Type">void</span> *s1, <span class="Type">const</span> <span class="Type">void</span> *s2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> strcmp((*(SPELL *<span class="Type">const</span> *) s1)-&gt;p.flag,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*(SPELL *<span class="Type">const</span> *) s2)-&gt;p.flag);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L210">&#x200c;</a></span><span class="linkable">cmpcmdflag</span>(<span class="Type">const</span> <span class="Type">void</span> *f1, <span class="Type">const</span> <span class="Type">void</span> *f2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; CompoundAffixFlag *fv1 = (CompoundAffixFlag *) f1,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *fv2 = (CompoundAffixFlag *) f2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(fv1-&gt;flagMode == fv2-&gt;flagMode);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fv1-&gt;flagMode == FM_NUM)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fv1-&gt;flag.i == fv2-&gt;flag.i)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (fv1-&gt;flag.i &gt; fv2-&gt;flag.i) ? <span class="Constant">1</span> : -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> strcmp(fv1-&gt;flag.s, fv2-&gt;flag.s);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L229">&#x200c;</a><span class="linkable">findchar</span>(<span class="Type">char</span> *str, <span class="Type">int</span> c)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*str)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, c))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> str;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; str += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L242">&#x200c;</a><span class="linkable">findchar2</span>(<span class="Type">char</span> *str, <span class="Type">int</span> c1, <span class="Type">int</span> c2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*str)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, c1) || t_iseq(str, c2))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> str;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; str += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* backward string <a href="../optimizer/geqo/geqo_pool.c.html#L145" title="optimizer/geqo/geqo_pool.c:145">compare</a> for suffix tree operations */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L257">&#x200c;</a></span><span class="linkable">strbcmp</span>(<span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *s1, <span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *s2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l1 = strlen((<span class="Type">const</span> <span class="Type">char</span> *) s1) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2 = strlen((<span class="Type">const</span> <span class="Type">char</span> *) s2) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (l1 &gt;= <span class="Constant">0</span> &amp;&amp; l2 &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s1[l1] &lt; s2[l2])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s1[l1] &gt; s2[l2])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; l1--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; l2--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l1 &lt; l2)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l1 &gt; l2)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L280">&#x200c;</a></span><span class="linkable">strbncmp</span>(<span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *s1, <span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *s2, <span class="Type">size_t</span> count)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l1 = strlen((<span class="Type">const</span> <span class="Type">char</span> *) s1) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2 = strlen((<span class="Type">const</span> <span class="Type">char</span> *) s2) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l = count;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (l1 &gt;= <span class="Constant">0</span> &amp;&amp; l2 &gt;= <span class="Constant">0</span> &amp;&amp; l &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s1[l1] &lt; s2[l2])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s1[l1] &gt; s2[l2])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; l1--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; l2--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; l--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l1 &lt; l2)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l1 &gt; l2)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Compares affixes.<br/></li>
<li></span><span class="Comment"> * First compares the type of an affix. Prefixes should go <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> affixes.<br/></li>
<li></span><span class="Comment"> * If types are <a href="../nodes/equalfuncs.c.html#L223" title="nodes/equalfuncs.c:223">equal</a> then compares replaceable string.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L311">&#x200c;</a></span><span class="linkable">cmpaffix</span>(<span class="Type">const</span> <span class="Type">void</span> *s1, <span class="Type">const</span> <span class="Type">void</span> *s2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> AFFIX *<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> = (<span class="Type">const</span> AFFIX *) s1;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> AFFIX *<a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> = (<span class="Type">const</span> AFFIX *) s2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>-&gt;type &lt; <a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>-&gt;type)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>-&gt;type &gt; <a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>-&gt;type)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>-&gt;type == FF_PREFIX)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> strcmp(<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>-&gt;repl, <a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>-&gt;repl);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L257" title="tsearch/spell.c:257">strbcmp</a>((<span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *) <a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>-&gt;repl,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *) <a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>-&gt;repl);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Gets an affix flag from the set of affix flags (sflagset).<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Several flags can be stored in a single string. Flags can be represented by:<br/></li>
<li></span><span class="Comment"> * - 1 character (FM_CHAR). A character may be Unicode.<br/></li>
<li></span><span class="Comment"> * - 2 characters (FM_LONG). A character may be Unicode.<br/></li>
<li></span><span class="Comment"> * - numbers from 1 to 65000 (FM_NUM).<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Depending on the flagMode an affix string can have the following format:<br/></li>
<li></span><span class="Comment"> * - FM_CHAR: ABCD<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; Here we have 4 flags: A, B, C and D<br/></li>
<li></span><span class="Comment"> * - FM_LONG: ABCDE*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; Here we have 3 flags: AB, CD and E*<br/></li>
<li></span><span class="Comment"> * - FM_NUM: 200,205,50<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; Here we have 3 flags: 200, 205 and 50<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * sflagset: the set of affix flags. Returns a reference to the start of a <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; affix flag.<br/></li>
<li></span><span class="Comment"> * sflag: returns an affix flag from sflagset.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L349">&#x200c;</a></span><span class="linkable">getNextFlagFromString</span>(IspellDict *Conf, <span class="Type">char</span> **sflagset, <span class="Type">char</span> *sflag)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; int32&nbsp; &nbsp; &nbsp; &nbsp; s;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *sbuf = *sflagset;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; maxstep;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; stop = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; met_comma = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; maxstep = (Conf-&gt;flagMode == FM_LONG) ? <span class="Constant">2</span> : <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (**sflagset)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (Conf-&gt;flagMode)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> FM_LONG:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> FM_CHAR:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(sflag, *sflagset);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sflag += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(*sflagset);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Go to start of the <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> flag */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *sflagset += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(*sflagset);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Check if we get all characters of flag */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; maxstep--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stop = (maxstep == <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> FM_NUM:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s = strtol(*sflagset, &amp;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>, <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*sflagset == <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> || errno == <span class="Constant">ERANGE</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, *sflagset)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s &lt; <span class="Constant">0</span> || s &gt; FLAGNUM_MAXSIZE)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> is out of <a href="../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *sflagset)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sflag += sprintf(sflag, <span class="Constant">&quot;</span><span class="Special">%0d</span><span class="Constant">&quot;</span>, s);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Go to start of the <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> flag */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *sflagset = <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (**sflagset)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ts_locale.c.html#L35" title="tsearch/ts_locale.c:35">t_isdigit</a>(*sflagset))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!met_comma)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *sflagset)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (t_iseq(*sflagset, <span class="Constant">','</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (met_comma)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *sflagset)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; met_comma = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(*sflagset))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid character in affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *sflagset)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *sflagset += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(*sflagset);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stop = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized type of Conf-&gt;flagMode: </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Conf-&gt;flagMode);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stop)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;flagMode == FM_LONG &amp;&amp; maxstep &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> with </span><span class="Special">\&quot;</span><span class="Constant">long</span><span class="Special">\&quot;</span><span class="Constant"> flag value&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbuf)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *sflag = <span class="Special">'\0'</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Checks if the affix set Conf-&gt;AffixData[affix] contains affixflag.<br/></li>
<li></span><span class="Comment"> * Conf-&gt;AffixData[affix] does not contain affixflag if this flag is not used<br/></li>
<li></span><span class="Comment"> * actually by the .dict file.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * affix: index of the Conf-&gt;AffixData array.<br/></li>
<li></span><span class="Comment"> * affixflag: the affix flag.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true if the string Conf-&gt;AffixData[affix] contains affixflag,<br/></li>
<li></span><span class="Comment"> * otherwise returns false.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L454">&#x200c;</a></span><span class="linkable">IsAffixFlagInUse</span>(IspellDict *Conf, <span class="Type">int</span> affix, <span class="Type">const</span> <span class="Type">char</span> *affixflag)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *flagcur;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; flag[<span class="Constant">BUFSIZ</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*affixflag == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(affix &lt; Conf-&gt;nAffixData);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; flagcur = Conf-&gt;AffixData[affix];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*flagcur)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L349" title="tsearch/spell.c:349">getNextFlagFromString</a>(Conf, &amp;flagcur, flag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Compare first affix flag in flagcur with affixflag */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (strcmp(flag, affixflag) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Could not <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> affixflag */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Adds the new <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> into the temporary array Spell.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>: new <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>.<br/></li>
<li></span><span class="Comment"> * flag: set of affix flags. Single flag can be get by <a href="#L349" title="tsearch/spell.c:349">getNextFlagFromString</a>().<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L486">&#x200c;</a></span><span class="linkable">NIAddSpell</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">const</span> <span class="Type">char</span> *flag)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;nspell &gt;= Conf-&gt;mspell)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;mspell)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;mspell *= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell = (SPELL **) <a href="../utils/mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(Conf-&gt;Spell, Conf-&gt;mspell * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(SPELL *));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;mspell = <span class="Constant">1024</span> * <span class="Constant">20</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell = (SPELL **) <a href="#L79" title="tsearch/spell.c:79">tmpalloc</a>(Conf-&gt;mspell * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(SPELL *));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;Spell[Conf-&gt;nspell] = (SPELL *) <a href="#L79" title="tsearch/spell.c:79">tmpalloc</a>(SPELLHDRSZ + strlen(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>) + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; strcpy(Conf-&gt;Spell[Conf-&gt;nspell]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;Spell[Conf-&gt;nspell]-&gt;p.flag = (*flag != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ? <a href="#L162" title="tsearch/spell.c:162">cpstrdup</a>(Conf, flag) : <a href="#L194" title="tsearch/spell.c:194">VoidString</a>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;nspell++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Imports dictionary into the temporary array Spell.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note caller must already have applied <a href="ts_utils.c.html#L33" title="tsearch/ts_utils.c:33">get_tsearch_config_filename</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * filename: path to the .dict file.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L517">&#x200c;</a></span><span class="linkable">NIImportDictionary</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *filename)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; tsearch_readline_state trst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *line;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="ts_locale.c.html#L134" title="tsearch/ts_locale.c:134">tsearch_readline_begin</a>(&amp;trst, filename))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;could not open dictionary file </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">: %m&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((line = <a href="ts_locale.c.html#L157" title="tsearch/ts_locale.c:157">tsearch_readline</a>(&amp;trst)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *s,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *pstr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Set of affix flags */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *flag;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Extract flag from the line */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; flag = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((s = <a href="#L229" title="tsearch/spell.c:229">findchar</a>(line, <span class="Constant">'/'</span>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *s++ = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = s;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we allow only single encoded flags for faster works */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s) == <span class="Constant">1</span> &amp;&amp; <a href="ts_locale.c.html#L95" title="tsearch/ts_locale.c:95">t_isprint</a>(s) &amp;&amp; !<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *s = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag = <span class="Constant">&quot;&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Remove trailing spaces */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; s = line;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *s = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pstr = <a href="#L175" title="tsearch/spell.c:175">lowerstr_ctx</a>(Conf, line);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L486" title="tsearch/spell.c:486">NIAddSpell</a>(Conf, pstr, flag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(pstr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(line);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <a href="ts_locale.c.html#L202" title="tsearch/ts_locale.c:202">tsearch_readline_end</a>(&amp;trst);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Searches a basic form of <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> in the prefix tree. This <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> was generated<br/></li>
<li></span><span class="Comment"> * using an affix rule. This rule may not be presented in an affix set of<br/></li>
<li></span><span class="Comment"> * a basic form of <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * For example, we have the entry in the .dict file:<br/></li>
<li></span><span class="Comment"> * meter/GMD<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The affix rule with the flag S:<br/></li>
<li></span><span class="Comment"> * SFX S&nbsp;&nbsp; y&nbsp; &nbsp;&nbsp; ies&nbsp; &nbsp; &nbsp; &nbsp; [^aeiou]y<br/></li>
<li></span><span class="Comment"> * is not presented here.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The affix rule with the flag M:<br/></li>
<li></span><span class="Comment"> * SFX M&nbsp;&nbsp; 0&nbsp; &nbsp;&nbsp; 's&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .<br/></li>
<li></span><span class="Comment"> * is presented here.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>: basic form of <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>.<br/></li>
<li></span><span class="Comment"> * affixflag: affix flag, by which a basic form of <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> was generated.<br/></li>
<li></span><span class="Comment"> * flag: compound flag used to <a href="../optimizer/geqo/geqo_pool.c.html#L145" title="optimizer/geqo/geqo_pool.c:145">compare</a> with StopMiddle-&gt;compoundflag.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns 1 if the <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> was found in the prefix tree, else returns 0.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L602">&#x200c;</a></span><span class="linkable">FindWord</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">const</span> <span class="Type">char</span> *affixflag, <span class="Type">int</span> flag)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; SPNode&nbsp; &nbsp; &nbsp;&nbsp; *node = Conf-&gt;Dictionary;<br/></li>
<li>&nbsp; &nbsp; SPNodeData *StopLow,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *StopHigh,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *StopMiddle;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> uint8 *ptr = (<span class="Type">const</span> uint8 *) <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; flag &amp;= FF_COMPOUNDFLAGMASK;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (node &amp;&amp; *ptr)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StopLow = node-&gt;data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StopHigh = node-&gt;data + node-&gt;length;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (StopLow &lt; StopHigh)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopMiddle = StopLow + ((StopHigh - StopLow) &gt;&gt; <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopMiddle-&gt;val == *ptr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*(ptr + <span class="Constant">1</span>) == <span class="Special">'\0'</span> &amp;&amp; StopMiddle-&gt;isword)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flag == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * The <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> can be formed only with another <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>. And<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * in the flag parameter there is not a sign that we<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * search compound words.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopMiddle-&gt;compoundflag &amp; FF_COMPOUNDONLY)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> ((flag &amp; StopMiddle-&gt;compoundflag) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Check if this affix rule is presented in the affix set<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * with index StopMiddle-&gt;affix.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L454" title="tsearch/spell.c:454">IsAffixFlagInUse</a>(Conf, StopMiddle-&gt;affix, affixflag))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = StopMiddle-&gt;node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (StopMiddle-&gt;val &lt; *ptr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopLow = StopMiddle + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopHigh = StopMiddle;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopLow &gt;= StopHigh)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Adds a new affix rule to the Affix field.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * flag: affix flag ('\' in the below example).<br/></li>
<li></span><span class="Comment"> * flagflags: set of flags from the flagval field for this affix rule. This set<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is listed after '/' character in the added string (repl).<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; For example L flag in the hunspell_sample.affix:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SFX \&nbsp;&nbsp; 0 Y/L [^Y]<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * mask: condition for search ('[^Y]' in the above example).<br/></li>
<li></span><span class="Comment"> * <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>: stripping characters from beginning (at prefix) or end (at suffix)<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; of the <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> ('0' in the above example, 0 means that there is not<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; stripping character).<br/></li>
<li></span><span class="Comment"> * repl: adding string after stripping ('Y' in the above example).<br/></li>
<li></span><span class="Comment"> * type: FF_SUFFIX or FF_PREFIX.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L677">&#x200c;</a></span><span class="linkable">NIAddAffix</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *flag, <span class="Type">char</span> flagflags, <span class="Type">const</span> <span class="Type">char</span> *mask,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <span class="Type">char</span> *<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, <span class="Type">const</span> <span class="Type">char</span> *repl, <span class="Type">int</span> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; AFFIX&nbsp; &nbsp; &nbsp;&nbsp; *Affix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;naffixes &gt;= Conf-&gt;maffixes)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;maffixes)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;maffixes *= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Affix = (AFFIX *) <a href="../utils/mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(Conf-&gt;Affix, Conf-&gt;maffixes * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;maffixes = <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Affix = (AFFIX *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(Conf-&gt;maffixes * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Affix = Conf-&gt;Affix + Conf-&gt;naffixes;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* This affix rule can be applied for words with <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> ending */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (strcmp(mask, <span class="Constant">&quot;.&quot;</span>) == <span class="Constant">0</span> || *mask == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;issimple = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;isregis = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* This affix rule will use regis to search <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> ending */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="regis.c.html#L31" title="tsearch/regis.c:31">RS_isRegis</a>(mask))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;issimple = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;isregis = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="regis.c.html#L85" title="tsearch/regis.c:85">RS_compile</a>(&amp;(Affix-&gt;reg.regis), (type == FF_SUFFIX),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *mask ? mask : <a href="#L194" title="tsearch/spell.c:194">VoidString</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* This affix rule will use regex_t to search <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> ending */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; masklen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wmasklen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pg_wchar&nbsp;&nbsp; *wmask;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *tmask;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;issimple = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;isregis = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tmask = (<span class="Type">char</span> *) <a href="#L79" title="tsearch/spell.c:79">tmpalloc</a>(strlen(mask) + <span class="Constant">3</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type == FF_SUFFIX)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(tmask, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">$&quot;</span>, mask);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sprintf(tmask, <span class="Constant">&quot;^</span><span class="Special">%s</span><span class="Constant">&quot;</span>, mask);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; masklen = strlen(tmask);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wmask = (pg_wchar *) <a href="#L79" title="tsearch/spell.c:79">tmpalloc</a>((masklen + <span class="Constant">1</span>) * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(pg_wchar));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wmasklen = <a href="../utils/mb/mbutils.c.html#L986" title="utils/mb/mbutils.c:986">pg_mb2wchar_with_len</a>(tmask, wmask, masklen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * The regex and all <a href="../utils/adt/pseudotypes.c.html#L373" title="utils/adt/pseudotypes.c:373">internal</a> state created by <a href="../regex/regcomp.c.html#L370" title="regex/regcomp.c:370">pg_regcomp</a> are<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * allocated in the dictionary's memory context, and will be freed<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * automatically when it is destroyed.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;reg.pregex = <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(regex_t));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; err = <a href="../regex/regcomp.c.html#L370" title="regex/regcomp.c:370">pg_regcomp</a>(Affix-&gt;reg.pregex, wmask, wmasklen,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; REG_ADVANCED | REG_NOSUB,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; DEFAULT_COLLATION_OID);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (err)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; errstr[<span class="Constant">100</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regerror.c.html#L60" title="regex/regerror.c:60">pg_regerror</a>(err, Affix-&gt;reg.pregex, errstr, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(errstr));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_INVALID_REGULAR_EXPRESSION),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid regular expression: </span><span class="Special">%s</span><span class="Constant">&quot;</span>, errstr)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Affix-&gt;flagflags = flagflags;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((Affix-&gt;flagflags &amp; FF_COMPOUNDONLY) || (Affix-&gt;flagflags &amp; FF_COMPOUNDPERMITFLAG))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((Affix-&gt;flagflags &amp; FF_COMPOUNDFLAG) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;flagflags |= FF_COMPOUNDFLAG;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; Affix-&gt;flag = <a href="#L162" title="tsearch/spell.c:162">cpstrdup</a>(Conf, flag);<br/></li>
<li>&nbsp; &nbsp; Affix-&gt;type = type;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Affix-&gt;<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> = (<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> &amp;&amp; *<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>) ? <a href="#L162" title="tsearch/spell.c:162">cpstrdup</a>(Conf, <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>) : <a href="#L194" title="tsearch/spell.c:194">VoidString</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((Affix-&gt;replen = strlen(repl)) &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;repl = <a href="#L162" title="tsearch/spell.c:162">cpstrdup</a>(Conf, repl);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;repl = <a href="#L194" title="tsearch/spell.c:194">VoidString</a>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;naffixes++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* Parsing states for <a href="#L913" title="tsearch/spell.c:913">parse_affentry</a>() and friends */<br/></li>
<li><a id="L771">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_WAIT_MASK</span>&nbsp; &nbsp; </span><span class="Constant">0<br/></li>
<li><a id="L772">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_INMASK</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">1<br/></li>
<li><a id="L773">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_WAIT_FIND</span>&nbsp; &nbsp; </span><span class="Constant">2<br/></li>
<li><a id="L774">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_INFIND</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">3<br/></li>
<li><a id="L775">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_WAIT_REPL</span>&nbsp; &nbsp; </span><span class="Constant">4<br/></li>
<li><a id="L776">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_INREPL</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">5<br/></li>
<li><a id="L777">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_WAIT_TYPE</span>&nbsp; &nbsp; </span><span class="Constant">6<br/></li>
<li><a id="L778">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">PAE_WAIT_FLAG</span>&nbsp; &nbsp; </span><span class="Constant">7<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Parse <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> space-separated field of an .affix file line.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * *str is the input pointer (will be advanced past field)<br/></li>
<li></span><span class="Comment"> * <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> is where to copy the field value to, with null termination<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * The buffer at &quot;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>&quot; must be of size BUFSIZ; we truncate the input to fit.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true if we found a field, false if not.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L791">&#x200c;</a></span><span class="linkable">get_nextfield</span>(<span class="Type">char</span> **str, <span class="Type">char</span> *<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L771" title="tsearch/spell.c:771">PAE_WAIT_MASK</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; avail = <span class="Constant">BUFSIZ</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (**str)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (state == <a href="#L771" title="tsearch/spell.c:771">PAE_WAIT_MASK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(*str, <span class="Constant">'#'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(*str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clen = <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(*str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clen &lt; avail)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>, *str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> += clen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; avail -= clen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L772" title="tsearch/spell.c:772">PAE_INMASK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* state == <a href="#L772" title="tsearch/spell.c:772">PAE_INMASK</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(*str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clen = <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(*str);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clen &lt; avail)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>, *str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> += clen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; avail -= clen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *str += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(*str);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (state == <a href="#L772" title="tsearch/spell.c:772">PAE_INMASK</a>);&nbsp; &nbsp; <span class="Comment">/* OK if we got a nonempty field */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Parses entry of an .affix file of MySpell or Hunspell format.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * An .affix file entry has the following format:<br/></li>
<li></span><span class="Comment"> * - header<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; &lt;type&gt;&nbsp; &lt;flag&gt;&nbsp; &lt;cross_flag&gt;&nbsp; &lt;flag_count&gt;<br/></li>
<li></span><span class="Comment"> * - fields after header:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp;&nbsp; &lt;type&gt;&nbsp; &lt;flag&gt;&nbsp; &lt;<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>&gt;&nbsp; &lt;replace&gt;&nbsp; &nbsp; &lt;mask&gt;<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * str is the input line<br/></li>
<li></span><span class="Comment"> * field <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a> are returned to type etc, which must be buffers of size BUFSIZ.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns number of fields found; <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> omitted fields are set to empty strings.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L857">&#x200c;</a></span><span class="linkable">parse_ooaffentry</span>(<span class="Type">char</span> *str, <span class="Type">char</span> *type, <span class="Type">char</span> *flag, <span class="Type">char</span> *<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">char</span> *repl, <span class="Type">char</span> *mask)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L777" title="tsearch/spell.c:777">PAE_WAIT_TYPE</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fields_read = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; valid = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *type = *flag = *<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> = *repl = *mask = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*str)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (state)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="#L777" title="tsearch/spell.c:777">PAE_WAIT_TYPE</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valid = <a href="#L791" title="tsearch/spell.c:791">get_nextfield</a>(&amp;str, type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L778" title="tsearch/spell.c:778">PAE_WAIT_FLAG</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="#L778" title="tsearch/spell.c:778">PAE_WAIT_FLAG</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valid = <a href="#L791" title="tsearch/spell.c:791">get_nextfield</a>(&amp;str, flag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L773" title="tsearch/spell.c:773">PAE_WAIT_FIND</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="#L773" title="tsearch/spell.c:773">PAE_WAIT_FIND</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valid = <a href="#L791" title="tsearch/spell.c:791">get_nextfield</a>(&amp;str, <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L775" title="tsearch/spell.c:775">PAE_WAIT_REPL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="#L775" title="tsearch/spell.c:775">PAE_WAIT_REPL</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valid = <a href="#L791" title="tsearch/spell.c:791">get_nextfield</a>(&amp;str, repl);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L771" title="tsearch/spell.c:771">PAE_WAIT_MASK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="#L771" title="tsearch/spell.c:771">PAE_WAIT_MASK</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valid = <a href="#L791" title="tsearch/spell.c:791">get_nextfield</a>(&amp;str, mask);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = -<span class="Constant">1</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* force loop exit */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">default</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized state in <a href="#L857" title="tsearch/spell.c:857">parse_ooaffentry</a>: </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; state);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (valid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fields_read++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* early EOL */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (state &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* got all fields */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> fields_read;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Parses entry of an .affix file of Ispell format<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * An .affix file entry has the following format:<br/></li>
<li></span><span class="Comment"> * &lt;mask&gt;&nbsp; &gt;&nbsp; [-&lt;<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>&gt;,]&lt;replace&gt;<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L913">&#x200c;</a></span><span class="linkable">parse_affentry</span>(<span class="Type">char</span> *str, <span class="Type">char</span> *mask, <span class="Type">char</span> *<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, <span class="Type">char</span> *repl)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L771" title="tsearch/spell.c:771">PAE_WAIT_MASK</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *pmask = mask,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *pfind = <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *prepl = repl;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *mask = *<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> = *repl = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*str)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (state == <a href="#L771" title="tsearch/spell.c:771">PAE_WAIT_MASK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, <span class="Constant">'#'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(pmask, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pmask += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L772" title="tsearch/spell.c:772">PAE_INMASK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (state == <a href="#L772" title="tsearch/spell.c:772">PAE_INMASK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, <span class="Constant">'&gt;'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *pmask = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L773" title="tsearch/spell.c:773">PAE_WAIT_FIND</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(pmask, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pmask += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (state == <a href="#L773" title="tsearch/spell.c:773">PAE_WAIT_FIND</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, <span class="Constant">'-'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L774" title="tsearch/spell.c:774">PAE_INFIND</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="ts_locale.c.html#L65" title="tsearch/ts_locale.c:65">t_isalpha</a>(str) || t_iseq(str, <span class="Special">'\''</span>) <span class="Comment">/* english 's */</span> )<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(prepl, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prepl += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L776" title="tsearch/spell.c:776">PAE_INREPL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;syntax error&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (state == <a href="#L774" title="tsearch/spell.c:774">PAE_INFIND</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, <span class="Constant">','</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *pfind = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L775" title="tsearch/spell.c:775">PAE_WAIT_REPL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="ts_locale.c.html#L65" title="tsearch/ts_locale.c:65">t_isalpha</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(pfind, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pfind += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;syntax error&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (state == <a href="#L775" title="tsearch/spell.c:775">PAE_WAIT_REPL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, <span class="Constant">'-'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* void repl */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="ts_locale.c.html#L65" title="tsearch/ts_locale.c:65">t_isalpha</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(prepl, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prepl += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = <a href="#L776" title="tsearch/spell.c:776">PAE_INREPL</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;syntax error&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (state == <a href="#L776" title="tsearch/spell.c:776">PAE_INREPL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(str, <span class="Constant">'#'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *prepl = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="ts_locale.c.html#L65" title="tsearch/ts_locale.c:65">t_isalpha</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(prepl, str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prepl += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(str))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;syntax error&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;unrecognized state in <a href="#L913" title="tsearch/spell.c:913">parse_affentry</a>: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, state);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; str += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(str);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *pmask = *pfind = *prepl = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (*mask &amp;&amp; (*<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> || *repl));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Sets a Hunspell options depending on flag type.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1031">&#x200c;</a></span><span class="linkable">setCompoundAffixFlagValue</span>(IspellDict *Conf, CompoundAffixFlag *entry,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> *s, uint32 val)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;flagMode == FM_NUM)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = strtol(s, &amp;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>, <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s == <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> || errno == <span class="Constant">ERANGE</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, s)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &lt; <span class="Constant">0</span> || i &gt; FLAGNUM_MAXSIZE)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;affix flag </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> is out of <a href="../regex/regc_locale.c.html#L412" title="regex/regc_locale.c:412">range</a>&quot;</span>, s)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;flag.i = i;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; entry-&gt;flag.s = <a href="#L162" title="tsearch/spell.c:162">cpstrdup</a>(Conf, s);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; entry-&gt;flagMode = Conf-&gt;flagMode;<br/></li>
<li>&nbsp; &nbsp; entry-&gt;value = val;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Sets up a correspondence for the affix parameter with the affix flag.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * s: affix flag in string.<br/></li>
<li></span><span class="Comment"> * val: affix parameter.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1066">&#x200c;</a></span><span class="linkable">addCompoundAffixFlagValue</span>(IspellDict *Conf, <span class="Type">char</span> *s, uint32 val)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; CompoundAffixFlag *newValue;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; sbuf[<span class="Constant">BUFSIZ</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *sflag;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*s &amp;&amp; <a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!*s)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;syntax error&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Get flag without \n */<br/></li>
<li></span>&nbsp; &nbsp; sflag = sbuf;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*s &amp;&amp; !<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s) &amp;&amp; *s != <span class="Special">'\n'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; clen = <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(sflag, s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sflag += clen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += clen;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; *sflag = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Resize array or allocate memory for array CompoundAffixFlag */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;nCompoundAffixFlag &gt;= Conf-&gt;mCompoundAffixFlag)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;mCompoundAffixFlag)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;mCompoundAffixFlag *= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;CompoundAffixFlags = (CompoundAffixFlag *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(Conf-&gt;CompoundAffixFlags,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Conf-&gt;mCompoundAffixFlag * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(CompoundAffixFlag));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;mCompoundAffixFlag = <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;CompoundAffixFlags = (CompoundAffixFlag *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L79" title="tsearch/spell.c:79">tmpalloc</a>(Conf-&gt;mCompoundAffixFlag * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(CompoundAffixFlag));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; newValue = Conf-&gt;CompoundAffixFlags + Conf-&gt;nCompoundAffixFlag;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L1031" title="tsearch/spell.c:1031">setCompoundAffixFlagValue</a>(Conf, newValue, sbuf, val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Conf-&gt;usecompound = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;nCompoundAffixFlag++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Returns a set of affix parameters which correspondence to the set of affix<br/></li>
<li></span><span class="Comment"> * flags s.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L1123">&#x200c;</a></span><span class="linkable">getCompoundAffixFlagValue</span>(IspellDict *Conf, <span class="Type">char</span> *s)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; uint32&nbsp; &nbsp; &nbsp; &nbsp; flag = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; CompoundAffixFlag *found,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; key;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; sflag[<span class="Constant">BUFSIZ</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *flagcur;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;nCompoundAffixFlag == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; flagcur = s;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*flagcur)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L349" title="tsearch/spell.c:349">getNextFlagFromString</a>(Conf, &amp;flagcur, sflag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1031" title="tsearch/spell.c:1031">setCompoundAffixFlagValue</a>(Conf, &amp;key, sflag, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; found = (CompoundAffixFlag *)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bsearch(&amp;key, Conf-&gt;CompoundAffixFlags,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;nCompoundAffixFlag, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(CompoundAffixFlag),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L210" title="tsearch/spell.c:210">cmpcmdflag</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (found != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag |= found-&gt;value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> flag;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Returns a flag set using the s parameter.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * If Conf-&gt;useFlagAliases is true then the s parameter is index of the<br/></li>
<li></span><span class="Comment"> * Conf-&gt;AffixData array and function returns its entry.<br/></li>
<li></span><span class="Comment"> * Else function returns the s parameter.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1159">&#x200c;</a><span class="linkable">getAffixFlagSet</span>(IspellDict *Conf, <span class="Type">char</span> *s)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;useFlagAliases &amp;&amp; *s != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *end;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; curaffix = strtol(s, &amp;end, <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s == end || errno == <span class="Constant">ERANGE</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix alias </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, s)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (curaffix &gt; <span class="Constant">0</span> &amp;&amp; curaffix &lt; Conf-&gt;nAffixData)<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Do not subtract 1 from curaffix because empty string was added<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * in <a href="#L1196" title="tsearch/spell.c:1196">NIImportOOAffixes</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> Conf-&gt;AffixData[curaffix];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (curaffix &gt; Conf-&gt;nAffixData)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix alias </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, s)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L194" title="tsearch/spell.c:194">VoidString</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> s;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Import an affix file that follows MySpell or Hunspell format.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * filename: path to the .affix file.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1196">&#x200c;</a></span><span class="linkable">NIImportOOAffixes</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *filename)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; type[<span class="Constant">BUFSIZ</span>],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *ptype = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; sflag[<span class="Constant">BUFSIZ</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; mask[<span class="Constant">BUFSIZ</span>],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *pmask;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>[<span class="Constant">BUFSIZ</span>],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *pfind;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; repl[<span class="Constant">BUFSIZ</span>],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *prepl;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; isSuffix = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naffix = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sflaglen = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; flagflags = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; tsearch_readline_state trst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *recoded;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* read file to <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> <a href="../utils/adt/pseudotypes.c.html#L365" title="utils/adt/pseudotypes.c:365">any</a> flag */<br/></li>
<li></span>&nbsp; &nbsp; Conf-&gt;usecompound = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;useFlagAliases = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;flagMode = FM_CHAR;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="ts_locale.c.html#L134" title="tsearch/ts_locale.c:134">tsearch_readline_begin</a>(&amp;trst, filename))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;could not open affix file </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">: %m&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((recoded = <a href="ts_locale.c.html#L157" title="tsearch/ts_locale.c:157">tsearch_readline</a>(&amp;trst)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*recoded == <span class="Special">'\0'</span> || <a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(recoded) || t_iseq(recoded, <span class="Constant">'#'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(recoded);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDFLAG&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf, recoded + strlen(<span class="Constant">&quot;COMPOUNDFLAG&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDFLAG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDBEGIN&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf, recoded + strlen(<span class="Constant">&quot;COMPOUNDBEGIN&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDBEGIN);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDLAST&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf, recoded + strlen(<span class="Constant">&quot;COMPOUNDLAST&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDLAST);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* COMPOUNDLAST and COMPOUNDEND are synonyms */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDEND&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf, recoded + strlen(<span class="Constant">&quot;COMPOUNDEND&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDLAST);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDMIDDLE&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf, recoded + strlen(<span class="Constant">&quot;COMPOUNDMIDDLE&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDMIDDLE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;ONLYINCOMPOUND&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf, recoded + strlen(<span class="Constant">&quot;ONLYINCOMPOUND&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDONLY);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDPERMITFLAG&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recoded + strlen(<span class="Constant">&quot;COMPOUNDPERMITFLAG&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDPERMITFLAG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDFORBIDFLAG&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recoded + strlen(<span class="Constant">&quot;COMPOUNDFORBIDFLAG&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDFORBIDFLAG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;FLAG&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *s = recoded + strlen(<span class="Constant">&quot;FLAG&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s &amp;&amp; <a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(s, <span class="Constant">&quot;long&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;flagMode = FM_LONG;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(s, <span class="Constant">&quot;num&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;flagMode = FM_NUM;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(s, <span class="Constant">&quot;default&quot;</span>) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;Ispell dictionary supports only &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">default</span><span class="Special">\&quot;</span><span class="Constant">, </span><span class="Special">\&quot;</span><span class="Constant">long</span><span class="Special">\&quot;</span><span class="Constant">, &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;and </span><span class="Special">\&quot;</span><span class="Constant">num</span><span class="Special">\&quot;</span><span class="Constant"> flag <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(recoded);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <a href="ts_locale.c.html#L202" title="tsearch/ts_locale.c:202">tsearch_readline_end</a>(&amp;trst);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;nCompoundAffixFlag &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; qsort(Conf-&gt;CompoundAffixFlags, Conf-&gt;nCompoundAffixFlag,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(CompoundAffixFlag), <a href="#L210" title="tsearch/spell.c:210">cmpcmdflag</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="ts_locale.c.html#L134" title="tsearch/ts_locale.c:134">tsearch_readline_begin</a>(&amp;trst, filename))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;could not open affix file </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">: %m&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((recoded = <a href="ts_locale.c.html#L157" title="tsearch/ts_locale.c:157">tsearch_readline</a>(&amp;trst)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fields_read;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*recoded == <span class="Special">'\0'</span> || <a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(recoded) || t_iseq(recoded, <span class="Constant">'#'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fields_read = <a href="#L857" title="tsearch/spell.c:857">parse_ooaffentry</a>(recoded, type, sflag, <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, repl, mask);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ptype)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(ptype);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ptype = <a href="#L175" title="tsearch/spell.c:175">lowerstr_ctx</a>(Conf, type);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* First try to <a href="../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> AF parameter (alias compression) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(ptype, <span class="Constant">&quot;af&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* First line is the number of aliases */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!Conf-&gt;useFlagAliases)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;useFlagAliases = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naffix = atoi(sflag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (naffix &lt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid number of flag vector aliases&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Also reserve place for empty flag set */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naffix++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;AffixData = (<span class="Type">char</span> **) <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(naffix * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;lenAffixData = Conf-&gt;nAffixData = naffix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Add empty flag set into AffixData */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;AffixData[curaffix] = <a href="#L194" title="tsearch/spell.c:194">VoidString</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Other lines are aliases */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (curaffix &lt; naffix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;AffixData[curaffix] = <a href="#L162" title="tsearch/spell.c:162">cpstrdup</a>(Conf, sflag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;number of aliases exceeds specified number </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naffix - <span class="Constant">1</span>)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Else try to <a href="../regex/regcomp.c.html#L715" title="regex/regcomp.c:715">parse</a> <a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a> and suffixes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fields_read &lt; <span class="Constant">4</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(ptype, <span class="Constant">&quot;sfx&quot;</span>) != <span class="Constant">0</span> &amp;&amp; <a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(ptype, <span class="Constant">&quot;pfx&quot;</span>) != <span class="Constant">0</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sflaglen = strlen(sflag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sflaglen == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (sflaglen &gt; <span class="Constant">1</span> &amp;&amp; Conf-&gt;flagMode == FM_CHAR)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (sflaglen &gt; <span class="Constant">2</span> &amp;&amp; Conf-&gt;flagMode == FM_LONG))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*--------<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Affix header. For example:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * SFX \ N 1<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *--------<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fields_read == <span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; isSuffix = (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(ptype, <span class="Constant">&quot;sfx&quot;</span>) == <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, <span class="Constant">'y'</span>) || t_iseq(<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, <span class="Constant">'Y'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flagflags = FF_CROSSPRODUCT;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flagflags = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*--------<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Affix fields. For example:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * SFX \&nbsp;&nbsp; 0&nbsp; &nbsp; Y/L [^Y]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *--------<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *ptr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aflg = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Get flags after '/' (flags are case sensitive) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ptr = strchr(repl, <span class="Constant">'/'</span>)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aflg |= <a href="#L1123" title="tsearch/spell.c:1123">getCompoundAffixFlagValue</a>(Conf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1159" title="tsearch/spell.c:1159">getAffixFlagSet</a>(Conf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr + <span class="Constant">1</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Get lowercased version of string <a href="../regex/regc_locale.c.html#L488" title="regex/regc_locale.c:488">before</a> '/' */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prepl = <a href="#L175" title="tsearch/spell.c:175">lowerstr_ctx</a>(Conf, repl);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ptr = strchr(prepl, <span class="Constant">'/'</span>)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *ptr = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pfind = <a href="#L175" title="tsearch/spell.c:175">lowerstr_ctx</a>(Conf, <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pmask = <a href="#L175" title="tsearch/spell.c:175">lowerstr_ctx</a>(Conf, mask);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, <span class="Constant">'0'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *pfind = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (t_iseq(repl, <span class="Constant">'0'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *prepl = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L677" title="tsearch/spell.c:677">NIAddAffix</a>(Conf, sflag, flagflags | aflg, pmask, pfind, prepl,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; isSuffix ? FF_SUFFIX : FF_PREFIX);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prepl);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(pfind);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(pmask);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="Statement">nextline</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(recoded);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ts_locale.c.html#L202" title="tsearch/ts_locale.c:202">tsearch_readline_end</a>(&amp;trst);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ptype)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(ptype);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * import affixes<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Note caller must already have applied <a href="ts_utils.c.html#L33" title="tsearch/ts_utils.c:33">get_tsearch_config_filename</a><br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This function is responsible for parsing ispell (&quot;old format&quot;) affix files.<br/></li>
<li></span><span class="Comment"> * If we realize that the file contains new-format commands, we pass off the<br/></li>
<li></span><span class="Comment"> * work to <a href="#L1196" title="tsearch/spell.c:1196">NIImportOOAffixes</a>(), which will re-read the whole file.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L1425">&#x200c;</a></span><span class="linkable">NIImportAffixes</span>(IspellDict *Conf, <span class="Type">const</span> <span class="Type">char</span> *filename)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *pstr = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; flag[<span class="Constant">BUFSIZ</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; mask[<span class="Constant">BUFSIZ</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>[<span class="Constant">BUFSIZ</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; repl[<span class="Constant">BUFSIZ</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *s;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; suffixes = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a> = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; flagflags = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; tsearch_readline_state trst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; oldformat = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *recoded = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="ts_locale.c.html#L134" title="tsearch/ts_locale.c:134">tsearch_readline_begin</a>(&amp;trst, filename))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;could not open affix file </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">: %m&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Conf-&gt;usecompound = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;useFlagAliases = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;flagMode = FM_CHAR;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((recoded = <a href="ts_locale.c.html#L157" title="tsearch/ts_locale.c:157">tsearch_readline</a>(&amp;trst)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pstr = <a href="ts_locale.c.html#L253" title="tsearch/ts_locale.c:253">lowerstr</a>(recoded);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Skip comments and empty lines */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*pstr == <span class="Constant">'#'</span> || *pstr == <span class="Special">'\n'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(pstr, <span class="Constant">&quot;compoundwords&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Find case-insensitive L flag in non-lowercased string */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s = <a href="#L242" title="tsearch/spell.c:242">findchar2</a>(recoded, <span class="Constant">'l'</span>, <span class="Constant">'L'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s &amp;&amp; !<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s &amp;&amp; <a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s &amp;&amp; <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s) == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1066" title="tsearch/spell.c:1066">addCompoundAffixFlagValue</a>(Conf, s, FF_COMPOUNDFLAG);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;usecompound = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldformat = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(pstr, <span class="Constant">&quot;suffixes&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; suffixes = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a> = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldformat = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(pstr, <span class="Constant">&quot;<a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a>&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; suffixes = <span class="Constant">false</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a> = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldformat = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(pstr, <span class="Constant">&quot;flag&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s = recoded + <span class="Constant">4</span>;&nbsp; &nbsp; <span class="Comment">/* we need non-lowercased string */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flagflags = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*s &amp;&amp; <a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s += <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Constant">'*'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flagflags |= FF_CROSSPRODUCT;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*s == <span class="Constant">'~'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flagflags |= FF_COMPOUNDONLY;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Special">'\\'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * An old-format flag is a single ASCII character; we expect it to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * be followed by EOL, whitespace, or ':'.&nbsp; Otherwise this is a<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * new-format flag command.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s &amp;&amp; <a href="../utils/mb/mbutils.c.html#L1023" title="utils/mb/mbutils.c:1023">pg_mblen</a>(s) == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COPYCHAR(flag, s);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flag[<span class="Constant">1</span>] = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*s == <span class="Special">'\0'</span> || *s == <span class="Constant">'#'</span> || *s == <span class="Special">'\n'</span> || *s == <span class="Constant">':'</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(s))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldformat = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> isnewformat;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDFLAG&quot;</span>) == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;COMPOUNDMIN&quot;</span>) == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;PFX&quot;</span>) == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L190" title="tsearch/spell.c:190">STRNCMP</a>(recoded, <span class="Constant">&quot;SFX&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> isnewformat;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((!suffixes) &amp;&amp; (!<a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L913" title="tsearch/spell.c:913">parse_affentry</a>(pstr, mask, <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, repl))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> nextline;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L677" title="tsearch/spell.c:677">NIAddAffix</a>(Conf, flag, flagflags, mask, <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>, repl, suffixes ? FF_SUFFIX : FF_PREFIX);<br/></li>
<li><br/></li>
<li><span class="Statement">nextline</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(recoded);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(pstr);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <a href="ts_locale.c.html#L202" title="tsearch/ts_locale.c:202">tsearch_readline_end</a>(&amp;trst);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">isnewformat</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (oldformat)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;affix file contains both old-style and new-style commands&quot;</span>)));<br/></li>
<li>&nbsp; &nbsp; <a href="ts_locale.c.html#L202" title="tsearch/ts_locale.c:202">tsearch_readline_end</a>(&amp;trst);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L1196" title="tsearch/spell.c:1196">NIImportOOAffixes</a>(Conf, filename);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Merges two affix flag sets and stores a new affix flag set into<br/></li>
<li></span><span class="Comment"> * Conf-&gt;AffixData.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns index of a new affix flag set.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L1572">&#x200c;</a></span><span class="linkable">MergeAffix</span>(IspellDict *Conf, <span class="Type">int</span> <a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>, <span class="Type">int</span> <a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **ptr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Assert(<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a> &lt; Conf-&gt;nAffixData &amp;&amp; <a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a> &lt; Conf-&gt;nAffixData);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Do not <a href="../lib/pairingheap.c.html#L79" title="lib/pairingheap.c:79">merge</a> affix flags if one of affix flags is empty */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (*Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>] == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>] == <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Double the size of AffixData if there's not enough space */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;nAffixData + <span class="Constant">1</span> &gt;= Conf-&gt;lenAffixData)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;lenAffixData *= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;AffixData = (<span class="Type">char</span> **) <a href="../utils/mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(Conf-&gt;AffixData,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *) * Conf-&gt;lenAffixData);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ptr = Conf-&gt;AffixData + Conf-&gt;nAffixData;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;flagMode == FM_NUM)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *ptr = <a href="#L158" title="tsearch/spell.c:158">cpalloc</a>(strlen(Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>]) +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; strlen(Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>]) +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">1</span> <span class="Comment">/* comma */</span> + <span class="Constant">1</span> <span class="Comment">/* \0 */</span> );<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(*ptr, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">,</span><span class="Special">%s</span><span class="Constant">&quot;</span>, Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>], Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>]);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *ptr = <a href="#L158" title="tsearch/spell.c:158">cpalloc</a>(strlen(Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>]) +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; strlen(Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>]) +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">1</span> <span class="Comment">/* \0 */</span> );<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(*ptr, <span class="Constant">&quot;</span><span class="Special">%s%s</span><span class="Constant">&quot;</span>, Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L142" title="catalog/heap.c:142">a1</a>], Conf-&gt;AffixData[<a href="../catalog/heap.c.html#L156" title="catalog/heap.c:156">a2</a>]);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; ptr++;<br/></li>
<li>&nbsp; &nbsp; *ptr = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;nAffixData++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> Conf-&gt;nAffixData - <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Returns a set of affix parameters which correspondence to the set of affix<br/></li>
<li></span><span class="Comment"> * flags with the given index.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> uint32<br/></li>
<li><a id="L1619">&#x200c;</a><span class="linkable">makeCompoundFlags</span>(IspellDict *Conf, <span class="Type">int</span> affix)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Assert(affix &lt; Conf-&gt;nAffixData);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (<a href="#L1123" title="tsearch/spell.c:1123">getCompoundAffixFlagValue</a>(Conf, Conf-&gt;AffixData[affix]) &amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FF_COMPOUNDFLAGMASK);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Makes a prefix tree for the given level.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * low: <a href="../utils/adt/oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a> index of the Conf-&gt;Spell array.<br/></li>
<li></span><span class="Comment"> * high: <a href="../utils/adt/oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a> index of the Conf-&gt;Spell array.<br/></li>
<li></span><span class="Comment"> * level: current prefix tree level.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> SPNode *<br/></li>
<li><a id="L1636">&#x200c;</a><span class="linkable">mkSPNode</span>(IspellDict *Conf, <span class="Type">int</span> low, <span class="Type">int</span> high, <span class="Type">int</span> level)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nchar = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; lastchar = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; SPNode&nbsp; &nbsp; &nbsp;&nbsp; *rs;<br/></li>
<li>&nbsp; &nbsp; SPNodeData *data;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lownew = low;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = low; i &lt; high; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Spell[i]-&gt;p.d.len &gt; level &amp;&amp; lastchar != Conf-&gt;Spell[i]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>[level])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nchar++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastchar = Conf-&gt;Spell[i]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>[level];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!nchar)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rs = (SPNode *) <a href="#L159" title="tsearch/spell.c:159">cpalloc0</a>(SPNHDRSZ + nchar * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(SPNodeData));<br/></li>
<li>&nbsp; &nbsp; rs-&gt;length = nchar;<br/></li>
<li>&nbsp; &nbsp; data = rs-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; lastchar = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = low; i &lt; high; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Spell[i]-&gt;p.d.len &gt; level)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lastchar != Conf-&gt;Spell[i]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>[level])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lastchar)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Next level of the prefix tree */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;node = <a href="#L1636" title="tsearch/spell.c:1636">mkSPNode</a>(Conf, lownew, i, level + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lownew = i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastchar = Conf-&gt;Spell[i]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>[level];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;val = ((uint8 *) (Conf-&gt;Spell[i]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>))[level];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Spell[i]-&gt;p.d.len == level + <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; clearCompoundOnly = <span class="Constant">false</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (data-&gt;isword &amp;&amp; data-&gt;affix != Conf-&gt;Spell[i]-&gt;p.d.affix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <a href="#L1572" title="tsearch/spell.c:1572">MergeAffix</a> called a few times. If one of <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * allowed to be in compound <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> and another isn't, then<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * clear FF_COMPOUNDONLY flag.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clearCompoundOnly = (FF_COMPOUNDONLY &amp; data-&gt;compoundflag<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp; <a href="#L1619" title="tsearch/spell.c:1619">makeCompoundFlags</a>(Conf, Conf-&gt;Spell[i]-&gt;p.d.affix))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? <span class="Constant">false</span> : <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;affix = <a href="#L1572" title="tsearch/spell.c:1572">MergeAffix</a>(Conf, data-&gt;affix, Conf-&gt;Spell[i]-&gt;p.d.affix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;affix = Conf-&gt;Spell[i]-&gt;p.d.affix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;isword = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;compoundflag = <a href="#L1619" title="tsearch/spell.c:1619">makeCompoundFlags</a>(Conf, data-&gt;affix);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((data-&gt;compoundflag &amp; FF_COMPOUNDONLY) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (data-&gt;compoundflag &amp; FF_COMPOUNDFLAG) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;compoundflag |= FF_COMPOUNDFLAG;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clearCompoundOnly)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;compoundflag &amp;= ~FF_COMPOUNDONLY;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Next level of the prefix tree */<br/></li>
<li></span>&nbsp; &nbsp; data-&gt;node = <a href="#L1636" title="tsearch/spell.c:1636">mkSPNode</a>(Conf, lownew, high, level + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> rs;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Builds the Conf-&gt;Dictionary tree and AffixData from the imported dictionary<br/></li>
<li></span><span class="Comment"> * and affixes.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L1718">&#x200c;</a></span><span class="linkable">NISortDictionary</span>(IspellDict *Conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naffix;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* compress affixes */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * If we use flag aliases then we need to use Conf-&gt;AffixData filled in<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * the <a href="#L1196" title="tsearch/spell.c:1196">NIImportOOAffixes</a>().<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;useFlagAliases)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; Conf-&gt;nspell; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *end;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*Conf-&gt;Spell[i]-&gt;p.flag != <span class="Special">'\0'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix = strtol(Conf-&gt;Spell[i]-&gt;p.flag, &amp;end, <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Spell[i]-&gt;p.flag == end || errno == <span class="Constant">ERANGE</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix alias </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell[i]-&gt;p.flag)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (curaffix &lt; <span class="Constant">0</span> || curaffix &gt;= Conf-&gt;nAffixData)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix alias </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell[i]-&gt;p.flag)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*end != <span class="Special">'\0'</span> &amp;&amp; !<a href="ts_locale.c.html#L35" title="tsearch/ts_locale.c:35">t_isdigit</a>(end) &amp;&amp; !<a href="ts_locale.c.html#L50" title="tsearch/ts_locale.c:50">t_isspace</a>(end))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_CONFIG_FILE_ERROR),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;invalid affix alias </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell[i]-&gt;p.flag)));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * If Conf-&gt;Spell[i]-&gt;p.flag is empty, then get empty value of<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Conf-&gt;AffixData (0 index).<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell[i]-&gt;p.d.affix = curaffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell[i]-&gt;p.d.len = strlen(Conf-&gt;Spell[i]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Otherwise fill Conf-&gt;AffixData here */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Count the number of different flags used in the dictionary */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; qsort(Conf-&gt;Spell, Conf-&gt;nspell, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(SPELL *),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L203" title="tsearch/spell.c:203">cmpspellaffix</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; naffix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; Conf-&gt;nspell; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcmp(Conf-&gt;Spell[i]-&gt;p.flag, Conf-&gt;Spell[i - <span class="Constant">1</span>]-&gt;p.flag) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naffix++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Fill in Conf-&gt;AffixData with the affixes that were used in the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * dictionary. Replace textual flag-field of Conf-&gt;Spell entries with<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * indexes into Conf-&gt;AffixData array.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;AffixData = (<span class="Type">char</span> **) <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(naffix * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; curaffix = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; Conf-&gt;nspell; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcmp(Conf-&gt;Spell[i]-&gt;p.flag, Conf-&gt;AffixData[curaffix]) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curaffix++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assert(curaffix &lt; naffix);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;AffixData[curaffix] = <a href="#L162" title="tsearch/spell.c:162">cpstrdup</a>(Conf,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Conf-&gt;Spell[i]-&gt;p.flag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell[i]-&gt;p.d.affix = curaffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Spell[i]-&gt;p.d.len = strlen(Conf-&gt;Spell[i]-&gt;<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;lenAffixData = Conf-&gt;nAffixData = naffix;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Start build a prefix tree */<br/></li>
<li></span>&nbsp; &nbsp; qsort(Conf-&gt;Spell, Conf-&gt;nspell, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(SPELL *), <a href="#L197" title="tsearch/spell.c:197">cmpspell</a>);<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;Dictionary = <a href="#L1636" title="tsearch/spell.c:1636">mkSPNode</a>(Conf, <span class="Constant">0</span>, Conf-&gt;nspell, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Makes a prefix tree for the given level using the repl string of an affix<br/></li>
<li></span><span class="Comment"> * rule. Affixes with empty replace string do not include in the prefix tree.<br/></li>
<li></span><span class="Comment"> * This affixes are included by <a href="#L1903" title="tsearch/spell.c:1903">mkVoidAffix</a>().<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * low: <a href="../utils/adt/oracle_compat.c.html#L49" title="utils/adt/oracle_compat.c:49">lower</a> index of the Conf-&gt;Affix array.<br/></li>
<li></span><span class="Comment"> * high: <a href="../utils/adt/oracle_compat.c.html#L80" title="utils/adt/oracle_compat.c:80">upper</a> index of the Conf-&gt;Affix array.<br/></li>
<li></span><span class="Comment"> * level: current prefix tree level.<br/></li>
<li></span><span class="Comment"> * type: FF_SUFFIX or FF_PREFIX.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> AffixNode *<br/></li>
<li><a id="L1826">&#x200c;</a><span class="linkable">mkANode</span>(IspellDict *Conf, <span class="Type">int</span> low, <span class="Type">int</span> high, <span class="Type">int</span> level, <span class="Type">int</span> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nchar = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; uint8&nbsp; &nbsp; &nbsp; &nbsp; lastchar = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; AffixNode&nbsp; *rs;<br/></li>
<li>&nbsp; &nbsp; AffixNodeData *data;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lownew = low;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naff;<br/></li>
<li>&nbsp; &nbsp; AFFIX&nbsp; &nbsp; &nbsp; **aff;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = low; i &lt; high; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Affix[i].replen &gt; level &amp;&amp; lastchar != <a href="../utils/adt/like_match.c.html#L74" title="utils/adt/like_match.c:74">GETCHAR</a>(Conf-&gt;Affix + i, level, type))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nchar++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastchar = <a href="../utils/adt/like_match.c.html#L74" title="utils/adt/like_match.c:74">GETCHAR</a>(Conf-&gt;Affix + i, level, type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!nchar)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; aff = (AFFIX **) <a href="#L79" title="tsearch/spell.c:79">tmpalloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX *) * (high - low + <span class="Constant">1</span>));<br/></li>
<li>&nbsp; &nbsp; naff = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rs = (AffixNode *) <a href="#L159" title="tsearch/spell.c:159">cpalloc0</a>(ANHRDSZ + nchar * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AffixNodeData));<br/></li>
<li>&nbsp; &nbsp; rs-&gt;length = nchar;<br/></li>
<li>&nbsp; &nbsp; data = rs-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; lastchar = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = low; i &lt; high; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Affix[i].replen &gt; level)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lastchar != <a href="../utils/adt/like_match.c.html#L74" title="utils/adt/like_match.c:74">GETCHAR</a>(Conf-&gt;Affix + i, level, type))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lastchar)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Next level of the prefix tree */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;node = <a href="#L1826" title="tsearch/spell.c:1826">mkANode</a>(Conf, lownew, i, level + <span class="Constant">1</span>, type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (naff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;naff = naff;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;aff = (AFFIX **) <a href="#L158" title="tsearch/spell.c:158">cpalloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX *) * naff);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(data-&gt;aff, aff, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX *) * naff);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; naff = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lownew = i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastchar = <a href="../utils/adt/like_match.c.html#L74" title="utils/adt/like_match.c:74">GETCHAR</a>(Conf-&gt;Affix + i, level, type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;val = <a href="../utils/adt/like_match.c.html#L74" title="utils/adt/like_match.c:74">GETCHAR</a>(Conf-&gt;Affix + i, level, type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Affix[i].replen == level + <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* affix stopped */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aff[naff++] = Conf-&gt;Affix + i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Next level of the prefix tree */<br/></li>
<li></span>&nbsp; &nbsp; data-&gt;node = <a href="#L1826" title="tsearch/spell.c:1826">mkANode</a>(Conf, lownew, high, level + <span class="Constant">1</span>, type);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (naff)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data-&gt;naff = naff;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data-&gt;aff = (AFFIX **) <a href="#L158" title="tsearch/spell.c:158">cpalloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX *) * naff);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(data-&gt;aff, aff, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX *) * naff);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; naff = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(aff);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> rs;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Makes the root void node in the prefix tree. The root void node is created<br/></li>
<li></span><span class="Comment"> * for affixes which have empty replace string (&quot;repl&quot; field).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1903">&#x200c;</a></span><span class="linkable">mkVoidAffix</span>(IspellDict *Conf, <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> issuffix, <span class="Type">int</span> startsuffix)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = (issuffix) ? startsuffix : <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end = (issuffix) ? Conf-&gt;naffixes : startsuffix;<br/></li>
<li>&nbsp; &nbsp; AffixNode&nbsp; *Affix = (AffixNode *) <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(ANHRDSZ + <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AffixNodeData));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Affix-&gt;length = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; Affix-&gt;isvoid = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (issuffix)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;data-&gt;node = Conf-&gt;Suffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Suffix = Affix;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;data-&gt;node = Conf-&gt;Prefix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Conf-&gt;Prefix = Affix;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Count affixes with empty replace string */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">for</span> (i = start; i &lt; end; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Affix[i].replen == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* There is not affixes with empty replace string */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (cnt == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; Affix-&gt;data-&gt;aff = (AFFIX **) <a href="#L158" title="tsearch/spell.c:158">cpalloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX *) * cnt);<br/></li>
<li>&nbsp; &nbsp; Affix-&gt;data-&gt;naff = (uint32) cnt;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cnt = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = start; i &lt; end; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;Affix[i].replen == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Affix-&gt;data-&gt;aff[cnt] = Conf-&gt;Affix + i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cnt++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Checks if the affixflag is used by dictionary. Conf-&gt;AffixData does not<br/></li>
<li></span><span class="Comment"> * contain affixflag if this flag is not used actually by the .dict file.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Conf: current dictionary.<br/></li>
<li></span><span class="Comment"> * affixflag: affix flag.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Returns true if the Conf-&gt;AffixData array contains affixflag, otherwise<br/></li>
<li></span><span class="Comment"> * returns false.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a><br/></li>
<li><a id="L1957">&#x200c;</a></span><span class="linkable">isAffixInUse</span>(IspellDict *Conf, <span class="Type">char</span> *affixflag)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; Conf-&gt;nAffixData; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L454" title="tsearch/spell.c:454">IsAffixFlagInUse</a>(Conf, i, affixflag))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">true</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">false</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Builds Conf-&gt;Prefix and Conf-&gt;Suffix trees from the imported affixes.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">void<br/></li>
<li><a id="L1972">&#x200c;</a></span><span class="linkable">NISortAffixes</span>(IspellDict *Conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; AFFIX&nbsp; &nbsp; &nbsp;&nbsp; *Affix;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; CMPDAffix&nbsp; *ptr;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; firstsuffix = Conf-&gt;naffixes;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;naffixes == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Store compound affixes in the Conf-&gt;CompoundAffix array */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;naffixes &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; qsort(Conf-&gt;Affix, Conf-&gt;naffixes, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(AFFIX), <a href="#L311" title="tsearch/spell.c:311">cmpaffix</a>);<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;CompoundAffix = ptr = (CMPDAffix *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(CMPDAffix) * Conf-&gt;naffixes);<br/></li>
<li>&nbsp; &nbsp; ptr-&gt;affix = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; Conf-&gt;naffixes; i++)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Affix = &amp;(((AFFIX *) Conf-&gt;Affix)[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;type == FF_SUFFIX &amp;&amp; i &lt; firstsuffix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; firstsuffix = i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((Affix-&gt;flagflags &amp; FF_COMPOUNDFLAG) &amp;&amp; Affix-&gt;replen &gt; <span class="Constant">0</span> &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1957" title="tsearch/spell.c:1957">isAffixInUse</a>(Conf, Affix-&gt;flag))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; issuffix = (Affix-&gt;type == FF_SUFFIX);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ptr == Conf-&gt;CompoundAffix ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; issuffix != (ptr - <span class="Constant">1</span>)-&gt;issuffix ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L280" title="tsearch/spell.c:280">strbncmp</a>((<span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *) (ptr - <span class="Constant">1</span>)-&gt;affix,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<span class="Type">const</span> <span class="Type">unsigned</span> <span class="Type">char</span> *) Affix-&gt;repl,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (ptr - <span class="Constant">1</span>)-&gt;len))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* leave only unique and minimal suffixes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr-&gt;affix = Affix-&gt;repl;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr-&gt;len = Affix-&gt;replen;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr-&gt;issuffix = issuffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; ptr-&gt;affix = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;CompoundAffix = (CMPDAffix *) <a href="../utils/mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(Conf-&gt;CompoundAffix, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(CMPDAffix) * (ptr - Conf-&gt;CompoundAffix + <span class="Constant">1</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Start build a prefix tree */<br/></li>
<li></span>&nbsp; &nbsp; Conf-&gt;Prefix = <a href="#L1826" title="tsearch/spell.c:1826">mkANode</a>(Conf, <span class="Constant">0</span>, firstsuffix, <span class="Constant">0</span>, FF_PREFIX);<br/></li>
<li>&nbsp; &nbsp; Conf-&gt;Suffix = <a href="#L1826" title="tsearch/spell.c:1826">mkANode</a>(Conf, firstsuffix, Conf-&gt;naffixes, <span class="Constant">0</span>, FF_SUFFIX);<br/></li>
<li>&nbsp; &nbsp; <a href="#L1903" title="tsearch/spell.c:1903">mkVoidAffix</a>(Conf, <span class="Constant">true</span>, firstsuffix);<br/></li>
<li>&nbsp; &nbsp; <a href="#L1903" title="tsearch/spell.c:1903">mkVoidAffix</a>(Conf, <span class="Constant">false</span>, firstsuffix);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> AffixNodeData *<br/></li>
<li><a id="L2024">&#x200c;</a><span class="linkable">FindAffixes</span>(AffixNode *node, <span class="Type">const</span> <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">int</span> wrdlen, <span class="Type">int</span> *level, <span class="Type">int</span> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; AffixNodeData *StopLow,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *StopHigh,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *StopMiddle;<br/></li>
<li>&nbsp; &nbsp; uint8 symbol;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (node-&gt;isvoid)<br/></li>
<li>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* search void affixes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (node-&gt;data-&gt;naff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> node-&gt;data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;data-&gt;node;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (node &amp;&amp; *level &lt; wrdlen)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StopLow = node-&gt;data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StopHigh = node-&gt;data + node-&gt;length;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (StopLow &lt; StopHigh)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopMiddle = StopLow + ((StopHigh - StopLow) &gt;&gt; <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; symbol = <a href="#L191" title="tsearch/spell.c:191">GETWCHAR</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wrdlen, *level, type);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopMiddle-&gt;val == symbol)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*level)++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopMiddle-&gt;naff)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> StopMiddle;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = StopMiddle-&gt;node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (StopMiddle-&gt;val &lt; symbol)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopLow = StopMiddle + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopHigh = StopMiddle;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopLow &gt;= StopHigh)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L2067">&#x200c;</a><span class="linkable">CheckAffix</span>(<span class="Type">const</span> <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">size_t</span> len, AFFIX *Affix, <span class="Type">int</span> flagflags, <span class="Type">char</span> *newword, <span class="Type">int</span> *baselen)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Check compound allow flags<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flagflags == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;flagflags &amp; FF_COMPOUNDONLY)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (flagflags &amp; FF_COMPOUNDBEGIN)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;flagflags &amp; FF_COMPOUNDFORBIDFLAG)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((Affix-&gt;flagflags &amp; FF_COMPOUNDBEGIN) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;type == FF_SUFFIX)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (flagflags &amp; FF_COMPOUNDMIDDLE)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((Affix-&gt;flagflags &amp; FF_COMPOUNDMIDDLE) == <span class="Constant">0</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (Affix-&gt;flagflags &amp; FF_COMPOUNDFORBIDFLAG))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (flagflags &amp; FF_COMPOUNDLAST)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;flagflags &amp; FF_COMPOUNDFORBIDFLAG)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((Affix-&gt;flagflags &amp; FF_COMPOUNDLAST) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;type == FF_PREFIX)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * make replace pattern of affix<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;type == FF_SUFFIX)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcpy(newword, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcpy(newword + len - Affix-&gt;replen, Affix-&gt;<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (baselen)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* store length of non-changed part of <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *baselen = len - Affix-&gt;replen;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * if prefix is an all non-changed part's length then all <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * contains only prefix and suffix, so out<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (baselen &amp;&amp; *baselen + strlen(Affix-&gt;<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>) &lt;= Affix-&gt;replen)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcpy(newword, Affix-&gt;<a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; strcat(newword, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> + Affix-&gt;replen);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * check resulting <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a><br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (Affix-&gt;issimple)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> newword;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (Affix-&gt;isregis)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="regis.c.html#L213" title="tsearch/regis.c:213">RS_execute</a>(&amp;(Affix-&gt;reg.regis), newword))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> newword;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pg_wchar&nbsp;&nbsp; *data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; data_len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newword_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Convert data string to wide characters */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; newword_len = strlen(newword);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data = (pg_wchar *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>((newword_len + <span class="Constant">1</span>) * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(pg_wchar));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data_len = <a href="../utils/mb/mbutils.c.html#L986" title="utils/mb/mbutils.c:986">pg_mb2wchar_with_len</a>(newword, data, newword_len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../regex/regexec.c.html#L185" title="regex/regexec.c:185">pg_regexec</a>(Affix-&gt;reg.pregex, data, data_len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">0</span>, <span class="Constant">NULL</span>, <span class="Constant">0</span>, <span class="Constant">NULL</span>, <span class="Constant">0</span>) == REG_OKAY)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(data);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> newword;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(data);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2157">&#x200c;</a></span><span class="linkable">addToResult</span>(<span class="Type">char</span> **forms, <span class="Type">char</span> **cur, <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cur - forms &gt;= <a href="#L187" title="tsearch/spell.c:187">MAX_NORM</a> - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (forms == cur || strcmp(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, *(cur - <span class="Constant">1</span>)) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *cur = <a href="../utils/mmgr/mcxt.c.html#L1695" title="utils/mmgr/mcxt.c:1695">pstrdup</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *(cur + <span class="Constant">1</span>) = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> **<br/></li>
<li><a id="L2172">&#x200c;</a><span class="linkable">NormalizeSubWord</span>(IspellDict *Conf, <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">int</span> flag)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; AffixNodeData *suffix = <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *prefix = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slevel = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; plevel = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wrdlen = strlen(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; swrdlen;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **forms;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **cur;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; newword[<span class="Constant">2</span> * <a href="#L188" title="tsearch/spell.c:188">MAXNORMLEN</a>] = <span class="Constant">&quot;&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; pnewword[<span class="Constant">2</span> * <a href="#L188" title="tsearch/spell.c:188">MAXNORMLEN</a>] = <span class="Constant">&quot;&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; AffixNode&nbsp; *snode = Conf-&gt;Suffix,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *pnode;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (wrdlen &gt; <a href="#L188" title="tsearch/spell.c:188">MAXNORMLEN</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; cur = forms = (<span class="Type">char</span> **) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<a href="#L187" title="tsearch/spell.c:187">MAX_NORM</a> * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *));<br/></li>
<li>&nbsp; &nbsp; *cur = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Check that the <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> itself is normal form */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L602" title="tsearch/spell.c:602">FindWord</a>(Conf, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <a href="#L194" title="tsearch/spell.c:194">VoidString</a>, flag))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *cur = <a href="../utils/mmgr/mcxt.c.html#L1695" title="utils/mmgr/mcxt.c:1695">pstrdup</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cur++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *cur = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Find all other NORMAL forms of the '<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>' (check only prefix) */<br/></li>
<li></span>&nbsp; &nbsp; pnode = Conf-&gt;Prefix;<br/></li>
<li>&nbsp; &nbsp; plevel = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (pnode)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; prefix = <a href="#L2024" title="tsearch/spell.c:2024">FindAffixes</a>(pnode, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wrdlen, &amp;plevel, FF_PREFIX);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!prefix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (j = <span class="Constant">0</span>; j &lt; prefix-&gt;naff; j++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2067" title="tsearch/spell.c:2067">CheckAffix</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wrdlen, prefix-&gt;aff[j], flag, newword, <span class="Constant">NULL</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* prefix success */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L602" title="tsearch/spell.c:602">FindWord</a>(Conf, newword, prefix-&gt;aff[j]-&gt;flag, flag))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cur += <a href="#L2157" title="tsearch/spell.c:2157">addToResult</a>(forms, cur, newword);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pnode = prefix-&gt;node;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * Find all other NORMAL forms of the '<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>' (check suffix and then<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * prefix)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">while</span> (snode)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; baselen = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> possible suffix */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; suffix = <a href="#L2024" title="tsearch/spell.c:2024">FindAffixes</a>(snode, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wrdlen, &amp;slevel, FF_SUFFIX);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!suffix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* foreach suffix check affix */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; suffix-&gt;naff; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2067" title="tsearch/spell.c:2067">CheckAffix</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wrdlen, suffix-&gt;aff[i], flag, newword, &amp;baselen))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* suffix success */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L602" title="tsearch/spell.c:602">FindWord</a>(Conf, newword, suffix-&gt;aff[i]-&gt;flag, flag))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cur += <a href="#L2157" title="tsearch/spell.c:2157">addToResult</a>(forms, cur, newword);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../utils/adt/timestamp.c.html#L1618" title="utils/adt/timestamp.c:1618">now</a> we will look changed <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> with <a href="../regex/regc_lex.c.html#L99" title="regex/regc_lex.c:99">prefixes</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnode = Conf-&gt;Prefix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; plevel = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; swrdlen = strlen(newword);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (pnode)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prefix = <a href="#L2024" title="tsearch/spell.c:2024">FindAffixes</a>(pnode, newword, swrdlen, &amp;plevel, FF_PREFIX);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!prefix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (j = <span class="Constant">0</span>; j &lt; prefix-&gt;naff; j++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2067" title="tsearch/spell.c:2067">CheckAffix</a>(newword, swrdlen, prefix-&gt;aff[j], flag, pnewword, &amp;baselen))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* prefix success */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *ff = (prefix-&gt;aff[j]-&gt;flagflags &amp; suffix-&gt;aff[i]-&gt;flagflags &amp; FF_CROSSPRODUCT) ?<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L194" title="tsearch/spell.c:194">VoidString</a> : prefix-&gt;aff[j]-&gt;flag;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L602" title="tsearch/spell.c:602">FindWord</a>(Conf, pnewword, ff, flag))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cur += <a href="#L2157" title="tsearch/spell.c:2157">addToResult</a>(forms, cur, pnewword);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnode = prefix-&gt;node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; snode = suffix-&gt;node;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cur == forms)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(forms);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> forms;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L2281">&#x200c;</a><span class="Type">typedef</span> <span class="Type">struct</span> <span class="linkable">SplitVar</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nstem;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lenstem;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **stem;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a> *<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>;<br/></li>
<li><a id="L2287">&#x200c;</a>} <span class="linkable">SplitVar</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int<br/></li>
<li><a id="L2290">&#x200c;</a></span><span class="linkable">CheckCompoundAffixes</span>(CMPDAffix **ptr, <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">int</span> len, <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span> CheckInPlace)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; issuffix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* in case CompoundAffix is null: */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (*ptr == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (CheckInPlace)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> ((*ptr)-&gt;affix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &gt; (*ptr)-&gt;len &amp;&amp; strncmp((*ptr)-&gt;affix, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, (*ptr)-&gt;len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = (*ptr)-&gt;len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; issuffix = (*ptr)-&gt;issuffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*ptr)++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (issuffix) ? len : <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*ptr)++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *affbegin;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> ((*ptr)-&gt;affix)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &gt; (*ptr)-&gt;len &amp;&amp; (affbegin = strstr(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, (*ptr)-&gt;affix)) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = (*ptr)-&gt;len + (affbegin - <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; issuffix = (*ptr)-&gt;issuffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*ptr)++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (issuffix) ? len : <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*ptr)++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a> *<br/></li>
<li><a id="L2332">&#x200c;</a><span class="linkable">CopyVar</span>(<a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a> *s, <span class="Type">int</span> makedup)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a>&nbsp;&nbsp; *v = (<a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (s)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;lenstem = s-&gt;lenstem;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;stem = (<span class="Type">char</span> **) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *) * v-&gt;lenstem);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;nstem = s-&gt;nstem;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; s-&gt;nstem; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;stem[i] = (makedup) ? <a href="../utils/mmgr/mcxt.c.html#L1695" title="utils/mmgr/mcxt.c:1695">pstrdup</a>(s-&gt;stem[i]) : s-&gt;stem[i];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;lenstem = <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;stem = (<span class="Type">char</span> **) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *) * v-&gt;lenstem);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;nstem = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> v;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L2357">&#x200c;</a></span><span class="linkable">AddStem</span>(<a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a> *v, <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;nstem &gt;= v-&gt;lenstem)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;lenstem *= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;stem = (<span class="Type">char</span> **) <a href="../utils/mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(v-&gt;stem, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<span class="Type">char</span> *) * v-&gt;lenstem);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;stem[v-&gt;nstem] = <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;nstem++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a> *<br/></li>
<li><a id="L2370">&#x200c;</a><span class="linkable">SplitToVariants</span>(IspellDict *Conf, SPNode *snode, <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a> *orig, <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">int</span> wordlen, <span class="Type">int</span> startpos, <span class="Type">int</span> minpos)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a>&nbsp;&nbsp; *var = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; SPNodeData *StopLow,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *StopHigh,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *StopMiddle = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; SPNode&nbsp; &nbsp; &nbsp;&nbsp; *node = (snode) ? snode : Conf-&gt;Dictionary;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; level = (snode) ? minpos : startpos;&nbsp; &nbsp; <span class="Comment">/* recursive<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * minpos==level */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lenaff;<br/></li>
<li>&nbsp; &nbsp; CMPDAffix&nbsp; *caff;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *notprobed;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compoundflag = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* since this function recurses, it could be driven to stack overflow */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../tcop/postgres.c.html#L3531" title="tcop/postgres.c:3531">check_stack_depth</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; notprobed = (<span class="Type">char</span> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(wordlen);<br/></li>
<li>&nbsp; &nbsp; memset(notprobed, <span class="Constant">1</span>, wordlen);<br/></li>
<li>&nbsp; &nbsp; var = <a href="#L2332" title="tsearch/spell.c:2332">CopyVar</a>(orig, <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (level &lt; wordlen)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> with epenthetic or/and compound affix */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; caff = Conf-&gt;CompoundAffix;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (level &gt; startpos &amp;&amp; (lenaff = <a href="#L2290" title="tsearch/spell.c:2290">CheckCompoundAffixes</a>(&amp;caff, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> + level, wordlen - level, (node) ? <span class="Constant">true</span> : <span class="Constant">false</span>)) &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * there is one of compound affixes, so check <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> for existings<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; buf[<a href="#L188" title="tsearch/spell.c:188">MAXNORMLEN</a>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **subres;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lenaff = level - startpos + lenaff;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!notprobed[startpos + lenaff - <span class="Constant">1</span>])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (level + lenaff - <span class="Constant">1</span> &lt;= minpos)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lenaff &gt;= <a href="#L188" title="tsearch/spell.c:188">MAXNORMLEN</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../regex/regc_lex.c.html#L982" title="regex/regc_lex.c:982">skip</a> too big value */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (lenaff &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy(buf, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> + startpos, lenaff);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf[lenaff] = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (level == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compoundflag = FF_COMPOUNDBEGIN;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (level == wordlen - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compoundflag = FF_COMPOUNDLAST;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compoundflag = FF_COMPOUNDMIDDLE;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; subres = <a href="#L2172" title="tsearch/spell.c:2172">NormalizeSubWord</a>(Conf, buf, compoundflag);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (subres)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Yes, it was a <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> from dictionary */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a>&nbsp;&nbsp; *new = <a href="#L2332" title="tsearch/spell.c:2332">CopyVar</a>(var, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a>&nbsp;&nbsp; *ptr = var;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **sptr = subres;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; notprobed[startpos + lenaff - <span class="Constant">1</span>] = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*sptr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2357" title="tsearch/spell.c:2357">AddStem</a>(new, *sptr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sptr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(subres);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (ptr-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr = ptr-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> = <a href="#L2370" title="tsearch/spell.c:2370">SplitToVariants</a>(Conf, <span class="Constant">NULL</span>, new, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wordlen, startpos + lenaff, startpos + lenaff);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(new-&gt;stem);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(new);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!node)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StopLow = node-&gt;data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; StopHigh = node-&gt;data + node-&gt;length;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (StopLow &lt; StopHigh)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopMiddle = StopLow + ((StopHigh - StopLow) &gt;&gt; <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopMiddle-&gt;val == ((uint8 *) (<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>))[level])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (StopMiddle-&gt;val &lt; ((uint8 *) (<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>))[level])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopLow = StopMiddle + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StopHigh = StopMiddle;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopLow &lt; StopHigh)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (startpos == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compoundflag = FF_COMPOUNDBEGIN;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (level == wordlen - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compoundflag = FF_COMPOUNDLAST;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compoundflag = FF_COMPOUNDMIDDLE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> infinitive */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (StopMiddle-&gt;isword &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (StopMiddle-&gt;compoundflag &amp; compoundflag) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; notprobed[level])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ok, we found full compoundallowed <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (level &gt; minpos)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* and its length more than minimal */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wordlen == level + <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* well, it was last <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2357" title="tsearch/spell.c:2357">AddStem</a>(var, <a href="../utils/mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> + startpos, wordlen - startpos));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(notprobed);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> var;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* then we will search more big <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> at the same point */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a>&nbsp;&nbsp; *ptr = var;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (ptr-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr = ptr-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> = <a href="#L2370" title="tsearch/spell.c:2370">SplitToVariants</a>(Conf, node, var, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wordlen, startpos, level);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we can <a href="../regex/regexec.c.html#L419" title="regex/regexec.c:419">find</a> <a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a> <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; level++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2357" title="tsearch/spell.c:2357">AddStem</a>(var, <a href="../utils/mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> + startpos, level - startpos));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = Conf-&gt;Dictionary;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; startpos = level;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = StopMiddle-&gt;node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; level++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L2357" title="tsearch/spell.c:2357">AddStem</a>(var, <a href="../utils/mmgr/mcxt.c.html#L1706" title="utils/mmgr/mcxt.c:1706">pnstrdup</a>(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> + startpos, wordlen - startpos));<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(notprobed);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> var;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L2520">&#x200c;</a></span><span class="linkable">addNorm</span>(TSLexeme **lres, TSLexeme **lcur, <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Type">int</span> flags, uint16 NVariant)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*lres == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *lcur = *lres = (TSLexeme *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<a href="#L187" title="tsearch/spell.c:187">MAX_NORM</a> * <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(TSLexeme));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*lcur - *lres &lt; <a href="#L187" title="tsearch/spell.c:187">MAX_NORM</a> - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*lcur)-&gt;lexeme = <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*lcur)-&gt;flags = flags;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*lcur)-&gt;nvariant = NVariant;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*lcur)++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*lcur)-&gt;lexeme = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>TSLexeme *<br/></li>
<li><a id="L2536">&#x200c;</a><span class="linkable">NINormalizeWord</span>(IspellDict *Conf, <span class="Type">char</span> *<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **res;<br/></li>
<li>&nbsp; &nbsp; TSLexeme&nbsp;&nbsp; *lcur = <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *lres = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; uint16&nbsp; &nbsp; &nbsp; &nbsp; NVariant = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; res = <a href="#L2172" title="tsearch/spell.c:2172">NormalizeSubWord</a>(Conf, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (res)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **ptr = res;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*ptr &amp;&amp; (lcur - lres) &lt; <a href="#L187" title="tsearch/spell.c:187">MAX_NORM</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2520" title="tsearch/spell.c:2520">addNorm</a>(&amp;lres, &amp;lcur, *ptr, <span class="Constant">0</span>, NVariant++);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(res);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (Conf-&gt;usecompound)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wordlen = strlen(<a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2281" title="tsearch/spell.c:2281">SplitVar</a>&nbsp;&nbsp; *ptr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *var = <a href="#L2370" title="tsearch/spell.c:2370">SplitToVariants</a>(Conf, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>, <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a>, wordlen, <span class="Constant">0</span>, -<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (var)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (var-&gt;nstem &gt; <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **subres = <a href="#L2172" title="tsearch/spell.c:2172">NormalizeSubWord</a>(Conf, var-&gt;stem[var-&gt;nstem - <span class="Constant">1</span>], FF_COMPOUNDLAST);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (subres)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; **subptr = subres;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*subptr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; var-&gt;nstem - <span class="Constant">1</span>; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2520" title="tsearch/spell.c:2520">addNorm</a>(&amp;lres, &amp;lcur, (subptr == subres) ? var-&gt;stem[i] : <a href="../utils/mmgr/mcxt.c.html#L1695" title="utils/mmgr/mcxt.c:1695">pstrdup</a>(var-&gt;stem[i]), <span class="Constant">0</span>, NVariant);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L2520" title="tsearch/spell.c:2520">addNorm</a>(&amp;lres, &amp;lcur, *subptr, <span class="Constant">0</span>, NVariant);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; subptr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NVariant++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(subres);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var-&gt;stem[<span class="Constant">0</span>] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(var-&gt;stem[var-&gt;nstem - <span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; var-&gt;nstem &amp;&amp; var-&gt;stem[i]; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(var-&gt;stem[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr = var-&gt;<a href="../regex/regc_lex.c.html#L200" title="regex/regc_lex.c:200">next</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(var-&gt;stem);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(var);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var = ptr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> lres;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
