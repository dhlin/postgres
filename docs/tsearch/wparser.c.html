<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>tsearch/wparser.c - pgsql17devel-backend</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

  <h1>tsearch/wparser.c - pgsql17devel-backend</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L34">HeadlineJsonState</a></li>
<li><a href="#L42">HeadlineJsonState</a></li>
<li><a href="#L151">LexemeEntry</a></li>
<li><a href="#L158">PrsStorage</a></li>
<li><a href="#L31">TSTokenTypeStorage</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L523">headline_json_value</a></li>
<li><a href="#L216">prs_process_call</a></li>
<li><a href="#L162">prs_setup_firstcall</a></li>
<li><a href="#L348">ts_headline</a></li>
<li><a href="#L339">ts_headline_byid</a></li>
<li><a href="#L288">ts_headline_byid_opt</a></li>
<li><a href="#L491">ts_headline_json</a></li>
<li><a href="#L500">ts_headline_json_byid</a></li>
<li><a href="#L443">ts_headline_json_byid_opt</a></li>
<li><a href="#L509">ts_headline_json_opt</a></li>
<li><a href="#L415">ts_headline_jsonb</a></li>
<li><a href="#L424">ts_headline_jsonb_byid</a></li>
<li><a href="#L367">ts_headline_jsonb_byid_opt</a></li>
<li><a href="#L433">ts_headline_jsonb_opt</a></li>
<li><a href="#L357">ts_headline_opt</a></li>
<li><a href="#L242">ts_parse_byid</a></li>
<li><a href="#L264">ts_parse_byname</a></li>
<li><a href="#L106">ts_token_type_byid</a></li>
<li><a href="#L125">ts_token_type_byname</a></li>
<li><a href="#L77">tt_process_call</a></li>
<li><a href="#L47">tt_setup_firstcall</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><span class="Comment">/*-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * wparser.c<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; Standard interface to <a href="../regex/regcomp.c.html#L1474" title="regex/regcomp.c:1474">word</a> parser<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Portions Copyright (c) 1996-2024, PostgreSQL Global Development Group<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * IDENTIFICATION<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; src/backend/tsearch/wparser.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *-------------------------------------------------------------------------<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;postgres.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;catalog/namespace.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;commands/defrem.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;funcapi.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;tsearch/ts_cache.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;tsearch/ts_utils.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/fmgrprotos.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/jsonfuncs.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;utils/varlena.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/******sql-level interface******/<br/></li>
<li></span><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cur;<br/></li>
<li>&nbsp; &nbsp; LexDescr&nbsp;&nbsp; *list;<br/></li>
<li><a id="L31">&#x200c;</a>} <span class="linkable">TSTokenTypeStorage</span>;<br/></li>
<li><br/></li>
<li><span class="Comment">/* state for ts_headline_json_* */<br/></li>
<li><a id="L34">&#x200c;</a></span><span class="Type">typedef</span> <span class="Type">struct</span> <span class="linkable">HeadlineJsonState</span><br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; HeadlineParsedText *prs;<br/></li>
<li>&nbsp; &nbsp; TSConfigCacheEntry *cfg;<br/></li>
<li>&nbsp; &nbsp; TSParserCacheEntry *prsobj;<br/></li>
<li>&nbsp; &nbsp; TSQuery&nbsp; &nbsp; &nbsp; &nbsp; query;<br/></li>
<li>&nbsp; &nbsp; List&nbsp; &nbsp; &nbsp;&nbsp; *prsoptions;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../utils/fmgr/dfmgr.c.html#L28" title="utils/fmgr/dfmgr.c:28">bool</a></span>&nbsp; &nbsp; &nbsp; &nbsp; transformed;<br/></li>
<li><a id="L42">&#x200c;</a>} <span class="linkable">HeadlineJsonState</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> text *<a href="#L523" title="tsearch/wparser.c:523">headline_json_value</a>(<span class="Type">void</span> *_state, <span class="Type">char</span> *elem_value, <span class="Type">int</span> elem_len);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L47">&#x200c;</a></span><span class="linkable">tt_setup_firstcall</span>(FuncCallContext *funcctx, FunctionCallInfo fcinfo,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Oid prsid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; TupleDesc&nbsp; &nbsp; tupdesc;<br/></li>
<li>&nbsp; &nbsp; MemoryContext oldcontext;<br/></li>
<li>&nbsp; &nbsp; <a href="#L31" title="tsearch/wparser.c:31">TSTokenTypeStorage</a> *st;<br/></li>
<li>&nbsp; &nbsp; TSParserCacheEntry *prs = <a href="../utils/cache/ts_cache.c.html#L113" title="utils/cache/ts_cache.c:113">lookup_ts_parser_cache</a>(prsid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(prs-&gt;lextypeOid))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;method lextype isn't defined for text search parser </span><span class="Special">%u</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; prsid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; oldcontext = MemoryContextSwitchTo(funcctx-&gt;multi_call_memory_ctx);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; st = (<a href="#L31" title="tsearch/wparser.c:31">TSTokenTypeStorage</a> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L31" title="tsearch/wparser.c:31">TSTokenTypeStorage</a>));<br/></li>
<li>&nbsp; &nbsp; st-&gt;cur = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* lextype takes one dummy argument */<br/></li>
<li></span>&nbsp; &nbsp; st-&gt;list = (LexDescr *) DatumGetPointer(OidFunctionCall1(prs-&gt;lextypeOid,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (Datum) <span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; funcctx-&gt;user_fctx = (<span class="Type">void</span> *) st;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../utils/fmgr/funcapi.c.html#L276" title="utils/fmgr/funcapi.c:276">get_call_result_type</a>(fcinfo, <span class="Constant">NULL</span>, &amp;tupdesc) != TYPEFUNC_COMPOSITE)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;return type must be a row type&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; funcctx-&gt;tuple_desc = tupdesc;<br/></li>
<li>&nbsp; &nbsp; funcctx-&gt;attinmeta = <a href="../executor/execTuples.c.html#L2173" title="executor/execTuples.c:2173">TupleDescGetAttInMetadata</a>(tupdesc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(oldcontext);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> Datum<br/></li>
<li><a id="L77">&#x200c;</a><span class="linkable">tt_process_call</span>(FuncCallContext *funcctx)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L31" title="tsearch/wparser.c:31">TSTokenTypeStorage</a> *st;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; st = (<a href="#L31" title="tsearch/wparser.c:31">TSTokenTypeStorage</a> *) funcctx-&gt;user_fctx;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (st-&gt;list &amp;&amp; st-&gt;list[st-&gt;cur].lexid)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *<a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">3</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; txtid[<span class="Constant">16</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; HeapTuple&nbsp; &nbsp; tuple;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(txtid, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, st-&gt;list[st-&gt;cur].lexid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">0</span>] = txtid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">1</span>] = st-&gt;list[st-&gt;cur].alias;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">2</span>] = st-&gt;list[st-&gt;cur].descr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tuple = <a href="../executor/execTuples.c.html#L2222" title="executor/execTuples.c:2222">BuildTupleFromCStrings</a>(funcctx-&gt;attinmeta, <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = HeapTupleGetDatum(tuple);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(<a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(<a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">2</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; st-&gt;cur++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (Datum) <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L106">&#x200c;</a><span class="linkable">ts_token_type_byid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; FuncCallContext *funcctx;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (SRF_IS_FIRSTCALL())<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; funcctx = SRF_FIRSTCALL_INIT();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L47" title="tsearch/wparser.c:47">tt_setup_firstcall</a>(funcctx, fcinfo, PG_GETARG_OID(<span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; funcctx = SRF_PERCALL_SETUP();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((result = <a href="#L77" title="tsearch/wparser.c:77">tt_process_call</a>(funcctx)) != (Datum) <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; SRF_RETURN_NEXT(funcctx, result);<br/></li>
<li>&nbsp; &nbsp; SRF_RETURN_DONE(funcctx);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L125">&#x200c;</a><span class="linkable">ts_token_type_byname</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; FuncCallContext *funcctx;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (SRF_IS_FIRSTCALL())<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *prsname = PG_GETARG_TEXT_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prsId;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; funcctx = SRF_FIRSTCALL_INIT();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; prsId = <a href="../catalog/namespace.c.html#L2701" title="catalog/namespace.c:2701">get_ts_parser_oid</a>(<a href="../utils/adt/varlena.c.html#L3399" title="utils/adt/varlena.c:3399">textToQualifiedNameList</a>(prsname), <span class="Constant">false</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L47" title="tsearch/wparser.c:47">tt_setup_firstcall</a>(funcctx, fcinfo, prsId);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; funcctx = SRF_PERCALL_SETUP();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((result = <a href="#L77" title="tsearch/wparser.c:77">tt_process_call</a>(funcctx)) != (Datum) <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; SRF_RETURN_NEXT(funcctx, result);<br/></li>
<li>&nbsp; &nbsp; SRF_RETURN_DONE(funcctx);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *lexeme;<br/></li>
<li><a id="L151">&#x200c;</a>} <span class="linkable">LexemeEntry</span>;<br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct<br/></li>
<li></span>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cur;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="#L151" title="tsearch/wparser.c:151">LexemeEntry</a> *list;<br/></li>
<li><a id="L158">&#x200c;</a>} <span class="linkable">PrsStorage</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L162">&#x200c;</a></span><span class="linkable">prs_setup_firstcall</span>(FuncCallContext *funcctx, FunctionCallInfo fcinfo,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid prsid, text *txt)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; TupleDesc&nbsp; &nbsp; tupdesc;<br/></li>
<li>&nbsp; &nbsp; MemoryContext oldcontext;<br/></li>
<li>&nbsp; &nbsp; <a href="#L158" title="tsearch/wparser.c:158">PrsStorage</a> *st;<br/></li>
<li>&nbsp; &nbsp; TSParserCacheEntry *prs = <a href="../utils/cache/ts_cache.c.html#L113" title="utils/cache/ts_cache.c:113">lookup_ts_parser_cache</a>(prsid);<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *lex = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; llen = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp;&nbsp; *prsdata;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; oldcontext = MemoryContextSwitchTo(funcctx-&gt;multi_call_memory_ctx);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; st = (<a href="#L158" title="tsearch/wparser.c:158">PrsStorage</a> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L158" title="tsearch/wparser.c:158">PrsStorage</a>));<br/></li>
<li>&nbsp; &nbsp; st-&gt;cur = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; st-&gt;len = <span class="Constant">16</span>;<br/></li>
<li>&nbsp; &nbsp; st-&gt;list = (<a href="#L151" title="tsearch/wparser.c:151">LexemeEntry</a> *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L151" title="tsearch/wparser.c:151">LexemeEntry</a>) * st-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; prsdata = (<span class="Type">void</span> *) DatumGetPointer(FunctionCall2(&amp;prs-&gt;prsstart,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PointerGetDatum(VARDATA_ANY(txt)),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Int32GetDatum(VARSIZE_ANY_EXHDR(txt))));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> ((type = DatumGetInt32(FunctionCall3(&amp;prs-&gt;prstoken,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PointerGetDatum(prsdata),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PointerGetDatum(&amp;lex),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PointerGetDatum(&amp;llen)))) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (st-&gt;cur &gt;= st-&gt;len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; st-&gt;len = <span class="Constant">2</span> * st-&gt;len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; st-&gt;list = (<a href="#L151" title="tsearch/wparser.c:151">LexemeEntry</a> *) <a href="../utils/mmgr/mcxt.c.html#L1540" title="utils/mmgr/mcxt.c:1540">repalloc</a>(st-&gt;list, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L151" title="tsearch/wparser.c:151">LexemeEntry</a>) * st-&gt;len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; st-&gt;list[st-&gt;cur].lexeme = <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(llen + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; memcpy(st-&gt;list[st-&gt;cur].lexeme, lex, llen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; st-&gt;list[st-&gt;cur].lexeme[llen] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; st-&gt;list[st-&gt;cur].type = type;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; st-&gt;cur++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; FunctionCall1(&amp;prs-&gt;prsend, PointerGetDatum(prsdata));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; st-&gt;len = st-&gt;cur;<br/></li>
<li>&nbsp; &nbsp; st-&gt;cur = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; funcctx-&gt;user_fctx = (<span class="Type">void</span> *) st;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../utils/fmgr/funcapi.c.html#L276" title="utils/fmgr/funcapi.c:276">get_call_result_type</a>(fcinfo, <span class="Constant">NULL</span>, &amp;tupdesc) != TYPEFUNC_COMPOSITE)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, <span class="Constant">&quot;return type must be a row type&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; funcctx-&gt;tuple_desc = tupdesc;<br/></li>
<li>&nbsp; &nbsp; funcctx-&gt;attinmeta = <a href="../executor/execTuples.c.html#L2173" title="executor/execTuples.c:2173">TupleDescGetAttInMetadata</a>(tupdesc);<br/></li>
<li>&nbsp; &nbsp; MemoryContextSwitchTo(oldcontext);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Type">static</span> Datum<br/></li>
<li><a id="L216">&#x200c;</a><span class="linkable">prs_process_call</span>(FuncCallContext *funcctx)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L158" title="tsearch/wparser.c:158">PrsStorage</a> *st;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; st = (<a href="#L158" title="tsearch/wparser.c:158">PrsStorage</a> *) funcctx-&gt;user_fctx;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (st-&gt;cur &lt; st-&gt;len)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp;&nbsp; *<a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">2</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; tid[<span class="Constant">16</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; HeapTuple&nbsp; &nbsp; tuple;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">0</span>] = tid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(tid, <span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, st-&gt;list[st-&gt;cur].type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">1</span>] = st-&gt;list[st-&gt;cur].lexeme;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tuple = <a href="../executor/execTuples.c.html#L2222" title="executor/execTuples.c:2222">BuildTupleFromCStrings</a>(funcctx-&gt;attinmeta, <a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; result = HeapTupleGetDatum(tuple);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(<a href="../bootstrap/bootstrap.c.html#L152" title="bootstrap/bootstrap.c:152">values</a>[<span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; st-&gt;cur++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> result;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (Datum) <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L242">&#x200c;</a><span class="linkable">ts_parse_byid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; FuncCallContext *funcctx;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (SRF_IS_FIRSTCALL())<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *txt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; funcctx = SRF_FIRSTCALL_INIT();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L162" title="tsearch/wparser.c:162">prs_setup_firstcall</a>(funcctx, fcinfo, PG_GETARG_OID(<span class="Constant">0</span>), txt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_FREE_IF_COPY(txt, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; funcctx = SRF_PERCALL_SETUP();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((result = <a href="#L216" title="tsearch/wparser.c:216">prs_process_call</a>(funcctx)) != (Datum) <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; SRF_RETURN_NEXT(funcctx, result);<br/></li>
<li>&nbsp; &nbsp; SRF_RETURN_DONE(funcctx);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L264">&#x200c;</a><span class="linkable">ts_parse_byname</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; FuncCallContext *funcctx;<br/></li>
<li>&nbsp; &nbsp; Datum&nbsp; &nbsp; &nbsp; &nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (SRF_IS_FIRSTCALL())<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *prsname = PG_GETARG_TEXT_PP(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *txt = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prsId;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; funcctx = SRF_FIRSTCALL_INIT();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; prsId = <a href="../catalog/namespace.c.html#L2701" title="catalog/namespace.c:2701">get_ts_parser_oid</a>(<a href="../utils/adt/varlena.c.html#L3399" title="utils/adt/varlena.c:3399">textToQualifiedNameList</a>(prsname), <span class="Constant">false</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L162" title="tsearch/wparser.c:162">prs_setup_firstcall</a>(funcctx, fcinfo, prsId, txt);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; funcctx = SRF_PERCALL_SETUP();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((result = <a href="#L216" title="tsearch/wparser.c:216">prs_process_call</a>(funcctx)) != (Datum) <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; SRF_RETURN_NEXT(funcctx, result);<br/></li>
<li>&nbsp; &nbsp; SRF_RETURN_DONE(funcctx);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L288">&#x200c;</a><span class="linkable">ts_headline_byid_opt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tsconfig = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *in = PG_GETARG_TEXT_PP(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; TSQuery&nbsp; &nbsp; &nbsp; &nbsp; query = PG_GETARG_TSQUERY(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *opt = (PG_NARGS() &gt; <span class="Constant">3</span> &amp;&amp; PG_GETARG_POINTER(<span class="Constant">3</span>)) ? PG_GETARG_TEXT_PP(<span class="Constant">3</span>) : <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; HeadlineParsedText prs;<br/></li>
<li>&nbsp; &nbsp; List&nbsp; &nbsp; &nbsp;&nbsp; *prsoptions;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *out;<br/></li>
<li>&nbsp; &nbsp; TSConfigCacheEntry *cfg;<br/></li>
<li>&nbsp; &nbsp; TSParserCacheEntry *prsobj;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cfg = <a href="../utils/cache/ts_cache.c.html#L385" title="utils/cache/ts_cache.c:385">lookup_ts_config_cache</a>(tsconfig);<br/></li>
<li>&nbsp; &nbsp; prsobj = <a href="../utils/cache/ts_cache.c.html#L113" title="utils/cache/ts_cache.c:113">lookup_ts_parser_cache</a>(cfg-&gt;prsId);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(prsobj-&gt;headlineOid))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;text search parser does not support headline creation&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memset(&amp;prs, <span class="Constant">0</span>, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(HeadlineParsedText));<br/></li>
<li>&nbsp; &nbsp; prs.lenwords = <span class="Constant">32</span>;<br/></li>
<li>&nbsp; &nbsp; prs.words = (HeadlineWordEntry *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(HeadlineWordEntry) * prs.lenwords);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ts_parse.c.html#L540" title="tsearch/ts_parse.c:540">hlparsetext</a>(cfg-&gt;cfgId, &amp;prs, query,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VARDATA_ANY(in), VARSIZE_ANY_EXHDR(in));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (opt)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; prsoptions = <a href="../commands/tsearchcmds.c.html#L1621" title="commands/tsearchcmds.c:1621">deserialize_deflist</a>(PointerGetDatum(opt));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; prsoptions = NIL;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; FunctionCall3(&amp;(prsobj-&gt;prsheadline),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PointerGetDatum(&amp;prs),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PointerGetDatum(prsoptions),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PointerGetDatum(query));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; out = <a href="ts_parse.c.html#L607" title="tsearch/ts_parse.c:607">generateHeadline</a>(&amp;prs);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_FREE_IF_COPY(in, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; PG_FREE_IF_COPY(query, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (opt)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_FREE_IF_COPY(opt, <span class="Constant">3</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.words);<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.startsel);<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.stopsel);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_POINTER(out);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L339">&#x200c;</a><span class="linkable">ts_headline_byid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall3(<a href="#L288" title="tsearch/wparser.c:288">ts_headline_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">2</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L348">&#x200c;</a><span class="linkable">ts_headline</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall3(<a href="#L288" title="tsearch/wparser.c:288">ts_headline_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectIdGetDatum(<a href="../utils/cache/ts_cache.c.html#L556" title="utils/cache/ts_cache.c:556">getTSCurrentConfig</a>(<span class="Constant">true</span>)),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L357">&#x200c;</a><span class="linkable">ts_headline_opt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall4(<a href="#L288" title="tsearch/wparser.c:288">ts_headline_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectIdGetDatum(<a href="../utils/cache/ts_cache.c.html#L556" title="utils/cache/ts_cache.c:556">getTSCurrentConfig</a>(<span class="Constant">true</span>)),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">2</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L367">&#x200c;</a><span class="linkable">ts_headline_jsonb_byid_opt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tsconfig = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; Jsonb&nbsp; &nbsp; &nbsp;&nbsp; *jb = PG_GETARG_JSONB_P(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; TSQuery&nbsp; &nbsp; &nbsp; &nbsp; query = PG_GETARG_TSQUERY(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *opt = (PG_NARGS() &gt; <span class="Constant">3</span> &amp;&amp; PG_GETARG_POINTER(<span class="Constant">3</span>)) ? PG_GETARG_TEXT_P(<span class="Constant">3</span>) : <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; Jsonb&nbsp; &nbsp; &nbsp;&nbsp; *out;<br/></li>
<li>&nbsp; &nbsp; JsonTransformStringValuesAction action = (JsonTransformStringValuesAction) <a href="#L523" title="tsearch/wparser.c:523">headline_json_value</a>;<br/></li>
<li>&nbsp; &nbsp; HeadlineParsedText prs;<br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="tsearch/wparser.c:34">HeadlineJsonState</a> *state = <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L34" title="tsearch/wparser.c:34">HeadlineJsonState</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memset(&amp;prs, <span class="Constant">0</span>, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(HeadlineParsedText));<br/></li>
<li>&nbsp; &nbsp; prs.lenwords = <span class="Constant">32</span>;<br/></li>
<li>&nbsp; &nbsp; prs.words = (HeadlineWordEntry *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(HeadlineWordEntry) * prs.lenwords);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; state-&gt;prs = &amp;prs;<br/></li>
<li>&nbsp; &nbsp; state-&gt;cfg = <a href="../utils/cache/ts_cache.c.html#L385" title="utils/cache/ts_cache.c:385">lookup_ts_config_cache</a>(tsconfig);<br/></li>
<li>&nbsp; &nbsp; state-&gt;prsobj = <a href="../utils/cache/ts_cache.c.html#L113" title="utils/cache/ts_cache.c:113">lookup_ts_parser_cache</a>(state-&gt;cfg-&gt;prsId);<br/></li>
<li>&nbsp; &nbsp; state-&gt;query = query;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (opt)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; state-&gt;prsoptions = <a href="../commands/tsearchcmds.c.html#L1621" title="commands/tsearchcmds.c:1621">deserialize_deflist</a>(PointerGetDatum(opt));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; state-&gt;prsoptions = NIL;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(state-&gt;prsobj-&gt;headlineOid))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;text search parser does not support headline creation&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; out = <a href="../utils/adt/jsonfuncs.c.html#L5760" title="utils/adt/jsonfuncs.c:5760">transform_jsonb_string_values</a>(jb, state, action);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_FREE_IF_COPY(jb, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; PG_FREE_IF_COPY(query, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (opt)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_FREE_IF_COPY(opt, <span class="Constant">3</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.words);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (state-&gt;transformed)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.startsel);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.stopsel);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_JSONB_P(out);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L415">&#x200c;</a><span class="linkable">ts_headline_jsonb</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall3(<a href="#L367" title="tsearch/wparser.c:367">ts_headline_jsonb_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectIdGetDatum(<a href="../utils/cache/ts_cache.c.html#L556" title="utils/cache/ts_cache.c:556">getTSCurrentConfig</a>(<span class="Constant">true</span>)),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L424">&#x200c;</a><span class="linkable">ts_headline_jsonb_byid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall3(<a href="#L367" title="tsearch/wparser.c:367">ts_headline_jsonb_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">2</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L433">&#x200c;</a><span class="linkable">ts_headline_jsonb_opt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall4(<a href="#L367" title="tsearch/wparser.c:367">ts_headline_jsonb_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectIdGetDatum(<a href="../utils/cache/ts_cache.c.html#L556" title="utils/cache/ts_cache.c:556">getTSCurrentConfig</a>(<span class="Constant">true</span>)),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">2</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L443">&#x200c;</a><span class="linkable">ts_headline_json_byid_opt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; Oid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tsconfig = PG_GETARG_OID(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *json = PG_GETARG_TEXT_P(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; TSQuery&nbsp; &nbsp; &nbsp; &nbsp; query = PG_GETARG_TSQUERY(<span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *opt = (PG_NARGS() &gt; <span class="Constant">3</span> &amp;&amp; PG_GETARG_POINTER(<span class="Constant">3</span>)) ? PG_GETARG_TEXT_P(<span class="Constant">3</span>) : <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; text&nbsp; &nbsp; &nbsp;&nbsp; *out;<br/></li>
<li>&nbsp; &nbsp; JsonTransformStringValuesAction action = (JsonTransformStringValuesAction) <a href="#L523" title="tsearch/wparser.c:523">headline_json_value</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; HeadlineParsedText prs;<br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="tsearch/wparser.c:34">HeadlineJsonState</a> *state = <a href="../utils/mmgr/mcxt.c.html#L1346" title="utils/mmgr/mcxt.c:1346">palloc0</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(<a href="#L34" title="tsearch/wparser.c:34">HeadlineJsonState</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; memset(&amp;prs, <span class="Constant">0</span>, <span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(HeadlineParsedText));<br/></li>
<li>&nbsp; &nbsp; prs.lenwords = <span class="Constant">32</span>;<br/></li>
<li>&nbsp; &nbsp; prs.words = (HeadlineWordEntry *) <a href="../utils/mmgr/mcxt.c.html#L1316" title="utils/mmgr/mcxt.c:1316">palloc</a>(<span class="Statement"><a href="../storage/page/itemptr.c.html#L23" title="storage/page/itemptr.c:23">sizeof</a></span>(HeadlineWordEntry) * prs.lenwords);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; state-&gt;prs = &amp;prs;<br/></li>
<li>&nbsp; &nbsp; state-&gt;cfg = <a href="../utils/cache/ts_cache.c.html#L385" title="utils/cache/ts_cache.c:385">lookup_ts_config_cache</a>(tsconfig);<br/></li>
<li>&nbsp; &nbsp; state-&gt;prsobj = <a href="../utils/cache/ts_cache.c.html#L113" title="utils/cache/ts_cache.c:113">lookup_ts_parser_cache</a>(state-&gt;cfg-&gt;prsId);<br/></li>
<li>&nbsp; &nbsp; state-&gt;query = query;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (opt)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; state-&gt;prsoptions = <a href="../commands/tsearchcmds.c.html#L1621" title="commands/tsearchcmds.c:1621">deserialize_deflist</a>(PointerGetDatum(opt));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; state-&gt;prsoptions = NIL;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!OidIsValid(state-&gt;prsobj-&gt;headlineOid))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../utils/error/elog.c.html#L859" title="utils/error/elog.c:859">errcode</a>(ERRCODE_FEATURE_NOT_SUPPORTED),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../utils/error/elog.c.html#L1072" title="utils/error/elog.c:1072">errmsg</a>(<span class="Constant">&quot;text search parser does not support headline creation&quot;</span>)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; out = <a href="../utils/adt/jsonfuncs.c.html#L5807" title="utils/adt/jsonfuncs.c:5807">transform_json_string_values</a>(json, state, action);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_FREE_IF_COPY(json, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; PG_FREE_IF_COPY(query, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (opt)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; PG_FREE_IF_COPY(opt, <span class="Constant">3</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.words);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (state-&gt;transformed)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.startsel);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/mmgr/mcxt.c.html#L1520" title="utils/mmgr/mcxt.c:1520">pfree</a>(prs.stopsel);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; PG_RETURN_TEXT_P(out);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L491">&#x200c;</a><span class="linkable">ts_headline_json</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall3(<a href="#L443" title="tsearch/wparser.c:443">ts_headline_json_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectIdGetDatum(<a href="../utils/cache/ts_cache.c.html#L556" title="utils/cache/ts_cache.c:556">getTSCurrentConfig</a>(<span class="Constant">true</span>)),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L500">&#x200c;</a><span class="linkable">ts_headline_json_byid</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall3(<a href="#L443" title="tsearch/wparser.c:443">ts_headline_json_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">2</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li>Datum<br/></li>
<li><a id="L509">&#x200c;</a><span class="linkable">ts_headline_json_opt</span>(PG_FUNCTION_ARGS)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; PG_RETURN_DATUM(DirectFunctionCall4(<a href="#L443" title="tsearch/wparser.c:443">ts_headline_json_byid_opt</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectIdGetDatum(<a href="../utils/cache/ts_cache.c.html#L556" title="utils/cache/ts_cache.c:556">getTSCurrentConfig</a>(<span class="Constant">true</span>)),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">0</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_GETARG_DATUM(<span class="Constant">2</span>)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Return headline in text from, generated from a json(b) <a href="../regex/regc_locale.c.html#L376" title="regex/regc_locale.c:376">element</a><br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="Type">static</span> text *<br/></li>
<li><a id="L523">&#x200c;</a><span class="linkable">headline_json_value</span>(<span class="Type">void</span> *_state, <span class="Type">char</span> *elem_value, <span class="Type">int</span> elem_len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L34" title="tsearch/wparser.c:34">HeadlineJsonState</a> *state = (<a href="#L34" title="tsearch/wparser.c:34">HeadlineJsonState</a> *) _state;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; HeadlineParsedText *prs = state-&gt;prs;<br/></li>
<li>&nbsp; &nbsp; TSConfigCacheEntry *cfg = state-&gt;cfg;<br/></li>
<li>&nbsp; &nbsp; TSParserCacheEntry *prsobj = state-&gt;prsobj;<br/></li>
<li>&nbsp; &nbsp; TSQuery&nbsp; &nbsp; &nbsp; &nbsp; query = state-&gt;query;<br/></li>
<li>&nbsp; &nbsp; List&nbsp; &nbsp; &nbsp;&nbsp; *prsoptions = state-&gt;prsoptions;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; prs-&gt;curwords = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="ts_parse.c.html#L540" title="tsearch/ts_parse.c:540">hlparsetext</a>(cfg-&gt;cfgId, prs, query, elem_value, elem_len);<br/></li>
<li>&nbsp; &nbsp; FunctionCall3(&amp;(prsobj-&gt;prsheadline),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PointerGetDatum(prs),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PointerGetDatum(prsoptions),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PointerGetDatum(query));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; state-&gt;transformed = <span class="Constant">true</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ts_parse.c.html#L607" title="tsearch/ts_parse.c:607">generateHeadline</a>(prs);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../index.html">Top Level</a></span>
 </p>

 </body>
</html>
